import{B as H}from"./BaseWrapper-0A6ewZ-i.js";import{u as J,e as R}from"./emitter-DolCq_6G.js";import{u as c}from"./http-w-ez0J3y.js";import{d as q,r,g as Q,f as X,i as Z,c as _,k as t,w as m,u as l,F as ee,o as b,a as i,e as K,m as ae,t as p,b as k,p as W}from"./index-D8N-YEmx.js";import{h as C}from"./moment-C5S46NFB.js";import{s as v}from"./index-CebLASv9.js";import{s as O}from"./index-VDt4N7-Y.js";import{s as y}from"./index-B6p2Nsl_.js";import{s as g}from"./index-BYtqMuz7.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-t--hEgTQ.js";import"./index-PIPAwceg.js";import"./index-DWqkmtiQ.js";const te={class:"prof-container"},se={class:"avatar-wrapper"},ie=["src"],oe={style:{padding:"0",margin:"0","font-size":"30px"}},ne={style:{padding:"0",margin:"0","font-size":"15px","text-align":"center"}},re={style:{padding:"0",margin:"0",display:"flex","flex-flow":"row wrap","align-items":"center","justify-content":"center"}},de={style:{padding:"0",margin:"0","font-size":"11px"}},ue={style:{display:"flex","justify-content":"center",gap:"0.5rem"}},me={key:0,style:{display:"flex","flex-flow":"column",gap:"0.5rem"}},pe={style:{"font-size":"12px",margin:"0",padding:"0"}},ve={key:1,style:{"font-size":"12px",margin:"0",padding:"0"}},fe={key:1,style:{"font-size":"12px",margin:"0",padding:"0"}},ye={style:{display:"flex",gap:"0.5rem","margin-top":"1rem"}},ge={style:{display:"flex","flex-flow":"column",gap:"0.5rem"}},be={style:{display:"flex",gap:"0.5rem","margin-top":"1rem"}},ke={style:{display:"flex","flex-flow":"column",gap:"0.5rem"}},ce={style:{display:"flex",gap:"0.5rem","margin-top":"1rem"}},he=q({__name:"ClientProfile",setup(Pe){const U=r(59),A=r(null),S=J(),d=r({name:"",email:"",dob:"",phone:""}),Y=Q(()=>C().diff(C(d.value.dob),"years")),o=X(),M=r(""),h=r(!1),P=r(!1),j=r(!1),n=r({oldPass:"",newPass:"",confirmPass:""});Z(async()=>{z(),E()});const z=async()=>{await c().httpGet("/users/profile").then(a=>{d.value.name=a.profile.name,d.value.email=a.profile.email,d.value.dob=a.profile.dob,d.value.phone=a.profile.phone,M.value=a.profile.createdAt}).catch(a=>{console.log(a)})},N=()=>{const a=document.createElement("input");a.type="file",a.accept="image/jpeg, image/png",a.click(),a.onchange=e=>{setTimeout(async()=>{o.add({severity:"info",summary:"Mohon tunggu",detail:"Mengunggah foto profil...",life:3e3});const f=new FormData;f.append("image",e.target.files[0]),await c().httpPost("/users/profile/avatar/upload",f).then(s=>{setTimeout(()=>{S.setAvatar(s.fileUrl),o.add({severity:"success",summary:"Berhasil!",detail:"Foto profil diperbarui!",life:3e3})},2e3)}).catch(s=>{console.log(s),o.add({severity:"error",summary:"Gagal!",detail:"Terjadi kesalahan",life:3e3})})},1e3)}},u=r(),D=async()=>{if(u.value.name===""||u.value.dob===""){o.add({severity:"error",summary:"Opss",detail:"Mohon isi semua bidang",life:3e3});return}await c().httpPost("/users/profile/update",u.value).then(a=>{a.status==200&&(o.add({severity:"success",summary:"Berhasil!",detail:a.message,life:3e3}),h.value=!1,z(),R.emit("profileUpdated"))}).catch(a=>{console.log(a),o.add({severity:"error",summary:"Gagal!",detail:a.response.data.message,life:3e3})})},E=async()=>{await c().httpGet("/users/profile/phone/getstate").then(a=>{a.status==200&&(j.value=a.state)}).catch(a=>{console.log(a)}).catch(a=>{console.log(a),o.add({severity:"error",summary:"Gagal!",detail:a.response.data.message,life:3e3})})},$=()=>{h.value=!0,u.value={...d.value}},I=async()=>{if(n.value.oldPass===""||n.value.newPass===""||n.value.confirmPass===""){o.add({severity:"error",summary:"Opss",detail:"Mohon isi semua bidang",life:3e3});return}if(n.value.newPass.length<8){o.add({severity:"error",summary:"Opss",detail:"Sandi baru minimal 8 karakter",life:3e3});return}if(n.value.newPass==n.value.oldPass){o.add({severity:"error",summary:"Opss",detail:"Sandi baru tidak boleh sama dengan sandi lama",life:3e3});return}if(n.value.newPass!==n.value.confirmPass){o.add({severity:"error",summary:"Opss",detail:"Sandi baru tidak sama",life:3e3});return}await c().httpPost("/users/profile/password/update",n.value).then(a=>{o.add({severity:"success",summary:"Berhasil!",detail:a.message,life:3e3}),P.value=!1}).catch(a=>{console.log(a),o.add({severity:"error",summary:"Gagal!",detail:a.response.data.message,life:3e3})})},w=r(!1),x=r(!1),V=r(!1),T=r(),B=r(!1),F=async()=>{G(),!V.value&&(V.value=!0,A.value=setInterval(()=>{U.value>0?U.value--:(clearInterval(A.value),V.value=!1,U.value=59)},1e3))},L=()=>{B.value=!1,w.value=!1,T.value=""},G=async()=>{if(V.value){w.value=!0,x.value=!1;return}x.value=!0,await c().httpGet("/users/profile/phone/verify/otp/send").then(a=>{a.status==200&&(w.value=!0,o.add({severity:"success",summary:"Berhasil!",detail:a.message,life:3e3}),x.value=!1)}).catch(a=>{console.log(a),o.add({severity:"error",summary:"Gagal!",detail:a.response.data.message,life:3e3}),x.value=!1})};return(a,e)=>{const f=ae("fasicon");return b(),_(ee,null,[t(H,null,{default:m(()=>[i("div",te,[i("div",se,[i("img",{src:l(S).getAvatar!=null?l(K).baseUserContent+l(S).getAvatar:l(K).defaultAvatar,alt:"User Avatar"},null,8,ie),i("span",{onClick:N,class:"change-avatar"},[t(f,{icon:"image"})])]),i("h2",oe,p(d.value.name),1),i("p",ne,[i("span",null,p(d.value.phone!=null?d.value.phone:"-"),1)]),i("p",re,[t(f,{icon:"at"}),k("   "+p(d.value.email)+"     ",1),t(f,{icon:"cake-candles"}),k("   "+p(l(C)(d.value.dob).format("DD MMMM YYYY"))+" ("+p(Y.value)+" tahun)",1)]),i("p",de,[t(f,{icon:"door-open"}),k(" bergabung sejak "+p(l(C)(M.value).format("DD MMM YYYY")),1)]),i("div",ue,[t(l(v),{onClick:$,label:"Edit Profil",icon:"pi pi-pencil",style:{width:"150px"}}),t(l(v),{onClick:e[0]||(e[0]=s=>P.value=!0),label:"Ubah Sandi",icon:"pi pi-lock",style:{width:"150px"}})])])]),_:1}),t(l(O),{draggable:!1,closable:!1,visible:B.value,"onUpdate:visible":e[2]||(e[2]=s=>B.value=s),modal:"",header:"Verifikasi No. WhatsApp",style:{width:"30rem"},"close-on-escape":!1,maximizable:!0},{default:m(()=>[w.value?(b(),_("div",me,[t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{id:"over_label",modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=s=>T.value=s),style:{width:"100%"}},null,8,["modelValue"]),e[14]||(e[14]=i("label",{for:"over_label"},"Kode OTP (6 digit)",-1))]),_:1}),i("p",pe,"Kode OTP telah dikirim ke WhatsApp kamu, "+p(d.value.name.split(" ")[0])+". Silahkan masukkan kode OTP untuk memverifikasi. Jika kamu tidak menerima kode OTP, silahkan klik tombol kirim ulang.",1),V.value?(b(),_("p",ve,[e[16]||(e[16]=k("Kode OTP dapat dikirim ulang dalam ")),i("b",null,p(U.value)+" detik",1)])):(b(),_("a",{key:0,onClick:F,href:"javascript:;",style:{color:"orange","text-decoration":"none","font-weight":"bold","font-size":"13px"}},[t(f,{icon:"refresh"}),e[15]||(e[15]=k(" Kirim Ulang OTP "))]))])):(b(),_("p",fe,[k(p(d.value.name.split(" ")[0])+", Kami akan mengirimkan kode OTP ke WhatsApp Kamu. Pastikan Nomor WhatsApp kamu sudah sesuai ya! Kalo kamu ingin ganti atau memperbaiki nomor WhatsApp, klik Edit Profil.",1),e[17]||(e[17]=i("br",null,null,-1)),e[18]||(e[18]=i("br",null,null,-1)),e[19]||(e[19]=k("Silahkan klik tombol kirim untuk mengirimkan kode OTP."))])),i("div",ye,[t(l(v),{type:"button",label:"Batal",severity:"secondary",onClick:L}),w.value?(b(),W(l(v),{key:0,type:"button",label:"Verifikasi",onClick:D})):(b(),W(l(v),{key:1,disabled:x.value,type:"button",label:"Kirim OTP",onClick:G},null,8,["disabled"]))])]),_:1},8,["visible"]),t(l(O),{visible:h.value,"onUpdate:visible":e[8]||(e[8]=s=>h.value=s),modal:"",header:"Perbarui Profil",style:{width:"30rem"},"close-on-escape":!0,maximizable:!0},{default:m(()=>[i("div",ge,[t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{id:"over_label",modelValue:u.value.name,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.name=s),style:{width:"100%"}},null,8,["modelValue"]),e[20]||(e[20]=i("label",{for:"over_label"},"Nama",-1))]),_:1}),t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{disabled:"",id:"over_label",modelValue:u.value.email,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.email=s),style:{width:"100%"}},null,8,["modelValue"]),e[21]||(e[21]=i("label",{for:"over_label"},"E-Mail",-1))]),_:1}),t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{id:"over_label",type:"date",modelValue:u.value.dob,"onUpdate:modelValue":e[5]||(e[5]=s=>u.value.dob=s),style:{width:"100%"}},null,8,["modelValue"]),e[22]||(e[22]=i("label",{for:"over_label"},"Tanggal Lahir",-1))]),_:1}),t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{id:"over_label",type:"text",modelValue:u.value.phone,"onUpdate:modelValue":e[6]||(e[6]=s=>u.value.phone=s),style:{width:"100%"}},null,8,["modelValue"]),e[23]||(e[23]=i("label",{for:"over_label"},"No. WhatsApp",-1))]),_:1})]),i("div",be,[t(l(v),{type:"button",label:"Batal",severity:"secondary",onClick:e[7]||(e[7]=s=>h.value=!1)}),t(l(v),{type:"button",label:"Perbarui",onClick:D})])]),_:1},8,["visible"]),t(l(O),{visible:P.value,"onUpdate:visible":e[13]||(e[13]=s=>P.value=s),modal:"",header:"Ubah Sandi",style:{width:"30rem"},"close-on-escape":!0,maximizable:!0},{default:m(()=>[i("div",ke,[t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{id:"over_label",modelValue:n.value.oldPass,"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.oldPass=s),style:{width:"100%"},type:"password"},null,8,["modelValue"]),e[24]||(e[24]=i("label",{for:"over_label"},"Sandi Lama",-1))]),_:1}),t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{id:"over_label",modelValue:n.value.newPass,"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.newPass=s),style:{width:"100%"},type:"password",min:"8"},null,8,["modelValue"]),e[25]||(e[25]=i("label",{for:"over_label"},"Sandi Baru",-1))]),_:1}),t(l(g),{variant:"in"},{default:m(()=>[t(l(y),{id:"over_label",modelValue:n.value.confirmPass,"onUpdate:modelValue":e[11]||(e[11]=s=>n.value.confirmPass=s),style:{width:"100%"},type:"password"},null,8,["modelValue"]),e[26]||(e[26]=i("label",{for:"over_label"},"Ulangi Sandi Baru",-1))]),_:1})]),i("div",ce,[t(l(v),{type:"button",label:"Batal",severity:"secondary",onClick:e[12]||(e[12]=s=>P.value=!1)}),t(l(v),{type:"button",label:"Perbarui",onClick:I})])]),_:1},8,["visible"])],64)}}}),De=le(he,[["__scopeId","data-v-6495817f"]]);export{De as default};
