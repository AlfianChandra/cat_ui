import{C as le}from"./ContentWrapper--oGUasJX.js";import{u as R,w as ne}from"./xlsx-CygJKsBP.js";import{h as T}from"./moment-C5S46NFB.js";import{h as se}from"./html2canvas.esm-BfYXEYrK.js";import{s as A}from"./index-DCV8vRp8.js";import{s as J}from"./index-CjfwYhiv.js";import{s as oe}from"./index-CDdS95kz.js";import{a as re}from"./index-t--hEgTQ.js";import{a as N,s as H}from"./index-DqS1GraQ.js";import{i as ie}from"./index-Bb6yjXMn.js";import{d as G,r as d,Q as z,i as Q,c as g,o as v,a,F as $,O as W,t as L,b as C,f as de,P as ue,k as r,w as b,u as p,l as ce,m as pe,p as me}from"./index-DjlRODs4.js";import{e as U}from"./index-BUIvxdcM.js";import{t as q}from"./testModel-rqW4HXum.js";import{j as fe}from"./jsonToMarkdown-C5mXda7r.js";import{l as ve}from"./katex-PY4D4bhS.js";import{n as ye,r as ge}from"./markdown-DIQSdFsy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BPhWlg4t.js";import"./index-CWBtyL2U.js";import"./index-B53Thli_.js";import"./index-DhAl9CO3.js";import"./index-D3y5KfKW.js";import"./index-CrUC6E7x.js";import"./index-B4KJCQAh.js";import"./_commonjsHelpers-Cpj98o6Y.js";/* empty css                  */const he={key:0,style:{display:"flex","flex-flow":"column"}},_e={style:{"margin-bottom":"1.5rem","padding-bottom":"1rem","padding-top":"1rem"}},we={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center",gap:"1rem"}},be={style:{margin:"0",padding:"5px","font-size":"13px"}},xe={style:{"font-size":"12px"}},ke={key:1,style:{display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},Se=G({__name:"RadarChartInstance",props:{data:{type:Object,required:!0}},setup(x){const i=x,m=d(null),_=d(null),u=d({tooltip:{},legend:{data:["Jawaban Benar","Jawaban Salah"],left:"center"},color:["#4caf50","#f44336"],radar:{center:["50%","55%"],radius:"55%",indicator:[],shape:"circle",name:{show:!0,textStyle:{fontSize:12,color:"#333",overflow:"break",lineHeight:16}},nameGap:10,splitNumber:5,axisLine:{lineStyle:{color:"#aaa"}},splitLine:{lineStyle:{color:"#aaa"}}},series:[{name:"Jawaban Benar",type:"radar",data:[]},{name:"Jawaban Salah",type:"radar",data:[]}]}),k=()=>new Promise((s,f)=>{try{setTimeout(()=>{m.value&&(_.value=ie(m.value),_.value.setOption(u.value),w())},500)}catch(y){f(y)}}),w=()=>{const s=Object.keys(i.data),f=s.map(P=>i.data[P].correct),y=s.map(P=>i.data[P].incorrect),S=Math.max(...f,...y);u.value.radar.indicator=s.map(P=>({name:P,max:S})),u.value.series[0].data=[{name:"Jawaban Benar",value:f,itemStyle:{color:"#4caf50"},lineStyle:{color:"#4caf50"},areaStyle:{color:"rgba(76, 175, 80, 0.3)"}}],u.value.series[1].data=[{name:"Jawaban Salah",value:y,itemStyle:{color:"#f44336"},lineStyle:{color:"#f44336"},areaStyle:{color:"rgba(244, 67, 54, 0.3)"}}],_.value.setOption(u.value)};return z(()=>[i.data],()=>{k().then(()=>{w()}).catch(s=>{console.error("Error initializing radar chart:",s)})},{deep:!0}),Q(async()=>{await k()}),(s,f)=>Object.keys(i.data).length>0?(v(),g("div",he,[a("div",_e,[a("div",{ref_key:"radarChart",ref:m,style:{width:"100%",height:"400px"}},null,512),a("div",we,[(v(!0),g($,null,W(i.data,(y,S)=>(v(),g("div",{key:S,style:{"text-align":"center",display:"flex","flex-flow":"column","align-items":"center",border:"1px solid #ccc",padding:"10px"}},[a("h4",be,L(y.indicator_name),1),a("span",xe,[f[0]||(f[0]=C("Benar: ")),a("b",null,L(y.correct),1),f[1]||(f[1]=C("   ·   Salah: ")),a("b",null,L(y.incorrect),1)])]))),128))])])])):(v(),g("div",ke,f[2]||(f[2]=[a("img",{style:{filter:"grayscale(1)",opacity:"0.2",width:"250px",height:"250px"},src:"https://thumb.ac-illust.com/90/909be00ebae674a6065df004e1000932_t.jpeg"},null,-1),a("span",{style:{"font-size":"13px","font-weight":"bold"}},"Tidak ada data performa untuk instansi ini",-1)])))}}),F={socketURL:"https://api.imanextgencbt.id/summ",socketPath:"/socket.io"},Ce=()=>{const x=d(null);let i=null,m=null;return{connectHandler:()=>{x.value=ve(F.socketURL,{path:F.socketPath,auth:{token:localStorage.getItem("authToken")||""}}),x.value.on("connect",()=>{console.log("Connected to summ socket"),x.value.on("summ:generate-result",s=>{i==null||i(s)}),x.value.on("summ:generate-result-completed",()=>{m==null||m()})})},setOnDelta:s=>{i=s},sendRecipe:s=>{x.value.emit("summ:generate",s)},setOnCompleted:s=>{m=s}}},Y=Ce(),Le={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Pe={style:{display:"flex","flex-flow":"column",gap:"0.2rem"}},je={style:{display:"flex","flex-flow":"column",gap:"0.2rem"}},He={style:{display:"flex","flex-flow":"column",gap:"0.2rem"}},Me={key:0,style:{display:"flex","flex-flow":"column",width:"100%"}},Oe={key:0},Be={key:1},De={style:{display:"flex","flex-flow":"column","font-size":"13px"}},Te={style:{color:"green"}},Ye={style:{color:"red"}},Re={style:{display:"flex","flex-flow":"column",padding:"15px",border:"1px solid #ccc","margin-top":"1rem"}},Ue={style:{"font-size":"13px",color:"#777","margin-top":"1rem"}},ze={style:{display:"block","margin-top":"1rem",color:"#777","font-size":"13px","font-weight":"bold","text-align":"center"}},$e={id:"captureArea",style:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center"}},Ve={key:0,style:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center",gap:"0.5rem"}},Ie={key:1,style:{display:"flex","flex-flow":"column",width:"100%"}},Ee={style:{display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},Ae=["innerHTML"],yt=G({__name:"LaporanTabular",setup(x){const i=de();ue();const m=d([]),_=d([]),u=d(null),k=d([]),w=d([]),s=d(null);function f(l){const e=ye(l);return ge(e)}const y=d([{label:"Selesai",value:"completed"},{label:"Sedang Berlangsung",value:"in_progress"}]),S=d(y.value[0].value),P=()=>new Promise((l,e)=>{K(),q().getSessions().then(t=>{var c;const n=t.map(o=>({id:o._id,name:o.name,instances:o.instances,questions:o.questions,isStarted:o.isStarted}));m.value=n,_.value=n.map(o=>({label:o.name,value:o.id})),u.value=_.value[0].value,k.value=((c=n.find(o=>o.id===u.value))==null?void 0:c.instances)||[],w.value=k.value.map(o=>({label:o.name,value:o.id})),s.value=w.value[0].value,l(n)}).catch(t=>{e(t)})});z(()=>u.value,l=>{var e;l&&(k.value=((e=m.value.find(t=>t.id===l))==null?void 0:e.instances)||[],w.value=k.value.map(t=>({label:t.name,value:t._id})),s.value=w.value[0].value)});const h=d([]),M=d([]),O=d([]),V=d({});z(()=>[u.value,s.value,S.value],async()=>{if(u.value&&s.value){const l={id_test:u.value,id_instance:s.value,status:S.value};q().getTestParticipantsByInstance(l).then(e=>{M.value=[],O.value=[],V.value=e.result,h.value=e.data,Object.keys(e.total).forEach(t=>{const n={name:t,correct:e.total[t].correct||0,incorrect:e.total[t].incorrect||0};M.value.push(n)}),e.data.forEach(t=>{const n=t.report;O.value.push(n)})}).catch(e=>{i.add({severity:"error",summary:"Oops",detail:e,life:3e3}),h.value=[],M.value=[]})}});const K=()=>{m.value=[],_.value=[],u.value=null},X=()=>{if(h.value.length===0){i.add({severity:"warn",summary:"Peringatan",detail:"Tidak ada data peserta untuk diunduh.",life:3e3});return}const l=R.json_to_sheet(O.value),e=R.book_new();R.book_append_sheet(e,l,"Laporan Peserta");const t=`Laporan_Peserta_${T().format("YYYYMMDD_HHmmss")}.xlsx`;ne(e,t)},j=d({}),Z=()=>{j.value.summ_data=D.value,j.value.radar_image=I.value,j.value.participant=h.value.map(l=>({id:l.participant_data._id,name:l.participant_data.name,session:l.session_data.test_name,status:l.session_data.test_status?"Selesai":"Sedang Berlangsung",answers:l.answers_data,report:l.report,start:T(l.session_data.start).format("YYYY-MM-DD HH:mm:ss"),end:T(l.session_data.end).format("YYYY-MM-DD HH:mm:ss"),token:l.session_data.session_token,participant:l.participant_data})),re.post("https://pdf.imanextgencbt.id/pdf/generate",j.value,{headers:{"Content-Type":"application/json"}}).then(l=>{const e=l.data.data,t=new Blob([Uint8Array.from(atob(e),o=>o.charCodeAt(0))],{type:"application/pdf"}),n=URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download=`Laporan_Peserta_${T().format("YYYYMMDD_HHmmss")}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(n),i.add({severity:"success",summary:"Berhasil",detail:"Laporan PDF berhasil diunduh.",life:3e3}),B.value=!1}).catch(l=>{i.add({severity:"error",summary:"Oops",detail:l,life:3e3})})},B=d(!1),D=d(""),I=d("");Y.setOnDelta(l=>{D.value+=l}),Y.setOnCompleted(()=>{i.add({severity:"success",summary:"Berhasil",detail:"Laporan berhasil dihasilkan.",life:3e3}),Z()});const ee=async()=>{D.value="",j.value={score_aggregation_by_level:M.value,per_participant_score_report:O.value,question_level_description:m.value.find(t=>t.id===u.value).questions,test_data:m.value.find(t=>t.id===u.value)};const e={examResults:fe(j.value)};Y.sendRecipe(e),B.value=!0,te("captureArea").then(t=>{I.value=t,console.log(t)}).catch(t=>{i.add({severity:"error",summary:"Error",detail:t,life:3e3})})},te=l=>new Promise((e,t)=>{const n=document.getElementById(l);if(!n){i.add({severity:"error",summary:"Error",detail:"Area not found",life:3e3});return}se(n,{scale:6}).then(c=>{e(c.toDataURL("image/jpeg"))}).catch(c=>{t(c),i.add({severity:"error",summary:"Error",detail:c.message,life:3e3})})});return Q(async()=>{await P(),Y.connectHandler()}),(l,e)=>{const t=pe("fasicon");return v(),g($,null,[r(le,{"content-title":"Laporan Tabel"},{default:b(()=>[a("div",Le,[a("div",Pe,[e[4]||(e[4]=a("label",{style:{"font-size":"12px","font-weight":"bold"}},"Sesi",-1)),r(p(U),{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value=n),options:_.value,"option-label":"label","option-value":"value",placeholder:"Pilih Test",class:"w-full md:w-14rem"},null,8,["modelValue","options"])]),a("div",je,[e[5]||(e[5]=a("label",{style:{"font-size":"12px","font-weight":"bold"}},"Instansi",-1)),r(p(U),{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=n=>s.value=n),options:w.value,"option-label":"label","option-value":"value",placeholder:"Pilih Instansi",class:"w-full md:w-14rem ml-2"},null,8,["modelValue","options"])]),a("div",He,[e[6]||(e[6]=a("label",{style:{"font-size":"12px","font-weight":"bold"}},"Status",-1)),r(p(U),{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=n=>S.value=n),options:y.value,"option-label":"label","option-value":"value",placeholder:"Pilih Status",class:"w-full md:w-14rem ml-2"},null,8,["modelValue","options"])])]),h.value.length>0?(v(),g("div",Me,[r(p(N),{value:h.value,class:"mt-3",style:{"margin-top":"1rem"}},{default:b(()=>{var n,c;return[r(p(H),{header:"Peserta"},{body:b(({data:o})=>[C(L(o.participant_data.name),1)]),_:1}),r(p(H),{header:"Status"},{body:b(({data:o})=>[o.session_data.test_status?(v(),g("span",Oe,[r(t,{style:{color:"green"},icon:"check-circle"})])):(v(),g("span",Be,[r(t,{icon:"clock"})]))]),_:1}),(v(!0),g($,null,W(((c=(n=h.value[0])==null?void 0:n.session_data)==null?void 0:c.payload)||[],(o,ae)=>(v(),me(p(H),{key:ae,header:o.name},{body:b(({data:E})=>[a("div",De,[a("span",Te,[e[7]||(e[7]=C("Benar: ")),a("b",null,L(E.answers_data[o.name].correct),1)]),a("span",Ye,[e[8]||(e[8]=C("Salah: ")),a("b",null,L(E.answers_data[o.name].incorrect),1)])])]),_:2},1032,["header"]))),128))]}),_:1},8,["value"]),a("div",Re,[e[9]||(e[9]=a("h4",{style:{margin:"0","margin-bottom":"1rem"}},"Akumulasi Skor",-1)),r(p(N),{value:M.value,class:"mt-3"},{default:b(()=>[r(p(H),{field:"name",header:"Level",style:{"font-weight":"bold"}}),r(p(H),{field:"correct",header:"Benar",style:{color:"green"}}),r(p(H),{field:"incorrect",header:"Salah",style:{color:"red"}})]),_:1},8,["value"]),a("span",Ue,"Akumulasi berdasarkan data dari "+L(h.value.length)+" peserta.",1)]),a("span",ze,[r(t,{icon:"users"}),C("   "+L(h.value.length)+" peserta ditampilkan",1)]),r(p(J)),a("div",$e,[r(Se,{data:V.value},null,8,["data"])]),r(p(J)),h.value.length>0?(v(),g("div",Ve,[r(p(A),{style:{width:"210px",padding:"12px"},onClick:X},{default:b(()=>[r(t,{icon:"file-excel",style:{width:"fit-content"}}),e[10]||(e[10]=C(" Unduh Spreadsheet"))]),_:1}),r(p(A),{style:{width:"210px",padding:"12px"},onClick:ee},{default:b(()=>[r(t,{icon:"file-pdf",style:{width:"fit-content"}}),e[11]||(e[11]=C(" Unduh PDF"))]),_:1})])):ce("",!0)])):(v(),g("div",Ie,e[12]||(e[12]=[a("div",{style:{display:"flex","flex-flow":"column","align-items":"center","margin-top":"2rem"}},[a("img",{style:{width:"250px",height:"250px","object-fit":"contain"},src:"https://assets-v2.lottiefiles.com/a/f0470cd6-117f-11ee-a4ed-1b2d7fb6aaaf/i83iUdPISg.gif"}),a("span",{style:{"font-size":"1.2rem","font-weight":"bold",color:"#777"}},"Tidak ada data peserta yang ditemukan"),a("span",{style:{"font-size":"0.9rem",color:"#777"}},"Silakan pilih sesi dan instansi yang valid.")],-1)])))]),_:1}),r(p(oe),{header:"Insight",visible:B.value,"onUpdate:visible":e[3]||(e[3]=n=>B.value=n),modal:!0,"close-on-click-modal":!1,style:{width:"35vw"}},{default:b(()=>[a("div",Ee,[e[13]||(e[13]=a("img",{src:"https://cdn-icons-gif.flaticon.com/10971/10971743.gif",style:{width:"150px",height:"150px"}},null,-1)),e[14]||(e[14]=a("h3",{style:{"text-align":"center",margin:"0",padding:"0"}},"Menganalisis...",-1)),e[15]||(e[15]=a("p",{style:{"text-align":"center",margin:"0"}},"Laporan akan siap dalam beberapa saat",-1)),a("p",{innerHTML:f(D.value)},null,8,Ae)])]),_:1},8,["visible"])],64)}}});export{yt as default};
