import{d as Me,f as Le,r as m,Q as oe,i as Te,j as je,c as d,k as l,w as f,u as r,F as S,o as u,a,p as Ae,b as v,t as p,l as C,m as Be,e as He,O as D,a6 as le}from"./index-DqRkhza9.js";import{a as Ue}from"./index-t--hEgTQ.js";import{h as De}from"./html2canvas.esm-BfYXEYrK.js";import{s as F}from"./index-Co-HF27q.js";import{s as h,a as re}from"./index-DxP0_fhd.js";import{h as P}from"./moment-C5S46NFB.js";import{i as Pe}from"./index-Bb6yjXMn.js";import{j as W}from"./jsonToMarkdown-C5mXda7r.js";import{s as K}from"./index-C8qxWQ22.js";import{s as Q}from"./index-CfrhmY15.js";import{e as ie}from"./index-DmFruwkt.js";import{C as Ve}from"./ContentWrapper-CmaYFmc6.js";import{t as G}from"./testModel-DxajHVIc.js";import{l as ze}from"./katex-PY4D4bhS.js";import{n as Ie,r as $e}from"./markdown-DIQSdFsy.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DWeKTkUq.js";import"./index-CUp9M6KZ.js";import"./index-CWVsYdVf.js";import"./index-D-BuL_aB.js";import"./index-CRqeUXnY.js";import"./index-dA8qzKJU.js";import"./index-j--27cNB.js";import"./_commonjsHelpers-Cpj98o6Y.js";/* empty css                  */const Ye={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Re={key:0},Je={key:1},Ee={key:0},Oe={key:1},Fe={key:1,style:{"margin-top":"1rem",display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},We={style:{display:"flex","flex-flow":"row wrap","align-items":"center",gap:"0.5rem","justify-content":"center"}},Ke={style:{padding:"20px"}},Qe=["src"],Ge={style:{display:"flex","flex-flow":"column"}},Ze={style:{margin:"0",padding:"0"}},Xe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},et={style:{display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},tt={style:{"font-size":"1.5rem","font-weight":"bold"}},at={key:0},st={class:"mtable",style:{"margin-top":"1rem"}},nt={style:{width:"10px","text-align":"center"}},ot={key:0,style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},lt={key:0,"data-is-correct":"true"},rt={style:{color:"green"}},it=["innerHTML"],ut={key:1,"data-is-correct":"false"},dt={style:{color:"red"}},pt=["innerHTML"],ct={key:2},mt=["onClick"],vt={key:1},ft={style:{display:"flex","flex-flow":"column",width:"100%","margin-top":"1rem"}},yt={style:{display:"flex","flex-flow":"column","justify-content":"space-between",width:"100%","align-items":"center"}},gt={style:{color:"green","font-weight":"bold"}},ht={style:{color:"red","font-weight":"bold"}},wt={style:{display:"flex","flex-flow":"column","word-wrap":"break-word"}},bt=["innerHTML"],_t={style:{display:"flex","flex-flow":"column",gap:".3rem"}},kt=["innerHTML"],xt={key:0},Ct={key:1},qt=["innerHTML"],St={key:2,style:{color:"red"}},Mt=["innerHTML"],Lt={style:{"font-size":"12px"}},Tt=["innerHTML"],jt=Me({__name:"SessionsMonitoring",setup(At){const q=Le(),y=m(null),Z={socketURL:"https://api.imanextgencbt.id",socketPath:"/socket.io"},M=m(null),V=m(null),L=m({title:{text:"Ikhtisar",left:"center",top:10,textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{},legend:{data:["Jawaban Benar","Jawaban Salah"],top:40,left:"center"},radar:{center:["50%","55%"],radius:"55%",indicator:[],shape:"circle",name:{show:!0,textStyle:{fontSize:12,color:"#333",overflow:"break",lineHeight:16}},nameGap:10,splitNumber:5,axisLine:{lineStyle:{color:"#aaa"}},splitLine:{lineStyle:{color:"#aaa"}}},series:[{name:"Jawaban Benar",type:"radar",data:[]}]}),T=m([]),z=m([]),j=m([]),_=m(null),X=m([]),A=m([]),k=m(null),ue=()=>new Promise((o,e)=>{setTimeout(()=>{if(M.value)try{V.value=Pe(M.value),V.value.setOption(L.value),console.log(M.value),o(!0)}catch(s){e(s)}},1e3)});function de(o){const e=Ie(o);return $e(e)}const pe=()=>{ce(),G().getSessions().then(o=>{const e=o.map(s=>({id:s._id,name:s.name,instances:s.instances,questions:s.questions,isStarted:s.isStarted}));z.value=e,j.value=e.map(s=>({label:s.name,value:s.id})),_.value=j.value[0].value}).catch(o=>{console.error(o)})},ce=()=>{z.value=[],j.value=[],_.value=null,X.value=[],A.value=[],k.value=null};oe(()=>_.value,()=>{var e;const o=((e=z.value.find(s=>s.id===_.value))==null?void 0:e.instances)||[];X.value=o,A.value=o.map(s=>({label:s.name,value:s._id})),k.value=A.value[0].value}),oe(()=>k.value,()=>{me()});const me=()=>{const o={id_test:_.value,id_instance:k.value};G().getUserSessions(o).then(e=>{T.value=e}).catch(e=>{T.value=[]})},I=m(!1),i=m({}),B=m({}),$=m([]),b=m([]),ve=async o=>{I.value=!0,i.value=o,B.value.question_categories=o.question.categories,B.value.question_items=o.question.payload;const e=o.question.payload.reduce((s,t)=>t.questions.length>s.questions.length?t:s).questions;$.value=e,console.log(o,i.value,$.value),b.value=[];for(let s=0;s<i.value.question.payload.length;s++){const t=i.value.question.payload[s];t.questions.length>0&&b.value.push({name:t.name,total:t.questions.length,correct:t.questions.filter(n=>n.result.isCorrect).length,incorrect:t.questions.filter(n=>n.result.answer!==null&&!n.result.isCorrect).length,not_taken:t.questions.filter(n=>n.result.answer===null&&n.result.isCorrect===!1).length})}ue().then(()=>{const s=Math.max(...b.value.map(t=>t.correct||0));L.value.radar.indicator=b.value.map(t=>({name:t.name,max:s>0?s:1})),L.value.series=[{name:"Jawaban Benar",type:"radar",data:[{value:b.value.map(t=>t.correct),name:"Jawaban Benar"}],areaStyle:{opacity:.1}}],V.value.setOption(L.value)}).catch(s=>{console.error(s)})},N=m(!1),g=m({}),fe=o=>{g.value.user_answer=o,ye(o.id_question)},ye=o=>{const e={id_question:o};G().getSoalData(e).then(s=>{g.value.soal=s,N.value=!0}).catch(s=>{console.error(s),q.add({severity:"error",summary:"Error",detail:s,life:3e3})})},Y=m(!1),H=m(""),ge=()=>{var c;H.value="";const o=W(b.value),e=W(i.value.participant_data.profile),s=he(".mtable"),t=W(s);let n=`### Detail Peserta (Jangan sebut informasi tidak perlu):
${e}

`;n+=`### Hasil Ujian. Terdapat level soal. Misal C3, C4, C5, dst, sesuai prinsip Computerized Adaptive Test: 
${t}

`,n+=`### Skor Insight:
${o}

`;const w={from:"sessions-monitoring",prompt:`
    Analisis dokumen hasil ujian peserta berikut ini. Cukup berikan hasil analisisnya saja, jangan tawarkan pertanyaan atau penjelasan lebih lanjut.
    Fokus pada analisis hasil ujian peserta.
    Kecualikan dari analisis untuk data soal yang tidak dijawab karena tidak dibutuhkan pada Computerized Adaptive Test, tidak menjawab artinya peserta tidak menguasai level tersebut atau karena sedang mengerjakan soal di level yang lebih tinggi.
    Analisis pola jawaban peserta: Letak benar dan salah, dan berikan insight tentang pola tersebut.
    Berikan kesimpulan estimasi kemampuan peserta dalam persentase.
    Buat kedalam format yang ramah untuk ditampilkan ke dokumen PDF. Gunakan heading dan poin-poin
    `,payload:n};(c=y.value)==null||c.emit("socket-analyzer:send-data",w),Y.value=!0};function he(o){const e=document.querySelector(o);if(!e)throw new Error("Table gak ketemu broh, cek selector-nya.");const t=Array.from(e.querySelectorAll("thead th")).slice(1).map(c=>{var x;return((x=c.textContent)==null?void 0:x.trim())||""}),n=[];return Array.from(e.querySelectorAll("tbody tr")).forEach(c=>{var ee,te;const x=Array.from(c.querySelectorAll("td")),xe=((te=(ee=x[0])==null?void 0:ee.textContent)==null?void 0:te.trim())||"",Ce=parseInt(xe,10)||0,qe=t.map((ae,Se)=>{var se,ne;const R=x[Se+1];if(!R)return{categoryName:ae,answer:null,isCorrect:!1};let J="-",E=!1;const O=R.querySelector("span[data-is-correct]");if(O)E=O.getAttribute("data-is-correct")==="true",J=((se=O.textContent)==null?void 0:se.trim())||null;else{const U=((ne=R.textContent)==null?void 0:ne.trim())||"";U&&U!=="-"&&(J=U,E=!1)}return{categoryName:ae,answer:J,isCorrect:E}});n.push({no:Ce,perCategory:qe})}),{rows:n}}const we=()=>{y.value&&(y.value.off(),y.value.disconnect()),y.value=ze(`${Z.socketURL}/analyzer`,{path:Z.socketPath}),y.value.on("connect",()=>{console.log("Connected to socket: ANALYZER NS"),be()})},be=()=>{var o,e;(o=y.value)==null||o.on("socket-analyzer:on-response",s=>{H.value+=s.data.content}),(e=y.value)==null||e.on("socket-analyzer:on-response-end",()=>{console.log("Response ended")})},_e=o=>new Promise((e,s)=>{const t=document.getElementById(o);if(!t){q.add({severity:"error",summary:"Error",detail:"Area not found",life:3e3});return}De(t,{scale:6}).then(n=>{e(n.toDataURL("image/jpeg"))}).catch(n=>{s(n),q.add({severity:"error",summary:"Error",detail:n.message,life:3e3})})}),ke=async()=>{let o={score_insight:b.value,ai_response:H.value,participant:i.value.participant_data.profile,radar_chart:await _e("captureArea").then(e=>e)};Ue.post("https://pdf.imanextgencbt.id/pdf/individual/generate",o,{headers:{"Content-Type":"application/json"}}).then(e=>{const s=e.data.data,t=new Blob([Uint8Array.from(atob(s),c=>c.charCodeAt(0))],{type:"application/pdf"}),n=URL.createObjectURL(t),w=document.createElement("a");w.href=n,w.download=`Laporan_Peserta_${P().format("YYYYMMDD_HHmmss")}.pdf`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(n),q.add({severity:"success",summary:"Berhasil",detail:"Laporan PDF berhasil diunduh.",life:3e3})}).catch(e=>{q.add({severity:"error",summary:"Oops",detail:e,life:3e3})})};return Te(()=>{pe(),we()}),je(()=>{y.value&&(y.value.off(),y.value.disconnect(),y.value=null)}),(o,e)=>{const s=Be("fasicon");return u(),d(S,null,[l(Ve,{contentTitle:"Monitoring Ujian"},{default:f(()=>[a("div",Ye,[l(r(ie),{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),options:j.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Sesi Ujian",class:"w-full mb-4"},null,8,["modelValue","options"]),l(r(ie),{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),options:A.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Instansi",class:"w-full mb-4"},null,8,["modelValue","options"])]),T.value.length>0?(u(),Ae(r(re),{key:0,style:{"margin-top":"1rem"},value:T.value,paginator:!0,rows:20,rowsPerPageOptions:[10,20,50],dataKey:"_id"},{default:f(()=>[l(r(h),{header:"Nama"},{body:f(({data:t})=>[v(p(t.participant_data.meta.name),1)]),_:1}),l(r(h),{header:"Kelas"},{body:f(({data:t})=>[v(p(t.participant_data.meta.kelas),1)]),_:1}),l(r(h),{header:"Jurusan"},{body:f(({data:t})=>[v(p(t.participant_data.meta.jurusan),1)]),_:1}),l(r(h),{header:"Mulai"},{body:f(({data:t})=>[v(p(r(P)(t.start).format("DD MMM YYYY -- hh:mm")+" WIB"),1)]),_:1}),l(r(h),{header:"Progres"},{body:f(({data:t})=>[t.test_status==="in_progress"?(u(),d("span",Re,"Berlangsung")):C("",!0),t.test_status==="completed"?(u(),d("span",Je,"Selesai")):C("",!0)]),_:1}),l(r(h),{header:"Soal"},{body:f(({data:t})=>[t.test_status!=="completed"?(u(),d("span",Ee,p(t.state.current_question)+" / "+p(t.question_done.length),1)):(u(),d("span",Oe,[l(s,{icon:"check-circle"})]))]),_:1}),l(r(h),{header:"Aksi"},{body:f(({data:t})=>[l(r(F),{onClick:n=>ve(t)},{default:f(()=>e[5]||(e[5]=[v("Detail")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value"])):(u(),d("div",Fe,e[6]||(e[6]=[a("img",{style:{width:"250px",height:"250px","object-fit":"contain"},src:"https://assets-v2.lottiefiles.com/a/f0470cd6-117f-11ee-a4ed-1b2d7fb6aaaf/i83iUdPISg.gif"},null,-1),a("h3",{style:{"text-align":"center",margin:"0"}},"Belum ada yang tersedia data untuk ditampilkan",-1)])))]),_:1}),l(r(K),{visible:I.value,"onUpdate:visible":e[2]||(e[2]=t=>I.value=t),modal:!0,header:"Detail Sesi Ujian",style:{width:"90vw"}},{default:f(()=>[a("div",We,[a("div",Ke,[a("img",{src:`${r(He).baseUserContent}${i.value.participant_data.profile.avatar}`,alt:"Participant Photo",style:{width:"200px",height:"200px","border-radius":"50%","object-fit":"cover",border:"8px solid #eee","box-shadow":"5px 5px 20px rgba(0,0,0,0.5)"}},null,8,Qe)]),a("div",Ge,[a("h1",Ze,p(i.value.participant_data.profile.name),1),a("div",Xe,[a("span",null,[e[7]||(e[7]=v("Kelas: ")),a("b",null,p(i.value.participant_data.meta.kelas),1)]),e[9]||(e[9]=v("  ·  ")),a("span",null,[e[8]||(e[8]=v("Jurusan: ")),a("b",null,p(i.value.participant_data.meta.jurusan),1)])]),a("span",null,[e[10]||(e[10]=v("Dimulai: ")),a("b",null,p(r(P)(i.value.start).format("DD MMM YYYY -- hh:mm")+" WIB"),1)]),a("span",null,[e[11]||(e[11]=v("Berakhir: ")),a("b",null,p(i.value.test_status==="completed"?"Selesai":r(P)(i.value.end).fromNow()),1)]),l(r(F),{onClick:ge,style:{width:"120px","margin-top":"1rem","font-size":"13px"}},{default:f(()=>e[12]||(e[12]=[v("Analisis Hasil")])),_:1})]),l(r(Q)),a("div",et,[a("span",tt,p(i.value.test_status==="in_progress"?"Asesmen Sedang Berlangsung":"Asesmen Selesai"),1),i.value.test_status==="in_progress"?(u(),d("span",at,[e[13]||(e[13]=v("Soal yang dikerjakan: ")),a("b",null,p(i.value.state.current_question)+" / "+p(i.value.question_done.length),1)])):C("",!0)]),a("table",st,[a("thead",null,[a("tr",null,[e[14]||(e[14]=a("th",{style:{"text-align":"center"}},"No",-1)),(u(!0),d(S,null,D(B.value.question_categories,(t,n)=>(u(),d("th",{style:{"text-align":"left"},key:n},p(t.name),1))),128))])]),a("tbody",null,[(u(!0),d(S,null,D($.value,(t,n)=>(u(),d("tr",{key:n},[a("td",nt,p(n+1),1),(u(!0),d(S,null,D(B.value.question_categories,(w,c)=>(u(),d("td",{style:{width:"50%"},key:c},[a("div",null,[i.value.question.payload[c].questions[n]!==void 0?(u(),d("div",ot,[i.value.question.payload[c].questions[n].result.answer!=null&&i.value.question.payload[c].questions[n].result.isCorrect?(u(),d("span",lt,[a("span",rt,[l(s,{icon:"check-circle"}),e[15]||(e[15]=v()),a("span",{innerHTML:i.value.question.payload[c].questions[n].result.answer},null,8,it)])])):C("",!0),i.value.question.payload[c].questions[n].result.answer!=null&&!i.value.question.payload[c].questions[n].result.isCorrect?(u(),d("span",ut,[a("span",dt,[l(s,{icon:"times-circle"}),e[16]||(e[16]=v()),a("span",{innerHTML:i.value.question.payload[c].questions[n].result.answer},null,8,pt)])])):C("",!0),!i.value.question.payload[c].questions[n].result.answer&&!i.value.question.payload[c].questions[n].result.isCorrect?(u(),d("span",ct,"-")):C("",!0),a("button",{onClick:x=>fe(i.value.question.payload[c].questions[n]),style:{width:"30px",height:"30px",background:"transparent",border:"1px solid #ccc",color:"#888",cursor:"pointer","border-radius":"5px"}},[l(s,{icon:"search"})],8,mt)])):(u(),d("div",vt,e[17]||(e[17]=[a("span",{style:{"font-weight":"bold",color:"#aaa"}},"N/A",-1)])))])]))),128))]))),128))])]),a("div",ft,[e[19]||(e[19]=a("h2",{style:{margin:"0",padding:"0"}},"Test Insight:",-1)),a("div",yt,[l(r(re),{value:b.value,dataKey:"name",style:{width:"100%","margin-top":"1rem"}},{default:f(()=>[l(r(h),{field:"name",header:"Level"}),l(r(h),{field:"correct",header:"Benar"}),l(r(h),{field:"incorrect",header:"Salah"}),l(r(h),{header:"%"},{body:f(({data:t})=>[a("span",gt,p((t.correct/t.total*100).toFixed(2))+"%",1),e[18]||(e[18]=v("    ·    ")),a("span",ht,p((t.incorrect/t.total*100).toFixed(2))+"%",1)]),_:1})]),_:1},8,["value"]),a("div",{id:"captureArea",ref_key:"radarContainer",ref:M,style:{width:"400px",height:"400px","margin-top":"1.5rem"}},null,512)])])])]),_:1},8,["visible"]),l(r(K),{closable:!0,visible:N.value,"onUpdate:visible":e[3]||(e[3]=t=>N.value=t),modal:!0,header:"Soal",style:{width:"40rem"}},{default:f(()=>[a("div",wt,[a("div",{innerHTML:g.value.soal.soal,style:{"margin-bottom":"1rem"}},null,8,bt),a("div",_t,[(u(!0),d(S,null,D(g.value.soal.answers,(t,n)=>(u(),d("div",{key:n,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem","box-shadow":"5px 5px 20px rgba(0,0,0,0.2)",padding:"10px","border-radius":"10px"}},[a("span",{style:le([{background:`${t.is_correct?"green":"#555"}`},{overflow:"clip","font-size":"13px",width:"30px",height:"30px",display:"flex","justify-content":"center","align-items":"center","font-weight":"bold","border-radius":"50%",color:"#fff"}])},p(String.fromCharCode(65+n)),5),a("span",{style:le([{color:`${t.is_correct?"green":"#555"}`},{"margin-left":"0.5rem",width:"80%","font-size":"13px"}]),innerHTML:t.value},null,12,kt)]))),128))]),l(r(Q)),e[24]||(e[24]=v(" Jawaban Peserta: ")),g.value.user_answer.result.answer==null?(u(),d("span",xt,e[20]||(e[20]=[a("b",null,"Tidak/Belum Menjawab",-1)]))):g.value.user_answer.result.isCorrect?(u(),d("span",Ct,[a("b",{style:{color:"green"},innerHTML:g.value.user_answer.result.answer},null,8,qt)])):(u(),d("span",St,[a("b",{innerHTML:g.value.user_answer.result.answer},null,8,Mt)])),l(r(Q)),a("span",Lt,[a("code",null,[e[21]||(e[21]=v("QID: ")),a("b",null,p(g.value.soal._id),1),e[22]||(e[22]=v(" | Level: ")),a("b",null,p(g.value.user_answer.level),1),e[23]||(e[23]=v(" | Time Taken: ")),a("b",null,p(g.value.user_answer.result.time_taken?g.value.user_answer.result.time_taken+" seconds":"not recorded"),1)])])])]),_:1},8,["visible"]),l(r(K),{closable:!0,visible:Y.value,"onUpdate:visible":e[4]||(e[4]=t=>Y.value=t),modal:!0,header:"Hasil Analisis AI",style:{width:"40rem"}},{default:f(()=>[a("p",{innerHTML:de(H.value),style:{"white-space":"pre-wrap","word-wrap":"break-word"}},null,8,Tt),l(r(F),{onClick:ke,style:{"margin-top":"1rem"}},{default:f(()=>e[25]||(e[25]=[v("Download Laporan")])),_:1})]),_:1},8,["visible"])],64)}}}),sa=Ne(jt,[["__scopeId","data-v-f0d0e8bd"]]);export{sa as default};
