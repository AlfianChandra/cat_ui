import{C as ae}from"./ContentWrapper-DlMdTUjN.js";import{u as H,w as le}from"./xlsx-CygJKsBP.js";import{h as Y}from"./moment-C5S46NFB.js";import{h as se}from"./html2canvas.esm-BfYXEYrK.js";import{s as E}from"./index-rh8fCLP3.js";import{s as A}from"./index-CD8Q60NI.js";import{s as oe}from"./index-piERbzvQ.js";import{a as ne}from"./index-t--hEgTQ.js";import{a as J,s as P}from"./index-Cng0D3wH.js";import{i as re}from"./index-Bb6yjXMn.js";import{d as F,r as d,S as T,i as G,c as g,o as h,a,F as $,O as Q,t as C,b as S,f as ie,Q as de,k as r,w as b,u as m,l as ce,m as ue,p as pe}from"./index-bioeAiyt.js";import{e as M}from"./index-CcbwDcOD.js";import{t as N}from"./testModel-PlmHZ5on.js";import{j as me}from"./jsonToMarkdown-C5mXda7r.js";import{l as fe}from"./index-BLRFddlS.js";import"./markdown-DiUCvktl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DhhDt_K-.js";import"./index-bhv4XlLD.js";import"./index-Bgv-j1VE.js";import"./index-L43QG1jP.js";import"./index-CW6tAiIF.js";import"./index-Bijw0uEp.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./katex-DhIX2AT_.js";/* empty css                  */const ve={key:0,style:{display:"flex","flex-flow":"column"}},ye={style:{"margin-bottom":"1.5rem","padding-bottom":"1rem","padding-top":"1rem"}},he={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center",gap:"1rem"}},ge={style:{margin:"0",padding:"5px","font-size":"13px"}},_e={style:{"font-size":"12px"}},we={key:1,style:{display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},be=F({__name:"RadarChartInstance",props:{data:{type:Object,required:!0}},setup(x){const i=x,f=d(null),_=d(null),c=d({tooltip:{},legend:{data:["Jawaban Benar","Jawaban Salah"],left:"center"},color:["#4caf50","#f44336"],radar:{center:["50%","55%"],radius:"55%",indicator:[],shape:"circle",name:{show:!0,textStyle:{fontSize:12,color:"#333",overflow:"break",lineHeight:16}},nameGap:10,splitNumber:5,axisLine:{lineStyle:{color:"#aaa"}},splitLine:{lineStyle:{color:"#aaa"}}},series:[{name:"Jawaban Benar",type:"radar",data:[]},{name:"Jawaban Salah",type:"radar",data:[]}]}),k=()=>new Promise((o,v)=>{try{setTimeout(()=>{f.value&&(_.value=re(f.value),_.value.setOption(c.value),w())},500)}catch(y){v(y)}}),w=()=>{const o=Object.keys(i.data),v=o.map(u=>i.data[u].correct),y=o.map(u=>i.data[u].incorrect),j=Math.max(...v,...y);c.value.radar.indicator=o.map(u=>({name:u,max:j})),c.value.series[0].data=[{name:"Jawaban Benar",value:v,itemStyle:{color:"#4caf50"},lineStyle:{color:"#4caf50"},areaStyle:{color:"rgba(76, 175, 80, 0.3)"}}],c.value.series[1].data=[{name:"Jawaban Salah",value:y,itemStyle:{color:"#f44336"},lineStyle:{color:"#f44336"},areaStyle:{color:"rgba(244, 67, 54, 0.3)"}}],_.value.setOption(c.value)};return T(()=>[i.data],()=>{k().then(()=>{w()}).catch(o=>{console.error("Error initializing radar chart:",o)})},{deep:!0}),G(async()=>{await k()}),(o,v)=>Object.keys(i.data).length>0?(h(),g("div",ve,[a("div",ye,[a("div",{ref_key:"radarChart",ref:f,style:{width:"100%",height:"400px"}},null,512),a("div",he,[(h(!0),g($,null,Q(i.data,(y,j)=>(h(),g("div",{key:j,style:{"text-align":"center",display:"flex","flex-flow":"column","align-items":"center",border:"1px solid #ccc",padding:"10px"}},[a("h4",ge,C(y.indicator_name),1),a("span",_e,[v[0]||(v[0]=S("Benar: ")),a("b",null,C(y.correct),1),v[1]||(v[1]=S("   ·   Salah: ")),a("b",null,C(y.incorrect),1)])]))),128))])])])):(h(),g("div",we,v[2]||(v[2]=[a("img",{style:{filter:"grayscale(1)",opacity:"0.2",width:"250px",height:"250px"},src:"https://thumb.ac-illust.com/90/909be00ebae674a6065df004e1000932_t.jpeg"},null,-1),a("span",{style:{"font-size":"13px","font-weight":"bold"}},"Tidak ada data performa untuk instansi ini",-1)])))}}),q={socketURL:"http://localhost:2512/summ",socketPath:"/socket.io"},xe=()=>{const x=d(null);let i=null,f=null;return{connectHandler:()=>{x.value=fe(q.socketURL,{path:q.socketPath,auth:{token:localStorage.getItem("authToken")||""}}),x.value.on("connect",()=>{console.log("Connected to summ socket"),x.value.on("summ:generate-result",o=>{i==null||i(o)}),x.value.on("summ:generate-result-completed",()=>{f==null||f()})})},setOnDelta:o=>{i=o},sendRecipe:o=>{x.value.emit("summ:generate",o)},setOnCompleted:o=>{f=o}}},R=xe(),ke={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Se={style:{display:"flex","flex-flow":"column",gap:"0.2rem"}},Ce={style:{display:"flex","flex-flow":"column",gap:"0.2rem"}},Le={style:{display:"flex","flex-flow":"column",gap:"0.2rem"}},Pe={key:0,style:{display:"flex","flex-flow":"column",width:"100%"}},je={key:0},Oe={key:1},Be={style:{display:"flex","flex-flow":"column","font-size":"13px"}},De={style:{color:"green"}},Ye={style:{color:"red"}},Re={style:{display:"flex","flex-flow":"column",padding:"15px",border:"1px solid #ccc","margin-top":"1rem"}},Ue={style:{"font-size":"13px",color:"#777","margin-top":"1rem"}},He={style:{display:"block","margin-top":"1rem",color:"#777","font-size":"13px","font-weight":"bold","text-align":"center"}},Me={id:"captureArea",style:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center"}},Te={key:0,style:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center",gap:"0.5rem"}},$e={key:1,style:{display:"flex","flex-flow":"column",width:"100%"}},ut=F({__name:"LaporanTabular",setup(x){const i=ie();de();const f=d([]),_=d([]),c=d(null),k=d([]),w=d([]),o=d(null),v=d([{label:"Selesai",value:"completed"},{label:"Sedang Berlangsung",value:"in_progress"}]),y=d(v.value[0].value),j=()=>new Promise((l,e)=>{W(),N().getSessions().then(t=>{var p;const s=t.map(n=>({id:n._id,name:n.name,instances:n.instances,questions:n.questions,isStarted:n.isStarted}));f.value=s,_.value=s.map(n=>({label:n.name,value:n.id})),c.value=_.value[0].value,k.value=((p=s.find(n=>n.id===c.value))==null?void 0:p.instances)||[],w.value=k.value.map(n=>({label:n.name,value:n.id})),o.value=w.value[0].value,l(s)}).catch(t=>{e(t)})});T(()=>c.value,l=>{var e;l&&(k.value=((e=f.value.find(t=>t.id===l))==null?void 0:e.instances)||[],w.value=k.value.map(t=>({label:t.name,value:t._id})),o.value=w.value[0].value)});const u=d([]),O=d([]),B=d([]),z=d({});T(()=>[c.value,o.value,y.value],async()=>{if(c.value&&o.value){const l={id_test:c.value,id_instance:o.value,status:y.value};N().getTestParticipantsByInstance(l).then(e=>{O.value=[],B.value=[],z.value=e.result,u.value=e.data,Object.keys(e.total).forEach(t=>{const s={name:t,correct:e.total[t].correct||0,incorrect:e.total[t].incorrect||0};O.value.push(s)}),e.data.forEach(t=>{const s=t.report;B.value.push(s)})}).catch(e=>{i.add({severity:"error",summary:"Oops",detail:e,life:3e3}),u.value=[],O.value=[]})}});const W=()=>{f.value=[],_.value=[],c.value=null},K=()=>{if(u.value.length===0){i.add({severity:"warn",summary:"Peringatan",detail:"Tidak ada data peserta untuk diunduh.",life:3e3});return}const l=H.json_to_sheet(B.value),e=H.book_new();H.book_append_sheet(e,l,"Laporan Peserta");const t=`Laporan_Peserta_${Y().format("YYYYMMDD_HHmmss")}.xlsx`;le(e,t)},L=d({}),X=()=>{L.value.summ_data=U.value,L.value.radar_image=V.value,L.value.participant=u.value.map(l=>({id:l.participant_data._id,name:l.participant_data.name,session:l.session_data.test_name,status:l.session_data.test_status?"Selesai":"Sedang Berlangsung",answers:l.answers_data,report:l.report,start:Y(l.session_data.start).format("YYYY-MM-DD HH:mm:ss"),end:Y(l.session_data.end).format("YYYY-MM-DD HH:mm:ss"),token:l.session_data.session_token,participant:l.participant_data})),ne.post("http://localhost/pdfengine/pdf/generate",L.value,{headers:{"Content-Type":"application/json"}}).then(l=>{const e=l.data.data,t=new Blob([Uint8Array.from(atob(e),n=>n.charCodeAt(0))],{type:"application/pdf"}),s=URL.createObjectURL(t),p=document.createElement("a");p.href=s,p.download=`Laporan_Peserta_${Y().format("YYYYMMDD_HHmmss")}.pdf`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(s),i.add({severity:"success",summary:"Berhasil",detail:"Laporan PDF berhasil diunduh.",life:3e3}),D.value=!1}).catch(l=>{i.add({severity:"error",summary:"Oops",detail:l,life:3e3})})},D=d(!1),U=d(""),V=d("");R.setOnDelta(l=>{U.value+=l}),R.setOnCompleted(()=>{i.add({severity:"success",summary:"Berhasil",detail:"Laporan berhasil dihasilkan.",life:3e3}),X()});const Z=async()=>{U.value="",L.value={score_aggregation_by_level:O.value,per_participant_score_report:B.value,question_level_description:f.value.find(t=>t.id===c.value).questions,test_data:f.value.find(t=>t.id===c.value)};const e={examResults:me(L.value)};R.sendRecipe(e),D.value=!0,ee("captureArea").then(t=>{V.value=t,console.log(t)}).catch(t=>{i.add({severity:"error",summary:"Error",detail:t,life:3e3})})},ee=l=>new Promise((e,t)=>{const s=document.getElementById(l);if(!s){i.add({severity:"error",summary:"Error",detail:"Area not found",life:3e3});return}se(s,{scale:6}).then(p=>{e(p.toDataURL("image/jpeg"))}).catch(p=>{t(p),i.add({severity:"error",summary:"Error",detail:p.message,life:3e3})})});return G(async()=>{await j(),R.connectHandler()}),(l,e)=>{const t=ue("fasicon");return h(),g($,null,[r(ae,{"content-title":"Laporan Tabel"},{default:b(()=>[a("div",ke,[a("div",Se,[e[4]||(e[4]=a("label",{style:{"font-size":"12px","font-weight":"bold"}},"Sesi",-1)),r(m(M),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),options:_.value,"option-label":"label","option-value":"value",placeholder:"Pilih Test",class:"w-full md:w-14rem"},null,8,["modelValue","options"])]),a("div",Ce,[e[5]||(e[5]=a("label",{style:{"font-size":"12px","font-weight":"bold"}},"Instansi",-1)),r(m(M),{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value=s),options:w.value,"option-label":"label","option-value":"value",placeholder:"Pilih Instansi",class:"w-full md:w-14rem ml-2"},null,8,["modelValue","options"])]),a("div",Le,[e[6]||(e[6]=a("label",{style:{"font-size":"12px","font-weight":"bold"}},"Status",-1)),r(m(M),{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),options:v.value,"option-label":"label","option-value":"value",placeholder:"Pilih Status",class:"w-full md:w-14rem ml-2"},null,8,["modelValue","options"])])]),u.value.length>0?(h(),g("div",Pe,[r(m(J),{value:u.value,class:"mt-3",style:{"margin-top":"1rem"}},{default:b(()=>{var s,p;return[r(m(P),{header:"Peserta"},{body:b(({data:n})=>[S(C(n.participant_data.name),1)]),_:1}),r(m(P),{header:"Status"},{body:b(({data:n})=>[n.session_data.test_status?(h(),g("span",je,[r(t,{style:{color:"green"},icon:"check-circle"})])):(h(),g("span",Oe,[r(t,{icon:"clock"})]))]),_:1}),(h(!0),g($,null,Q(((p=(s=u.value[0])==null?void 0:s.session_data)==null?void 0:p.payload)||[],(n,te)=>(h(),pe(m(P),{key:te,header:n.name},{body:b(({data:I})=>[a("div",Be,[a("span",De,[e[7]||(e[7]=S("Benar: ")),a("b",null,C(I.answers_data[n.name].correct),1)]),a("span",Ye,[e[8]||(e[8]=S("Salah: ")),a("b",null,C(I.answers_data[n.name].incorrect),1)])])]),_:2},1032,["header"]))),128))]}),_:1},8,["value"]),a("div",Re,[e[9]||(e[9]=a("h4",{style:{margin:"0","margin-bottom":"1rem"}},"Akumulasi Skor",-1)),r(m(J),{value:O.value,class:"mt-3"},{default:b(()=>[r(m(P),{field:"name",header:"Level",style:{"font-weight":"bold"}}),r(m(P),{field:"correct",header:"Benar",style:{color:"green"}}),r(m(P),{field:"incorrect",header:"Salah",style:{color:"red"}})]),_:1},8,["value"]),a("span",Ue,"Akumulasi berdasarkan data dari "+C(u.value.length)+" peserta.",1)]),a("span",He,[r(t,{icon:"users"}),S("   "+C(u.value.length)+" peserta ditampilkan",1)]),r(m(A)),a("div",Me,[r(be,{data:z.value},null,8,["data"])]),r(m(A)),u.value.length>0?(h(),g("div",Te,[r(m(E),{style:{width:"210px",padding:"12px"},onClick:K},{default:b(()=>[r(t,{icon:"file-excel",style:{width:"fit-content"}}),e[10]||(e[10]=S(" Unduh Spreadsheet"))]),_:1}),r(m(E),{style:{width:"210px",padding:"12px"},onClick:Z},{default:b(()=>[r(t,{icon:"file-pdf",style:{width:"fit-content"}}),e[11]||(e[11]=S(" Unduh PDF"))]),_:1})])):ce("",!0)])):(h(),g("div",$e,e[12]||(e[12]=[a("div",{style:{display:"flex","flex-flow":"column","align-items":"center","margin-top":"2rem"}},[a("img",{style:{width:"250px",height:"250px","object-fit":"contain"},src:"https://assets-v2.lottiefiles.com/a/f0470cd6-117f-11ee-a4ed-1b2d7fb6aaaf/i83iUdPISg.gif"}),a("span",{style:{"font-size":"1.2rem","font-weight":"bold",color:"#777"}},"Tidak ada data peserta yang ditemukan"),a("span",{style:{"font-size":"0.9rem",color:"#777"}},"Silakan pilih sesi dan instansi yang valid.")],-1)])))]),_:1}),r(m(oe),{header:"Insight",visible:D.value,"onUpdate:visible":e[3]||(e[3]=s=>D.value=s),modal:!0,"close-on-click-modal":!1,style:{width:"35vw"}},{default:b(()=>e[13]||(e[13]=[a("div",{style:{display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},[a("img",{src:"https://cdn-icons-gif.flaticon.com/10971/10971743.gif",style:{width:"150px",height:"150px"}}),a("h3",{style:{"text-align":"center",margin:"0",padding:"0"}},"Menganalisis..."),a("p",{style:{"text-align":"center",margin:"0"}},"Laporan akan siap dalam beberapa saat")],-1)])),_:1},8,["visible"])],64)}}});export{ut as default};
