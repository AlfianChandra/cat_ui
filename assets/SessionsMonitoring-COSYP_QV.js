import{d as Se,f as Me,P as Te,r as c,Q as se,i as Le,j as je,c as d,k as l,w as f,u as r,F as C,o as u,a,p as $e,b as m,t as p,l as x,m as Ae,e as Be,O as B,a6 as ne}from"./index-GPuS0P4G.js";import{s as oe}from"./index-CgT_lfSS.js";import{s as h,a as le}from"./index-DB7XWvx-.js";import{h as O}from"./moment-C5S46NFB.js";import{i as He}from"./index-Bb6yjXMn.js";import{j as W}from"./jsonToMarkdown-C5mXda7r.js";import{s as E}from"./index-DC67B2fT.js";import{s as F}from"./index-y1oIo8on.js";import{e as re}from"./index-BH76n2cD.js";import{C as Ve}from"./ContentWrapper-CF5IwQ17.js";import{t as K}from"./testModel-Vg6Q2vJt.js";import{l as ze}from"./index-BLRFddlS.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CUStOz80.js";import"./index-DNXSlYFd.js";import"./index-QccRvrAa.js";import"./index-Bi1Y1-xo.js";import"./index-Cy89gHzg.js";import"./index-kpONFu7z.js";import"./index-B2yYq3rf.js";import"./index-t--hEgTQ.js";const Ie={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Pe={key:0},De={key:1},Ne={key:0},Je={key:1},Ye={key:1,style:{"margin-top":"1rem",display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},Re={style:{display:"flex","flex-flow":"row wrap","align-items":"center",gap:"0.5rem","justify-content":"center"}},Oe={style:{padding:"20px"}},We=["src"],Ee={style:{display:"flex","flex-flow":"column"}},Fe={style:{margin:"0",padding:"0"}},Ke={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Qe={style:{display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},Ge={style:{"font-size":"1.5rem","font-weight":"bold"}},Ze={key:0},Xe={class:"mtable",style:{"margin-top":"1rem"}},et={style:{width:"10px","text-align":"center"}},tt={key:0,style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},at={key:0,"data-is-correct":"true"},st={style:{color:"green"}},nt=["innerHTML"],ot={key:1,"data-is-correct":"false"},lt={style:{color:"red"}},rt=["innerHTML"],it={key:2},ut=["onClick"],dt={key:1},pt={style:{display:"flex","flex-flow":"column",width:"100%","margin-top":"1rem"}},ct={style:{display:"flex","flex-flow":"column","justify-content":"space-between",width:"100%","align-items":"center"}},mt={style:{color:"green","font-weight":"bold"}},vt={style:{color:"red","font-weight":"bold"}},ft={style:{display:"flex","flex-flow":"column","word-wrap":"break-word"}},gt=["innerHTML"],yt={style:{display:"flex","flex-flow":"column",gap:".3rem"}},ht=["innerHTML"],wt={key:0},bt={key:1},_t=["innerHTML"],kt={key:2,style:{color:"red"}},xt=["innerHTML"],qt={style:{"font-size":"12px"}},Ct=["innerHTML"],St=Se({__name:"SessionsMonitoring",setup(Mt){const ie=Me();Te();const g=c(null),Q={socketURL:"https://api.imanextgencbt.id",socketPath:"/socket.io"},S=c(null),H=c(null),M=c({title:{text:"Ikhtisar",left:"center",top:10,textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{},legend:{data:["Jawaban Benar","Jawaban Salah"],top:40,left:"center"},radar:{center:["50%","55%"],radius:"55%",indicator:[],shape:"circle",name:{show:!0,textStyle:{fontSize:12,color:"#333",overflow:"break",lineHeight:16}},nameGap:10,splitNumber:5,axisLine:{lineStyle:{color:"#aaa"}},splitLine:{lineStyle:{color:"#aaa"}}},series:[{name:"Jawaban Benar",type:"radar",data:[]}]}),T=c([]),V=c([]),L=c([]),w=c(null),G=c([]),j=c([]),_=c(null),ue=()=>new Promise((o,e)=>{setTimeout(()=>{if(S.value)try{H.value=He(S.value),H.value.setOption(M.value),console.log(S.value),o(!0)}catch(s){e(s)}},1e3)}),de=()=>{pe(),K().getSessions().then(o=>{const e=o.map(s=>({id:s._id,name:s.name,instances:s.instances,questions:s.questions,isStarted:s.isStarted}));V.value=e,L.value=e.map(s=>({label:s.name,value:s.id})),w.value=L.value[0].value}).catch(o=>{console.error(o)})},pe=()=>{V.value=[],L.value=[],w.value=null,G.value=[],j.value=[],_.value=null};se(()=>w.value,()=>{var e;const o=((e=V.value.find(s=>s.id===w.value))==null?void 0:e.instances)||[];G.value=o,j.value=o.map(s=>({label:s.name,value:s._id})),_.value=j.value[0].value}),se(()=>_.value,()=>{ce()});const ce=()=>{const o={id_test:w.value,id_instance:_.value};K().getUserSessions(o).then(e=>{T.value=e}).catch(e=>{T.value=[]})},z=c(!1),i=c({}),$=c({}),U=c([]),b=c([]),me=async o=>{z.value=!0,i.value=o,$.value.question_categories=o.question.categories,$.value.question_items=o.question.payload;const e=o.question.payload.reduce((s,t)=>t.questions.length>s.questions.length?t:s).questions;U.value=e,console.log(o,i.value,U.value),b.value=[];for(let s=0;s<i.value.question.payload.length;s++){const t=i.value.question.payload[s];t.questions.length>0&&b.value.push({name:t.name,total:t.questions.length,correct:t.questions.filter(n=>n.result.isCorrect).length,incorrect:t.questions.filter(n=>n.result.answer!==null&&!n.result.isCorrect).length,not_taken:t.questions.filter(n=>n.result.answer===null&&n.result.isCorrect===!1).length})}ue().then(()=>{const s=Math.max(...b.value.map(t=>t.correct||0));M.value.radar.indicator=b.value.map(t=>({name:t.name,max:s>0?s:1})),M.value.series=[{name:"Jawaban Benar",type:"radar",data:[{value:b.value.map(t=>t.correct),name:"Jawaban Benar"}],areaStyle:{opacity:.1}}],H.value.setOption(M.value)}).catch(s=>{console.error(s)})},I=c(!1),y=c({}),ve=o=>{y.value.user_answer=o,fe(o.id_question)},fe=o=>{const e={id_question:o};K().getSoalData(e).then(s=>{y.value.soal=s,I.value=!0}).catch(s=>{console.error(s),ie.add({severity:"error",summary:"Error",detail:s,life:3e3})})},P=c(!1),D=c(""),ge=()=>{var v;D.value="";const o=W(b.value),e=W(i.value.participant_data.profile),s=ye(".mtable"),t=W(s);let n=`### Detail Peserta (Jangan sebut informasi tidak perlu):
${e}

`;n+=`### Hasil Ujian. Terdapat level soal. Misal C3, C4, C5, dst, sesuai prinsip Computerized Adaptive Test: 
${t}

`,n+=`### Skor Insight:
${o}

`;const q={from:"sessions-monitoring",prompt:"Analisis dokumen hasil ujian peserta berikut ini. Cukup berikan hasil analisisnya saja, jangan tawarkan pertanyaan atau penjelasan lebih lanjut. Fokus pada analisis hasil ujian peserta. Kecualikan dari analisis untuk data soal yang tidak dijawab karena tidak dibutuhkan pada Computerized Adaptive Test, tidak menjawab artinya peserta tidak menguasai level tersebut atau karena sedang mengerjakan soal di level yang lebih tinggi. Analisis pola jawaban peserta: Letak benar dan salah, dan berikan insight tentang pola tersebut. Berikan kesimpulan estimasi kemampuan peserta dalam persentase.",payload:n};(v=g.value)==null||v.emit("socket-analyzer:send-data",q),P.value=!0};function ye(o){const e=document.querySelector(o);if(!e)throw new Error("Table gak ketemu broh, cek selector-nya.");const t=Array.from(e.querySelectorAll("thead th")).slice(1).map(v=>{var k;return((k=v.textContent)==null?void 0:k.trim())||""}),n=[];return Array.from(e.querySelectorAll("tbody tr")).forEach(v=>{var Z,X;const k=Array.from(v.querySelectorAll("td")),ke=((X=(Z=k[0])==null?void 0:Z.textContent)==null?void 0:X.trim())||"",xe=parseInt(ke,10)||0,qe=t.map((ee,Ce)=>{var te,ae;const N=k[Ce+1];if(!N)return{categoryName:ee,answer:null,isCorrect:!1};let J="-",Y=!1;const R=N.querySelector("span[data-is-correct]");if(R)Y=R.getAttribute("data-is-correct")==="true",J=((te=R.textContent)==null?void 0:te.trim())||null;else{const A=((ae=N.textContent)==null?void 0:ae.trim())||"";A&&A!=="-"&&(J=A,Y=!1)}return{categoryName:ee,answer:J,isCorrect:Y}});n.push({no:xe,perCategory:qe})}),{rows:n}}const he=o=>(o=we(o),o.replace(/^(#{1,6})\s+(.*)$/gm,(e,s,t)=>{const n=s.length;return`<h${n} style="color:orange">${t}</h${n}>`}).replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/_(.*?)_/g,"<i>$1</i>").replace(/~~(.*?)~~/g,"<del>$1</del>").replace(/\n/g,"<br>").replace(/!\[([^\]]+)\]\(([^)]+)\)/g,'<img src="$2" alt="$1" style="max-width:100%;height:auto;"/>').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>')),we=o=>o.replace(/```(\w+)?\n([\s\S]*?)```/g,(e,s,t)=>{const n=s||"plaintext",q=t.replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<div style="margin-top:0.5rem;padding:15px;border-radius:5px;overflow-y:auto;background:rgb(10,10,10);color:rgb(255,255,255);"><span style='color:orange;text-transform:uppercase;font-weight:bold;font-size:12px;'>${n}</span><hr><pre class="language-${n}"><code>${q}</code></pre></div>`}),be=()=>{g.value&&(g.value.off(),g.value.disconnect()),g.value=ze(`${Q.socketURL}/analyzer`,{path:Q.socketPath}),g.value.on("connect",()=>{console.log("Connected to socket: ANALYZER NS"),_e()})},_e=()=>{var o,e;(o=g.value)==null||o.on("socket-analyzer:on-response",s=>{D.value+=s.data.content}),(e=g.value)==null||e.on("socket-analyzer:on-response-end",()=>{console.log("Response ended")})};return Le(()=>{de(),be()}),je(()=>{g.value&&(g.value.off(),g.value.disconnect(),g.value=null)}),(o,e)=>{const s=Ae("fasicon");return u(),d(C,null,[l(Ve,{contentTitle:"Monitoring Ujian"},{default:f(()=>[a("div",Ie,[l(r(re),{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),options:L.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Sesi Ujian",class:"w-full mb-4"},null,8,["modelValue","options"]),l(r(re),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),options:j.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Instansi",class:"w-full mb-4"},null,8,["modelValue","options"])]),T.value.length>0?(u(),$e(r(le),{key:0,style:{"margin-top":"1rem"},value:T.value,paginator:!0,rows:20,rowsPerPageOptions:[10,20,50],dataKey:"_id"},{default:f(()=>[l(r(h),{header:"Nama"},{body:f(({data:t})=>[m(p(t.participant_data.meta.name),1)]),_:1}),l(r(h),{header:"Kelas"},{body:f(({data:t})=>[m(p(t.participant_data.meta.kelas),1)]),_:1}),l(r(h),{header:"Jurusan"},{body:f(({data:t})=>[m(p(t.participant_data.meta.jurusan),1)]),_:1}),l(r(h),{header:"Mulai"},{body:f(({data:t})=>[m(p(r(O)(t.start).format("DD MMM YYYY -- hh:mm")+" WIB"),1)]),_:1}),l(r(h),{header:"Progres"},{body:f(({data:t})=>[t.test_status==="in_progress"?(u(),d("span",Pe,"Berlangsung")):x("",!0),t.test_status==="completed"?(u(),d("span",De,"Selesai")):x("",!0)]),_:1}),l(r(h),{header:"Soal"},{body:f(({data:t})=>[t.test_status!=="completed"?(u(),d("span",Ne,p(t.state.current_question)+" / "+p(t.question_done.length),1)):(u(),d("span",Je,[l(s,{icon:"check-circle"})]))]),_:1}),l(r(h),{header:"Aksi"},{body:f(({data:t})=>[l(r(oe),{onClick:n=>me(t)},{default:f(()=>e[5]||(e[5]=[m("Detail")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value"])):(u(),d("div",Ye,e[6]||(e[6]=[a("img",{style:{width:"250px",height:"250px","object-fit":"contain"},src:"https://assets-v2.lottiefiles.com/a/f0470cd6-117f-11ee-a4ed-1b2d7fb6aaaf/i83iUdPISg.gif"},null,-1),a("h3",{style:{"text-align":"center",margin:"0"}},"Belum ada yang tersedia data untuk ditampilkan",-1)])))]),_:1}),l(r(E),{visible:z.value,"onUpdate:visible":e[2]||(e[2]=t=>z.value=t),modal:!0,header:"Detail Sesi Ujian",style:{width:"90vw"}},{default:f(()=>[a("div",Re,[a("div",Oe,[a("img",{src:`${r(Be).baseUserContent}${i.value.participant_data.profile.avatar}`,alt:"Participant Photo",style:{width:"200px",height:"200px","border-radius":"50%","object-fit":"cover",border:"8px solid #eee","box-shadow":"5px 5px 20px rgba(0,0,0,0.5)"}},null,8,We)]),a("div",Ee,[a("h1",Fe,p(i.value.participant_data.profile.name),1),a("div",Ke,[a("span",null,[e[7]||(e[7]=m("Kelas: ")),a("b",null,p(i.value.participant_data.meta.kelas),1)]),e[9]||(e[9]=m("  ·  ")),a("span",null,[e[8]||(e[8]=m("Jurusan: ")),a("b",null,p(i.value.participant_data.meta.jurusan),1)])]),a("span",null,[e[10]||(e[10]=m("Dimulai: ")),a("b",null,p(r(O)(i.value.start).format("DD MMM YYYY -- hh:mm")+" WIB"),1)]),a("span",null,[e[11]||(e[11]=m("Berakhir: ")),a("b",null,p(i.value.test_status==="completed"?"Selesai":r(O)(i.value.end).fromNow()),1)]),l(r(oe),{onClick:ge,style:{width:"120px","margin-top":"1rem","font-size":"13px"}},{default:f(()=>e[12]||(e[12]=[m("Analisis Hasil")])),_:1})]),l(r(F)),a("div",Qe,[a("span",Ge,p(i.value.test_status==="in_progress"?"Asesmen Sedang Berlangsung":"Asesmen Selesai"),1),i.value.test_status==="in_progress"?(u(),d("span",Ze,[e[13]||(e[13]=m("Soal yang dikerjakan: ")),a("b",null,p(i.value.state.current_question)+" / "+p(i.value.question_done.length),1)])):x("",!0)]),a("table",Xe,[a("thead",null,[a("tr",null,[e[14]||(e[14]=a("th",{style:{"text-align":"center"}},"No",-1)),(u(!0),d(C,null,B($.value.question_categories,(t,n)=>(u(),d("th",{style:{"text-align":"left"},key:n},p(t.name),1))),128))])]),a("tbody",null,[(u(!0),d(C,null,B(U.value,(t,n)=>(u(),d("tr",{key:n},[a("td",et,p(n+1),1),(u(!0),d(C,null,B($.value.question_categories,(q,v)=>(u(),d("td",{style:{width:"50%"},key:v},[a("div",null,[i.value.question.payload[v].questions[n]!==void 0?(u(),d("div",tt,[i.value.question.payload[v].questions[n].result.answer!=null&&i.value.question.payload[v].questions[n].result.isCorrect?(u(),d("span",at,[a("span",st,[l(s,{icon:"check-circle"}),e[15]||(e[15]=m()),a("span",{innerHTML:i.value.question.payload[v].questions[n].result.answer},null,8,nt)])])):x("",!0),i.value.question.payload[v].questions[n].result.answer!=null&&!i.value.question.payload[v].questions[n].result.isCorrect?(u(),d("span",ot,[a("span",lt,[l(s,{icon:"times-circle"}),e[16]||(e[16]=m()),a("span",{innerHTML:i.value.question.payload[v].questions[n].result.answer},null,8,rt)])])):x("",!0),!i.value.question.payload[v].questions[n].result.answer&&!i.value.question.payload[v].questions[n].result.isCorrect?(u(),d("span",it,"-")):x("",!0),a("button",{onClick:k=>ve(i.value.question.payload[v].questions[n]),style:{width:"30px",height:"30px",background:"transparent",border:"1px solid #ccc",color:"#888",cursor:"pointer","border-radius":"5px"}},[l(s,{icon:"search"})],8,ut)])):(u(),d("div",dt,e[17]||(e[17]=[a("span",{style:{"font-weight":"bold",color:"#aaa"}},"N/A",-1)])))])]))),128))]))),128))])]),a("div",pt,[e[19]||(e[19]=a("h2",{style:{margin:"0",padding:"0"}},"Test Insight:",-1)),a("div",ct,[l(r(le),{value:b.value,dataKey:"name",style:{width:"100%","margin-top":"1rem"}},{default:f(()=>[l(r(h),{field:"name",header:"Level"}),l(r(h),{field:"correct",header:"Benar"}),l(r(h),{field:"incorrect",header:"Salah"}),l(r(h),{header:"%"},{body:f(({data:t})=>[a("span",mt,p((t.correct/t.total*100).toFixed(2))+"%",1),e[18]||(e[18]=m("    ·    ")),a("span",vt,p((t.incorrect/t.total*100).toFixed(2))+"%",1)]),_:1})]),_:1},8,["value"]),a("div",{ref_key:"radarContainer",ref:S,style:{width:"400px",height:"400px","margin-top":"1.5rem"}},null,512)])])])]),_:1},8,["visible"]),l(r(E),{closable:!0,visible:I.value,"onUpdate:visible":e[3]||(e[3]=t=>I.value=t),modal:!0,header:"Soal",style:{width:"40rem"}},{default:f(()=>[a("div",ft,[a("div",{innerHTML:y.value.soal.soal,style:{"margin-bottom":"1rem"}},null,8,gt),a("div",yt,[(u(!0),d(C,null,B(y.value.soal.answers,(t,n)=>(u(),d("div",{key:n,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem","box-shadow":"5px 5px 20px rgba(0,0,0,0.2)",padding:"10px","border-radius":"10px"}},[a("span",{style:ne([{background:`${t.is_correct?"green":"#555"}`},{overflow:"clip","font-size":"13px",width:"30px",height:"30px",display:"flex","justify-content":"center","align-items":"center","font-weight":"bold","border-radius":"50%",color:"#fff"}])},p(String.fromCharCode(65+n)),5),a("span",{style:ne([{color:`${t.is_correct?"green":"#555"}`},{"margin-left":"0.5rem",width:"80%","font-size":"13px"}]),innerHTML:t.value},null,12,ht)]))),128))]),l(r(F)),e[24]||(e[24]=m(" Jawaban Peserta: ")),y.value.user_answer.result.answer==null?(u(),d("span",wt,e[20]||(e[20]=[a("b",null,"Tidak/Belum Menjawab",-1)]))):y.value.user_answer.result.isCorrect?(u(),d("span",bt,[a("b",{style:{color:"green"},innerHTML:y.value.user_answer.result.answer},null,8,_t)])):(u(),d("span",kt,[a("b",{innerHTML:y.value.user_answer.result.answer},null,8,xt)])),l(r(F)),a("span",qt,[a("code",null,[e[21]||(e[21]=m("QID: ")),a("b",null,p(y.value.soal._id),1),e[22]||(e[22]=m(" | Level: ")),a("b",null,p(y.value.user_answer.level),1),e[23]||(e[23]=m(" | Time Taken: ")),a("b",null,p(y.value.user_answer.result.time_taken?y.value.user_answer.result.time_taken+" seconds":"not recorded"),1)])])])]),_:1},8,["visible"]),l(r(E),{closable:!0,visible:P.value,"onUpdate:visible":e[4]||(e[4]=t=>P.value=t),modal:!0,header:"Hasil Analisis AI",style:{width:"40rem"}},{default:f(()=>[a("p",{innerHTML:he(D.value),style:{"white-space":"pre-wrap","word-wrap":"break-word"}},null,8,Ct)]),_:1},8,["visible"])],64)}}}),Kt=Ue(St,[["__scopeId","data-v-813896fc"]]);export{Kt as default};
