var Vg=Object.defineProperty;var zf=l=>{throw TypeError(l)};var Kg=(l,t,e)=>t in l?Vg(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var D=(l,t,e)=>Kg(l,typeof t!="symbol"?t+"":t,e),Wd=(l,t,e)=>t.has(l)||zf("Cannot "+e);var r=(l,t,e)=>(Wd(l,t,"read from private field"),e?e.call(l):t.get(l)),g=(l,t,e)=>t.has(l)?zf("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(l):t.set(l,e),f=(l,t,e,i)=>(Wd(l,t,"write to private field"),i?i.call(l,e):t.set(l,e),e),b=(l,t,e)=>(Wd(l,t,"access private method"),e);var Me=(l,t,e,i)=>({set _(s){f(l,t,s,e)},get _(){return r(l,t,i)}});import{V as Gg,r as Lt,g as Wg,W as vp,B as _f,R as wp,A as nl,x as Q,X as ki,Y as Da,I as pi,J as yc,_ as Qt,$ as dc,a0 as wr,a1 as jf,a2 as Ap,m as Ri,L as Od,c as $,o as F,F as Ee,O as xa,l as gt,a as K,k as vt,M as or,p as Zt,N as Pi,n as yi,t as Ie,w as gi,a3 as _p,T as Nd,U as As,d as pn,f as Ip,P as qg,q as Xg,u as Rt,a4 as Uf,a5 as Yg,Z as Ga,a6 as Qg,a7 as Jg,a8 as Zg,e as gr,b as ar,z as tb,y as eb,C as ib,Q as sb,i as If,S as Sp,a9 as Cc,aa as nb}from"./index-ejyJlZ5F.js";import{s as Ep}from"./index-6T4hCFA5.js";import{s as xp}from"./index-yr1VNxvS.js";import{_ as rl}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as rb,a as ab,b as ob}from"./index-BvpqAqj8.js";import{s as lb}from"./index-CLuMbOD9.js";import{s as Cp}from"./index-MHma-4p1.js";import{s as hb}from"./index-C67hLERA.js";import{s as cb}from"./index-D0Rv0m5m.js";import{s as kp}from"./index-DUbWLBIj.js";import{F as db,u as ub,b as fb}from"./index-BecHZODx.js";import{U as pb}from"./UserProfile-mbiowscL.js";import{r as mb,u as gb}from"./xlsx-CygJKsBP.js";import{g as bb}from"./_commonjsHelpers-Cpj98o6Y.js";import{l as yb}from"./katex-PY4D4bhS.js";import{s as vb}from"./index-CL0EY4lH.js";import{u as wb}from"./latextParser-CxSr48Wy.js";import"./index-DAUUs_Jy.js";import"./index-WaH6avFF.js";import"./http-CZxw-Wco.js";import"./index-t--hEgTQ.js";import"./auth-B6NhTdRS.js";import"./emitter-BIAHFEhY.js";/* empty css                  */import"./html2canvas.esm-BfYXEYrK.js";const Bd=Gg("theme",()=>{const l=Lt(localStorage.getItem("theme")||"theme-light"),t=Lt(localStorage.getItem("themeDarkColor")||"#141414"),e=s=>{localStorage.setItem("theme",s),l.value=s};Wg(()=>localStorage.getItem("theme"));const i=()=>{const s=l.value==="theme-light"?"theme-dark":"theme-light";return e(s),l.value==="theme-light"?"theme-light":"theme-dark"};return vp(()=>{l.value==="theme-light"?(document.documentElement.classList.remove("my-app-dark"),document.body.style.backgroundColor=""):(document.documentElement.classList.add("my-app-dark"),document.body.style.backgroundColor=t.value)}),{mTheme:l,setTheme:e,toggleTheme:i,themeDarkColor:t}});var Ab=({dt:l})=>`
.p-panelmenu {
    display: flex;
    flex-direction: column;
    gap: ${l("panelmenu.gap")};
}

.p-panelmenu-panel {
    background: ${l("panelmenu.panel.background")};
    border-width: ${l("panelmenu.panel.border.width")};
    border-style: solid;
    border-color: ${l("panelmenu.panel.border.color")};
    color: ${l("panelmenu.panel.color")};
    border-radius: ${l("panelmenu.panel.border.radius")};
    padding: ${l("panelmenu.panel.padding")};
}

.p-panelmenu-panel:first-child {
    border-width: ${l("panelmenu.panel.first.border.width")};
    border-start-start-radius: ${l("panelmenu.panel.first.top.border.radius")};
    border-start-end-radius: ${l("panelmenu.panel.first.top.border.radius")};
}

.p-panelmenu-panel:last-child {
    border-width: ${l("panelmenu.panel.last.border.width")};
    border-end-start-radius: ${l("panelmenu.panel.last.bottom.border.radius")};
    border-end-end-radius: ${l("panelmenu.panel.last.bottom.border.radius")};
}

.p-panelmenu-header {
    outline: 0 none;
}

.p-panelmenu-header-content {
    border-radius: ${l("panelmenu.item.border.radius")};
    transition: background ${l("panelmenu.transition.duration")}, color ${l("panelmenu.transition.duration")}, outline-color ${l("panelmenu.transition.duration")}, box-shadow ${l("panelmenu.transition.duration")};
    outline-color: transparent;
    color: ${l("panelmenu.item.color")};
}

.p-panelmenu-header-link {
    display: flex;
    gap: ${l("panelmenu.item.gap")};
    padding: ${l("panelmenu.item.padding")};
    align-items: center;
    user-select: none;
    cursor: pointer;
    position: relative;
    text-decoration: none;
    color: inherit;
}

.p-panelmenu-header-icon,
.p-panelmenu-item-icon {
    color: ${l("panelmenu.item.icon.color")};
}

.p-panelmenu-submenu-icon {
    color: ${l("panelmenu.submenu.icon.color")};
}

.p-panelmenu-submenu-icon:dir(rtl) {
    transform: rotate(180deg);
}

.p-panelmenu-header:not(.p-disabled):focus-visible .p-panelmenu-header-content {
    background: ${l("panelmenu.item.focus.background")};
    color: ${l("panelmenu.item.focus.color")};
}

.p-panelmenu-header:not(.p-disabled):focus-visible .p-panelmenu-header-content .p-panelmenu-header-icon {
    color: ${l("panelmenu.item.icon.focus.color")};
}

.p-panelmenu-header:not(.p-disabled):focus-visible .p-panelmenu-header-content .p-panelmenu-submenu-icon {
    color: ${l("panelmenu.submenu.icon.focus.color")};
}

.p-panelmenu-header:not(.p-disabled) .p-panelmenu-header-content:hover {
    background: ${l("panelmenu.item.focus.background")};
    color: ${l("panelmenu.item.focus.color")};
}

.p-panelmenu-header:not(.p-disabled) .p-panelmenu-header-content:hover .p-panelmenu-header-icon {
    color: ${l("panelmenu.item.icon.focus.color")};
}

.p-panelmenu-header:not(.p-disabled) .p-panelmenu-header-content:hover .p-panelmenu-submenu-icon {
    color: ${l("panelmenu.submenu.icon.focus.color")};
}

.p-panelmenu-submenu {
    margin: 0;
    padding: 0 0 0 ${l("panelmenu.submenu.indent")};
    outline: 0;
    list-style: none;
}

.p-panelmenu-submenu:dir(rtl) {
    padding: 0 ${l("panelmenu.submenu.indent")} 0 0;
}

.p-panelmenu-item-link {
    display: flex;
    gap: ${l("panelmenu.item.gap")};
    padding: ${l("panelmenu.item.padding")};
    align-items: center;
    user-select: none;
    cursor: pointer;
    text-decoration: none;
    color: inherit;
    position: relative;
    overflow: hidden;
}

.p-panelmenu-item-label {
    line-height: 1;
}

.p-panelmenu-item-content {
    border-radius: ${l("panelmenu.item.border.radius")};
    transition: background ${l("panelmenu.transition.duration")}, color ${l("panelmenu.transition.duration")}, outline-color ${l("panelmenu.transition.duration")}, box-shadow ${l("panelmenu.transition.duration")};
    color: ${l("panelmenu.item.color")};
    outline-color: transparent;
}

.p-panelmenu-item.p-focus > .p-panelmenu-item-content {
    background: ${l("panelmenu.item.focus.background")};
    color: ${l("panelmenu.item.focus.color")};
}

.p-panelmenu-item.p-focus > .p-panelmenu-item-content .p-panelmenu-item-icon {
    color: ${l("panelmenu.item.focus.color")};
}

.p-panelmenu-item.p-focus > .p-panelmenu-item-content .p-panelmenu-submenu-icon {
    color: ${l("panelmenu.submenu.icon.focus.color")};
}

.p-panelmenu-item:not(.p-disabled) > .p-panelmenu-item-content:hover {
    background: ${l("panelmenu.item.focus.background")};
    color: ${l("panelmenu.item.focus.color")};
}

.p-panelmenu-item:not(.p-disabled) > .p-panelmenu-item-content:hover .p-panelmenu-item-icon {
    color: ${l("panelmenu.item.icon.focus.color")};
}

.p-panelmenu-item:not(.p-disabled) > .p-panelmenu-item-content:hover .p-panelmenu-submenu-icon {
    color: ${l("panelmenu.submenu.icon.focus.color")};
}
`,_b={root:"p-panelmenu p-component",panel:"p-panelmenu-panel",header:function(t){var e=t.instance,i=t.item;return["p-panelmenu-header",{"p-panelmenu-header-active":e.isItemActive(i)&&!!i.items,"p-disabled":e.isItemDisabled(i)}]},headerContent:"p-panelmenu-header-content",headerLink:"p-panelmenu-header-link",headerIcon:"p-panelmenu-header-icon",headerLabel:"p-panelmenu-header-label",contentContainer:"p-panelmenu-content-container",content:"p-panelmenu-content",rootList:"p-panelmenu-root-list",item:function(t){var e=t.instance,i=t.processedItem;return["p-panelmenu-item",{"p-focus":e.isItemFocused(i),"p-disabled":e.isItemDisabled(i)}]},itemContent:"p-panelmenu-item-content",itemLink:"p-panelmenu-item-link",itemIcon:"p-panelmenu-item-icon",itemLabel:"p-panelmenu-item-label",submenuIcon:"p-panelmenu-submenu-icon",submenu:"p-panelmenu-submenu",separator:"p-menuitem-separator"},Ib=_f.extend({name:"panelmenu",style:Ab,classes:_b}),Sb={name:"BasePanelMenu",extends:nl,props:{model:{type:Array,default:null},expandedKeys:{type:Object,default:null},multiple:{type:Boolean,default:!1},tabindex:{type:Number,default:0}},style:Ib,provide:function(){return{$pcPanelMenu:this,$parentInstance:this}}},Tp={name:"PanelMenuSub",hostName:"PanelMenu",extends:nl,emits:["item-toggle","item-mousemove"],props:{panelId:{type:String,default:null},focusedItemId:{type:String,default:null},items:{type:Array,default:null},level:{type:Number,default:0},templates:{type:Object,default:null},activeItemPath:{type:Object,default:null},tabindex:{type:Number,default:-1}},methods:{getItemId:function(t){return"".concat(this.panelId,"_").concat(t.key)},getItemKey:function(t){return this.getItemId(t)},getItemProp:function(t,e,i){return t&&t.item?dc(t.item[e],i):void 0},getItemLabel:function(t){return this.getItemProp(t,"label")},getPTOptions:function(t,e,i){return this.ptm(t,{context:{item:e.item,index:i,active:this.isItemActive(e),focused:this.isItemFocused(e),disabled:this.isItemDisabled(e)}})},isItemActive:function(t){return this.activeItemPath.some(function(e){return e.key===t.key})},isItemVisible:function(t){return this.getItemProp(t,"visible")!==!1},isItemDisabled:function(t){return this.getItemProp(t,"disabled")},isItemFocused:function(t){return this.focusedItemId===this.getItemId(t)},isItemGroup:function(t){return Qt(t.items)},onItemClick:function(t,e){this.getItemProp(e,"command",{originalEvent:t,item:e.item}),this.$emit("item-toggle",{processedItem:e,expanded:!this.isItemActive(e)})},onItemToggle:function(t){this.$emit("item-toggle",t)},onItemMouseMove:function(t,e){this.$emit("item-mousemove",{originalEvent:t,processedItem:e})},getAriaSetSize:function(){var t=this;return this.items.filter(function(e){return t.isItemVisible(e)&&!t.getItemProp(e,"separator")}).length},getAriaPosInset:function(t){var e=this;return t-this.items.slice(0,t).filter(function(i){return e.isItemVisible(i)&&e.getItemProp(i,"separator")}).length+1},getMenuItemProps:function(t,e){return{action:Q({class:this.cx("itemLink"),tabindex:-1},this.getPTOptions("itemLink",t,e)),icon:Q({class:[this.cx("itemIcon"),this.getItemProp(t,"icon")]},this.getPTOptions("itemIcon",t,e)),label:Q({class:this.cx("itemLabel")},this.getPTOptions("itemLabel",t,e)),submenuicon:Q({class:this.cx("submenuIcon")},this.getPTOptions("submenuicon",t,e))}}},components:{ChevronRightIcon:xp,ChevronDownIcon:Ep},directives:{ripple:wp}},Eb=["tabindex"],xb=["id","aria-label","aria-expanded","aria-level","aria-setsize","aria-posinset","data-p-focused","data-p-disabled"],Cb=["onClick","onMousemove"],kb=["href","target"];function Tb(l,t,e,i,s,n){var a=Ri("PanelMenuSub",!0),o=Od("ripple");return F(),$("ul",{class:yi(l.cx("submenu")),tabindex:e.tabindex},[(F(!0),$(Ee,null,xa(e.items,function(h,c){return F(),$(Ee,{key:n.getItemKey(h)},[n.isItemVisible(h)&&!n.getItemProp(h,"separator")?(F(),$("li",Q({key:0,id:n.getItemId(h),class:[l.cx("item",{processedItem:h}),n.getItemProp(h,"class")],style:n.getItemProp(h,"style"),role:"treeitem","aria-label":n.getItemLabel(h),"aria-expanded":n.isItemGroup(h)?n.isItemActive(h):void 0,"aria-level":e.level+1,"aria-setsize":n.getAriaSetSize(),"aria-posinset":n.getAriaPosInset(c),ref_for:!0},n.getPTOptions("item",h,c),{"data-p-focused":n.isItemFocused(h),"data-p-disabled":n.isItemDisabled(h)}),[K("div",Q({class:l.cx("itemContent"),onClick:function(u){return n.onItemClick(u,h)},onMousemove:function(u){return n.onItemMouseMove(u,h)},ref_for:!0},n.getPTOptions("itemContent",h,c)),[e.templates.item?(F(),Zt(Pi(e.templates.item),{key:1,item:h.item,root:!1,active:n.isItemActive(h),hasSubmenu:n.isItemGroup(h),label:n.getItemLabel(h),props:n.getMenuItemProps(h,c)},null,8,["item","active","hasSubmenu","label","props"])):or((F(),$("a",Q({key:0,href:n.getItemProp(h,"url"),class:l.cx("itemLink"),target:n.getItemProp(h,"target"),tabindex:"-1",ref_for:!0},n.getPTOptions("itemLink",h,c)),[n.isItemGroup(h)?(F(),$(Ee,{key:0},[e.templates.submenuicon?(F(),Zt(Pi(e.templates.submenuicon),Q({key:0,class:l.cx("submenuIcon"),active:n.isItemActive(h),ref_for:!0},n.getPTOptions("submenuIcon",h,c)),null,16,["class","active"])):(F(),Zt(Pi(n.isItemActive(h)?"ChevronDownIcon":"ChevronRightIcon"),Q({key:1,class:l.cx("submenuIcon"),ref_for:!0},n.getPTOptions("submenuIcon",h,c)),null,16,["class"]))],64)):gt("",!0),e.templates.itemicon?(F(),Zt(Pi(e.templates.itemicon),{key:1,item:h.item,class:yi(l.cx("itemIcon"))},null,8,["item","class"])):n.getItemProp(h,"icon")?(F(),$("span",Q({key:2,class:[l.cx("itemIcon"),n.getItemProp(h,"icon")],ref_for:!0},n.getPTOptions("itemIcon",h,c)),null,16)):gt("",!0),K("span",Q({class:l.cx("itemLabel"),ref_for:!0},n.getPTOptions("itemLabel",h,c)),Ie(n.getItemLabel(h)),17)],16,kb)),[[o]])],16,Cb),vt(Nd,Q({name:"p-toggleable-content",ref_for:!0},l.ptm("transition")),{default:gi(function(){return[or(K("div",Q({class:l.cx("contentContainer"),ref_for:!0},l.ptm("contentContainer")),[n.isItemVisible(h)&&n.isItemGroup(h)?(F(),Zt(a,Q({key:0,id:n.getItemId(h)+"_list",role:"group",panelId:e.panelId,focusedItemId:e.focusedItemId,items:h.items,level:e.level+1,templates:e.templates,activeItemPath:e.activeItemPath,onItemToggle:n.onItemToggle,onItemMousemove:t[0]||(t[0]=function(d){return l.$emit("item-mousemove",d)}),pt:l.pt,unstyled:l.unstyled,ref_for:!0},l.ptm("submenu")),null,16,["id","panelId","focusedItemId","items","level","templates","activeItemPath","onItemToggle","pt","unstyled"])):gt("",!0)],16),[[_p,n.isItemActive(h)]])]}),_:2},1040)],16,xb)):gt("",!0),n.isItemVisible(h)&&n.getItemProp(h,"separator")?(F(),$("li",Q({key:1,style:n.getItemProp(h,"style"),class:[l.cx("separator"),n.getItemProp(h,"class")],role:"separator",ref_for:!0},l.ptm("separator")),null,16)):gt("",!0)],64)}),128))],10,Eb)}Tp.render=Tb;function Pb(l,t){return Db(l)||Mb(l,t)||Rb(l,t)||Lb()}function Lb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rb(l,t){if(l){if(typeof l=="string")return Vf(l,t);var e={}.toString.call(l).slice(8,-1);return e==="Object"&&l.constructor&&(e=l.constructor.name),e==="Map"||e==="Set"?Array.from(l):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Vf(l,t):void 0}}function Vf(l,t){(t==null||t>l.length)&&(t=l.length);for(var e=0,i=Array(t);e<t;e++)i[e]=l[e];return i}function Mb(l,t){var e=l==null?null:typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(e!=null){var i,s,n,a,o=[],h=!0,c=!1;try{if(n=(e=e.call(l)).next,t!==0)for(;!(h=(i=n.call(e)).done)&&(o.push(i.value),o.length!==t);h=!0);}catch(d){c=!0,s=d}finally{try{if(!h&&e.return!=null&&(a=e.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function Db(l){if(Array.isArray(l))return l}var Pp={name:"PanelMenuList",hostName:"PanelMenu",extends:nl,emits:["item-toggle","header-focus"],props:{panelId:{type:String,default:null},items:{type:Array,default:null},templates:{type:Object,default:null},expandedKeys:{type:Object,default:null}},searchTimeout:null,searchValue:null,data:function(){return{focused:!1,focusedItem:null,activeItemPath:[]}},watch:{expandedKeys:function(t){this.autoUpdateActiveItemPath(t)}},mounted:function(){this.autoUpdateActiveItemPath(this.expandedKeys)},methods:{getItemProp:function(t,e){return t&&t.item?dc(t.item[e]):void 0},getItemLabel:function(t){return this.getItemProp(t,"label")},isItemVisible:function(t){return this.getItemProp(t,"visible")!==!1},isItemDisabled:function(t){return this.getItemProp(t,"disabled")},isItemActive:function(t){return this.activeItemPath.some(function(e){return e.key===t.parentKey})},isItemGroup:function(t){return Qt(t.items)},onFocus:function(t){this.focused=!0,this.focusedItem=this.focusedItem||(this.isElementInPanel(t,t.relatedTarget)?this.findFirstItem():this.findLastItem())},onBlur:function(){this.focused=!1,this.focusedItem=null,this.searchValue=""},onKeyDown:function(t){var e=t.metaKey||t.ctrlKey;switch(t.code){case"ArrowDown":this.onArrowDownKey(t);break;case"ArrowUp":this.onArrowUpKey(t);break;case"ArrowLeft":this.onArrowLeftKey(t);break;case"ArrowRight":this.onArrowRightKey(t);break;case"Home":this.onHomeKey(t);break;case"End":this.onEndKey(t);break;case"Space":this.onSpaceKey(t);break;case"Enter":case"NumpadEnter":this.onEnterKey(t);break;case"Escape":case"Tab":case"PageDown":case"PageUp":case"Backspace":case"ShiftLeft":case"ShiftRight":break;default:!e&&Ap(t.key)&&this.searchItems(t,t.key);break}},onArrowDownKey:function(t){var e=Qt(this.focusedItem)?this.findNextItem(this.focusedItem):this.findFirstItem();this.changeFocusedItem({originalEvent:t,processedItem:e,focusOnNext:!0}),t.preventDefault()},onArrowUpKey:function(t){var e=Qt(this.focusedItem)?this.findPrevItem(this.focusedItem):this.findLastItem();this.changeFocusedItem({originalEvent:t,processedItem:e,selfCheck:!0}),t.preventDefault()},onArrowLeftKey:function(t){var e=this;if(Qt(this.focusedItem)){var i=this.activeItemPath.some(function(s){return s.key===e.focusedItem.key});i?this.activeItemPath=this.activeItemPath.filter(function(s){return s.key!==e.focusedItem.key}):this.focusedItem=Qt(this.focusedItem.parent)?this.focusedItem.parent:this.focusedItem,t.preventDefault()}},onArrowRightKey:function(t){var e=this;if(Qt(this.focusedItem)){var i=this.isItemGroup(this.focusedItem);if(i){var s=this.activeItemPath.some(function(n){return n.key===e.focusedItem.key});s?this.onArrowDownKey(t):(this.activeItemPath=this.activeItemPath.filter(function(n){return n.parentKey!==e.focusedItem.parentKey}),this.activeItemPath.push(this.focusedItem))}t.preventDefault()}},onHomeKey:function(t){this.changeFocusedItem({originalEvent:t,processedItem:this.findFirstItem(),allowHeaderFocus:!1}),t.preventDefault()},onEndKey:function(t){this.changeFocusedItem({originalEvent:t,processedItem:this.findLastItem(),focusOnNext:!0,allowHeaderFocus:!1}),t.preventDefault()},onEnterKey:function(t){if(Qt(this.focusedItem)){var e=pi(this.$el,'li[id="'.concat("".concat(this.focusedItemId),'"]')),i=e&&(pi(e,'[data-pc-section="itemlink"]')||pi(e,"a,button"));i?i.click():e&&e.click()}t.preventDefault()},onSpaceKey:function(t){this.onEnterKey(t)},onItemToggle:function(t){var e=t.processedItem,i=t.expanded;this.expandedKeys?this.$emit("item-toggle",{item:e.item,expanded:i}):(this.activeItemPath=this.activeItemPath.filter(function(s){return s.parentKey!==e.parentKey}),i&&this.activeItemPath.push(e)),this.focusedItem=e,ki(this.$el)},onItemMouseMove:function(t){this.focused&&(this.focusedItem=t.processedItem)},isElementInPanel:function(t,e){var i=t.currentTarget.closest('[data-pc-section="panel"]');return i&&i.contains(e)},isItemMatched:function(t){var e;return this.isValidItem(t)&&((e=this.getItemLabel(t))===null||e===void 0?void 0:e.toLocaleLowerCase(this.searchLocale).startsWith(this.searchValue.toLocaleLowerCase(this.searchLocale)))},isVisibleItem:function(t){return!!t&&(t.level===0||this.isItemActive(t))&&this.isItemVisible(t)},isValidItem:function(t){return!!t&&!this.isItemDisabled(t)&&!this.getItemProp(t,"separator")},findFirstItem:function(){var t=this;return this.visibleItems.find(function(e){return t.isValidItem(e)})},findLastItem:function(){var t=this;return jf(this.visibleItems,function(e){return t.isValidItem(e)})},findNextItem:function(t){var e=this,i=this.visibleItems.findIndex(function(n){return n.key===t.key}),s=i<this.visibleItems.length-1?this.visibleItems.slice(i+1).find(function(n){return e.isValidItem(n)}):void 0;return s||t},findPrevItem:function(t){var e=this,i=this.visibleItems.findIndex(function(n){return n.key===t.key}),s=i>0?jf(this.visibleItems.slice(0,i),function(n){return e.isValidItem(n)}):void 0;return s||t},searchItems:function(t,e){var i=this;this.searchValue=(this.searchValue||"")+e;var s=null,n=!1;if(Qt(this.focusedItem)){var a=this.visibleItems.findIndex(function(o){return o.key===i.focusedItem.key});s=this.visibleItems.slice(a).find(function(o){return i.isItemMatched(o)}),s=wr(s)?this.visibleItems.slice(0,a).find(function(o){return i.isItemMatched(o)}):s}else s=this.visibleItems.find(function(o){return i.isItemMatched(o)});return Qt(s)&&(n=!0),wr(s)&&wr(this.focusedItem)&&(s=this.findFirstItem()),Qt(s)&&this.changeFocusedItem({originalEvent:t,processedItem:s,allowHeaderFocus:!1}),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(function(){i.searchValue="",i.searchTimeout=null},500),n},changeFocusedItem:function(t){var e=t.originalEvent,i=t.processedItem,s=t.focusOnNext,n=t.selfCheck,a=t.allowHeaderFocus,o=a===void 0?!0:a;Qt(this.focusedItem)&&this.focusedItem.key!==i.key?(this.focusedItem=i,this.scrollInView()):o&&this.$emit("header-focus",{originalEvent:e,focusOnNext:s,selfCheck:n})},scrollInView:function(){var t=pi(this.$el,'li[id="'.concat("".concat(this.focusedItemId),'"]'));t&&t.scrollIntoView&&t.scrollIntoView({block:"nearest",inline:"start"})},autoUpdateActiveItemPath:function(t){var e=this;this.activeItemPath=Object.entries(t||{}).reduce(function(i,s){var n=Pb(s,2),a=n[0],o=n[1];if(o){var h=e.findProcessedItemByItemKey(a);h&&i.push(h)}return i},[])},findProcessedItemByItemKey:function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(e=e||i===0&&this.processedItems,!e)return null;for(var s=0;s<e.length;s++){var n=e[s];if(this.getItemProp(n,"key")===t)return n;var a=this.findProcessedItemByItemKey(t,n.items,i+1);if(a)return a}},createProcessedItems:function(t){var e=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",a=[];return t&&t.forEach(function(o,h){var c=(n!==""?n+"_":"")+h,d={item:o,index:h,level:i,key:c,parent:s,parentKey:n};d.items=e.createProcessedItems(o.items,i+1,d,c),a.push(d)}),a},flatItems:function(t){var e=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t&&t.forEach(function(s){e.isVisibleItem(s)&&(i.push(s),e.flatItems(s.items,i))}),i}},computed:{processedItems:function(){return this.createProcessedItems(this.items||[])},visibleItems:function(){return this.flatItems(this.processedItems)},focusedItemId:function(){return Qt(this.focusedItem)?"".concat(this.panelId,"_").concat(this.focusedItem.key):null}},components:{PanelMenuSub:Tp}};function Fb(l,t,e,i,s,n){var a=Ri("PanelMenuSub");return F(),Zt(a,Q({id:e.panelId+"_list",class:l.cx("rootList"),role:"tree",tabindex:-1,"aria-activedescendant":s.focused?n.focusedItemId:void 0,panelId:e.panelId,focusedItemId:s.focused?n.focusedItemId:void 0,items:n.processedItems,templates:e.templates,activeItemPath:s.activeItemPath,onFocus:n.onFocus,onBlur:n.onBlur,onKeydown:n.onKeyDown,onItemToggle:n.onItemToggle,onItemMousemove:n.onItemMouseMove,pt:l.pt,unstyled:l.unstyled},l.ptm("rootList")),null,16,["id","class","aria-activedescendant","panelId","focusedItemId","items","templates","activeItemPath","onFocus","onBlur","onKeydown","onItemToggle","onItemMousemove","pt","unstyled"])}Pp.render=Fb;function Ll(l){"@babel/helpers - typeof";return Ll=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ll(l)}function Kf(l,t){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),e.push.apply(e,i)}return e}function Ob(l){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Kf(Object(e),!0).forEach(function(i){Nb(l,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):Kf(Object(e)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(e,i))})}return l}function Nb(l,t,e){return(t=Bb(t))in l?Object.defineProperty(l,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[t]=e,l}function Bb(l){var t=Hb(l,"string");return Ll(t)=="symbol"?t:t+""}function Hb(l,t){if(Ll(l)!="object"||!l)return l;var e=l[Symbol.toPrimitive];if(e!==void 0){var i=e.call(l,t);if(Ll(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(l)}var Lp={name:"PanelMenu",extends:Sb,inheritAttrs:!1,emits:["update:expandedKeys","panel-open","panel-close"],data:function(){return{activeItem:null,activeItems:[]}},methods:{getItemProp:function(t,e){return t?dc(t[e]):void 0},getItemLabel:function(t){return this.getItemProp(t,"label")},getPTOptions:function(t,e,i){return this.ptm(t,{context:{index:i,active:this.isItemActive(e),focused:this.isItemFocused(e),disabled:this.isItemDisabled(e)}})},isItemActive:function(t){return this.expandedKeys?this.expandedKeys[this.getItemProp(t,"key")]:this.multiple?this.activeItems.some(function(e){return Da(t,e)}):Da(t,this.activeItem)},isItemVisible:function(t){return this.getItemProp(t,"visible")!==!1},isItemDisabled:function(t){return this.getItemProp(t,"disabled")},isItemFocused:function(t){return Da(t,this.activeItem)},isItemGroup:function(t){return Qt(t.items)},getPanelId:function(t){return"".concat(this.$id,"_").concat(t)},getPanelKey:function(t){return this.getPanelId(t)},getHeaderId:function(t){return"".concat(this.getPanelId(t),"_header")},getContentId:function(t){return"".concat(this.getPanelId(t),"_content")},onHeaderClick:function(t,e){if(this.isItemDisabled(e)){t.preventDefault();return}e.command&&e.command({originalEvent:t,item:e}),this.changeActiveItem(t,e),ki(t.currentTarget)},onHeaderKeyDown:function(t,e){switch(t.code){case"ArrowDown":this.onHeaderArrowDownKey(t);break;case"ArrowUp":this.onHeaderArrowUpKey(t);break;case"Home":this.onHeaderHomeKey(t);break;case"End":this.onHeaderEndKey(t);break;case"Enter":case"NumpadEnter":case"Space":this.onHeaderEnterKey(t,e);break}},onHeaderArrowDownKey:function(t){var e=yc(t.currentTarget,"data-p-active")===!0?pi(t.currentTarget.nextElementSibling,'[data-pc-section="rootlist"]'):null;e?ki(e):this.updateFocusedHeader({originalEvent:t,focusOnNext:!0}),t.preventDefault()},onHeaderArrowUpKey:function(t){var e=this.findPrevHeader(t.currentTarget.parentElement)||this.findLastHeader(),i=yc(e,"data-p-active")===!0?pi(e.nextElementSibling,'[data-pc-section="rootlist"]'):null;i?ki(i):this.updateFocusedHeader({originalEvent:t,focusOnNext:!1}),t.preventDefault()},onHeaderHomeKey:function(t){this.changeFocusedHeader(t,this.findFirstHeader()),t.preventDefault()},onHeaderEndKey:function(t){this.changeFocusedHeader(t,this.findLastHeader()),t.preventDefault()},onHeaderEnterKey:function(t,e){var i=pi(t.currentTarget,'[data-pc-section="headerlink"]');i?i.click():this.onHeaderClick(t,e),t.preventDefault()},findNextHeader:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=e?t:t.nextElementSibling,s=pi(i,'[data-pc-section="header"]');return s?yc(s,"data-p-disabled")?this.findNextHeader(s.parentElement):s:null},findPrevHeader:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=e?t:t.previousElementSibling,s=pi(i,'[data-pc-section="header"]');return s?yc(s,"data-p-disabled")?this.findPrevHeader(s.parentElement):s:null},findFirstHeader:function(){return this.findNextHeader(this.$el.firstElementChild,!0)},findLastHeader:function(){return this.findPrevHeader(this.$el.lastElementChild,!0)},updateFocusedHeader:function(t){var e=t.originalEvent,i=t.focusOnNext,s=t.selfCheck,n=e.currentTarget.closest('[data-pc-section="panel"]'),a=s?pi(n,'[data-pc-section="header"]'):i?this.findNextHeader(n):this.findPrevHeader(n);a?this.changeFocusedHeader(e,a):i?this.onHeaderHomeKey(e):this.onHeaderEndKey(e)},changeActiveItem:function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!this.isItemDisabled(e)){var s=this.isItemActive(e),n=s?"panel-close":"panel-open";this.activeItem=i?e:this.activeItem&&Da(e,this.activeItem)?null:e,this.multiple&&(this.activeItems.some(function(a){return Da(e,a)})?this.activeItems=this.activeItems.filter(function(a){return!Da(e,a)}):this.activeItems.push(e)),this.changeExpandedKeys({item:e,expanded:!s}),this.$emit(n,{originalEvent:t,item:e})}},changeExpandedKeys:function(t){var e=t.item,i=t.expanded,s=i===void 0?!1:i;if(this.expandedKeys){var n=Ob({},this.expandedKeys);s?n[e.key]=!0:delete n[e.key],this.$emit("update:expandedKeys",n)}},changeFocusedHeader:function(t,e){e&&ki(e)},getMenuItemProps:function(t,e){return{icon:Q({class:[this.cx("headerIcon"),this.getItemProp(t,"icon")]},this.getPTOptions("headerIcon",t,e)),label:Q({class:this.cx("headerLabel")},this.getPTOptions("headerLabel",t,e))}}},components:{PanelMenuList:Pp,ChevronRightIcon:xp,ChevronDownIcon:Ep}},$b=["id"],zb=["id","tabindex","aria-label","aria-expanded","aria-controls","aria-disabled","onClick","onKeydown","data-p-active","data-p-disabled"],jb=["href"],Ub=["id","aria-labelledby"];function Vb(l,t,e,i,s,n){var a=Ri("PanelMenuList");return F(),$("div",Q({id:l.$id,class:l.cx("root")},l.ptmi("root")),[(F(!0),$(Ee,null,xa(l.model,function(o,h){return F(),$(Ee,{key:n.getPanelKey(h)},[n.isItemVisible(o)?(F(),$("div",Q({key:0,style:n.getItemProp(o,"style"),class:[l.cx("panel"),n.getItemProp(o,"class")],ref_for:!0},l.ptm("panel")),[K("div",Q({id:n.getHeaderId(h),class:[l.cx("header",{item:o}),n.getItemProp(o,"headerClass")],tabindex:n.isItemDisabled(o)?-1:l.tabindex,role:"button","aria-label":n.getItemLabel(o),"aria-expanded":n.isItemActive(o),"aria-controls":n.getContentId(h),"aria-disabled":n.isItemDisabled(o),onClick:function(d){return n.onHeaderClick(d,o)},onKeydown:function(d){return n.onHeaderKeyDown(d,o)},ref_for:!0},n.getPTOptions("header",o,h),{"data-p-active":n.isItemActive(o),"data-p-disabled":n.isItemDisabled(o)}),[K("div",Q({class:l.cx("headerContent"),ref_for:!0},n.getPTOptions("headerContent",o,h)),[l.$slots.item?(F(),Zt(Pi(l.$slots.item),{key:1,item:o,root:!0,active:n.isItemActive(o),hasSubmenu:n.isItemGroup(o),label:n.getItemLabel(o),props:n.getMenuItemProps(o,h)},null,8,["item","active","hasSubmenu","label","props"])):(F(),$("a",Q({key:0,href:n.getItemProp(o,"url"),class:l.cx("headerLink"),tabindex:-1,ref_for:!0},n.getPTOptions("headerLink",o,h)),[n.getItemProp(o,"items")?As(l.$slots,"submenuicon",{key:0,active:n.isItemActive(o)},function(){return[(F(),Zt(Pi(n.isItemActive(o)?"ChevronDownIcon":"ChevronRightIcon"),Q({class:l.cx("submenuIcon"),ref_for:!0},n.getPTOptions("submenuIcon",o,h)),null,16,["class"]))]}):gt("",!0),l.$slots.headericon?(F(),Zt(Pi(l.$slots.headericon),{key:1,item:o,class:yi([l.cx("headerIcon"),n.getItemProp(o,"icon")])},null,8,["item","class"])):n.getItemProp(o,"icon")?(F(),$("span",Q({key:2,class:[l.cx("headerIcon"),n.getItemProp(o,"icon")],ref_for:!0},n.getPTOptions("headerIcon",o,h)),null,16)):gt("",!0),K("span",Q({class:l.cx("headerLabel"),ref_for:!0},n.getPTOptions("headerLabel",o,h)),Ie(n.getItemLabel(o)),17)],16,jb))],16)],16,zb),vt(Nd,Q({name:"p-toggleable-content",ref_for:!0},l.ptm("transition")),{default:gi(function(){return[or(K("div",Q({id:n.getContentId(h),class:l.cx("contentContainer"),role:"region","aria-labelledby":n.getHeaderId(h),ref_for:!0},l.ptm("contentContainer")),[n.getItemProp(o,"items")?(F(),$("div",Q({key:0,class:l.cx("content"),ref_for:!0},l.ptm("content")),[vt(a,{panelId:n.getPanelId(h),items:n.getItemProp(o,"items"),templates:l.$slots,expandedKeys:l.expandedKeys,onItemToggle:n.changeExpandedKeys,onHeaderFocus:n.updateFocusedHeader,pt:l.pt,unstyled:l.unstyled},null,8,["panelId","items","templates","expandedKeys","onItemToggle","onHeaderFocus","pt","unstyled"])],16)):gt("",!0)],16,Ub),[[_p,n.isItemActive(o)]])]}),_:2},1040)],16)):gt("",!0)],64)}),128))],16,$b)}Lp.render=Vb;const Kb=pn({__name:"BaseAsideMenu",setup(l){const t=Xg(),e=Ip(),i=qg(),s=Lt([{label:"Dasbor",icon:"pi pi-fw pi-home",items:[{label:"Halaman Utama",command:()=>{t.push("/sysadmin/home")}}]},{label:"Ujian",icon:"pi pi-fw pi-book",items:[{label:"Sesi Ujian",command:()=>{t.push("/sysadmin/sessions")}}]},{label:"Instansi",icon:"pi pi-fw pi-building",items:[{label:"Kelola Instansi",command:()=>{t.push("/sysadmin/instances")}}]},{label:"Partisipan",icon:"pi pi-fw pi-users",items:[{label:"Kelola Partisipan",command:()=>{t.push("/sysadmin/participants")}}]},{label:"Soal",icon:"pi pi-fw pi-pencil",items:[{label:"Kategori Soal",command:()=>{t.push("/sysadmin/questioncat")}},{label:"Materi",command:()=>{t.push("/sysadmin/materi")}},{label:"Kelola Soal",command:()=>{t.push("/sysadmin/questions")}}]},{label:"Laporan",icon:"pi pi-fw pi-chart-bar",items:[{label:"Monitoring Ujian",command:()=>{t.push("/sysadmin/sessions/monitoring")}},{label:"Laporan Grafik",command:()=>{t.push("/sysadmin/report/graphical")}},{label:"Laporan Tabular",command:()=>{t.push("/sysadmin/report/tabular")}}]},{label:"Akun",icon:"pi pi-fw pi-user",items:[{label:"Kelola Akun",command:()=>{t.push("/sysadmin/account")}},{label:"Keluar",command:()=>{n()}}]},{label:"Pengaturan",icon:"pi pi-fw pi-cog",items:[{label:"Pengaturan Asesmen",command:()=>{t.push("/sysadmin/settings")}}]}]),n=()=>{i.require({message:"Anda yakin? Anda dapat masuk kembali kapan saja.",header:"Keluar",icon:"pi pi-power-off",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Keluar",icon:"pi pi-power-off"},accept:()=>{e.add({severity:"info",summary:"Logout success!",detail:"Redirecting. Please wait...",life:2e3}),setTimeout(()=>{localStorage.removeItem("authToken"),window.location.href="/auth/webmaster"},2e3)}})};return(a,o)=>(F(),Zt(Rt(Lp),{model:s.value},null,8,["model"]))}}),Gb=pn({__name:"AsideNav",setup(l){const t=Bd();return(e,i)=>(F(),$("div",{class:yi(Rt(t).mTheme=="theme-light"?"aside-nav":"aside-nav-dark")},[vt(Kb)],2))}}),Wb=rl(Gb,[["__scopeId","data-v-c070371f"]]),qb={class:"logo-parent"},Xb={key:0,class:"brand-text",style:{"font-size":"1.2rem"}},Yb=pn({__name:"Logo",props:{brandText:{type:String,required:!1,default:""}},setup(l){const t=l;return(e,i)=>(F(),$("div",qb,[i[0]||(i[0]=K("img",{src:"https://upload.wikimedia.org/wikipedia/commons/0/0d/Logo_UIN_STS_Jambi.jpg",alt:"logo"},null,-1)),t.brandText?(F(),$("span",Xb,[K("b",null,Ie(t.brandText),1)])):gt("",!0)]))}}),Qb=rl(Yb,[["__scopeId","data-v-72d8647a"]]);var Jb=({dt:l})=>`
.p-menubar {
    display: flex;
    align-items: center;
    background: ${l("menubar.background")};
    border: 1px solid ${l("menubar.border.color")};
    border-radius: ${l("menubar.border.radius")};
    color: ${l("menubar.color")};
    padding: ${l("menubar.padding")};
    gap: ${l("menubar.gap")};
}

.p-menubar-start,
.p-megamenu-end {
    display: flex;
    align-items: center;
}

.p-menubar-root-list,
.p-menubar-submenu {
    display: flex;
    margin: 0;
    padding: 0;
    list-style: none;
    outline: 0 none;
}

.p-menubar-root-list {
    align-items: center;
    flex-wrap: wrap;
    gap: ${l("menubar.gap")};
}

.p-menubar-root-list > .p-menubar-item > .p-menubar-item-content {
    border-radius: ${l("menubar.base.item.border.radius")};
}

.p-menubar-root-list > .p-menubar-item > .p-menubar-item-content > .p-menubar-item-link {
    padding: ${l("menubar.base.item.padding")};
}

.p-menubar-item-content {
    transition: background ${l("menubar.transition.duration")}, color ${l("menubar.transition.duration")};
    border-radius: ${l("menubar.item.border.radius")};
    color: ${l("menubar.item.color")};
}

.p-menubar-item-link {
    cursor: pointer;
    display: flex;
    align-items: center;
    text-decoration: none;
    overflow: hidden;
    position: relative;
    color: inherit;
    padding: ${l("menubar.item.padding")};
    gap: ${l("menubar.item.gap")};
    user-select: none;
    outline: 0 none;
}

.p-menubar-item-label {
    line-height: 1;
}

.p-menubar-item-icon {
    color: ${l("menubar.item.icon.color")};
}

.p-menubar-submenu-icon {
    color: ${l("menubar.submenu.icon.color")};
    margin-left: auto;
    font-size: ${l("menubar.submenu.icon.size")};
    width: ${l("menubar.submenu.icon.size")};
    height: ${l("menubar.submenu.icon.size")};
}

.p-menubar-submenu .p-menubar-submenu-icon:dir(rtl) {
    margin-left: 0;
    margin-right: auto;
}

.p-menubar-item.p-focus > .p-menubar-item-content {
    color: ${l("menubar.item.focus.color")};
    background: ${l("menubar.item.focus.background")};
}

.p-menubar-item.p-focus > .p-menubar-item-content .p-menubar-item-icon {
    color: ${l("menubar.item.icon.focus.color")};
}

.p-menubar-item.p-focus > .p-menubar-item-content .p-menubar-submenu-icon {
    color: ${l("menubar.submenu.icon.focus.color")};
}

.p-menubar-item:not(.p-disabled) > .p-menubar-item-content:hover {
    color: ${l("menubar.item.focus.color")};
    background: ${l("menubar.item.focus.background")};
}

.p-menubar-item:not(.p-disabled) > .p-menubar-item-content:hover .p-menubar-item-icon {
    color: ${l("menubar.item.icon.focus.color")};
}

.p-menubar-item:not(.p-disabled) > .p-menubar-item-content:hover .p-menubar-submenu-icon {
    color: ${l("menubar.submenu.icon.focus.color")};
}

.p-menubar-item-active > .p-menubar-item-content {
    color: ${l("menubar.item.active.color")};
    background: ${l("menubar.item.active.background")};
}

.p-menubar-item-active > .p-menubar-item-content .p-menubar-item-icon {
    color: ${l("menubar.item.icon.active.color")};
}

.p-menubar-item-active > .p-menubar-item-content .p-menubar-submenu-icon {
    color: ${l("menubar.submenu.icon.active.color")};
}

.p-menubar-submenu {
    display: none;
    position: absolute;
    min-width: 12.5rem;
    z-index: 1;
    background: ${l("menubar.submenu.background")};
    border: 1px solid ${l("menubar.submenu.border.color")};
    border-radius: ${l("menubar.submenu.border.radius")};
    box-shadow: ${l("menubar.submenu.shadow")};
    color: ${l("menubar.submenu.color")};
    flex-direction: column;
    padding: ${l("menubar.submenu.padding")};
    gap: ${l("menubar.submenu.gap")};
}

.p-menubar-submenu .p-menubar-separator {
    border-block-start: 1px solid ${l("menubar.separator.border.color")};
}

.p-menubar-submenu .p-menubar-item {
    position: relative;
}

.p-menubar-submenu > .p-menubar-item-active > .p-menubar-submenu {
    display: block;
    left: 100%;
    top: 0;
}

.p-menubar-end {
    margin-left: auto;
    align-self: center;
}

.p-menubar-end:dir(rtl) {
    margin-left: 0;
    margin-right: auto;
}

.p-menubar-button {
    display: none;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    width: ${l("menubar.mobile.button.size")};
    height: ${l("menubar.mobile.button.size")};
    position: relative;
    color: ${l("menubar.mobile.button.color")};
    border: 0 none;
    background: transparent;
    border-radius: ${l("menubar.mobile.button.border.radius")};
    transition: background ${l("menubar.transition.duration")}, color ${l("menubar.transition.duration")}, outline-color ${l("menubar.transition.duration")};
    outline-color: transparent;
}

.p-menubar-button:hover {
    color: ${l("menubar.mobile.button.hover.color")};
    background: ${l("menubar.mobile.button.hover.background")};
}

.p-menubar-button:focus-visible {
    box-shadow: ${l("menubar.mobile.button.focus.ring.shadow")};
    outline: ${l("menubar.mobile.button.focus.ring.width")} ${l("menubar.mobile.button.focus.ring.style")} ${l("menubar.mobile.button.focus.ring.color")};
    outline-offset: ${l("menubar.mobile.button.focus.ring.offset")};
}

.p-menubar-mobile {
    position: relative;
}

.p-menubar-mobile .p-menubar-button {
    display: flex;
}

.p-menubar-mobile .p-menubar-root-list {
    position: absolute;
    display: none;
    width: 100%;
    flex-direction: column;
    top: 100%;
    left: 0;
    z-index: 1;
    padding: ${l("menubar.submenu.padding")};
    background: ${l("menubar.submenu.background")};
    border: 1px solid ${l("menubar.submenu.border.color")};
    box-shadow: ${l("menubar.submenu.shadow")};
    border-radius: ${l("menubar.submenu.border.radius")};
    gap: ${l("menubar.submenu.gap")};
}

.p-menubar-mobile .p-menubar-root-list:dir(rtl) {
    left: auto;
    right: 0;
}

.p-menubar-mobile .p-menubar-root-list > .p-menubar-item > .p-menubar-item-content > .p-menubar-item-link {
    padding: ${l("menubar.item.padding")};
}

.p-menubar-mobile-active .p-menubar-root-list {
    display: flex;
}

.p-menubar-mobile .p-menubar-root-list .p-menubar-item {
    width: 100%;
    position: static;
}

.p-menubar-mobile .p-menubar-root-list .p-menubar-separator {
    border-block-start: 1px solid ${l("menubar.separator.border.color")};
}

.p-menubar-mobile .p-menubar-root-list > .p-menubar-item > .p-menubar-item-content .p-menubar-submenu-icon {
    margin-left: auto;
    transition: transform 0.2s;
}

.p-menubar-mobile .p-menubar-root-list > .p-menubar-item > .p-menubar-item-content .p-menubar-submenu-icon:dir(rtl),
.p-menubar-mobile .p-menubar-submenu-icon:dir(rtl) {
    margin-left: 0;
    margin-right: auto;
}

.p-menubar-mobile .p-menubar-root-list > .p-menubar-item-active > .p-menubar-item-content .p-menubar-submenu-icon {
    transform: rotate(-180deg);
}

.p-menubar-mobile .p-menubar-submenu .p-menubar-submenu-icon {
    transition: transform 0.2s;
    transform: rotate(90deg);
}

.p-menubar-mobile .p-menubar-item-active > .p-menubar-item-content .p-menubar-submenu-icon {
    transform: rotate(-90deg);
}

.p-menubar-mobile .p-menubar-submenu {
    width: 100%;
    position: static;
    box-shadow: none;
    border: 0 none;
    padding-inline-start: ${l("menubar.submenu.mobile.indent")};
    padding-inline-end: 0;
}
`,Zb={submenu:function(t){var e=t.instance,i=t.processedItem;return{display:e.isItemActive(i)?"flex":"none"}}},ty={root:function(t){var e=t.instance;return["p-menubar p-component",{"p-menubar-mobile":e.queryMatches,"p-menubar-mobile-active":e.mobileActive}]},start:"p-menubar-start",button:"p-menubar-button",rootList:"p-menubar-root-list",item:function(t){var e=t.instance,i=t.processedItem;return["p-menubar-item",{"p-menubar-item-active":e.isItemActive(i),"p-focus":e.isItemFocused(i),"p-disabled":e.isItemDisabled(i)}]},itemContent:"p-menubar-item-content",itemLink:"p-menubar-item-link",itemIcon:"p-menubar-item-icon",itemLabel:"p-menubar-item-label",submenuIcon:"p-menubar-submenu-icon",submenu:"p-menubar-submenu",separator:"p-menubar-separator",end:"p-menubar-end"},ey=_f.extend({name:"menubar",style:Jb,classes:ty,inlineStyles:Zb}),iy={name:"BaseMenubar",extends:nl,props:{model:{type:Array,default:null},buttonProps:{type:null,default:null},breakpoint:{type:String,default:"960px"},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:ey,provide:function(){return{$pcMenubar:this,$parentInstance:this}}},Rp={name:"MenubarSub",hostName:"Menubar",extends:nl,emits:["item-mouseenter","item-click","item-mousemove"],props:{items:{type:Array,default:null},root:{type:Boolean,default:!1},popup:{type:Boolean,default:!1},mobileActive:{type:Boolean,default:!1},templates:{type:Object,default:null},level:{type:Number,default:0},menuId:{type:String,default:null},focusedItemId:{type:String,default:null},activeItemPath:{type:Object,default:null}},list:null,methods:{getItemId:function(t){return"".concat(this.menuId,"_").concat(t.key)},getItemKey:function(t){return this.getItemId(t)},getItemProp:function(t,e,i){return t&&t.item?dc(t.item[e],i):void 0},getItemLabel:function(t){return this.getItemProp(t,"label")},getItemLabelId:function(t){return"".concat(this.menuId,"_").concat(t.key,"_label")},getPTOptions:function(t,e,i){return this.ptm(i,{context:{item:t.item,index:e,active:this.isItemActive(t),focused:this.isItemFocused(t),disabled:this.isItemDisabled(t),level:this.level}})},isItemActive:function(t){return this.activeItemPath.some(function(e){return e.key===t.key})},isItemVisible:function(t){return this.getItemProp(t,"visible")!==!1},isItemDisabled:function(t){return this.getItemProp(t,"disabled")},isItemFocused:function(t){return this.focusedItemId===this.getItemId(t)},isItemGroup:function(t){return Qt(t.items)},onItemClick:function(t,e){this.getItemProp(e,"command",{originalEvent:t,item:e.item}),this.$emit("item-click",{originalEvent:t,processedItem:e,isFocus:!0})},onItemMouseEnter:function(t,e){this.$emit("item-mouseenter",{originalEvent:t,processedItem:e})},onItemMouseMove:function(t,e){this.$emit("item-mousemove",{originalEvent:t,processedItem:e})},getAriaPosInset:function(t){return t-this.calculateAriaSetSize.slice(0,t).length+1},getMenuItemProps:function(t,e){return{action:Q({class:this.cx("itemLink"),tabindex:-1},this.getPTOptions(t,e,"itemLink")),icon:Q({class:[this.cx("itemIcon"),this.getItemProp(t,"icon")]},this.getPTOptions(t,e,"itemIcon")),label:Q({class:this.cx("itemLabel")},this.getPTOptions(t,e,"itemLabel")),submenuicon:Q({class:this.cx("submenuIcon")},this.getPTOptions(t,e,"submenuIcon"))}}},computed:{calculateAriaSetSize:function(){var t=this;return this.items.filter(function(e){return t.isItemVisible(e)&&t.getItemProp(e,"separator")})},getAriaSetSize:function(){var t=this;return this.items.filter(function(e){return t.isItemVisible(e)&&!t.getItemProp(e,"separator")}).length}},components:{AngleRightIcon:ob,AngleDownIcon:ab},directives:{ripple:wp}},sy=["id","aria-label","aria-disabled","aria-expanded","aria-haspopup","aria-level","aria-setsize","aria-posinset","data-p-active","data-p-focused","data-p-disabled"],ny=["onClick","onMouseenter","onMousemove"],ry=["href","target"],ay=["id"],oy=["id"];function ly(l,t,e,i,s,n){var a=Ri("MenubarSub",!0),o=Od("ripple");return F(),$("ul",Q({class:e.level===0?l.cx("rootList"):l.cx("submenu")},e.level===0?l.ptm("rootList"):l.ptm("submenu")),[(F(!0),$(Ee,null,xa(e.items,function(h,c){return F(),$(Ee,{key:n.getItemKey(h)},[n.isItemVisible(h)&&!n.getItemProp(h,"separator")?(F(),$("li",Q({key:0,id:n.getItemId(h),style:n.getItemProp(h,"style"),class:[l.cx("item",{processedItem:h}),n.getItemProp(h,"class")],role:"menuitem","aria-label":n.getItemLabel(h),"aria-disabled":n.isItemDisabled(h)||void 0,"aria-expanded":n.isItemGroup(h)?n.isItemActive(h):void 0,"aria-haspopup":n.isItemGroup(h)&&!n.getItemProp(h,"to")?"menu":void 0,"aria-level":e.level+1,"aria-setsize":n.getAriaSetSize,"aria-posinset":n.getAriaPosInset(c),ref_for:!0},n.getPTOptions(h,c,"item"),{"data-p-active":n.isItemActive(h),"data-p-focused":n.isItemFocused(h),"data-p-disabled":n.isItemDisabled(h)}),[K("div",Q({class:l.cx("itemContent"),onClick:function(u){return n.onItemClick(u,h)},onMouseenter:function(u){return n.onItemMouseEnter(u,h)},onMousemove:function(u){return n.onItemMouseMove(u,h)},ref_for:!0},n.getPTOptions(h,c,"itemContent")),[e.templates.item?(F(),Zt(Pi(e.templates.item),{key:1,item:h.item,root:e.root,hasSubmenu:n.getItemProp(h,"items"),label:n.getItemLabel(h),props:n.getMenuItemProps(h,c)},null,8,["item","root","hasSubmenu","label","props"])):or((F(),$("a",Q({key:0,href:n.getItemProp(h,"url"),class:l.cx("itemLink"),target:n.getItemProp(h,"target"),tabindex:"-1",ref_for:!0},n.getPTOptions(h,c,"itemLink")),[e.templates.itemicon?(F(),Zt(Pi(e.templates.itemicon),{key:0,item:h.item,class:yi(l.cx("itemIcon"))},null,8,["item","class"])):n.getItemProp(h,"icon")?(F(),$("span",Q({key:1,class:[l.cx("itemIcon"),n.getItemProp(h,"icon")],ref_for:!0},n.getPTOptions(h,c,"itemIcon")),null,16)):gt("",!0),K("span",Q({id:n.getItemLabelId(h),class:l.cx("itemLabel"),ref_for:!0},n.getPTOptions(h,c,"itemLabel")),Ie(n.getItemLabel(h)),17,ay),n.getItemProp(h,"items")?(F(),$(Ee,{key:2},[e.templates.submenuicon?(F(),Zt(Pi(e.templates.submenuicon),{key:0,root:e.root,active:n.isItemActive(h),class:yi(l.cx("submenuIcon"))},null,8,["root","active","class"])):(F(),Zt(Pi(e.root?"AngleDownIcon":"AngleRightIcon"),Q({key:1,class:l.cx("submenuIcon"),ref_for:!0},n.getPTOptions(h,c,"submenuIcon")),null,16,["class"]))],64)):gt("",!0)],16,ry)),[[o]])],16,ny),n.isItemVisible(h)&&n.isItemGroup(h)?(F(),Zt(a,{key:0,id:n.getItemId(h)+"_list",menuId:e.menuId,role:"menu",style:Qg(l.sx("submenu",!0,{processedItem:h})),focusedItemId:e.focusedItemId,items:h.items,mobileActive:e.mobileActive,activeItemPath:e.activeItemPath,templates:e.templates,level:e.level+1,"aria-labelledby":n.getItemLabelId(h),pt:l.pt,unstyled:l.unstyled,onItemClick:t[0]||(t[0]=function(d){return l.$emit("item-click",d)}),onItemMouseenter:t[1]||(t[1]=function(d){return l.$emit("item-mouseenter",d)}),onItemMousemove:t[2]||(t[2]=function(d){return l.$emit("item-mousemove",d)})},null,8,["id","menuId","style","focusedItemId","items","mobileActive","activeItemPath","templates","level","aria-labelledby","pt","unstyled"])):gt("",!0)],16,sy)):gt("",!0),n.isItemVisible(h)&&n.getItemProp(h,"separator")?(F(),$("li",Q({key:1,id:n.getItemId(h),class:[l.cx("separator"),n.getItemProp(h,"class")],style:n.getItemProp(h,"style"),role:"separator",ref_for:!0},l.ptm("separator")),null,16,oy)):gt("",!0)],64)}),128))],16)}Rp.render=ly;var Mp={name:"Menubar",extends:iy,inheritAttrs:!1,emits:["focus","blur"],matchMediaListener:null,data:function(){return{mobileActive:!1,focused:!1,focusedItemInfo:{index:-1,level:0,parentKey:""},activeItemPath:[],dirty:!1,query:null,queryMatches:!1}},watch:{activeItemPath:function(t){Qt(t)?(this.bindOutsideClickListener(),this.bindResizeListener()):(this.unbindOutsideClickListener(),this.unbindResizeListener())}},outsideClickListener:null,container:null,menubar:null,mounted:function(){this.bindMatchMediaListener()},beforeUnmount:function(){this.mobileActive=!1,this.unbindOutsideClickListener(),this.unbindResizeListener(),this.unbindMatchMediaListener(),this.container&&Ga.clear(this.container),this.container=null},methods:{getItemProp:function(t,e){return t?dc(t[e]):void 0},getItemLabel:function(t){return this.getItemProp(t,"label")},isItemDisabled:function(t){return this.getItemProp(t,"disabled")},isItemVisible:function(t){return this.getItemProp(t,"visible")!==!1},isItemGroup:function(t){return Qt(this.getItemProp(t,"items"))},isItemSeparator:function(t){return this.getItemProp(t,"separator")},getProccessedItemLabel:function(t){return t?this.getItemLabel(t.item):void 0},isProccessedItemGroup:function(t){return t&&Qt(t.items)},toggle:function(t){var e=this;this.mobileActive?(this.mobileActive=!1,Ga.clear(this.menubar),this.hide()):(this.mobileActive=!0,Ga.set("menu",this.menubar,this.$primevue.config.zIndex.menu),setTimeout(function(){e.show()},1)),this.bindOutsideClickListener(),t.preventDefault()},show:function(){ki(this.menubar)},hide:function(t,e){var i=this;this.mobileActive&&(this.mobileActive=!1,setTimeout(function(){ki(i.$refs.menubutton)},0)),this.activeItemPath=[],this.focusedItemInfo={index:-1,level:0,parentKey:""},e&&ki(this.menubar),this.dirty=!1},onFocus:function(t){this.focused=!0,this.focusedItemInfo=this.focusedItemInfo.index!==-1?this.focusedItemInfo:{index:this.findFirstFocusedItemIndex(),level:0,parentKey:""},this.$emit("focus",t)},onBlur:function(t){this.focused=!1,this.focusedItemInfo={index:-1,level:0,parentKey:""},this.searchValue="",this.dirty=!1,this.$emit("blur",t)},onKeyDown:function(t){var e=t.metaKey||t.ctrlKey;switch(t.code){case"ArrowDown":this.onArrowDownKey(t);break;case"ArrowUp":this.onArrowUpKey(t);break;case"ArrowLeft":this.onArrowLeftKey(t);break;case"ArrowRight":this.onArrowRightKey(t);break;case"Home":this.onHomeKey(t);break;case"End":this.onEndKey(t);break;case"Space":this.onSpaceKey(t);break;case"Enter":case"NumpadEnter":this.onEnterKey(t);break;case"Escape":this.onEscapeKey(t);break;case"Tab":this.onTabKey(t);break;case"PageDown":case"PageUp":case"Backspace":case"ShiftLeft":case"ShiftRight":break;default:!e&&Ap(t.key)&&this.searchItems(t,t.key);break}},onItemChange:function(t,e){var i=t.processedItem,s=t.isFocus;if(!wr(i)){var n=i.index,a=i.key,o=i.level,h=i.parentKey,c=i.items,d=Qt(c),u=this.activeItemPath.filter(function(p){return p.parentKey!==h&&p.parentKey!==a});d&&u.push(i),this.focusedItemInfo={index:n,level:o,parentKey:h},d&&(this.dirty=!0),s&&ki(this.menubar),!(e==="hover"&&this.queryMatches)&&(this.activeItemPath=u)}},onItemClick:function(t){var e=t.originalEvent,i=t.processedItem,s=this.isProccessedItemGroup(i),n=wr(i.parent),a=this.isSelected(i);if(a){var o=i.index,h=i.key,c=i.level,d=i.parentKey;this.activeItemPath=this.activeItemPath.filter(function(p){return h!==p.key&&h.startsWith(p.key)}),this.focusedItemInfo={index:o,level:c,parentKey:d},this.dirty=!n,ki(this.menubar)}else if(s)this.onItemChange(t);else{var u=n?i:this.activeItemPath.find(function(p){return p.parentKey===""});this.hide(e),this.changeFocusedItemIndex(e,u?u.index:-1),this.mobileActive=!1,ki(this.menubar)}},onItemMouseEnter:function(t){this.dirty&&this.onItemChange(t,"hover")},onItemMouseMove:function(t){this.focused&&this.changeFocusedItemIndex(t,t.processedItem.index)},menuButtonClick:function(t){this.toggle(t)},menuButtonKeydown:function(t){(t.code==="Enter"||t.code==="NumpadEnter"||t.code==="Space")&&this.menuButtonClick(t)},onArrowDownKey:function(t){var e=this.visibleItems[this.focusedItemInfo.index],i=e?wr(e.parent):null;if(i){var s=this.isProccessedItemGroup(e);s&&(this.onItemChange({originalEvent:t,processedItem:e}),this.focusedItemInfo={index:-1,parentKey:e.key},this.onArrowRightKey(t))}else{var n=this.focusedItemInfo.index!==-1?this.findNextItemIndex(this.focusedItemInfo.index):this.findFirstFocusedItemIndex();this.changeFocusedItemIndex(t,n)}t.preventDefault()},onArrowUpKey:function(t){var e=this,i=this.visibleItems[this.focusedItemInfo.index],s=wr(i.parent);if(s){var n=this.isProccessedItemGroup(i);if(n){this.onItemChange({originalEvent:t,processedItem:i}),this.focusedItemInfo={index:-1,parentKey:i.key};var a=this.findLastItemIndex();this.changeFocusedItemIndex(t,a)}}else{var o=this.activeItemPath.find(function(c){return c.key===i.parentKey});if(this.focusedItemInfo.index===0)this.focusedItemInfo={index:-1,parentKey:o?o.parentKey:""},this.searchValue="",this.onArrowLeftKey(t),this.activeItemPath=this.activeItemPath.filter(function(c){return c.parentKey!==e.focusedItemInfo.parentKey});else{var h=this.focusedItemInfo.index!==-1?this.findPrevItemIndex(this.focusedItemInfo.index):this.findLastFocusedItemIndex();this.changeFocusedItemIndex(t,h)}}t.preventDefault()},onArrowLeftKey:function(t){var e=this,i=this.visibleItems[this.focusedItemInfo.index],s=i?this.activeItemPath.find(function(a){return a.key===i.parentKey}):null;if(s)this.onItemChange({originalEvent:t,processedItem:s}),this.activeItemPath=this.activeItemPath.filter(function(a){return a.parentKey!==e.focusedItemInfo.parentKey}),t.preventDefault();else{var n=this.focusedItemInfo.index!==-1?this.findPrevItemIndex(this.focusedItemInfo.index):this.findLastFocusedItemIndex();this.changeFocusedItemIndex(t,n),t.preventDefault()}},onArrowRightKey:function(t){var e=this.visibleItems[this.focusedItemInfo.index],i=e?this.activeItemPath.find(function(a){return a.key===e.parentKey}):null;if(i){var s=this.isProccessedItemGroup(e);s&&(this.onItemChange({originalEvent:t,processedItem:e}),this.focusedItemInfo={index:-1,parentKey:e.key},this.onArrowDownKey(t))}else{var n=this.focusedItemInfo.index!==-1?this.findNextItemIndex(this.focusedItemInfo.index):this.findFirstFocusedItemIndex();this.changeFocusedItemIndex(t,n),t.preventDefault()}},onHomeKey:function(t){this.changeFocusedItemIndex(t,this.findFirstItemIndex()),t.preventDefault()},onEndKey:function(t){this.changeFocusedItemIndex(t,this.findLastItemIndex()),t.preventDefault()},onEnterKey:function(t){if(this.focusedItemInfo.index!==-1){var e=pi(this.menubar,'li[id="'.concat("".concat(this.focusedItemId),'"]')),i=e&&pi(e,'a[data-pc-section="itemlink"]');i?i.click():e&&e.click();var s=this.visibleItems[this.focusedItemInfo.index],n=this.isProccessedItemGroup(s);!n&&(this.focusedItemInfo.index=this.findFirstFocusedItemIndex())}t.preventDefault()},onSpaceKey:function(t){this.onEnterKey(t)},onEscapeKey:function(t){if(this.focusedItemInfo.level!==0){var e=this.focusedItemInfo;this.hide(t,!1),this.focusedItemInfo={index:Number(e.parentKey.split("_")[0]),level:0,parentKey:""}}t.preventDefault()},onTabKey:function(t){if(this.focusedItemInfo.index!==-1){var e=this.visibleItems[this.focusedItemInfo.index],i=this.isProccessedItemGroup(e);!i&&this.onItemChange({originalEvent:t,processedItem:e})}this.hide()},bindOutsideClickListener:function(){var t=this;this.outsideClickListener||(this.outsideClickListener=function(e){var i=t.container&&!t.container.contains(e.target),s=!(t.target&&(t.target===e.target||t.target.contains(e.target)));i&&s&&t.hide()},document.addEventListener("click",this.outsideClickListener,!0))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener,!0),this.outsideClickListener=null)},bindResizeListener:function(){var t=this;this.resizeListener||(this.resizeListener=function(e){Yg()||t.hide(e,!0),t.mobileActive=!1},window.addEventListener("resize",this.resizeListener))},unbindResizeListener:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},bindMatchMediaListener:function(){var t=this;if(!this.matchMediaListener){var e=matchMedia("(max-width: ".concat(this.breakpoint,")"));this.query=e,this.queryMatches=e.matches,this.matchMediaListener=function(){t.queryMatches=e.matches,t.mobileActive=!1},this.query.addEventListener("change",this.matchMediaListener)}},unbindMatchMediaListener:function(){this.matchMediaListener&&(this.query.removeEventListener("change",this.matchMediaListener),this.matchMediaListener=null)},isItemMatched:function(t){var e;return this.isValidItem(t)&&((e=this.getProccessedItemLabel(t))===null||e===void 0?void 0:e.toLocaleLowerCase().startsWith(this.searchValue.toLocaleLowerCase()))},isValidItem:function(t){return!!t&&!this.isItemDisabled(t.item)&&!this.isItemSeparator(t.item)&&this.isItemVisible(t.item)},isValidSelectedItem:function(t){return this.isValidItem(t)&&this.isSelected(t)},isSelected:function(t){return this.activeItemPath.some(function(e){return e.key===t.key})},findFirstItemIndex:function(){var t=this;return this.visibleItems.findIndex(function(e){return t.isValidItem(e)})},findLastItemIndex:function(){var t=this;return Uf(this.visibleItems,function(e){return t.isValidItem(e)})},findNextItemIndex:function(t){var e=this,i=t<this.visibleItems.length-1?this.visibleItems.slice(t+1).findIndex(function(s){return e.isValidItem(s)}):-1;return i>-1?i+t+1:t},findPrevItemIndex:function(t){var e=this,i=t>0?Uf(this.visibleItems.slice(0,t),function(s){return e.isValidItem(s)}):-1;return i>-1?i:t},findSelectedItemIndex:function(){var t=this;return this.visibleItems.findIndex(function(e){return t.isValidSelectedItem(e)})},findFirstFocusedItemIndex:function(){var t=this.findSelectedItemIndex();return t<0?this.findFirstItemIndex():t},findLastFocusedItemIndex:function(){var t=this.findSelectedItemIndex();return t<0?this.findLastItemIndex():t},searchItems:function(t,e){var i=this;this.searchValue=(this.searchValue||"")+e;var s=-1,n=!1;return this.focusedItemInfo.index!==-1?(s=this.visibleItems.slice(this.focusedItemInfo.index).findIndex(function(a){return i.isItemMatched(a)}),s=s===-1?this.visibleItems.slice(0,this.focusedItemInfo.index).findIndex(function(a){return i.isItemMatched(a)}):s+this.focusedItemInfo.index):s=this.visibleItems.findIndex(function(a){return i.isItemMatched(a)}),s!==-1&&(n=!0),s===-1&&this.focusedItemInfo.index===-1&&(s=this.findFirstFocusedItemIndex()),s!==-1&&this.changeFocusedItemIndex(t,s),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(function(){i.searchValue="",i.searchTimeout=null},500),n},changeFocusedItemIndex:function(t,e){this.focusedItemInfo.index!==e&&(this.focusedItemInfo.index=e,this.scrollInView())},scrollInView:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,e=t!==-1?"".concat(this.$id,"_").concat(t):this.focusedItemId,i=pi(this.menubar,'li[id="'.concat(e,'"]'));i&&i.scrollIntoView&&i.scrollIntoView({block:"nearest",inline:"start"})},createProcessedItems:function(t){var e=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",a=[];return t&&t.forEach(function(o,h){var c=(n!==""?n+"_":"")+h,d={item:o,index:h,level:i,key:c,parent:s,parentKey:n};d.items=e.createProcessedItems(o.items,i+1,d,c),a.push(d)}),a},containerRef:function(t){this.container=t},menubarRef:function(t){this.menubar=t?t.$el:void 0}},computed:{processedItems:function(){return this.createProcessedItems(this.model||[])},visibleItems:function(){var t=this,e=this.activeItemPath.find(function(i){return i.key===t.focusedItemInfo.parentKey});return e?e.items:this.processedItems},focusedItemId:function(){return this.focusedItemInfo.index!==-1?"".concat(this.$id).concat(Qt(this.focusedItemInfo.parentKey)?"_"+this.focusedItemInfo.parentKey:"","_").concat(this.focusedItemInfo.index):null}},components:{MenubarSub:Rp,BarsIcon:rb}};function Rl(l){"@babel/helpers - typeof";return Rl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rl(l)}function Gf(l,t){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),e.push.apply(e,i)}return e}function Wf(l){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Gf(Object(e),!0).forEach(function(i){hy(l,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):Gf(Object(e)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(e,i))})}return l}function hy(l,t,e){return(t=cy(t))in l?Object.defineProperty(l,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[t]=e,l}function cy(l){var t=dy(l,"string");return Rl(t)=="symbol"?t:t+""}function dy(l,t){if(Rl(l)!="object"||!l)return l;var e=l[Symbol.toPrimitive];if(e!==void 0){var i=e.call(l,t);if(Rl(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(l)}var uy=["aria-haspopup","aria-expanded","aria-controls","aria-label"];function fy(l,t,e,i,s,n){var a=Ri("BarsIcon"),o=Ri("MenubarSub");return F(),$("div",Q({ref:n.containerRef,class:l.cx("root")},l.ptmi("root")),[l.$slots.start?(F(),$("div",Q({key:0,class:l.cx("start")},l.ptm("start")),[As(l.$slots,"start")],16)):gt("",!0),As(l.$slots,l.$slots.button?"button":"menubutton",{id:l.$id,class:yi(l.cx("button")),toggleCallback:function(c){return n.menuButtonClick(c)}},function(){var h;return[l.model&&l.model.length>0?(F(),$("a",Q({key:0,ref:"menubutton",role:"button",tabindex:"0",class:l.cx("button"),"aria-haspopup":!!(l.model.length&&l.model.length>0),"aria-expanded":s.mobileActive,"aria-controls":l.$id,"aria-label":(h=l.$primevue.config.locale.aria)===null||h===void 0?void 0:h.navigation,onClick:t[0]||(t[0]=function(c){return n.menuButtonClick(c)}),onKeydown:t[1]||(t[1]=function(c){return n.menuButtonKeydown(c)})},Wf(Wf({},l.buttonProps),l.ptm("button"))),[As(l.$slots,l.$slots.buttonicon?"buttonicon":"menubuttonicon",{},function(){return[vt(a,Jg(Zg(l.ptm("buttonicon"))),null,16)]})],16,uy)):gt("",!0)]}),vt(o,{ref:n.menubarRef,id:l.$id+"_list",role:"menubar",items:n.processedItems,templates:l.$slots,root:!0,mobileActive:s.mobileActive,tabindex:"0","aria-activedescendant":s.focused?n.focusedItemId:void 0,menuId:l.$id,focusedItemId:s.focused?n.focusedItemId:void 0,activeItemPath:s.activeItemPath,level:0,"aria-labelledby":l.ariaLabelledby,"aria-label":l.ariaLabel,pt:l.pt,unstyled:l.unstyled,onFocus:n.onFocus,onBlur:n.onBlur,onKeydown:n.onKeyDown,onItemClick:n.onItemClick,onItemMouseenter:n.onItemMouseEnter,onItemMousemove:n.onItemMouseMove},null,8,["id","items","templates","mobileActive","aria-activedescendant","menuId","focusedItemId","activeItemPath","aria-labelledby","aria-label","pt","unstyled","onFocus","onBlur","onKeydown","onItemClick","onItemMouseenter","onItemMousemove"]),l.$slots.end?(F(),$("div",Q({key:1,class:l.cx("end")},l.ptm("end")),[As(l.$slots,"end")],16)):gt("",!0)],16)}Mp.render=fy;const py=["href","onClick"],my=["href","target"],gy={key:0,class:"pi pi-fw pi-angle-down"},by={style:{margin:"0"}},yy={style:{"font-size":"12px"}},vy=pn({__name:"BaseNavMenu",emits:["onUiSettings","onSearch"],setup(l,{emit:t}){const e=Lt(!1),i=t,s=Lt([{label:"Tentang",icon:"pi pi-info-circle",command:()=>{e.value=!0}},{label:"Opsi UI",icon:"pi pi-cog",items:[{label:"Mode Aplikasi",command:()=>{i("onUiSettings","theme")}}]}]);return(n,a)=>{const o=Ri("router-link"),h=Od("ripple");return F(),$(Ee,null,[vt(Rt(Mp),{model:s.value,style:{border:"none",background:"transparent"}},{item:gi(({item:c,props:d,hasSubmenu:u})=>[c.route?(F(),Zt(o,{key:0,to:c.route,custom:""},{default:gi(({href:p,navigate:m})=>[or((F(),$("a",Q({href:p},d.action,{onClick:m}),[K("span",{class:yi(c.icon)},null,2),K("span",null,Ie(c.label),1)],16,py)),[[h]])]),_:2},1032,["to"])):or((F(),$("a",Q({key:1,href:c.url,target:c.target},d.action),[K("span",{class:yi(c.icon)},null,2),K("span",null,Ie(c.label),1),u?(F(),$("span",gy)):gt("",!0)],16,my)),[[h]])]),_:1},8,["model"]),vt(Rt(Cp),{visible:e.value,"onUpdate:visible":a[0]||(a[0]=c=>e.value=c),maximizable:"",modal:"",header:"Info Aplikasi",style:{width:"35rem"}},{default:gi(()=>[K("h2",by,Ie(Rt(gr).appFullName),1),K("span",yy,[a[1]||(a[1]=ar("Version Code: ")),K("b",null,Ie(Rt(gr).appName)+"-"+Ie(Rt(gr).appVer)+"-"+Ie(Rt(gr).release+"-"+Rt(gr).date),1)]),a[2]||(a[2]=K("br",null,null,-1)),a[3]||(a[3]=K("br",null,null,-1)),a[4]||(a[4]=K("p",{style:{margin:"0","margin-bottom":"1rem"}},[ar(" Computerized Adaptive Testing (CAT) adalah metode ujian berbasis komputer yang secara dinamis menyesuaikan tingkat kesulitan soal dengan kemampuan peserta. Karena kemampuannya dalam menyesuaikan ujian secara individual, metode ini juga dikenal sebagai tes adaptif atau tailored testing."),K("br"),K("br"),ar(" Dalam pelaksanaannya, soal yang diberikan kepada peserta tidak bersifat tetap, melainkan ditentukan berdasarkan jawaban peserta pada soal sebelumnya. Jika peserta menjawab dengan benar, maka sistem akan menyajikan soal dengan tingkat kesulitan yang lebih tinggi. Sebaliknya, jika peserta memberikan jawaban yang salah, sistem akan menyesuaikan dengan memberikan soal yang lebih mudah."),K("br"),K("br"),ar(" Pendekatan ini memungkinkan evaluasi yang lebih efisien dan akurat terhadap kemampuan peserta, sekaligus mengurangi jumlah soal yang perlu dijawab tanpa mengorbankan validitas hasil tes. ")],-1)),vt(Rt(lb)),a[5]||(a[5]=K("div",{style:{"font-weight":"bold","font-size":"13px"}},"Tech Stack:",-1)),a[6]||(a[6]=K("div",{style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem","margin-top":"0.5rem"}},[K("span",{style:{"font-weight":"bold","font-size":"13px",padding:"5px",background:"rgb(50,200,20)",color:"#fff","border-radius":"100px","padding-left":"15px","padding-right":"15px"}},"VueJS 3"),K("span",{style:{"font-weight":"bold","font-size":"13px",padding:"5px",background:"rgb(50,200,20)",color:"#fff","border-radius":"100px","padding-left":"15px","padding-right":"15px"}},"NodeJS"),K("span",{style:{"font-weight":"bold","font-size":"13px",padding:"5px",background:"rgb(50,200,20)",color:"#fff","border-radius":"100px","padding-left":"15px","padding-right":"15px"}},"MongoDB"),K("span",{style:{"font-weight":"bold","font-size":"13px",padding:"5px",background:"rgb(50,200,20)",color:"#fff","border-radius":"100px","padding-left":"15px","padding-right":"15px"}},"PHP")],-1))]),_:1},8,["visible"])],64)}}}),wy=rl(vy,[["__scopeId","data-v-1501e6df"]]),Ay={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"0.5rem"}},_y={style:{width:"15px","font-size":"12px"}},Iy=pn({__name:"ThemeSwitcher",setup(l){const t=Bd(),e=Lt(t.mTheme=="theme-dark"),i=()=>{const s=t.toggleTheme();e.value=s=="theme-dark"};return vp(()=>{e.value=t.mTheme=="theme-dark"}),(s,n)=>(F(),$("div",Ay,[vt(Rt(cb),{onChange:i,modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=a=>e.value=a)},null,8,["modelValue"]),K("span",_y,[K("b",null,Ie(e.value?"Gelap":"Terang"),1)])]))}});var Sy=({dt:l})=>`
.p-drawer {
    display: flex;
    flex-direction: column;
    transform: translate3d(0px, 0px, 0px);
    position: relative;
    transition: transform 0.3s;
    background: ${l("drawer.background")};
    color: ${l("drawer.color")};
    border: 1px solid ${l("drawer.border.color")};
    box-shadow: ${l("drawer.shadow")};
}

.p-drawer-content {
    overflow-y: auto;
    flex-grow: 1;
    padding: ${l("drawer.content.padding")};
}

.p-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    padding: ${l("drawer.header.padding")};
}

.p-drawer-footer {
    padding: ${l("drawer.footer.padding")};
}

.p-drawer-title {
    font-weight: ${l("drawer.title.font.weight")};
    font-size: ${l("drawer.title.font.size")};
}

.p-drawer-full .p-drawer {
    transition: none;
    transform: none;
    width: 100vw !important;
    height: 100vh !important;
    max-height: 100%;
    top: 0px !important;
    left: 0px !important;
    border-width: 1px;
}

.p-drawer-left .p-drawer-enter-from,
.p-drawer-left .p-drawer-leave-to {
    transform: translateX(-100%);
}

.p-drawer-right .p-drawer-enter-from,
.p-drawer-right .p-drawer-leave-to {
    transform: translateX(100%);
}

.p-drawer-top .p-drawer-enter-from,
.p-drawer-top .p-drawer-leave-to {
    transform: translateY(-100%);
}

.p-drawer-bottom .p-drawer-enter-from,
.p-drawer-bottom .p-drawer-leave-to {
    transform: translateY(100%);
}

.p-drawer-full .p-drawer-enter-from,
.p-drawer-full .p-drawer-leave-to {
    opacity: 0;
}

.p-drawer-full .p-drawer-enter-active,
.p-drawer-full .p-drawer-leave-active {
    transition: opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1);
}

.p-drawer-left .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-end-width: 1px;
}

.p-drawer-right .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-start-width: 1px;
}

.p-drawer-top .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-end-width: 1px;
}

.p-drawer-bottom .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-start-width: 1px;
}

.p-drawer-left .p-drawer-content,
.p-drawer-right .p-drawer-content,
.p-drawer-top .p-drawer-content,
.p-drawer-bottom .p-drawer-content {
    width: 100%;
    height: 100%;
}

.p-drawer-open {
    display: flex;
}

.p-drawer-mask:dir(rtl) {
    flex-direction: row-reverse;
}
`,Ey={mask:function(t){var e=t.position,i=t.modal;return{position:"fixed",height:"100%",width:"100%",left:0,top:0,display:"flex",justifyContent:e==="left"?"flex-start":e==="right"?"flex-end":"center",alignItems:e==="top"?"flex-start":e==="bottom"?"flex-end":"center",pointerEvents:i?"auto":"none"}},root:{pointerEvents:"auto"}},xy={mask:function(t){var e=t.instance,i=t.props,s=["left","right","top","bottom"],n=s.find(function(a){return a===i.position});return["p-drawer-mask",{"p-overlay-mask p-overlay-mask-enter":i.modal,"p-drawer-open":e.containerVisible,"p-drawer-full":e.fullScreen},n?"p-drawer-".concat(n):""]},root:function(t){var e=t.instance;return["p-drawer p-component",{"p-drawer-full":e.fullScreen}]},header:"p-drawer-header",title:"p-drawer-title",pcCloseButton:"p-drawer-close-button",content:"p-drawer-content",footer:"p-drawer-footer"},Cy=_f.extend({name:"drawer",style:Sy,classes:xy,inlineStyles:Ey}),ky={name:"BaseDrawer",extends:nl,props:{visible:{type:Boolean,default:!1},position:{type:String,default:"left"},header:{type:null,default:null},baseZIndex:{type:Number,default:0},autoZIndex:{type:Boolean,default:!0},dismissable:{type:Boolean,default:!0},showCloseIcon:{type:Boolean,default:!0},closeButtonProps:{type:Object,default:function(){return{severity:"secondary",text:!0,rounded:!0}}},closeIcon:{type:String,default:void 0},modal:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!1}},style:Cy,provide:function(){return{$pcDrawer:this,$parentInstance:this}}},iu={name:"Drawer",extends:ky,inheritAttrs:!1,emits:["update:visible","show","after-show","hide","after-hide","before-hide"],data:function(){return{containerVisible:this.visible}},container:null,mask:null,content:null,headerContainer:null,footerContainer:null,closeButton:null,outsideClickListener:null,documentKeydownListener:null,watch:{dismissable:function(t){t?this.enableDocumentSettings():this.disableDocumentSettings()}},updated:function(){this.visible&&(this.containerVisible=this.visible)},beforeUnmount:function(){this.disableDocumentSettings(),this.mask&&this.autoZIndex&&Ga.clear(this.mask),this.container=null,this.mask=null},methods:{hide:function(){this.$emit("update:visible",!1)},onEnter:function(){this.$emit("show"),this.focus(),this.bindDocumentKeyDownListener(),this.autoZIndex&&Ga.set("modal",this.mask,this.baseZIndex||this.$primevue.config.zIndex.modal)},onAfterEnter:function(){this.enableDocumentSettings(),this.$emit("after-show")},onBeforeLeave:function(){this.modal&&!this.isUnstyled&&ib(this.mask,"p-overlay-mask-leave"),this.$emit("before-hide")},onLeave:function(){this.$emit("hide")},onAfterLeave:function(){this.autoZIndex&&Ga.clear(this.mask),this.unbindDocumentKeyDownListener(),this.containerVisible=!1,this.disableDocumentSettings(),this.$emit("after-hide")},onMaskClick:function(t){this.dismissable&&this.modal&&this.mask===t.target&&this.hide()},focus:function(){var t=function(s){return s&&s.querySelector("[autofocus]")},e=this.$slots.header&&t(this.headerContainer);e||(e=this.$slots.default&&t(this.container),e||(e=this.$slots.footer&&t(this.footerContainer),e||(e=this.closeButton))),e&&ki(e)},enableDocumentSettings:function(){this.dismissable&&!this.modal&&this.bindOutsideClickListener(),this.blockScroll&&fb()},disableDocumentSettings:function(){this.unbindOutsideClickListener(),this.blockScroll&&ub()},onKeydown:function(t){t.code==="Escape"&&this.hide()},containerRef:function(t){this.container=t},maskRef:function(t){this.mask=t},contentRef:function(t){this.content=t},headerContainerRef:function(t){this.headerContainer=t},footerContainerRef:function(t){this.footerContainer=t},closeButtonRef:function(t){this.closeButton=t?t.$el:void 0},bindDocumentKeyDownListener:function(){this.documentKeydownListener||(this.documentKeydownListener=this.onKeydown,document.addEventListener("keydown",this.documentKeydownListener))},unbindDocumentKeyDownListener:function(){this.documentKeydownListener&&(document.removeEventListener("keydown",this.documentKeydownListener),this.documentKeydownListener=null)},bindOutsideClickListener:function(){var t=this;this.outsideClickListener||(this.outsideClickListener=function(e){t.isOutsideClicked(e)&&t.hide()},document.addEventListener("click",this.outsideClickListener,!0))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener,!0),this.outsideClickListener=null)},isOutsideClicked:function(t){return this.container&&!this.container.contains(t.target)}},computed:{fullScreen:function(){return this.position==="full"},closeAriaLabel:function(){return this.$primevue.config.locale.aria?this.$primevue.config.locale.aria.close:void 0}},directives:{focustrap:db},components:{Button:kp,Portal:eb,TimesIcon:tb}},Ty=["aria-modal"];function Py(l,t,e,i,s,n){var a=Ri("Button"),o=Ri("Portal"),h=Od("focustrap");return F(),Zt(o,null,{default:gi(function(){return[s.containerVisible?(F(),$("div",Q({key:0,ref:n.maskRef,onMousedown:t[0]||(t[0]=function(){return n.onMaskClick&&n.onMaskClick.apply(n,arguments)}),class:l.cx("mask"),style:l.sx("mask",!0,{position:l.position,modal:l.modal})},l.ptm("mask")),[vt(Nd,Q({name:"p-drawer",onEnter:n.onEnter,onAfterEnter:n.onAfterEnter,onBeforeLeave:n.onBeforeLeave,onLeave:n.onLeave,onAfterLeave:n.onAfterLeave,appear:""},l.ptm("transition")),{default:gi(function(){return[l.visible?or((F(),$("div",Q({key:0,ref:n.containerRef,class:l.cx("root"),style:l.sx("root"),role:"complementary","aria-modal":l.modal},l.ptmi("root")),[l.$slots.container?As(l.$slots,"container",{key:0,closeCallback:n.hide}):(F(),$(Ee,{key:1},[K("div",Q({ref:n.headerContainerRef,class:l.cx("header")},l.ptm("header")),[As(l.$slots,"header",{class:yi(l.cx("title"))},function(){return[l.header?(F(),$("div",Q({key:0,class:l.cx("title")},l.ptm("title")),Ie(l.header),17)):gt("",!0)]}),l.showCloseIcon?(F(),Zt(a,Q({key:0,ref:n.closeButtonRef,type:"button",class:l.cx("pcCloseButton"),"aria-label":n.closeAriaLabel,unstyled:l.unstyled,onClick:n.hide},l.closeButtonProps,{pt:l.ptm("pcCloseButton"),"data-pc-group-section":"iconcontainer"}),{icon:gi(function(c){return[As(l.$slots,"closeicon",{},function(){return[(F(),Zt(Pi(l.closeIcon?"span":"TimesIcon"),Q({class:[l.closeIcon,c.class]},l.ptm("pcCloseButton").icon),null,16,["class"]))]})]}),_:3},16,["class","aria-label","unstyled","onClick","pt"])):gt("",!0)],16),K("div",Q({ref:n.contentRef,class:l.cx("content")},l.ptm("content")),[As(l.$slots,"default")],16),l.$slots.footer?(F(),$("div",Q({key:0,ref:n.footerContainerRef,class:l.cx("footer")},l.ptm("footer")),[As(l.$slots,"footer")],16)):gt("",!0)],64))],16,Ty)),[[h]]):gt("",!0)]}),_:3},16,["onEnter","onAfterEnter","onBeforeLeave","onLeave","onAfterLeave"])],16)):gt("",!0)]}),_:3})}iu.render=Py;const Ly={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"2rem",width:"100%"}},Ry={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},My={class:"navitems"},Dy={style:{display:"flex","flex-flow":"column",gap:"1rem"}},Fy=pn({__name:"BaseNav",setup(l){const t=Bd(),e=Lt(!1),i=a=>{a==="theme"&&(e.value=!0)},s=Lt(!1),n=()=>{s.value=!0};return(a,o)=>(F(),$(Ee,null,[K("div",{class:yi(Rt(t).mTheme=="theme-light"?"b-nav":"b-nav-dark")},[K("div",Ly,[vt(Qb,{"brand-text":Rt(gr).appName},null,8,["brand-text"]),o[2]||(o[2]=K("span",{style:{height:"20px",border:"0.5px solid #ddd"}},null,-1)),K("div",Ry,[K("div",My,[vt(wy,{onOnSearch:n,onOnUiSettings:i})])])]),vt(pb)],2),vt(Rt(iu),{visible:e.value,"onUpdate:visible":o[0]||(o[0]=h=>e.value=h),header:"Mode Aplikasi",position:"right"},{default:gi(()=>[K("div",Dy,[K("div",null,[vt(Iy)])])]),_:1},8,["visible"]),vt(Rt(iu),{visible:s.value,"onUpdate:visible":o[1]||(o[1]=h=>s.value=h),header:"Search",position:"top",style:{"padding-left":"5%","padding-right":"5%"}},{default:gi(()=>[vt(Rt(hb),{placeholder:"Keyword",style:{width:"30%"}})]),_:1},8,["visible"])],64))}}),Oy=rl(Fy,[["__scopeId","data-v-1d7365a3"]]),Ny=()=>({compressImageToBase64:(t,e={})=>{const i=e.maxWidth||800,s=e.quality||.7;return new Promise((n,a)=>{const o=new Image,h=new FileReader;h.onload=c=>{var d;if(!((d=c.target)!=null&&d.result))return a("No result from FileReader");o.src=c.target.result},o.onload=()=>{const c=document.createElement("canvas"),d=i/o.width;c.width=i,c.height=o.height*d;const u=c.getContext("2d");if(!u)return a("Failed to get canvas context");u.drawImage(o,0,0,c.width,c.height);const p=c.toDataURL("image/jpeg",s);n(p)},h.onerror=a,h.readAsDataURL(t)})}});var kc={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var By=kc.exports,qf;function Hy(){return qf||(qf=1,function(l,t){((e,i)=>{l.exports=i()})(By,function e(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},s,n=!i.document&&!!i.postMessage,a=i.IS_PAPA_WORKER||!1,o={},h=0,c={};function d(_){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(S){var T=C(S);T.chunkSize=parseInt(T.chunkSize),S.step||S.chunk||(T.chunkSize=null),this._handle=new y(T),(this._handle.streamer=this)._config=T}).call(this,_),this.parseChunk=function(S,T){var L=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<L){let z=this._config.newline;z||(M=this._config.quoteChar||'"',z=this._handle.guessLineEndings(S,M)),S=[...S.split(z).slice(L)].join(z)}this.isFirstChunk&&k(this._config.beforeFirstChunk)&&(M=this._config.beforeFirstChunk(S))!==void 0&&(S=M),this.isFirstChunk=!1,this._halted=!1;var L=this._partialLine+S,M=(this._partialLine="",this._handle.parse(L,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(S=M.meta.cursor,L=(this._finished||(this._partialLine=L.substring(S-this._baseIndex),this._baseIndex=S),M&&M.data&&(this._rowCount+=M.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),a)i.postMessage({results:M,workerId:c.WORKER_ID,finished:L});else if(k(this._config.chunk)&&!T){if(this._config.chunk(M,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=M=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(M.data),this._completeResults.errors=this._completeResults.errors.concat(M.errors),this._completeResults.meta=M.meta),this._completed||!L||!k(this._config.complete)||M&&M.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),L||M&&M.meta.paused||this._nextChunk(),M}this._halted=!0},this._sendError=function(S){k(this._config.error)?this._config.error(S):a&&this._config.error&&i.postMessage({workerId:c.WORKER_ID,error:S,finished:!1})}}function u(_){var S;(_=_||{}).chunkSize||(_.chunkSize=c.RemoteChunkSize),d.call(this,_),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(T){this._input=T,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(S=new XMLHttpRequest,this._config.withCredentials&&(S.withCredentials=this._config.withCredentials),n||(S.onload=P(this._chunkLoaded,this),S.onerror=P(this._chunkError,this)),S.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var T,L=this._config.downloadRequestHeaders;for(T in L)S.setRequestHeader(T,L[T])}var M;this._config.chunkSize&&(M=this._start+this._config.chunkSize-1,S.setRequestHeader("Range","bytes="+this._start+"-"+M));try{S.send(this._config.downloadRequestBody)}catch(z){this._chunkError(z.message)}n&&S.status===0&&this._chunkError()}},this._chunkLoaded=function(){S.readyState===4&&(S.status<200||400<=S.status?this._chunkError():(this._start+=this._config.chunkSize||S.responseText.length,this._finished=!this._config.chunkSize||this._start>=(T=>(T=T.getResponseHeader("Content-Range"))!==null?parseInt(T.substring(T.lastIndexOf("/")+1)):-1)(S),this.parseChunk(S.responseText)))},this._chunkError=function(T){T=S.statusText||T,this._sendError(new Error(T))}}function p(_){(_=_||{}).chunkSize||(_.chunkSize=c.LocalChunkSize),d.call(this,_);var S,T,L=typeof FileReader<"u";this.stream=function(M){this._input=M,T=M.slice||M.webkitSlice||M.mozSlice,L?((S=new FileReader).onload=P(this._chunkLoaded,this),S.onerror=P(this._chunkError,this)):S=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var M=this._input,z=(this._config.chunkSize&&(z=Math.min(this._start+this._config.chunkSize,this._input.size),M=T.call(M,this._start,z)),S.readAsText(M,this._config.encoding));L||this._chunkLoaded({target:{result:z}})},this._chunkLoaded=function(M){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(M.target.result)},this._chunkError=function(){this._sendError(S.error)}}function m(_){var S;d.call(this,_=_||{}),this.stream=function(T){return S=T,this._nextChunk()},this._nextChunk=function(){var T,L;if(!this._finished)return T=this._config.chunkSize,S=T?(L=S.substring(0,T),S.substring(T)):(L=S,""),this._finished=!S,this.parseChunk(L)}}function v(_){d.call(this,_=_||{});var S=[],T=!0,L=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(M){this._input=M,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){L&&S.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),S.length?this.parseChunk(S.shift()):T=!0},this._streamData=P(function(M){try{S.push(typeof M=="string"?M:M.toString(this._config.encoding)),T&&(T=!1,this._checkIsFinished(),this.parseChunk(S.shift()))}catch(z){this._streamError(z)}},this),this._streamError=P(function(M){this._streamCleanUp(),this._sendError(M)},this),this._streamEnd=P(function(){this._streamCleanUp(),L=!0,this._streamData("")},this),this._streamCleanUp=P(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function y(_){var S,T,L,M,z=Math.pow(2,53),G=-z,It=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,B=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,R=this,ft=0,q=0,Mt=!1,Z=!1,X=[],O={data:[],errors:[],meta:{}};function H(et){return _.skipEmptyLines==="greedy"?et.join("").trim()==="":et.length===1&&et[0].length===0}function st(){if(O&&L&&(nt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),L=!1),_.skipEmptyLines&&(O.data=O.data.filter(function(J){return!H(J)})),ct()){let J=function(Ct,Vt){k(_.transformHeader)&&(Ct=_.transformHeader(Ct,Vt)),X.push(Ct)};if(O)if(Array.isArray(O.data[0])){for(var et=0;ct()&&et<O.data.length;et++)O.data[et].forEach(J);O.data.splice(0,1)}else O.data.forEach(J)}function it(J,Ct){for(var Vt=_.header?{}:[],Et=0;Et<J.length;Et++){var Dt=Et,pt=J[Et],pt=((Di,lt)=>(zt=>(_.dynamicTypingFunction&&_.dynamicTyping[zt]===void 0&&(_.dynamicTyping[zt]=_.dynamicTypingFunction(zt)),(_.dynamicTyping[zt]||_.dynamicTyping)===!0))(Di)?lt==="true"||lt==="TRUE"||lt!=="false"&&lt!=="FALSE"&&((zt=>{if(It.test(zt)&&(zt=parseFloat(zt),G<zt&&zt<z))return 1})(lt)?parseFloat(lt):B.test(lt)?new Date(lt):lt===""?null:lt):lt)(Dt=_.header?Et>=X.length?"__parsed_extra":X[Et]:Dt,pt=_.transform?_.transform(pt,Dt):pt);Dt==="__parsed_extra"?(Vt[Dt]=Vt[Dt]||[],Vt[Dt].push(pt)):Vt[Dt]=pt}return _.header&&(Et>X.length?nt("FieldMismatch","TooManyFields","Too many fields: expected "+X.length+" fields but parsed "+Et,q+Ct):Et<X.length&&nt("FieldMismatch","TooFewFields","Too few fields: expected "+X.length+" fields but parsed "+Et,q+Ct)),Vt}var At;O&&(_.header||_.dynamicTyping||_.transform)&&(At=1,!O.data.length||Array.isArray(O.data[0])?(O.data=O.data.map(it),At=O.data.length):O.data=it(O.data,0),_.header&&O.meta&&(O.meta.fields=X),q+=At)}function ct(){return _.header&&X.length===0}function nt(et,it,At,J){et={type:et,code:it,message:At},J!==void 0&&(et.row=J),O.errors.push(et)}k(_.step)&&(M=_.step,_.step=function(et){O=et,ct()?st():(st(),O.data.length!==0&&(ft+=et.data.length,_.preview&&ft>_.preview?T.abort():(O.data=O.data[0],M(O,R))))}),this.parse=function(et,it,At){var J=_.quoteChar||'"',J=(_.newline||(_.newline=this.guessLineEndings(et,J)),L=!1,_.delimiter?k(_.delimiter)&&(_.delimiter=_.delimiter(et),O.meta.delimiter=_.delimiter):((J=((Ct,Vt,Et,Dt,pt)=>{var Di,lt,zt,mn;pt=pt||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var Ra=0;Ra<pt.length;Ra++){for(var Xi,al=pt[Ra],Ce=0,Yi=0,oe=0,Ue=(zt=void 0,new A({comments:Dt,delimiter:al,newline:Vt,preview:10}).parse(Ct)),Es=0;Es<Ue.data.length;Es++)Et&&H(Ue.data[Es])?oe++:(Xi=Ue.data[Es].length,Yi+=Xi,zt===void 0?zt=Xi:0<Xi&&(Ce+=Math.abs(Xi-zt),zt=Xi));0<Ue.data.length&&(Yi/=Ue.data.length-oe),(lt===void 0||Ce<=lt)&&(mn===void 0||mn<Yi)&&1.99<Yi&&(lt=Ce,Di=al,mn=Yi)}return{successful:!!(_.delimiter=Di),bestDelimiter:Di}})(et,_.newline,_.skipEmptyLines,_.comments,_.delimitersToGuess)).successful?_.delimiter=J.bestDelimiter:(L=!0,_.delimiter=c.DefaultDelimiter),O.meta.delimiter=_.delimiter),C(_));return _.preview&&_.header&&J.preview++,S=et,T=new A(J),O=T.parse(S,it,At),st(),Mt?{meta:{paused:!0}}:O||{meta:{paused:!1}}},this.paused=function(){return Mt},this.pause=function(){Mt=!0,T.abort(),S=k(_.chunk)?"":S.substring(T.getCharIndex())},this.resume=function(){R.streamer._halted?(Mt=!1,R.streamer.parseChunk(S,!0)):setTimeout(R.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,T.abort(),O.meta.aborted=!0,k(_.complete)&&_.complete(O),S=""},this.guessLineEndings=function(Ct,J){Ct=Ct.substring(0,1048576);var J=new RegExp(w(J)+"([^]*?)"+w(J),"gm"),At=(Ct=Ct.replace(J,"")).split("\r"),J=Ct.split(`
`),Ct=1<J.length&&J[0].length<At[0].length;if(At.length===1||Ct)return`
`;for(var Vt=0,Et=0;Et<At.length;Et++)At[Et][0]===`
`&&Vt++;return Vt>=At.length/2?`\r
`:"\r"}}function w(_){return _.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function A(_){var S=(_=_||{}).delimiter,T=_.newline,L=_.comments,M=_.step,z=_.preview,G=_.fastMode,It=null,B=!1,R=_.quoteChar==null?'"':_.quoteChar,ft=R;if(_.escapeChar!==void 0&&(ft=_.escapeChar),(typeof S!="string"||-1<c.BAD_DELIMITERS.indexOf(S))&&(S=","),L===S)throw new Error("Comment character same as delimiter");L===!0?L="#":(typeof L!="string"||-1<c.BAD_DELIMITERS.indexOf(L))&&(L=!1),T!==`
`&&T!=="\r"&&T!==`\r
`&&(T=`
`);var q=0,Mt=!1;this.parse=function(Z,X,O){if(typeof Z!="string")throw new Error("Input must be a string");var H=Z.length,st=S.length,ct=T.length,nt=L.length,et=k(M),it=[],At=[],J=[],Ct=q=0;if(!Z)return Ce();if(G||G!==!1&&Z.indexOf(R)===-1){for(var Vt=Z.split(T),Et=0;Et<Vt.length;Et++){if(J=Vt[Et],q+=J.length,Et!==Vt.length-1)q+=T.length;else if(O)return Ce();if(!L||J.substring(0,nt)!==L){if(et){if(it=[],mn(J.split(S)),Yi(),Mt)return Ce()}else mn(J.split(S));if(z&&z<=Et)return it=it.slice(0,z),Ce(!0)}}return Ce()}for(var Dt=Z.indexOf(S,q),pt=Z.indexOf(T,q),Di=new RegExp(w(ft)+w(R),"g"),lt=Z.indexOf(R,q);;)if(Z[q]===R)for(lt=q,q++;;){if((lt=Z.indexOf(R,lt+1))===-1)return O||At.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:it.length,index:q}),Xi();if(lt===H-1)return Xi(Z.substring(q,lt).replace(Di,R));if(R===ft&&Z[lt+1]===ft)lt++;else if(R===ft||lt===0||Z[lt-1]!==ft){Dt!==-1&&Dt<lt+1&&(Dt=Z.indexOf(S,lt+1));var zt=Ra((pt=pt!==-1&&pt<lt+1?Z.indexOf(T,lt+1):pt)===-1?Dt:Math.min(Dt,pt));if(Z.substr(lt+1+zt,st)===S){J.push(Z.substring(q,lt).replace(Di,R)),Z[q=lt+1+zt+st]!==R&&(lt=Z.indexOf(R,q)),Dt=Z.indexOf(S,q),pt=Z.indexOf(T,q);break}if(zt=Ra(pt),Z.substring(lt+1+zt,lt+1+zt+ct)===T){if(J.push(Z.substring(q,lt).replace(Di,R)),al(lt+1+zt+ct),Dt=Z.indexOf(S,q),lt=Z.indexOf(R,q),et&&(Yi(),Mt))return Ce();if(z&&it.length>=z)return Ce(!0);break}At.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:it.length,index:q}),lt++}}else if(L&&J.length===0&&Z.substring(q,q+nt)===L){if(pt===-1)return Ce();q=pt+ct,pt=Z.indexOf(T,q),Dt=Z.indexOf(S,q)}else if(Dt!==-1&&(Dt<pt||pt===-1))J.push(Z.substring(q,Dt)),q=Dt+st,Dt=Z.indexOf(S,q);else{if(pt===-1)break;if(J.push(Z.substring(q,pt)),al(pt+ct),et&&(Yi(),Mt))return Ce();if(z&&it.length>=z)return Ce(!0)}return Xi();function mn(oe){it.push(oe),Ct=q}function Ra(oe){var Ue=0;return Ue=oe!==-1&&(oe=Z.substring(lt+1,oe))&&oe.trim()===""?oe.length:Ue}function Xi(oe){return O||(oe===void 0&&(oe=Z.substring(q)),J.push(oe),q=H,mn(J),et&&Yi()),Ce()}function al(oe){q=oe,mn(J),J=[],pt=Z.indexOf(T,q)}function Ce(oe){if(_.header&&!X&&it.length&&!B){var Ue=it[0],Es=Object.create(null),Gd=new Set(Ue);let Hf=!1;for(let Ma=0;Ma<Ue.length;Ma++){let Qi=Ue[Ma];if(Es[Qi=k(_.transformHeader)?_.transformHeader(Qi,Ma):Qi]){let ol,$f=Es[Qi];for(;ol=Qi+"_"+$f,$f++,Gd.has(ol););Gd.add(ol),Ue[Ma]=ol,Es[Qi]++,Hf=!0,(It=It===null?{}:It)[ol]=Qi}else Es[Qi]=1,Ue[Ma]=Qi;Gd.add(Qi)}Hf&&console.warn("Duplicate headers found and renamed."),B=!0}return{data:it,errors:At,meta:{delimiter:S,linebreak:T,aborted:Mt,truncated:!!oe,cursor:Ct+(X||0),renamedHeaders:It}}}function Yi(){M(Ce()),it=[],At=[]}},this.abort=function(){Mt=!0},this.getCharIndex=function(){return q}}function x(_){var S=_.data,T=o[S.workerId],L=!1;if(S.error)T.userError(S.error,S.file);else if(S.results&&S.results.data){var M={abort:function(){L=!0,I(S.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:E,resume:E};if(k(T.userStep)){for(var z=0;z<S.results.data.length&&(T.userStep({data:S.results.data[z],errors:S.results.errors,meta:S.results.meta},M),!L);z++);delete S.results}else k(T.userChunk)&&(T.userChunk(S.results,M,S.file),delete S.results)}S.finished&&!L&&I(S.workerId,S.results)}function I(_,S){var T=o[_];k(T.userComplete)&&T.userComplete(S),T.terminate(),delete o[_]}function E(){throw new Error("Not implemented.")}function C(_){if(typeof _!="object"||_===null)return _;var S,T=Array.isArray(_)?[]:{};for(S in _)T[S]=C(_[S]);return T}function P(_,S){return function(){_.apply(S,arguments)}}function k(_){return typeof _=="function"}return c.parse=function(_,S){var T=(S=S||{}).dynamicTyping||!1;if(k(T)&&(S.dynamicTypingFunction=T,T={}),S.dynamicTyping=T,S.transform=!!k(S.transform)&&S.transform,!S.worker||!c.WORKERS_SUPPORTED)return T=null,c.NODE_STREAM_INPUT,typeof _=="string"?(_=(L=>L.charCodeAt(0)!==65279?L:L.slice(1))(_),T=new(S.download?u:m)(S)):_.readable===!0&&k(_.read)&&k(_.on)?T=new v(S):(i.File&&_ instanceof File||_ instanceof Object)&&(T=new p(S)),T.stream(_);(T=(()=>{var L;return!!c.WORKERS_SUPPORTED&&(L=(()=>{var M=i.URL||i.webkitURL||null,z=e.toString();return c.BLOB_URL||(c.BLOB_URL=M.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",z,")();"],{type:"text/javascript"})))})(),(L=new i.Worker(L)).onmessage=x,L.id=h++,o[L.id]=L)})()).userStep=S.step,T.userChunk=S.chunk,T.userComplete=S.complete,T.userError=S.error,S.step=k(S.step),S.chunk=k(S.chunk),S.complete=k(S.complete),S.error=k(S.error),delete S.worker,T.postMessage({input:_,config:S,workerId:T.id})},c.unparse=function(_,S){var T=!1,L=!0,M=",",z=`\r
`,G='"',It=G+G,B=!1,R=null,ft=!1,q=((()=>{if(typeof S=="object"){if(typeof S.delimiter!="string"||c.BAD_DELIMITERS.filter(function(X){return S.delimiter.indexOf(X)!==-1}).length||(M=S.delimiter),typeof S.quotes!="boolean"&&typeof S.quotes!="function"&&!Array.isArray(S.quotes)||(T=S.quotes),typeof S.skipEmptyLines!="boolean"&&typeof S.skipEmptyLines!="string"||(B=S.skipEmptyLines),typeof S.newline=="string"&&(z=S.newline),typeof S.quoteChar=="string"&&(G=S.quoteChar),typeof S.header=="boolean"&&(L=S.header),Array.isArray(S.columns)){if(S.columns.length===0)throw new Error("Option columns is empty");R=S.columns}S.escapeChar!==void 0&&(It=S.escapeChar+G),S.escapeFormulae instanceof RegExp?ft=S.escapeFormulae:typeof S.escapeFormulae=="boolean"&&S.escapeFormulae&&(ft=/^[=+\-@\t\r].*$/)}})(),new RegExp(w(G),"g"));if(typeof _=="string"&&(_=JSON.parse(_)),Array.isArray(_)){if(!_.length||Array.isArray(_[0]))return Mt(null,_,B);if(typeof _[0]=="object")return Mt(R||Object.keys(_[0]),_,B)}else if(typeof _=="object")return typeof _.data=="string"&&(_.data=JSON.parse(_.data)),Array.isArray(_.data)&&(_.fields||(_.fields=_.meta&&_.meta.fields||R),_.fields||(_.fields=Array.isArray(_.data[0])?_.fields:typeof _.data[0]=="object"?Object.keys(_.data[0]):[]),Array.isArray(_.data[0])||typeof _.data[0]=="object"||(_.data=[_.data])),Mt(_.fields||[],_.data||[],B);throw new Error("Unable to serialize unrecognized input");function Mt(X,O,H){var st="",ct=(typeof X=="string"&&(X=JSON.parse(X)),typeof O=="string"&&(O=JSON.parse(O)),Array.isArray(X)&&0<X.length),nt=!Array.isArray(O[0]);if(ct&&L){for(var et=0;et<X.length;et++)0<et&&(st+=M),st+=Z(X[et],et);0<O.length&&(st+=z)}for(var it=0;it<O.length;it++){var At=(ct?X:O[it]).length,J=!1,Ct=ct?Object.keys(O[it]).length===0:O[it].length===0;if(H&&!ct&&(J=H==="greedy"?O[it].join("").trim()==="":O[it].length===1&&O[it][0].length===0),H==="greedy"&&ct){for(var Vt=[],Et=0;Et<At;Et++){var Dt=nt?X[Et]:Et;Vt.push(O[it][Dt])}J=Vt.join("").trim()===""}if(!J){for(var pt=0;pt<At;pt++){0<pt&&!Ct&&(st+=M);var Di=ct&&nt?X[pt]:pt;st+=Z(O[it][Di],pt)}it<O.length-1&&(!H||0<At&&!Ct)&&(st+=z)}}return st}function Z(X,O){var H,st;return X==null?"":X.constructor===Date?JSON.stringify(X).slice(1,25):(st=!1,ft&&typeof X=="string"&&ft.test(X)&&(X="'"+X,st=!0),H=X.toString().replace(q,It),(st=st||T===!0||typeof T=="function"&&T(X,O)||Array.isArray(T)&&T[O]||((ct,nt)=>{for(var et=0;et<nt.length;et++)if(-1<ct.indexOf(nt[et]))return!0;return!1})(H,c.BAD_DELIMITERS)||-1<H.indexOf(M)||H.charAt(0)===" "||H.charAt(H.length-1)===" ")?G+H+G:H)}},c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!n&&!!i.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=A,c.ParserHandle=y,c.NetworkStreamer=u,c.FileStreamer=p,c.StringStreamer=m,c.ReadableStreamStreamer=v,i.jQuery&&((s=i.jQuery).fn.parse=function(_){var S=_.config||{},T=[];return this.each(function(z){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var G=0;G<this.files.length;G++)T.push({file:this.files[G],inputElem:this,instanceConfig:s.extend({},S)})}),L(),this;function L(){if(T.length===0)k(_.complete)&&_.complete();else{var z,G,It,B,R=T[0];if(k(_.before)){var ft=_.before(R.file,R.inputElem);if(typeof ft=="object"){if(ft.action==="abort")return z="AbortError",G=R.file,It=R.inputElem,B=ft.reason,void(k(_.error)&&_.error({name:z},G,It,B));if(ft.action==="skip")return void M();typeof ft.config=="object"&&(R.instanceConfig=s.extend(R.instanceConfig,ft.config))}else if(ft==="skip")return void M()}var q=R.instanceConfig.complete;R.instanceConfig.complete=function(Mt){k(q)&&q(Mt,R.file,R.inputElem),M()},c.parse(R.file,R.instanceConfig)}}function M(){T.splice(0,1),L()}}),a&&(i.onmessage=function(_){_=_.data,c.WORKER_ID===void 0&&_&&(c.WORKER_ID=_.workerId),typeof _.input=="string"?i.postMessage({workerId:c.WORKER_ID,results:c.parse(_.input,_.config),finished:!0}):(i.File&&_.input instanceof File||_.input instanceof Object)&&(_=c.parse(_.input,_.config))&&i.postMessage({workerId:c.WORKER_ID,results:_,finished:!0})}),(u.prototype=Object.create(d.prototype)).constructor=u,(p.prototype=Object.create(d.prototype)).constructor=p,(m.prototype=Object.create(m.prototype)).constructor=m,(v.prototype=Object.create(d.prototype)).constructor=v,c})}(kc)),kc.exports}var $y=Hy();const zy=bb($y),jy=()=>{const l=async a=>{const o=await a.arrayBuffer(),h=mb(o,{type:"array"}),c=h.SheetNames[0],d=h.Sheets[c];return gb.sheet_to_json(d,{defval:""})},t=async a=>new Promise((o,h)=>{zy.parse(a,{header:!0,skipEmptyLines:!0,complete:c=>o(c.data),error:c=>h(c)})}),e=async a=>{var d;const o=((d=a.name.split(".").pop())==null?void 0:d.toLowerCase())||"";let h=[];if(o==="csv")h=await t(a);else if(o==="xls"||o==="xlsx")h=await l(a);else throw new Error(`Unsupported file extension: ${o}`);const c=n(h);return{rows:h,ext:o,markdown:c}},i=(a,o="file.xlsx")=>{var m;const h=a.split(","),c=((m=h[0].match(/:(.*?);/))==null?void 0:m[1])||"",d=atob(h[1]);let u=d.length;const p=new Uint8Array(u);for(;u--;)p[u]=d.charCodeAt(u);return new File([p],o,{type:c})},s=async(a,o="file.xlsx")=>{const h=i(a,o);return await e(h)},n=a=>{if(!a.length)return"";const o=Object.keys(a[0]),h=`| ${o.join(" | ")} |`,c=`| ${o.map(()=>"---").join(" | ")} |`,d=a.map(u=>`| ${o.map(p=>`${String(u[p]??"")}`).join(" | ")} |`);return[h,c,...d].join(`
`)};return{parseCsv:t,parseExcel:l,detectAndParse:e,parseBase64:s,toMarkdownTable:n}},He=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),su=[.001,0,0,.001,0,0],qd=1.35,ui={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},bn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Dp="pdfjs_internal_editor_",rt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101,COMMENT:102},mt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Uy={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ke={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Tc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Yt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Fa={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Hd={ERRORS:0,WARNINGS:1,INFOS:5},ad={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},vc={moveTo:0,lineTo:1,curveTo:2,closePath:3},Vy={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let $d=Hd.WARNINGS;function Ky(l){Number.isInteger(l)&&($d=l)}function Gy(){return $d}function zd(l){$d>=Hd.INFOS&&console.log(`Info: ${l}`)}function at(l){$d>=Hd.WARNINGS&&console.log(`Warning: ${l}`)}function Pt(l){throw new Error(l)}function te(l,t){l||Pt(t)}function Wy(l){switch(l==null?void 0:l.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Fp(l,t=null,e=null){if(!l)return null;if(e&&typeof l=="string"){if(e.addDefaultProtocol&&l.startsWith("www.")){const s=l.match(/\./g);(s==null?void 0:s.length)>=2&&(l=`http://${l}`)}if(e.tryConvertEncoding)try{l=Jy(l)}catch{}}const i=t?URL.parse(l,t):URL.parse(l);return Wy(i)?i:null}function Op(l,t,e=!1){const i=URL.parse(l);return i?(i.hash=t,i.href):e&&Fp(l,"http://example.com")?l.split("#",1)[0]+`${t?`#${t}`:""}`:""}function ut(l,t,e,i=!1){return Object.defineProperty(l,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const Pa=function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t}();class Xf extends Pa{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Xd extends Pa{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class nu extends Pa{constructor(t){super(t,"InvalidPDFException")}}class od extends Pa{constructor(t,e,i){super(t,"ResponseException"),this.status=e,this.missing=i}}class qy extends Pa{constructor(t){super(t,"FormatError")}}class lr extends Pa{constructor(t){super(t,"AbortException")}}function Np(l){(typeof l!="object"||(l==null?void 0:l.length)===void 0)&&Pt("Invalid argument for bytesToString");const t=l.length,e=8192;if(t<e)return String.fromCharCode.apply(null,l);const i=[];for(let s=0;s<t;s+=e){const n=Math.min(s+e,t),a=l.subarray(s,n);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function uc(l){typeof l!="string"&&Pt("Invalid argument for stringToBytes");const t=l.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=l.charCodeAt(i)&255;return e}function Xy(l){return String.fromCharCode(l>>24&255,l>>16&255,l>>8&255,l&255)}function Yy(){const l=new Uint8Array(4);return l[0]=1,new Uint32Array(l.buffer,0,1)[0]===1}function Qy(){try{return new Function(""),!0}catch{return!1}}class xe{static get isLittleEndian(){return ut(this,"isLittleEndian",Yy())}static get isEvalSupported(){return ut(this,"isEvalSupported",Qy())}static get isOffscreenCanvasSupported(){return ut(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ut(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return ut(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){var t,e;return ut(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const Yd=Array.from(Array(256).keys(),l=>l.toString(16).padStart(2,"0"));var dn,Pc,ru;class Y{static makeHexColor(t,e,i){return`#${Yd[t]}${Yd[e]}${Yd[i]}`}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e,i=0){const s=t[i],n=t[i+1];t[i]=s*e[0]+n*e[2]+e[4],t[i+1]=s*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,i=0){const s=e[0],n=e[1],a=e[2],o=e[3],h=e[4],c=e[5];for(let d=0;d<6;d+=2){const u=t[i+d],p=t[i+d+1];t[i+d]=u*s+p*a+h,t[i+d+1]=u*n+p*o+c}}static applyInverseTransform(t,e){const i=t[0],s=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(i*e[3]-s*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-i*e[1]+s*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,i){const s=e[0],n=e[1],a=e[2],o=e[3],h=e[4],c=e[5],d=t[0],u=t[1],p=t[2],m=t[3];let v=s*d+h,y=v,w=s*p+h,A=w,x=o*u+c,I=x,E=o*m+c,C=E;if(n!==0||a!==0){const P=n*d,k=n*p,_=a*u,S=a*m;v+=_,A+=_,w+=S,y+=S,x+=P,C+=P,E+=k,I+=k}i[0]=Math.min(i[0],v,w,y,A),i[1]=Math.min(i[1],x,E,I,C),i[2]=Math.max(i[2],v,w,y,A),i[3]=Math.max(i[3],x,E,I,C)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const i=t[0],s=t[1],n=t[2],a=t[3],o=i**2+s**2,h=i*n+s*a,c=n**2+a**2,d=(o+c)/2,u=Math.sqrt(d**2-(o*c-h**2));e[0]=Math.sqrt(d+u||1),e[1]=Math.sqrt(d-u||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>a?null:[i,n,s,a]}static pointBoundingBox(t,e,i){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}static rectBoundingBox(t,e,i,s,n){n[0]=Math.min(n[0],t,i),n[1]=Math.min(n[1],e,s),n[2]=Math.max(n[2],t,i),n[3]=Math.max(n[3],e,s)}static bezierBoundingBox(t,e,i,s,n,a,o,h,c){c[0]=Math.min(c[0],t,o),c[1]=Math.min(c[1],e,h),c[2]=Math.max(c[2],t,o),c[3]=Math.max(c[3],e,h),b(this,dn,ru).call(this,t,i,n,o,e,s,a,h,3*(-t+3*(i-n)+o),6*(t-2*i+n),3*(i-t),c),b(this,dn,ru).call(this,t,i,n,o,e,s,a,h,3*(-e+3*(s-a)+h),6*(e-2*s+a),3*(s-e),c)}}dn=new WeakSet,Pc=function(t,e,i,s,n,a,o,h,c,d){if(c<=0||c>=1)return;const u=1-c,p=c*c,m=p*c,v=u*(u*(u*t+3*c*e)+3*p*i)+m*s,y=u*(u*(u*n+3*c*a)+3*p*o)+m*h;d[0]=Math.min(d[0],v),d[1]=Math.min(d[1],y),d[2]=Math.max(d[2],v),d[3]=Math.max(d[3],y)},ru=function(t,e,i,s,n,a,o,h,c,d,u,p){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&b(this,dn,Pc).call(this,t,e,i,s,n,a,o,h,-u/d,p);return}const m=d**2-4*u*c;if(m<0)return;const v=Math.sqrt(m),y=2*c;b(this,dn,Pc).call(this,t,e,i,s,n,a,o,h,(-d+v)/y,p),b(this,dn,Pc).call(this,t,e,i,s,n,a,o,h,(-d-v)/y,p)},g(Y,dn);function Jy(l){return decodeURIComponent(escape(l))}let Qd=null,Yf=null;function Zy(l){return Qd||(Qd=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Yf=new Map([["ﬅ","ſt"]])),l.replaceAll(Qd,(t,e,i)=>e?e.normalize("NFKC"):Yf.get(i))}function Bp(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const l=new Uint8Array(32);return crypto.getRandomValues(l),Np(l)}const Sf="pdfjs_internal_id_";function tv(l,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[i,s,...n]=e;if(!l(i)&&!Number.isInteger(i)||!t(s))return!1;const a=n.length;let o=!0;switch(s.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const h of n)if(!(typeof h=="number"||o&&h===null))return!1;return!0}function $e(l,t,e){return Math.min(Math.max(l,t),e)}function Hp(l){return Uint8Array.prototype.toBase64?l.toBase64():btoa(Np(l))}function ev(l){return Uint8Array.fromBase64?Uint8Array.fromBase64(l):uc(atob(l))}typeof Promise.try!="function"&&(Promise.try=function(l,...t){return new Promise(e=>{e(l(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(l){return l.reduce((t,e)=>t+e,0)});const xs="http://www.w3.org/2000/svg",br=class br{};D(br,"CSS",96),D(br,"PDF",72),D(br,"PDF_TO_CSS_UNITS",br.CSS/br.PDF);let hr=br;async function fc(l,t="text"){if(ul(l,document.baseURI)){const e=await fetch(l);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const s=new XMLHttpRequest;s.open("GET",l,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class pc{constructor({viewBox:t,userUnit:e,scale:i,rotation:s,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=a,i*=e;const h=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let d,u,p,m;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,u=0,p=0,m=1;break;case 90:d=0,u=1,p=1,m=0;break;case 270:d=0,u=-1,p=-1,m=0;break;case 0:d=1,u=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,m=-m);let v,y,w,A;d===0?(v=Math.abs(c-t[1])*i+n,y=Math.abs(h-t[0])*i+a,w=(t[3]-t[1])*i,A=(t[2]-t[0])*i):(v=Math.abs(h-t[0])*i+n,y=Math.abs(c-t[1])*i+a,w=(t[2]-t[0])*i,A=(t[3]-t[1])*i),this.transform=[d*i,u*i,p*i,m*i,v-d*i*h-p*i*c,y-u*i*h-m*i*c],this.width=w,this.height=A}get rawDims(){const t=this.viewBox;return ut(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new pc({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(t,e){const i=[t,e];return Y.applyTransform(i,this.transform),i}convertToViewportRectangle(t){const e=[t[0],t[1]];Y.applyTransform(e,this.transform);const i=[t[2],t[3]];return Y.applyTransform(i,this.transform),[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){const i=[t,e];return Y.applyInverseTransform(i,this.transform),i}}class Ef extends Pa{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function jd(l){const t=l.length;let e=0;for(;e<t&&l[e].trim()==="";)e++;return l.substring(e,e+5).toLowerCase()==="data:"}function xf(l){return typeof l=="string"&&/\.pdf$/i.test(l)}function iv(l){return[l]=l.split(/[#?]/,1),l.substring(l.lastIndexOf("/")+1)}function sv(l,t="document.pdf"){if(typeof l!="string")return t;if(jd(l))return at('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const i=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(l);if(!i)return t;const s=o=>{try{let h=decodeURIComponent(o);return h.includes("/")?(h=h.split("/").at(-1),h.test(/^\.pdf$/i)?h:o):h}catch{return o}},n=/\.pdf$/i,a=i.pathname.split("/").at(-1);if(n.test(a))return s(a);if(i.searchParams.size>0){const o=Array.from(i.searchParams.values()).reverse();for(const c of o)if(n.test(c))return s(c);const h=Array.from(i.searchParams.keys()).reverse();for(const c of h)if(n.test(c))return s(c)}if(i.hash){const h=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(h)return s(h[0])}return t}class Qf{constructor(){D(this,"started",Object.create(null));D(this,"times",[])}time(t){t in this.started&&at(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||at(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:s,end:n}of this.times)t.push(`${i.padEnd(e)} ${n-s}ms
`);return t.join("")}}function ul(l,t){const e=t?URL.parse(l,t):URL.parse(l);return(e==null?void 0:e.protocol)==="http:"||(e==null?void 0:e.protocol)==="https:"}function Mi(l){l.preventDefault()}function Jt(l){l.preventDefault(),l.stopPropagation()}function nv(l){console.log("Deprecated API usage: "+l)}var Ol;class ld{static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;r(this,Ol)||f(this,Ol,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=r(this,Ol).exec(t);if(!e)return null;const i=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let h=parseInt(e[6],10);h=h>=0&&h<=59?h:0;const c=e[7]||"Z";let d=parseInt(e[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,c==="-"?(a+=d,o+=u):c==="+"&&(a-=d,o-=u),new Date(Date.UTC(i,s,n,a,o,h))}}Ol=new WeakMap,g(ld,Ol);function rv(l,{scale:t=1,rotation:e=0}){const{width:i,height:s}=l.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new pc({viewBox:n,userUnit:1,scale:t,rotation:e})}function Ud(l){if(l.startsWith("#")){const t=parseInt(l.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return l.startsWith("rgb(")?l.slice(4,-1).split(",").map(t=>parseInt(t)):l.startsWith("rgba(")?l.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(at(`Not a valid color format: "${l}"`),[0,0,0])}function av(l){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of l.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;l.set(e,Ud(i))}t.remove()}function Ut(l){const{a:t,b:e,c:i,d:s,e:n,f:a}=l.getTransform();return[t,e,i,s,n,a]}function Ji(l){const{a:t,b:e,c:i,d:s,e:n,f:a}=l.getTransform().invertSelf();return[t,e,i,s,n,a]}function Ca(l,t,e=!1,i=!0){if(t instanceof pc){const{pageWidth:s,pageHeight:n}=t.rawDims,{style:a}=l,o=xe.isCSSRoundSupported,h=`var(--total-scale-factor) * ${s}px`,c=`var(--total-scale-factor) * ${n}px`,d=o?`round(down, ${h}, var(--scale-round-x))`:`calc(${h})`,u=o?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!e||t.rotation%180===0?(a.width=d,a.height=u):(a.width=u,a.height=d)}i&&l.setAttribute("data-main-rotation",t.rotation)}class Is{constructor(){const{pixelRatio:t}=Is;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,i,s,n=-1){let a=1/0,o=1/0,h=1/0;i=Is.capPixels(i,n),i>0&&(a=Math.sqrt(i/(t*e))),s!==-1&&(o=s/t,h=s/e);const c=Math.min(a,o,h);return this.sx>c||this.sy>c?(this.sx=c,this.sy=c,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,i):i}return t}}const au=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var yn,vn,wi,Ls,Nl,qa,Xa,Bl,bd,$p,Se,zp,jp,Oa,fl;const Ts=class Ts{constructor(t){g(this,Se);g(this,yn,null);g(this,vn,null);g(this,wi);g(this,Ls,null);g(this,Nl,null);g(this,qa,null);g(this,Xa,null);f(this,wi,t),r(Ts,Bl)||f(Ts,Bl,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const t=f(this,yn,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=r(this,wi)._uiManager._signal;t.addEventListener("contextmenu",Mi,{signal:e}),t.addEventListener("pointerdown",b(Ts,bd,$p),{signal:e});const i=f(this,Ls,document.createElement("div"));i.className="buttons",t.append(i);const s=r(this,wi).toolbarPosition;if(s){const{style:n}=t,a=r(this,wi)._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return r(this,yn)}hide(){var t;r(this,yn).classList.add("hidden"),(t=r(this,vn))==null||t.hideDropdown()}show(){var t,e;r(this,yn).classList.remove("hidden"),(t=r(this,Nl))==null||t.shown(),(e=r(this,qa))==null||e.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=r(this,wi),i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",r(Ts,Bl)[t]),b(this,Se,Oa).call(this,i),i.addEventListener("click",s=>{e.delete()},{signal:e._signal}),r(this,Ls).append(i)}async addAltText(t){const e=await t.render();b(this,Se,Oa).call(this,e),r(this,Ls).append(e,r(this,Se,fl)),f(this,Nl,t)}addComment(t){if(r(this,qa))return;const e=t.render();e&&(b(this,Se,Oa).call(this,e),r(this,Ls).prepend(e,r(this,Se,fl)),f(this,qa,t),t.toolbar=this)}addColorPicker(t){if(r(this,vn))return;f(this,vn,t);const e=t.renderButton();b(this,Se,Oa).call(this,e),r(this,Ls).append(e,r(this,Se,fl))}async addEditSignatureButton(t){const e=f(this,Xa,await t.renderEditButton(r(this,wi)));b(this,Se,Oa).call(this,e),r(this,Ls).append(e,r(this,Se,fl))}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}updateEditSignatureButton(t){r(this,Xa)&&(r(this,Xa).title=t)}remove(){var t;r(this,yn).remove(),(t=r(this,vn))==null||t.destroy(),f(this,vn,null)}};yn=new WeakMap,vn=new WeakMap,wi=new WeakMap,Ls=new WeakMap,Nl=new WeakMap,qa=new WeakMap,Xa=new WeakMap,Bl=new WeakMap,bd=new WeakSet,$p=function(t){t.stopPropagation()},Se=new WeakSet,zp=function(t){r(this,wi)._focusEventsAllowed=!1,Jt(t)},jp=function(t){r(this,wi)._focusEventsAllowed=!0,Jt(t)},Oa=function(t){const e=r(this,wi)._uiManager._signal;t.addEventListener("focusin",b(this,Se,zp).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",b(this,Se,jp).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Mi,{signal:e})},fl=function(){const t=document.createElement("div");return t.className="divider",t},g(Ts,bd),g(Ts,Bl,null);let ou=Ts;var Hl,Ar,_r,cr,Up,Vp,Kp;class ov{constructor(t){g(this,cr);g(this,Hl,null);g(this,Ar,null);g(this,_r);f(this,_r,t)}show(t,e,i){const[s,n]=b(this,cr,Vp).call(this,e,i),{style:a}=r(this,Ar)||f(this,Ar,b(this,cr,Up).call(this));t.append(r(this,Ar)),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){r(this,Ar).remove()}}Hl=new WeakMap,Ar=new WeakMap,_r=new WeakMap,cr=new WeakSet,Up=function(){const t=f(this,Ar,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",Mi,{signal:r(this,_r)._signal});const e=f(this,Hl,document.createElement("div"));return e.className="buttons",t.append(e),b(this,cr,Kp).call(this),t},Vp=function(t,e){let i=0,s=0;for(const n of t){const a=n.y+n.height;if(a<i)continue;const o=n.x+(e?n.width:0);if(a>i){s=o,i=a;continue}e?o>s&&(s=o):o<s&&(s=o)}return[e?1-s:s,i]},Kp=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=r(this,_r)._signal;t.addEventListener("contextmenu",Mi,{signal:i}),t.addEventListener("click",()=>{r(this,_r).highlightSelection("floating_button")},{signal:i}),r(this,Hl).append(t)};function Gp(l,t,e){for(const i of e)t.addEventListener(i,l[i].bind(l))}var yd;class lv{constructor(){g(this,yd,0)}get id(){return`${Dp}${Me(this,yd)._++}`}}yd=new WeakMap;var Ya,$l,Pe,Qa,Lc;const Df=class Df{constructor(){g(this,Qa);g(this,Ya,Bp());g(this,$l,0);g(this,Pe,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return ut(this,"_isSVGFittingCanvas",n)}async getFromFile(t){const{lastModified:e,name:i,size:s,type:n}=t;return b(this,Qa,Lc).call(this,`${e}_${i}_${s}_${n}`,t)}async getFromUrl(t){return b(this,Qa,Lc).call(this,t,t)}async getFromBlob(t,e){const i=await e;return b(this,Qa,Lc).call(this,t,i)}async getFromId(t){r(this,Pe)||f(this,Pe,new Map);const e=r(this,Pe).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){r(this,Pe)||f(this,Pe,new Map);let i=r(this,Pe).get(t);if(i!=null&&i.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${r(this,Ya)}_${Me(this,$l)._++}`,refCounter:1,isSvg:!1},r(this,Pe).set(t,i),r(this,Pe).set(i.id,i),i}getSvgUrl(t){const e=r(this,Pe).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var s;r(this,Pe)||f(this,Pe,new Map);const e=r(this,Pe).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(i.width,i.height);n.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=n.convertToBlob()}(s=i.close)==null||s.call(i),e.bitmap=null}isValidId(t){return t.startsWith(`image_${r(this,Ya)}_`)}};Ya=new WeakMap,$l=new WeakMap,Pe=new WeakMap,Qa=new WeakSet,Lc=async function(t,e){r(this,Pe)||f(this,Pe,new Map);let i=r(this,Pe).get(t);if(i===null)return null;if(i!=null&&i.bitmap)return i.refCounter+=1,i;try{i||(i={bitmap:null,id:`image_${r(this,Ya)}_${Me(this,$l)._++}`,refCounter:0,isSvg:!1});let s;if(typeof e=="string"?(i.url=e,s=await fc(e,"blob")):e instanceof File?s=i.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const n=Df._isSVGFittingCanvas,a=new FileReader,o=new Image,h=new Promise((c,d)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,c()},a.onload=async()=>{const u=i.svgUrl=a.result;o.src=await n?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=a.onerror=d});a.readAsDataURL(s),await h}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){at(s),i=null}return r(this,Pe).set(t,i),i&&r(this,Pe).set(i.id,i),i};let lu=Df;var Gt,wn,zl,jt;class hv{constructor(t=128){g(this,Gt,[]);g(this,wn,!1);g(this,zl);g(this,jt,-1);f(this,zl,t)}add({cmd:t,undo:e,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(s&&t(),r(this,wn))return;const h={cmd:t,undo:e,post:i,type:n};if(r(this,jt)===-1){r(this,Gt).length>0&&(r(this,Gt).length=0),f(this,jt,0),r(this,Gt).push(h);return}if(a&&r(this,Gt)[r(this,jt)].type===n){o&&(h.undo=r(this,Gt)[r(this,jt)].undo),r(this,Gt)[r(this,jt)]=h;return}const c=r(this,jt)+1;c===r(this,zl)?r(this,Gt).splice(0,1):(f(this,jt,c),c<r(this,Gt).length&&r(this,Gt).splice(c)),r(this,Gt).push(h)}undo(){if(r(this,jt)===-1)return;f(this,wn,!0);const{undo:t,post:e}=r(this,Gt)[r(this,jt)];t(),e==null||e(),f(this,wn,!1),f(this,jt,r(this,jt)-1)}redo(){if(r(this,jt)<r(this,Gt).length-1){f(this,jt,r(this,jt)+1),f(this,wn,!0);const{cmd:t,post:e}=r(this,Gt)[r(this,jt)];t(),e==null||e(),f(this,wn,!1)}}hasSomethingToUndo(){return r(this,jt)!==-1}hasSomethingToRedo(){return r(this,jt)<r(this,Gt).length-1}cleanType(t){if(r(this,jt)!==-1){for(let e=r(this,jt);e>=0;e--)if(r(this,Gt)[e].type!==t){r(this,Gt).splice(e+1,r(this,jt)-e),f(this,jt,e);return}r(this,Gt).length=0,f(this,jt,-1)}}destroy(){f(this,Gt,null)}}Gt=new WeakMap,wn=new WeakMap,zl=new WeakMap,jt=new WeakMap;var vd,Wp;class mc{constructor(t){g(this,vd);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=xe.platform;for(const[i,s,n={}]of t)for(const a of i){const o=a.startsWith("mac+");e&&o?(this.callbacks.set(a.slice(4),{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1))):!e&&!o&&(this.callbacks.set(a,{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(b(this,vd,Wp).call(this,e));if(!i)return;const{callback:s,options:{bubbles:n=!1,args:a=[],checker:o=null}}=i;o&&!o(t,e)||(s.bind(t,...a,e)(),n||Jt(e))}}vd=new WeakSet,Wp=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const wd=class wd{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return av(t),ut(this,"_colors",t)}convert(t){const e=Ud(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,s]of this._colors)if(s.every((n,a)=>n===e[a]))return wd._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?Y.makeHexColor(...e):t}};D(wd,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let hu=wd;var Ja,Qe,ne,me,Za,Rs,to,Ai,Ir,An,_n,eo,Sr,es,Oi,Er,jl,Ul,io,Vl,is,In,so,Sn,ss,Ad,En,Kl,xn,xr,no,Cn,Gl,le,xt,Ms,kn,Tn,Wl,ql,Pn,ns,Ds,Xl,Yl,_i,N,Rc,cu,qp,Xp,Mc,Yp,Qp,Jp,du,Zp,uu,fu,tm,De,Cs,em,im,pu,sm,pl,mu;const Va=class Va{constructor(t,e,i,s,n,a,o,h,c,d,u,p,m,v,y,w){g(this,N);g(this,Ja,new AbortController);g(this,Qe,null);g(this,ne,new Map);g(this,me,new Map);g(this,Za,null);g(this,Rs,null);g(this,to,null);g(this,Ai,new hv);g(this,Ir,null);g(this,An,null);g(this,_n,null);g(this,eo,0);g(this,Sr,new Set);g(this,es,null);g(this,Oi,null);g(this,Er,new Set);D(this,"_editorUndoBar",null);g(this,jl,!1);g(this,Ul,!1);g(this,io,!1);g(this,Vl,null);g(this,is,null);g(this,In,null);g(this,so,null);g(this,Sn,!1);g(this,ss,null);g(this,Ad,new lv);g(this,En,!1);g(this,Kl,!1);g(this,xn,null);g(this,xr,null);g(this,no,null);g(this,Cn,null);g(this,Gl,null);g(this,le,rt.NONE);g(this,xt,new Set);g(this,Ms,null);g(this,kn,null);g(this,Tn,null);g(this,Wl,null);g(this,ql,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});g(this,Pn,[0,0]);g(this,ns,null);g(this,Ds,null);g(this,Xl,null);g(this,Yl,null);g(this,_i,null);const A=this._signal=r(this,Ja).signal;f(this,Ds,t),f(this,Xl,e),f(this,Yl,i),f(this,Za,s),f(this,Ir,n),f(this,kn,a),this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:A}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:A}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:A}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:A}),o._on("setpreference",this.onSetPreference.bind(this),{signal:A}),o._on("switchannotationeditorparams",x=>this.updateParams(x.type,x.value),{signal:A}),b(this,N,Yp).call(this),b(this,N,tm).call(this),b(this,N,du).call(this),f(this,Rs,h.annotationStorage),f(this,Vl,h.filterFactory),f(this,Tn,c),f(this,so,d||null),f(this,jl,u),f(this,Ul,p),f(this,io,m),f(this,Gl,v||null),this.viewParameters={realScale:hr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=y||null,this._supportsPinchToZoom=w!==!1}static get _keyboardManager(){const t=Va.prototype,e=a=>r(a,Ds).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),i=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:h}=o;return h!=="text"&&h!=="number"}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return ut(this,"_keyboardManager",new mc([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,Ds).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,Ds).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}destroy(){var t,e,i,s,n,a,o,h,c;(t=r(this,_i))==null||t.resolve(),f(this,_i,null),(e=r(this,Ja))==null||e.abort(),f(this,Ja,null),this._signal=null;for(const d of r(this,me).values())d.destroy();r(this,me).clear(),r(this,ne).clear(),r(this,Er).clear(),(i=r(this,Cn))==null||i.clear(),f(this,Qe,null),r(this,xt).clear(),r(this,Ai).destroy(),(s=r(this,Za))==null||s.destroy(),(n=r(this,Ir))==null||n.destroy(),(a=r(this,kn))==null||a.destroy(),(o=r(this,ss))==null||o.hide(),f(this,ss,null),(h=r(this,no))==null||h.destroy(),f(this,no,null),r(this,is)&&(clearTimeout(r(this,is)),f(this,is,null)),r(this,ns)&&(clearTimeout(r(this,ns)),f(this,ns,null)),(c=this._editorUndoBar)==null||c.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return r(this,Gl)}get useNewAltTextFlow(){return r(this,Ul)}get useNewAltTextWhenAddingImage(){return r(this,io)}get hcmFilter(){return ut(this,"hcmFilter",r(this,Tn)?r(this,Vl).addHCMFilter(r(this,Tn).foreground,r(this,Tn).background):"none")}get direction(){return ut(this,"direction",getComputedStyle(r(this,Ds)).direction)}get _highlightColors(){return ut(this,"_highlightColors",r(this,so)?new Map(r(this,so).split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return ut(this,"highlightColors",null);const e=new Map,i=!!r(this,Tn);for(const[s,n]of t){const a=s.endsWith("_HCM");if(i&&a){e.set(s.replace("_HCM",""),n);continue}!i&&!a&&e.set(s,n)}return ut(this,"highlightColors",e)}get highlightColorNames(){return ut(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),f(this,_n,t)}setMainHighlightColorPicker(t){f(this,no,t)}editAltText(t,e=!1){var i;(i=r(this,Za))==null||i.editAltText(this,t,e)}hasCommentManager(){return!!r(this,Ir)}editComment(t,e){var i;(i=r(this,Ir))==null||i.open(this,t,e)}getSignature(t){var e;(e=r(this,kn))==null||e.getSignature({uiManager:this,editor:t})}get signatureManager(){return r(this,kn)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":f(this,io,e);break}}onPageChanging({pageNumber:t}){f(this,eo,t-1)}focusMainContainer(){r(this,Ds).focus()}findParent(t,e){for(const i of r(this,me).values()){const{x:s,y:n,width:a,height:o}=i.div.getBoundingClientRect();if(t>=s&&t<=s+a&&e>=n&&e<=n+o)return i}return null}disableUserSelect(t=!1){r(this,Xl).classList.toggle("noUserSelect",t)}addShouldRescale(t){r(this,Er).add(t)}removeShouldRescale(t){r(this,Er).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*hr.PDF_TO_CSS_UNITS;for(const i of r(this,Er))i.onScaleChanging();(e=r(this,_n))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:a}=e,o=e.toString(),c=b(this,N,Rc).call(this,e).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;e.empty();const u=b(this,N,cu).call(this,c),p=r(this,le)===rt.NONE,m=()=>{u==null||u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:a,text:o}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(rt.HIGHLIGHT,m);return}m()}addToAnnotationStorage(t){!t.isEmpty()&&r(this,Rs)&&!r(this,Rs).has(t.id)&&r(this,Rs).setValue(t.id,t)}a11yAlert(t,e=null){const i=r(this,Yl);i&&(i.setAttribute("data-l10n-id",t),e?i.setAttribute("data-l10n-args",JSON.stringify(e)):i.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,r(this,Sn)&&(f(this,Sn,!1),b(this,N,Mc).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of r(this,xt))if(e.div.contains(t)){f(this,xr,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!r(this,xr))return;const[t,e]=r(this,xr);f(this,xr,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){b(this,N,du).call(this),b(this,N,uu).call(this)}removeEditListeners(){b(this,N,Zp).call(this),b(this,N,fu).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of r(this,Oi))if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of r(this,Oi))if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var i;if(t.preventDefault(),(i=r(this,Qe))==null||i.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of r(this,xt)){const n=s.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const a of r(this,Oi))if(a.isHandlingMimeForPasting(n.type)){a.paste(n,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(n){at(`paste: "${n.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const n=[];for(const h of i){const c=await s.deserialize(h);if(!c)return;n.push(c)}const a=()=>{for(const h of n)b(this,N,pu).call(this,h);b(this,N,mu).call(this,n)},o=()=>{for(const h of n)h.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(n){at(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),r(this,le)!==rt.NONE&&!this.isEditorHandlingKeyboard&&Va._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,r(this,Sn)&&(f(this,Sn,!1),b(this,N,Mc).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(b(this,N,Qp).call(this),b(this,N,uu).call(this),b(this,N,De).call(this,{isEditing:r(this,le)!==rt.NONE,isEmpty:b(this,N,pl).call(this),hasSomethingToUndo:r(this,Ai).hasSomethingToUndo(),hasSomethingToRedo:r(this,Ai).hasSomethingToRedo(),hasSelectedEditor:!1})):(b(this,N,Jp).call(this),b(this,N,fu).call(this),b(this,N,De).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!r(this,Oi)){f(this,Oi,t);for(const e of r(this,Oi))b(this,N,Cs).call(this,e.defaultPropertiesToUpdate)}}getId(){return r(this,Ad).id}get currentLayer(){return r(this,me).get(r(this,eo))}getLayer(t){return r(this,me).get(t)}get currentPageIndex(){return r(this,eo)}addLayer(t){r(this,me).set(t.pageIndex,t),r(this,En)?t.enable():t.disable()}removeLayer(t){r(this,me).delete(t.pageIndex)}async updateMode(t,e=null,i=!1,s=!1,n=!1){var a,o,h;if(r(this,le)!==t&&!(r(this,_i)&&(await r(this,_i).promise,!r(this,_i)))){if(f(this,_i,Promise.withResolvers()),(a=r(this,_n))==null||a.commitOrRemove(),f(this,le,t),t===rt.NONE){this.setEditingState(!1),b(this,N,im).call(this),(o=this._editorUndoBar)==null||o.hide(),r(this,_i).resolve();return}t===rt.SIGNATURE&&await((h=r(this,kn))==null?void 0:h.loadSignatures()),this.setEditingState(!0),await b(this,N,em).call(this),this.unselectAll();for(const c of r(this,me).values())c.updateMode(t);if(!e){i&&this.addNewEditorFromKeyboard(),r(this,_i).resolve();return}for(const c of r(this,ne).values())c.annotationElementId===e||c.id===e?(this.setSelected(c),n?c.editComment():s&&c.enterInEditMode()):c.unselect();r(this,_i).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==r(this,le)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(r(this,Oi)){switch(t){case mt.CREATE:this.currentLayer.addNewEditor(e);return;case mt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(r(this,Wl)||f(this,Wl,new Map)).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const i of r(this,xt))i.updateParams(t,e);else for(const i of r(this,Oi))i.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){var n;for(const a of r(this,ne).values())a.editorType===t&&a.show(e);(((n=r(this,Wl))==null?void 0:n.get(mt.HIGHLIGHT_SHOW_ALL))??!0)!==e&&b(this,N,Cs).call(this,[[mt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(r(this,Kl)!==t){f(this,Kl,t);for(const e of r(this,me).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const i of r(this,ne).values())i.pageIndex===t&&e.push(i);return e}getEditor(t){return r(this,ne).get(t)}addEditor(t){r(this,ne).set(t.id,t)}removeEditor(t){var e,i;t.div.contains(document.activeElement)&&(r(this,is)&&clearTimeout(r(this,is)),f(this,is,setTimeout(()=>{this.focusMainContainer(),f(this,is,null)},0))),r(this,ne).delete(t.id),t.annotationElementId&&((e=r(this,Cn))==null||e.delete(t.annotationElementId)),this.unselect(t),(!t.annotationElementId||!r(this,Sr).has(t.annotationElementId))&&((i=r(this,Rs))==null||i.remove(t.id))}addDeletedAnnotationElement(t){r(this,Sr).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return r(this,Sr).has(t)}removeDeletedAnnotationElement(t){r(this,Sr).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){r(this,Qe)!==t&&(f(this,Qe,t),t&&b(this,N,Cs).call(this,t.propertiesToUpdate))}updateUI(t){r(this,N,sm)===t&&b(this,N,Cs).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){b(this,N,Cs).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(r(this,xt).has(t)){r(this,xt).delete(t),t.unselect(),b(this,N,De).call(this,{hasSelectedEditor:this.hasSelection});return}r(this,xt).add(t),t.select(),b(this,N,Cs).call(this,t.propertiesToUpdate),b(this,N,De).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;this.updateToolbar({mode:t.mode,editId:t.id}),(e=r(this,_n))==null||e.commitOrRemove();for(const i of r(this,xt))i!==t&&i.unselect();r(this,xt).clear(),r(this,xt).add(t),t.select(),b(this,N,Cs).call(this,t.propertiesToUpdate),b(this,N,De).call(this,{hasSelectedEditor:!0})}isSelected(t){return r(this,xt).has(t)}get firstSelectedEditor(){return r(this,xt).values().next().value}unselect(t){t.unselect(),r(this,xt).delete(t),b(this,N,De).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return r(this,xt).size!==0}get isEnterHandled(){return r(this,xt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;r(this,Ai).undo(),b(this,N,De).call(this,{hasSomethingToUndo:r(this,Ai).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:b(this,N,pl).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){r(this,Ai).redo(),b(this,N,De).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:r(this,Ai).hasSomethingToRedo(),isEmpty:b(this,N,pl).call(this)})}addCommands(t){r(this,Ai).add(t),b(this,N,De).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:b(this,N,pl).call(this)})}cleanUndoStack(t){r(this,Ai).cleanType(t)}delete(){var n;this.commitOrRemove();const t=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...r(this,xt)],i=()=>{var a;(a=this._editorUndoBar)==null||a.show(s,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},s=()=>{for(const a of e)b(this,N,pu).call(this,a)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){var t;(t=r(this,Qe))==null||t.commitOrRemove()}hasSomethingToControl(){return r(this,Qe)||this.hasSelection}selectAll(){for(const t of r(this,xt))t.commit();b(this,N,mu).call(this,r(this,ne).values())}unselectAll(){var t;if(!(r(this,Qe)&&(r(this,Qe).commitOrRemove(),r(this,le)!==rt.NONE))&&!((t=r(this,_n))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of r(this,xt))e.unselect();r(this,xt).clear(),b(this,N,De).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;r(this,Pn)[0]+=t,r(this,Pn)[1]+=e;const[s,n]=r(this,Pn),a=[...r(this,xt)],o=1e3;r(this,ns)&&clearTimeout(r(this,ns)),f(this,ns,setTimeout(()=>{f(this,ns,null),r(this,Pn)[0]=r(this,Pn)[1]=0,this.addCommands({cmd:()=>{for(const h of a)r(this,ne).has(h.id)&&(h.translateInPage(s,n),h.translationDone())},undo:()=>{for(const h of a)r(this,ne).has(h.id)&&(h.translateInPage(-s,-n),h.translationDone())},mustExec:!1})},o));for(const h of a)h.translateInPage(t,e),h.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),f(this,es,new Map);for(const t of r(this,xt))r(this,es).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!r(this,es))return!1;this.disableUserSelect(!1);const t=r(this,es);f(this,es,null);let e=!1;for(const[{x:s,y:n,pageIndex:a},o]of t)o.newX=s,o.newY=n,o.newPageIndex=a,e||(e=s!==o.savedX||n!==o.savedY||a!==o.savedPageIndex);if(!e)return!1;const i=(s,n,a,o)=>{if(r(this,ne).has(s.id)){const h=r(this,me).get(o);h?s._setParentAndPosition(h,n,a):(s.pageIndex=o,s.x=n,s.y=a)}};return this.addCommands({cmd:()=>{for(const[s,{newX:n,newY:a,newPageIndex:o}]of t)i(s,n,a,o)},undo:()=>{for(const[s,{savedX:n,savedY:a,savedPageIndex:o}]of t)i(s,n,a,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(r(this,es))for(const i of r(this,es).keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||r(this,xt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return r(this,Qe)===t}getActive(){return r(this,Qe)}getMode(){return r(this,le)}get imageManager(){return ut(this,"imageManager",new lu)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,d=e.rangeCount;c<d;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:i,y:s,width:n,height:a}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(c,d,u,p)=>({x:(d-s)/a,y:1-(c+u-i)/n,width:p/a,height:u/n});break;case"180":o=(c,d,u,p)=>({x:1-(c+u-i)/n,y:1-(d+p-s)/a,width:u/n,height:p/a});break;case"270":o=(c,d,u,p)=>({x:1-(d+p-s)/a,y:(c-i)/n,width:p/a,height:u/n});break;default:o=(c,d,u,p)=>({x:(c-i)/n,y:(d-s)/a,width:u/n,height:p/a});break}const h=[];for(let c=0,d=e.rangeCount;c<d;c++){const u=e.getRangeAt(c);if(!u.collapsed)for(const{x:p,y:m,width:v,height:y}of u.getClientRects())v===0||y===0||h.push(o(p,m,v,y))}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:t,id:e}){(r(this,to)||f(this,to,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=r(this,to))==null||e.delete(t)}renderAnnotationElement(t){var s;const e=(s=r(this,to))==null?void 0:s.get(t.data.id);if(!e)return;const i=r(this,Rs).getRawValue(e);i&&(r(this,le)===rt.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}setMissingCanvas(t,e,i){var n;const s=(n=r(this,Cn))==null?void 0:n.get(t);s&&(s.setCanvas(e,i),r(this,Cn).delete(t))}addMissingCanvas(t,e){(r(this,Cn)||f(this,Cn,new Map)).set(t,e)}};Ja=new WeakMap,Qe=new WeakMap,ne=new WeakMap,me=new WeakMap,Za=new WeakMap,Rs=new WeakMap,to=new WeakMap,Ai=new WeakMap,Ir=new WeakMap,An=new WeakMap,_n=new WeakMap,eo=new WeakMap,Sr=new WeakMap,es=new WeakMap,Oi=new WeakMap,Er=new WeakMap,jl=new WeakMap,Ul=new WeakMap,io=new WeakMap,Vl=new WeakMap,is=new WeakMap,In=new WeakMap,so=new WeakMap,Sn=new WeakMap,ss=new WeakMap,Ad=new WeakMap,En=new WeakMap,Kl=new WeakMap,xn=new WeakMap,xr=new WeakMap,no=new WeakMap,Cn=new WeakMap,Gl=new WeakMap,le=new WeakMap,xt=new WeakMap,Ms=new WeakMap,kn=new WeakMap,Tn=new WeakMap,Wl=new WeakMap,ql=new WeakMap,Pn=new WeakMap,ns=new WeakMap,Ds=new WeakMap,Xl=new WeakMap,Yl=new WeakMap,_i=new WeakMap,N=new WeakSet,Rc=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},cu=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of r(this,me).values())if(i.hasTextLayer(t))return i;return null},qp=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=b(this,N,Rc).call(this,t).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(r(this,ss)||f(this,ss,new ov(this)),r(this,ss).show(i,s,this.direction==="ltr"))},Xp=function(){var n,a,o;const t=document.getSelection();if(!t||t.isCollapsed){r(this,Ms)&&((n=r(this,ss))==null||n.hide(),f(this,Ms,null),b(this,N,De).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===r(this,Ms))return;const s=b(this,N,Rc).call(this,t).closest(".textLayer");if(!s){r(this,Ms)&&((a=r(this,ss))==null||a.hide(),f(this,Ms,null),b(this,N,De).call(this,{hasSelectedText:!1}));return}if((o=r(this,ss))==null||o.hide(),f(this,Ms,e),b(this,N,De).call(this,{hasSelectedText:!0}),!(r(this,le)!==rt.HIGHLIGHT&&r(this,le)!==rt.NONE)&&(r(this,le)===rt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),f(this,Sn,this.isShiftKeyDown),!this.isShiftKeyDown)){const h=r(this,le)===rt.HIGHLIGHT?b(this,N,cu).call(this,s):null;h==null||h.toggleDrawing();const c=new AbortController,d=this.combinedSignal(c),u=p=>{p.type==="pointerup"&&p.button!==0||(c.abort(),h==null||h.toggleDrawing(!0),p.type==="pointerup"&&b(this,N,Mc).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("blur",u,{signal:d})}},Mc=function(t=""){r(this,le)===rt.HIGHLIGHT?this.highlightSelection(t):r(this,jl)&&b(this,N,qp).call(this)},Yp=function(){document.addEventListener("selectionchange",b(this,N,Xp).bind(this),{signal:this._signal})},Qp=function(){if(r(this,In))return;f(this,In,new AbortController);const t=this.combinedSignal(r(this,In));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},Jp=function(){var t;(t=r(this,In))==null||t.abort(),f(this,In,null)},du=function(){if(r(this,xn))return;f(this,xn,new AbortController);const t=this.combinedSignal(r(this,xn));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},Zp=function(){var t;(t=r(this,xn))==null||t.abort(),f(this,xn,null)},uu=function(){if(r(this,An))return;f(this,An,new AbortController);const t=this.combinedSignal(r(this,An));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},fu=function(){var t;(t=r(this,An))==null||t.abort(),f(this,An,null)},tm=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},De=function(t){Object.entries(t).some(([i,s])=>r(this,ql)[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(r(this,ql),t)}),r(this,le)===rt.HIGHLIGHT&&t.hasSelectedEditor===!1&&b(this,N,Cs).call(this,[[mt.HIGHLIGHT_FREE,!0]]))},Cs=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},em=async function(){if(!r(this,En)){f(this,En,!0);const t=[];for(const e of r(this,me).values())t.push(e.enable());await Promise.all(t);for(const e of r(this,ne).values())e.enable()}},im=function(){if(this.unselectAll(),r(this,En)){f(this,En,!1);for(const t of r(this,me).values())t.disable();for(const t of r(this,ne).values())t.disable()}},pu=function(t){const e=r(this,me).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},sm=function(){let t=null;for(t of r(this,xt));return t},pl=function(){if(r(this,ne).size===0)return!0;if(r(this,ne).size===1)for(const t of r(this,ne).values())return t.isEmpty();return!1},mu=function(t){for(const e of r(this,xt))e.unselect();r(this,xt).clear();for(const e of t)e.isEmpty()||(r(this,xt).add(e),e.select());b(this,N,De).call(this,{hasSelectedEditor:this.hasSelection})},D(Va,"TRANSLATE_SMALL",1),D(Va,"TRANSLATE_BIG",10);let ka=Va;var he,rs,Ni,ro,as,Je,ao,os,Ge,Fs,Cr,ls,Ln,Wi,ml,Dc;const Fe=class Fe{constructor(t){g(this,Wi);g(this,he,null);g(this,rs,!1);g(this,Ni,null);g(this,ro,null);g(this,as,null);g(this,Je,null);g(this,ao,!1);g(this,os,null);g(this,Ge,null);g(this,Fs,null);g(this,Cr,null);g(this,ls,!1);f(this,Ge,t),f(this,ls,t._uiManager.useNewAltTextFlow),r(Fe,Ln)||f(Fe,Ln,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){Fe._l10n??(Fe._l10n=t)}async render(){const t=f(this,Ni,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=f(this,ro,document.createElement("span"));t.append(e),r(this,ls)?(t.classList.add("new"),t.setAttribute("data-l10n-id",r(Fe,Ln).missing),e.setAttribute("data-l10n-id",r(Fe,Ln)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=r(this,Ge)._uiManager._signal;t.addEventListener("contextmenu",Mi,{signal:i}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),r(this,Ge)._uiManager.editAltText(r(this,Ge)),r(this,ls)&&r(this,Ge)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:r(this,Wi,ml)}})};return t.addEventListener("click",s,{capture:!0,signal:i}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(f(this,ao,!0),s(n))},{signal:i}),await b(this,Wi,Dc).call(this),t}finish(){r(this,Ni)&&(r(this,Ni).focus({focusVisible:r(this,ao)}),f(this,ao,!1))}isEmpty(){return r(this,ls)?r(this,he)===null:!r(this,he)&&!r(this,rs)}hasData(){return r(this,ls)?r(this,he)!==null||!!r(this,Fs):this.isEmpty()}get guessedText(){return r(this,Fs)}async setGuessedText(t){r(this,he)===null&&(f(this,Fs,t),f(this,Cr,await Fe._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),b(this,Wi,Dc).call(this))}toggleAltTextBadge(t=!1){var e;if(!r(this,ls)||r(this,he)){(e=r(this,os))==null||e.remove(),f(this,os,null);return}if(!r(this,os)){const i=f(this,os,document.createElement("div"));i.className="noAltTextBadge",r(this,Ge).div.append(i)}r(this,os).classList.toggle("hidden",!t)}serialize(t){let e=r(this,he);return!t&&r(this,Fs)===e&&(e=r(this,Cr)),{altText:e,decorative:r(this,rs),guessedText:r(this,Fs),textWithDisclaimer:r(this,Cr)}}get data(){return{altText:r(this,he),decorative:r(this,rs)}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:s,cancel:n=!1}){i&&(f(this,Fs,i),f(this,Cr,s)),!(r(this,he)===t&&r(this,rs)===e)&&(n||(f(this,he,t),f(this,rs,e)),b(this,Wi,Dc).call(this))}toggle(t=!1){r(this,Ni)&&(!t&&r(this,Je)&&(clearTimeout(r(this,Je)),f(this,Je,null)),r(this,Ni).disabled=!t)}shown(){r(this,Ge)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:r(this,Wi,ml)}})}destroy(){var t,e;(t=r(this,Ni))==null||t.remove(),f(this,Ni,null),f(this,ro,null),f(this,as,null),(e=r(this,os))==null||e.remove(),f(this,os,null)}};he=new WeakMap,rs=new WeakMap,Ni=new WeakMap,ro=new WeakMap,as=new WeakMap,Je=new WeakMap,ao=new WeakMap,os=new WeakMap,Ge=new WeakMap,Fs=new WeakMap,Cr=new WeakMap,ls=new WeakMap,Ln=new WeakMap,Wi=new WeakSet,ml=function(){return r(this,he)&&"added"||r(this,he)===null&&this.guessedText&&"review"||"missing"},Dc=async function(){var s,n,a;const t=r(this,Ni);if(!t)return;if(r(this,ls)){if(t.classList.toggle("done",!!r(this,he)),t.setAttribute("data-l10n-id",r(Fe,Ln)[r(this,Wi,ml)]),(s=r(this,ro))==null||s.setAttribute("data-l10n-id",r(Fe,Ln)[`${r(this,Wi,ml)}-label`]),!r(this,he)){(n=r(this,as))==null||n.remove();return}}else{if(!r(this,he)&&!r(this,rs)){t.classList.remove("done"),(a=r(this,as))==null||a.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=r(this,as);if(!e){f(this,as,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${r(this,Ge).id}`;const o=100,h=r(this,Ge)._uiManager._signal;h.addEventListener("abort",()=>{clearTimeout(r(this,Je)),f(this,Je,null)},{once:!0}),t.addEventListener("mouseenter",()=>{f(this,Je,setTimeout(()=>{f(this,Je,null),r(this,as).classList.add("show"),r(this,Ge)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:h}),t.addEventListener("mouseleave",()=>{var c;r(this,Je)&&(clearTimeout(r(this,Je)),f(this,Je,null)),(c=r(this,as))==null||c.classList.remove("show")},{signal:h})}r(this,rs)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=r(this,he)),e.parentNode||t.append(e);const i=r(this,Ge).getElementForAltText();i==null||i.setAttribute("aria-describedby",e.id)},g(Fe,Ln,null),D(Fe,"_l10n",null);let hd=Fe;var hs,kr,Bi,Ql,Os,oo,Rn;class wc{constructor(t){g(this,hs,null);g(this,kr,!1);g(this,Bi,null);g(this,Ql,null);g(this,Os,null);g(this,oo,null);g(this,Rn,!1);f(this,Bi,t),this.toolbar=null}render(){if(!r(this,Bi)._uiManager.hasCommentManager())return null;const t=f(this,hs,document.createElement("button"));t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=r(this,Bi)._uiManager._signal;t.addEventListener("contextmenu",Mi,{signal:e}),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:e});const i=s=>{s.preventDefault(),this.edit()};return t.addEventListener("click",i,{capture:!0,signal:e}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(f(this,kr,!0),i(s))},{signal:e}),t}edit(){const{bottom:t,left:e,right:i}=r(this,Bi).getClientDimensions(),s={top:t};r(this,Bi)._uiManager.direction==="ltr"?s.right=i:s.left=e,r(this,Bi)._uiManager.editComment(r(this,Bi),s)}finish(){r(this,hs)&&(r(this,hs).focus({focusVisible:r(this,kr)}),f(this,kr,!1))}isDeleted(){return r(this,Rn)||r(this,Os)===""}hasBeenEdited(){return this.isDeleted()||r(this,Os)!==r(this,Ql)}serialize(){return this.data}get data(){return{text:r(this,Os),date:r(this,oo),deleted:r(this,Rn)}}set data(t){if(t===null){f(this,Os,""),f(this,Rn,!0);return}f(this,Os,t),f(this,oo,new Date),f(this,Rn,!1)}setInitialText(t){f(this,Ql,t),this.data=t}toggle(t=!1){r(this,hs)&&(r(this,hs).disabled=!t)}shown(){}destroy(){var t;(t=r(this,hs))==null||t.remove(),f(this,hs,null),f(this,Os,""),f(this,oo,null),f(this,Bi,null),f(this,kr,!1),f(this,Rn,!1)}}hs=new WeakMap,kr=new WeakMap,Bi=new WeakMap,Ql=new WeakMap,Os=new WeakMap,oo=new WeakMap,Rn=new WeakMap;var lo,Tr,Jl,Zl,th,eh,ih,Ns,Pr,Bs,Lr,Hs,dr,nm,rm,am;const Ff=class Ff{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){g(this,dr);g(this,lo);g(this,Tr,!1);g(this,Jl,null);g(this,Zl);g(this,th);g(this,eh);g(this,ih);g(this,Ns,null);g(this,Pr);g(this,Bs,null);g(this,Lr);g(this,Hs,null);f(this,lo,t),f(this,Jl,i),f(this,Zl,e),f(this,th,s),f(this,eh,n),f(this,ih,a),f(this,Lr,new AbortController),f(this,Pr,AbortSignal.any([o,r(this,Lr).signal])),t.addEventListener("touchstart",b(this,dr,nm).bind(this),{passive:!1,signal:r(this,Pr)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Is.pixelRatio}destroy(){var t,e;(t=r(this,Lr))==null||t.abort(),f(this,Lr,null),(e=r(this,Ns))==null||e.abort(),f(this,Ns,null)}};lo=new WeakMap,Tr=new WeakMap,Jl=new WeakMap,Zl=new WeakMap,th=new WeakMap,eh=new WeakMap,ih=new WeakMap,Ns=new WeakMap,Pr=new WeakMap,Bs=new WeakMap,Lr=new WeakMap,Hs=new WeakMap,dr=new WeakSet,nm=function(t){var s,n,a;if((s=r(this,Zl))!=null&&s.call(this))return;if(t.touches.length===1){if(r(this,Ns))return;const o=f(this,Ns,new AbortController),h=AbortSignal.any([r(this,Pr),o.signal]),c=r(this,lo),d={capture:!0,signal:h,passive:!1},u=p=>{var m;p.pointerType==="touch"&&((m=r(this,Ns))==null||m.abort(),f(this,Ns,null))};c.addEventListener("pointerdown",p=>{p.pointerType==="touch"&&(Jt(p),u(p))},d),c.addEventListener("pointerup",u,d),c.addEventListener("pointercancel",u,d);return}if(!r(this,Hs)){f(this,Hs,new AbortController);const o=AbortSignal.any([r(this,Pr),r(this,Hs).signal]),h=r(this,lo),c={signal:o,capture:!1,passive:!1};h.addEventListener("touchmove",b(this,dr,rm).bind(this),c);const d=b(this,dr,am).bind(this);h.addEventListener("touchend",d,c),h.addEventListener("touchcancel",d,c),c.capture=!0,h.addEventListener("pointerdown",Jt,c),h.addEventListener("pointermove",Jt,c),h.addEventListener("pointercancel",Jt,c),h.addEventListener("pointerup",Jt,c),(n=r(this,th))==null||n.call(this)}if(Jt(t),t.touches.length!==2||(a=r(this,Jl))!=null&&a.call(this)){f(this,Bs,null);return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),f(this,Bs,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY})},rm=function(t){var E;if(!r(this,Bs)||t.touches.length!==2)return;Jt(t);let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);const{screenX:s,screenY:n}=e,{screenX:a,screenY:o}=i,h=r(this,Bs),{touch0X:c,touch0Y:d,touch1X:u,touch1Y:p}=h,m=u-c,v=p-d,y=a-s,w=o-n,A=Math.hypot(y,w)||1,x=Math.hypot(m,v)||1;if(!r(this,Tr)&&Math.abs(x-A)<=Ff.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(h.touch0X=s,h.touch0Y=n,h.touch1X=a,h.touch1Y=o,!r(this,Tr)){f(this,Tr,!0);return}const I=[(s+a)/2,(n+o)/2];(E=r(this,eh))==null||E.call(this,I,x,A)},am=function(t){var e;t.touches.length>=2||(r(this,Hs)&&(r(this,Hs).abort(),f(this,Hs,null),(e=r(this,ih))==null||e.call(this)),r(this,Bs)&&(Jt(t),f(this,Bs,null),f(this,Tr,!1)))};let cd=Ff;var Rr,Hi,Bt,ge,ho,Mn,sh,Mr,be,Dr,$s,Dn,nh,Fr,Ze,rh,Or,zs,cs,co,uo,Ii,Nr,ah,_d,tt,gu,oh,bu,Fc,om,lm,yu,Oc,vu,hm,cm,dm,wu,um,Au,fm,pm,mm,_u,gl;const ht=class ht{constructor(t){g(this,tt);g(this,Rr,null);g(this,Hi,null);g(this,Bt,null);g(this,ge,null);g(this,ho,!1);g(this,Mn,null);g(this,sh,"");g(this,Mr,!1);g(this,be,null);g(this,Dr,null);g(this,$s,null);g(this,Dn,null);g(this,nh,"");g(this,Fr,!1);g(this,Ze,null);g(this,rh,!1);g(this,Or,!1);g(this,zs,!1);g(this,cs,null);g(this,co,0);g(this,uo,0);g(this,Ii,null);g(this,Nr,null);D(this,"isSelected",!1);D(this,"_isCopy",!1);D(this,"_editToolbar",null);D(this,"_initialOptions",Object.create(null));D(this,"_initialData",null);D(this,"_isVisible",!0);D(this,"_uiManager",null);D(this,"_focusEventsAllowed",!0);g(this,ah,!1);g(this,_d,ht._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,a];const[o,h]=this.parentDimensions;this.x=t.x/o,this.y=t.y/h,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=ht.prototype._resizeWithKeyboard,e=ka.TRANSLATE_SMALL,i=ka.TRANSLATE_BIG;return ut(this,"_resizerKeyboardManager",new mc([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],ht.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ut(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new cv({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(ht._l10n??(ht._l10n=t),ht._l10nResizer||(ht._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),ht._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);ht._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Pt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return r(this,ah)}set _isDraggable(t){var e;f(this,ah,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=r(this,_d)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):b(this,tt,gl).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(r(this,Fr)?f(this,Fr,!1):this.parent.setSelected(this))}focusout(t){var i;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(i=this.parent)!=null&&i.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){const[n,a]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/n,this.y=(e+s)/a,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s),this._onTranslated()}translate(t,e){b(this,tt,gu).call(this,this.parentDimensions,t,e)}translateInPage(t,e){r(this,Ze)||f(this,Ze,[this.x,this.y,this.width,this.height]),b(this,tt,gu).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){r(this,Ze)||f(this,Ze,[this.x,this.y,this.width,this.height]);const{div:i,parentDimensions:[s,n]}=this;if(this.x+=t/s,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[h,c]=this.getBaseTranslation();a+=h,o+=c;const{style:d}=i;d.left=`${(100*a).toFixed(2)}%`,d.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!r(this,Ze)&&(r(this,Ze)[0]!==this.x||r(this,Ze)[1]!==this.y)}get _hasBeenResized(){return!!r(this,Ze)&&(r(this,Ze)[2]!==this.width||r(this,Ze)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=ht,s=i/t,n=i/e;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[i,s]}=this;let{x:n,y:a,width:o,height:h}=this;if(o*=i,h*=s,n*=i,a*=s,this._mustFixPosition)switch(t){case 0:n=$e(n,0,i-o),a=$e(a,0,s-h);break;case 90:n=$e(n,0,i-h),a=$e(a,o,s);break;case 180:n=$e(n,o,i),a=$e(a,h,s);break;case 270:n=$e(n,h,i),a=$e(a,0,s-o);break}this.x=n/=i,this.y=a/=s;const[c,d]=this.getBaseTranslation();n+=c,a+=d,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var i;return b(i=ht,oh,bu).call(i,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var i;return b(i=ht,oh,bu).call(i,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(t,e){const[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/i).toFixed(2)}%`,r(this,Mr)||(n.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:i}=t,s=i.endsWith("%"),n=!r(this,Mr)&&e.endsWith("%");if(s&&n)return;const[a,o]=this.parentDimensions;s||(t.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!r(this,Mr)&&!n&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=r(this,Bt))==null||t.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||r(this,Or))return this._editToolbar;this._editToolbar=new ou(this),this.div.append(this._editToolbar.render()),this._editToolbar.addButton("comment",this.addCommentButton());const{toolbarButtons:t}=this;if(t)for(const[e,i]of t)await this._editToolbar.addButton(e,i);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=r(this,Bt))==null||t.destroy())}addContainer(t){var i;const e=(i=this._editToolbar)==null?void 0:i.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return r(this,Bt)||(hd.initialize(ht._l10n),f(this,Bt,new hd(this)),r(this,Rr)&&(r(this,Bt).data=r(this,Rr),f(this,Rr,null))),r(this,Bt)}get altTextData(){var t;return(t=r(this,Bt))==null?void 0:t.data}set altTextData(t){r(this,Bt)&&(r(this,Bt).data=t)}get guessedAltText(){var t;return(t=r(this,Bt))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=r(this,Bt))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=r(this,Bt))==null?void 0:e.serialize(t)}hasAltText(){return!!r(this,Bt)&&!r(this,Bt).isEmpty()}hasAltTextData(){var t;return((t=r(this,Bt))==null?void 0:t.hasData())??!1}addCommentButton(){return r(this,ge)?r(this,ge):f(this,ge,new wc(this))}get commentColor(){return null}get comment(){const t=r(this,ge);return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){r(this,ge)||f(this,ge,new wc(this)),r(this,ge).data=t}setCommentData(t){r(this,ge)||f(this,ge,new wc(this)),r(this,ge).setInitialText(t)}get hasEditedComment(){var t;return(t=r(this,ge))==null?void 0:t.hasBeenEdited()}async editComment(){r(this,ge)||f(this,ge,new wc(this)),r(this,ge).edit()}addComment(t){this.hasEditedComment&&(t.popup={contents:this.comment.text,deleted:this.comment.deleted})}render(){var a;const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=r(this,ho)?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),b(this,tt,Au).call(this);const[e,i]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*i/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/i).toFixed(2)}%`);const[s,n]=this.getInitialTranslation();return this.translate(s,n),Gp(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(r(this,Nr)||f(this,Nr,new cd({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:b(this,tt,hm).bind(this),onPinching:b(this,tt,cm).bind(this),onPinchEnd:b(this,tt,dm).bind(this),signal:this._uiManager._signal}))),(a=this._uiManager._editorUndoBar)==null||a.hide(),t}pointerdown(t){const{isMac:e}=xe.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(f(this,Fr,!0),this._isDraggable){b(this,tt,um).call(this,t);return}b(this,tt,wu).call(this,t)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){r(this,cs)&&clearTimeout(r(this,cs)),f(this,cs,setTimeout(()=>{var t;f(this,cs,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){const s=this.parentScale,[n,a]=this.pageDimensions,[o,h]=this.pageTranslation,c=t/s,d=e/s,u=this.x*n,p=this.y*a,m=this.width*n,v=this.height*a;switch(i){case 0:return[u+c+o,a-p-d-v+h,u+c+m+o,a-p-d+h];case 90:return[u+d+o,a-p+c+h,u+d+v+o,a-p+c+m+h];case 180:return[u-c-m+o,a-p+d+h,u-c+o,a-p+d+v+h];case 270:return[u-d-v+o,a-p-c-m+h,u-d+o,a-p-c+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,s,n,a]=t,o=n-i,h=a-s;switch(this.rotation){case 0:return[i,e-a,o,h];case 90:return[i,e-s,h,o];case 180:return[n,e-s,o,h];case 270:return[n,e-a,h,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),f(this,Or,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),f(this,Or,!1),!0):!1}isInEditMode(){return r(this,Or)}shouldGetKeyboardEvents(){return r(this,zs)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return e<a&&s>0&&t<n&&i>0}rebuild(){b(this,tt,Au).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){Pt("An editor must be serializable")}static async deserialize(t,e,i){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i,annotationElementId:t.annotationElementId});s.rotation=t.rotation,f(s,Rr,t.accessibilityData),s._isCopy=t.isCopy||!1;const[n,a]=s.pageDimensions,[o,h,c,d]=s.getRectInCurrentCoords(t.rect,a);return s.x=o/n,s.y=h/a,s.width=c/n,s.height=d/a,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=r(this,Dn))==null||t.abort(),f(this,Dn,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),r(this,cs)&&(clearTimeout(r(this,cs)),f(this,cs,null)),b(this,tt,gl).call(this),this.removeEditToolbar(),r(this,Ii)){for(const i of r(this,Ii).values())clearTimeout(i);f(this,Ii,null)}this.parent=null,(e=r(this,Nr))==null||e.destroy(),f(this,Nr,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(b(this,tt,om).call(this),r(this,be).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),f(this,$s,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=r(this,be).children;if(!r(this,Hi)){f(this,Hi,Array.from(e));const a=b(this,tt,fm).bind(this),o=b(this,tt,pm).bind(this),h=this._uiManager._signal;for(const c of r(this,Hi)){const d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",a,{signal:h}),c.addEventListener("blur",o,{signal:h}),c.addEventListener("focus",b(this,tt,mm).bind(this,d),{signal:h}),c.setAttribute("data-l10n-id",ht._l10nResizer[d])}}const i=r(this,Hi)[0];let s=0;for(const a of e){if(a===i)break;s++}const n=(360-this.rotation+this.parentRotation)%360/90*(r(this,Hi).length/4);if(n!==s){if(n<s)for(let o=0;o<s-n;o++)r(this,be).append(r(this,be).firstChild);else if(n>s)for(let o=0;o<n-s;o++)r(this,be).firstChild.before(r(this,be).lastChild);let a=0;for(const o of e){const c=r(this,Hi)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",ht._l10nResizer[c])}}b(this,tt,_u).call(this,0),f(this,zs,!0),r(this,be).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){r(this,zs)&&b(this,tt,vu).call(this,r(this,nh),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){b(this,tt,gl).call(this),this.div.focus()}select(){var t,e,i;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,n;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(e=this._editToolbar)==null||e.show(),(i=r(this,Bt))==null||i.toggleAltTextBadge(!1)}}unselect(){var t,e,i,s,n;this.isSelected&&(this.isSelected=!1,(t=r(this,be))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(i=this.div)!=null&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(n=r(this,Bt))==null||n.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return r(this,rh)}set isEditing(t){f(this,rh,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){f(this,Mr,!0);const i=t/e,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){r(this,Ii)||f(this,Ii,new Map);const{action:i}=t;let s=r(this,Ii).get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),r(this,Ii).delete(i),r(this,Ii).size===0&&f(this,Ii,null)},ht._telemetryTimeout),r(this,Ii).set(i,s);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),f(this,ho,!1)}disable(){this.div&&(this.div.tabIndex=-1),f(this,ho,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};Rr=new WeakMap,Hi=new WeakMap,Bt=new WeakMap,ge=new WeakMap,ho=new WeakMap,Mn=new WeakMap,sh=new WeakMap,Mr=new WeakMap,be=new WeakMap,Dr=new WeakMap,$s=new WeakMap,Dn=new WeakMap,nh=new WeakMap,Fr=new WeakMap,Ze=new WeakMap,rh=new WeakMap,Or=new WeakMap,zs=new WeakMap,cs=new WeakMap,co=new WeakMap,uo=new WeakMap,Ii=new WeakMap,Nr=new WeakMap,ah=new WeakMap,_d=new WeakMap,tt=new WeakSet,gu=function([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},oh=new WeakSet,bu=function(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},Fc=function(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}},om=function(){if(r(this,be))return;f(this,be,document.createElement("div")),r(this,be).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const s=document.createElement("div");r(this,be).append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",b(this,tt,lm).bind(this,i),{signal:e}),s.addEventListener("contextmenu",Mi,{signal:e}),s.tabIndex=-1}this.div.prepend(r(this,be))},lm=function(t,e){var d;e.preventDefault();const{isMac:i}=xe.platform;if(e.button!==0||e.ctrlKey&&i)return;(d=r(this,Bt))==null||d.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,f(this,Dr,[e.screenX,e.screenY]);const n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",b(this,tt,vu).bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Jt,{passive:!1,signal:a}),window.addEventListener("contextmenu",Mi,{signal:a}),f(this,$s,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const c=()=>{var u;n.abort(),this.parent.togglePointerEvents(!0),(u=r(this,Bt))==null||u.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=o,this.div.style.cursor=h,b(this,tt,Oc).call(this)};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})},yu=function(t,e,i,s){this.width=i,this.height=s,this.x=t,this.y=e;const[n,a]=this.parentDimensions;this.setDims(n*i,a*s),this.fixAndSetPosition(),this._onResized()},Oc=function(){if(!r(this,$s))return;const{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=r(this,$s);f(this,$s,null);const n=this.x,a=this.y,o=this.width,h=this.height;n===t&&a===e&&o===i&&h===s||this.addCommands({cmd:b(this,tt,yu).bind(this,n,a,o,h),undo:b(this,tt,yu).bind(this,t,e,i,s),mustExec:!0})},vu=function(t,e){const[i,s]=this.parentDimensions,n=this.x,a=this.y,o=this.width,h=this.height,c=ht.MIN_SIZE/i,d=ht.MIN_SIZE/s,u=b(this,tt,Fc).call(this,this.rotation),p=(B,R)=>[u[0]*B+u[2]*R,u[1]*B+u[3]*R],m=b(this,tt,Fc).call(this,360-this.rotation),v=(B,R)=>[m[0]*B+m[2]*R,m[1]*B+m[3]*R];let y,w,A=!1,x=!1;switch(t){case"topLeft":A=!0,y=(B,R)=>[0,0],w=(B,R)=>[B,R];break;case"topMiddle":y=(B,R)=>[B/2,0],w=(B,R)=>[B/2,R];break;case"topRight":A=!0,y=(B,R)=>[B,0],w=(B,R)=>[0,R];break;case"middleRight":x=!0,y=(B,R)=>[B,R/2],w=(B,R)=>[0,R/2];break;case"bottomRight":A=!0,y=(B,R)=>[B,R],w=(B,R)=>[0,0];break;case"bottomMiddle":y=(B,R)=>[B/2,R],w=(B,R)=>[B/2,0];break;case"bottomLeft":A=!0,y=(B,R)=>[0,R],w=(B,R)=>[B,0];break;case"middleLeft":x=!0,y=(B,R)=>[0,R/2],w=(B,R)=>[B,R/2];break}const I=y(o,h),E=w(o,h);let C=p(...E);const P=ht._round(n+C[0]),k=ht._round(a+C[1]);let _=1,S=1,T,L;if(e.fromKeyboard)({deltaX:T,deltaY:L}=e);else{const{screenX:B,screenY:R}=e,[ft,q]=r(this,Dr);[T,L]=this.screenToPageTranslation(B-ft,R-q),r(this,Dr)[0]=B,r(this,Dr)[1]=R}if([T,L]=v(T/i,L/s),A){const B=Math.hypot(o,h);_=S=Math.max(Math.min(Math.hypot(E[0]-I[0]-T,E[1]-I[1]-L)/B,1/o,1/h),c/o,d/h)}else x?_=$e(Math.abs(E[0]-I[0]-T),c,1)/o:S=$e(Math.abs(E[1]-I[1]-L),d,1)/h;const M=ht._round(o*_),z=ht._round(h*S);C=p(...w(M,z));const G=P-C[0],It=k-C[1];r(this,Ze)||f(this,Ze,[this.x,this.y,this.width,this.height]),this.width=M,this.height=z,this.x=G,this.y=It,this.setDims(i*M,s*z),this.fixAndSetPosition(),this._onResizing()},hm=function(){var t;f(this,$s,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=r(this,Bt))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},cm=function(t,e,i){let n=.7*(i/e)+1-.7;if(n===1)return;const a=b(this,tt,Fc).call(this,this.rotation),o=(P,k)=>[a[0]*P+a[2]*k,a[1]*P+a[3]*k],[h,c]=this.parentDimensions,d=this.x,u=this.y,p=this.width,m=this.height,v=ht.MIN_SIZE/h,y=ht.MIN_SIZE/c;n=Math.max(Math.min(n,1/p,1/m),v/p,y/m);const w=ht._round(p*n),A=ht._round(m*n);if(w===p&&A===m)return;r(this,Ze)||f(this,Ze,[d,u,p,m]);const x=o(p/2,m/2),I=ht._round(d+x[0]),E=ht._round(u+x[1]),C=o(w/2,A/2);this.x=I-C[0],this.y=E-C[1],this.width=w,this.height=A,this.setDims(h*w,c*A),this.fixAndSetPosition(),this._onResizing()},dm=function(){var t;(t=r(this,Bt))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),b(this,tt,Oc).call(this)},wu=function(t){const{isMac:e}=xe.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},um=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,n=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:n},o=c=>{s.abort(),f(this,Mn,null),f(this,Fr,!1),this._uiManager.endDragSession()||b(this,tt,wu).call(this,c),i&&this._onStopDragging()};e&&(f(this,co,t.clientX),f(this,uo,t.clientY),f(this,Mn,t.pointerId),f(this,sh,t.pointerType),window.addEventListener("pointermove",c=>{i||(i=!0,this._onStartDragging());const{clientX:d,clientY:u,pointerId:p}=c;if(p!==r(this,Mn)){Jt(c);return}const[m,v]=this.screenToPageTranslation(d-r(this,co),u-r(this,uo));f(this,co,d),f(this,uo,u),this._uiManager.dragSelectedEditors(m,v)},a),window.addEventListener("touchmove",Jt,a),window.addEventListener("pointerdown",c=>{c.pointerType===r(this,sh)&&(r(this,Nr)||c.isPrimary)&&o(c),Jt(c)},a));const h=c=>{if(!r(this,Mn)||r(this,Mn)===c.pointerId){o(c);return}Jt(c)};window.addEventListener("pointerup",h,{signal:n}),window.addEventListener("blur",h,{signal:n})},Au=function(){if(r(this,Dn)||!this.div)return;f(this,Dn,new AbortController);const t=this._uiManager.combinedSignal(r(this,Dn));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},fm=function(t){ht._resizerKeyboardManager.exec(this,t)},pm=function(t){var e;r(this,zs)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==r(this,be)&&b(this,tt,gl).call(this)},mm=function(t){f(this,nh,r(this,zs)?t:"")},_u=function(t){if(r(this,Hi))for(const e of r(this,Hi))e.tabIndex=t},gl=function(){f(this,zs,!1),b(this,tt,_u).call(this,-1),b(this,tt,Oc).call(this)},g(ht,oh),D(ht,"_l10n",null),D(ht,"_l10nResizer",null),D(ht,"_borderLineWidth",-1),D(ht,"_colorManager",new hu),D(ht,"_zIndex",1),D(ht,"_telemetryTimeout",1e3);let Ot=ht;class cv extends Ot{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Jf=3285377520,vi=4294901760,Zi=65535;class gm{constructor(t){this.h1=t?t&4294967295:Jf,this.h2=t?t&4294967295:Jf}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let y=0,w=t.length;y<w;y++){const A=t.charCodeAt(y);A<=255?e[i++]=A:(e[i++]=A>>>8,e[i++]=A&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,n=i-s*4,a=new Uint32Array(e.buffer,0,s);let o=0,h=0,c=this.h1,d=this.h2;const u=3432918353,p=461845907,m=u&Zi,v=p&Zi;for(let y=0;y<s;y++)y&1?(o=a[y],o=o*u&vi|o*m&Zi,o=o<<15|o>>>17,o=o*p&vi|o*v&Zi,c^=o,c=c<<13|c>>>19,c=c*5+3864292196):(h=a[y],h=h*u&vi|h*m&Zi,h=h<<15|h>>>17,h=h*p&vi|h*v&Zi,d^=h,d=d<<13|d>>>19,d=d*5+3864292196);switch(o=0,n){case 3:o^=e[s*4+2]<<16;case 2:o^=e[s*4+1]<<8;case 1:o^=e[s*4],o=o*u&vi|o*m&Zi,o=o<<15|o>>>17,o=o*p&vi|o*v&Zi,s&1?c^=o:d^=o}this.h1=c,this.h2=d}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&vi|t*36045&Zi,e=e*4283543511&vi|((e<<16|t>>>16)*2950163797&vi)>>>16,t^=e>>>1,t=t*444984403&vi|t*60499&Zi,e=e*3301882366&vi|((e<<16|t>>>16)*3120437893&vi)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Iu=Object.freeze({map:null,hash:"",transfer:void 0});var Br,Hr,ye,Id,bm;class Cf{constructor(){g(this,Id);g(this,Br,!1);g(this,Hr,null);g(this,ye,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=r(this,ye).get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return r(this,ye).get(t)}remove(t){if(r(this,ye).delete(t),r(this,ye).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of r(this,ye).values())if(e instanceof Ot)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=r(this,ye).get(t);let s=!1;if(i!==void 0)for(const[n,a]of Object.entries(e))i[n]!==a&&(s=!0,i[n]=a);else s=!0,r(this,ye).set(t,e);s&&b(this,Id,bm).call(this),e instanceof Ot&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return r(this,ye).has(t)}get size(){return r(this,ye).size}resetModified(){r(this,Br)&&(f(this,Br,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new ym(this)}get serializable(){if(r(this,ye).size===0)return Iu;const t=new Map,e=new gm,i=[],s=Object.create(null);let n=!1;for(const[a,o]of r(this,ye)){const h=o instanceof Ot?o.serialize(!1,s):o;h&&(t.set(a,h),e.update(`${a}:${JSON.stringify(h)}`),n||(n=!!h.bitmap))}if(n)for(const a of t.values())a.bitmap&&i.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:Iu}get editorStats(){let t=null;const e=new Map;for(const i of r(this,ye).values()){if(!(i instanceof Ot))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:n}=s;e.has(n)||e.set(n,Object.getPrototypeOf(i).constructor),t||(t=Object.create(null));const a=t[n]||(t[n]=new Map);for(const[o,h]of Object.entries(s)){if(o==="type")continue;let c=a.get(o);c||(c=new Map,a.set(o,c));const d=c.get(h)??0;c.set(h,d+1)}}for(const[i,s]of e)t[i]=s.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){f(this,Hr,null)}get modifiedIds(){if(r(this,Hr))return r(this,Hr);const t=[];for(const e of r(this,ye).values())!(e instanceof Ot)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return f(this,Hr,{ids:new Set(t),hash:t.join(",")})}[Symbol.iterator](){return r(this,ye).entries()}}Br=new WeakMap,Hr=new WeakMap,ye=new WeakMap,Id=new WeakSet,bm=function(){r(this,Br)||(f(this,Br,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var lh;class ym extends Cf{constructor(e){super();g(this,lh);const{map:i,hash:s,transfer:n}=e.serializable,a=structuredClone(i,n?{transfer:n}:null);f(this,lh,{map:a,hash:s,transfer:n})}get print(){Pt("Should not call PrintAnnotationStorage.print")}get serializable(){return r(this,lh)}get modifiedIds(){return ut(this,"modifiedIds",{ids:new Set,hash:""})}}lh=new WeakMap;var fo;class dv{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){g(this,fo,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),r(this,fo).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:i}){if(!(!t||r(this,fo).has(t.loadedName))){if(te(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:n,style:a}=t,o=new FontFace(s,n,a);this.addNativeFontFace(o);try{await o.load(),r(this,fo).add(s),i==null||i(t)}catch{at(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Pt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw at(`Failed to load font '${i.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return ut(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return ut(this,"isSyncFontLoadingSupported",He||xe.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(te(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const n=i.shift();setTimeout(n.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:e,callback:t};return i.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ut(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(E,C){return E.charCodeAt(C)<<24|E.charCodeAt(C+1)<<16|E.charCodeAt(C+2)<<8|E.charCodeAt(C+3)&255}function s(E,C,P,k){const _=E.substring(0,C),S=E.substring(C+P);return _+k+S}let n,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const h=o.getContext("2d");let c=0;function d(E,C){if(++c>30){at("Load test font never loaded."),C();return}if(h.font="30px "+E,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){C();return}setTimeout(d.bind(null,E,C))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=s(p,976,u.length,u);const v=16,y=1482184792;let w=i(p,v);for(n=0,a=u.length-3;n<a;n+=4)w=w-y+i(u,n)|0;n<u.length&&(w=w-y+i(u+"XXX",n)|0),p=s(p,v,4,Xy(w));const A=`url(data:font/opentype;base64,${btoa(p)});`,x=`@font-face {font-family:"${u}";src:${A}}`;this.insertRule(x);const I=this._document.createElement("div");I.style.visibility="hidden",I.style.width=I.style.height="10px",I.style.position="absolute",I.style.top=I.style.left="0px";for(const E of[t.loadedName,u]){const C=this._document.createElement("span");C.textContent="Hi",C.style.fontFamily=E,I.append(C)}this._document.body.append(I),d(u,()=>{I.remove(),e.complete()})}}fo=new WeakMap;class uv{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const i in t)this[i]=t[i];this._inspectFont=e}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Hp(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return(i=this._inspectFont)==null||i.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const i=this.loadedName+"_path_"+e;let s;try{s=t.get(i)}catch(a){at(`getPathGenerator - ignoring character: "${a}".`)}const n=new Path2D(s||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=n}}function fv(l){if(l instanceof URL)return l.href;if(typeof l=="string"){if(He)return l;const t=URL.parse(l,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function pv(l){if(He&&typeof Buffer<"u"&&l instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength)return l;if(typeof l=="string")return uc(l);if(l instanceof ArrayBuffer||ArrayBuffer.isView(l)||typeof l=="object"&&!isNaN(l==null?void 0:l.length))return new Uint8Array(l);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Ac(l){if(typeof l!="string")return null;if(l.endsWith("/"))return l;throw new Error(`Invalid factory url: "${l}" must include trailing slash.`)}const Su=l=>typeof l=="object"&&Number.isInteger(l==null?void 0:l.num)&&l.num>=0&&Number.isInteger(l==null?void 0:l.gen)&&l.gen>=0,mv=l=>typeof l=="object"&&typeof(l==null?void 0:l.name)=="string",gv=tv.bind(null,Su,mv);var js,Sd;class bv{constructor(){g(this,js,new Map);g(this,Sd,Promise.resolve())}postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};r(this,Sd).then(()=>{for(const[s]of r(this,js))s.call(this,i)})}addEventListener(t,e,i=null){let s=null;if((i==null?void 0:i.signal)instanceof AbortSignal){const{signal:n}=i;if(n.aborted){at("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(t,e);s=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}r(this,js).set(e,s)}removeEventListener(t,e){const i=r(this,js).get(e);i==null||i(),r(this,js).delete(e)}terminate(){for(const[,t]of r(this,js))t==null||t();r(this,js).clear()}}js=new WeakMap,Sd=new WeakMap;const _c={DATA:1,ERROR:2},Xt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Zf(){}function Ve(l){if(l instanceof lr||l instanceof nu||l instanceof Xf||l instanceof od||l instanceof Xd)return l;switch(l instanceof Error||typeof l=="object"&&l!==null||Pt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),l.name){case"AbortException":return new lr(l.message);case"InvalidPDFException":return new nu(l.message);case"PasswordException":return new Xf(l.message,l.code);case"ResponseException":return new od(l.message,l.status,l.missing);case"UnknownErrorException":return new Xd(l.message,l.details)}return new Xd(l.message,l.toString())}var po,Li,vm,wm,Am,Nc;class bl{constructor(t,e,i){g(this,Li);g(this,po,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",b(this,Li,vm).bind(this),{signal:r(this,po).signal})}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(a){n.reject(a)}return n.promise}sendWithStream(t,e,i,s){const n=this.streamId++,a=this.sourceName,o=this.targetName,h=this.comObj;return new ReadableStream({start:c=>{const d=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:a,targetName:o,action:t,streamId:n,data:e,desiredSize:c.desiredSize},s),d.promise},pull:c=>{const d=Promise.withResolvers();return this.streamControllers[n].pullCall=d,h.postMessage({sourceName:a,targetName:o,stream:Xt.PULL,streamId:n,desiredSize:c.desiredSize}),d.promise},cancel:c=>{te(c instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[n].cancelCall=d,this.streamControllers[n].isClosed=!0,h.postMessage({sourceName:a,targetName:o,stream:Xt.CANCEL,streamId:n,reason:Ve(c)}),d.promise}},i)}destroy(){var t;(t=r(this,po))==null||t.abort(),f(this,po,null)}}po=new WeakMap,Li=new WeakSet,vm=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){b(this,Li,Am).call(this,t);return}if(t.callback){const i=t.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===_c.DATA)s.resolve(t.data);else if(t.callback===_c.ERROR)s.reject(Ve(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,s=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(a){n.postMessage({sourceName:i,targetName:s,callback:_c.DATA,callbackId:t.callbackId,data:a})},function(a){n.postMessage({sourceName:i,targetName:s,callback:_c.ERROR,callbackId:t.callbackId,reason:Ve(a)})});return}if(t.streamId){b(this,Li,wm).call(this,t);return}e(t.data)},wm=function(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this,o=this.actionHandler[t.action],h={enqueue(c,d=1,u){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:Xt.ENQUEUE,streamId:e,chunk:c},u)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Xt.CLOSE,streamId:e}),delete a.streamSinks[e])},error(c){te(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Xt.ERROR,streamId:e,reason:Ve(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[e]=h,Promise.try(o,t.data,h).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Xt.START_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:Xt.START_COMPLETE,streamId:e,reason:Ve(c)})})},Am=function(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case Xt.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(Ve(t.reason));break;case Xt.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(Ve(t.reason));break;case Xt.PULL:if(!o){n.postMessage({sourceName:i,targetName:s,stream:Xt.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||Zf).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Xt.PULL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:Xt.PULL_COMPLETE,streamId:e,reason:Ve(c)})});break;case Xt.ENQUEUE:if(te(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case Xt.CLOSE:if(te(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),b(this,Li,Nc).call(this,a,e);break;case Xt.ERROR:te(a,"error should have stream controller"),a.controller.error(Ve(t.reason)),b(this,Li,Nc).call(this,a,e);break;case Xt.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(Ve(t.reason)),b(this,Li,Nc).call(this,a,e);break;case Xt.CANCEL:if(!o)break;const h=Ve(t.reason);Promise.try(o.onCancel||Zf,h).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Xt.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:Xt.CANCEL_COMPLETE,streamId:e,reason:Ve(c)})}),o.sinkCapability.reject(h),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},Nc=async function(t,e){var i,s,n;await Promise.allSettled([(i=t.startCall)==null?void 0:i.promise,(s=t.pullCall)==null?void 0:s.promise,(n=t.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[e]};var hh;class _m{constructor({enableHWA:t=!1}){g(this,hh,!1);f(this,hh,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!r(this,hh)})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Pt("Abstract method `_createCanvas` called.")}}hh=new WeakMap;class yv extends _m{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class Im{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Pt("Abstract method `_fetch` called.")}}class tp extends Im{async _fetch(t){const e=await fc(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):uc(e)}}class Sm{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,s,n){return"none"}destroy(t=!1){}}var $r,mo,Us,Vs,Le,zr,jr,j,Te,yl,Na,Bc,Ba,Em,Eu,Ha,vl,wl,xu,Al;class vv extends Sm{constructor({docId:e,ownerDocument:i=globalThis.document}){super();g(this,j);g(this,$r);g(this,mo);g(this,Us);g(this,Vs);g(this,Le);g(this,zr);g(this,jr,0);f(this,Vs,e),f(this,Le,i)}addFilter(e){if(!e)return"none";let i=r(this,j,Te).get(e);if(i)return i;const[s,n,a]=b(this,j,Bc).call(this,e),o=e.length===1?s:`${s}${n}${a}`;if(i=r(this,j,Te).get(o),i)return r(this,j,Te).set(e,i),i;const h=`g_${r(this,Vs)}_transfer_map_${Me(this,jr)._++}`,c=b(this,j,Ba).call(this,h);r(this,j,Te).set(e,c),r(this,j,Te).set(o,c);const d=b(this,j,Ha).call(this,h);return b(this,j,wl).call(this,s,n,a,d),c}addHCMFilter(e,i){var v;const s=`${e}-${i}`,n="base";let a=r(this,j,yl).get(n);if((a==null?void 0:a.key)===s||(a?((v=a.filter)==null||v.remove(),a.key=s,a.url="none",a.filter=null):(a={key:s,url:"none",filter:null},r(this,j,yl).set(n,a)),!e||!i))return a.url;const o=b(this,j,Al).call(this,e);e=Y.makeHexColor(...o);const h=b(this,j,Al).call(this,i);if(i=Y.makeHexColor(...h),r(this,j,Na).style.color="",e==="#000000"&&i==="#ffffff"||e===i)return a.url;const c=new Array(256);for(let y=0;y<=255;y++){const w=y/255;c[y]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}const d=c.join(","),u=`g_${r(this,Vs)}_hcm_filter`,p=a.filter=b(this,j,Ha).call(this,u);b(this,j,wl).call(this,d,d,d,p),b(this,j,Eu).call(this,p);const m=(y,w)=>{const A=o[y]/255,x=h[y]/255,I=new Array(w+1);for(let E=0;E<=w;E++)I[E]=A+E/w*(x-A);return I.join(",")};return b(this,j,wl).call(this,m(0,5),m(1,5),m(2,5),p),a.url=b(this,j,Ba).call(this,u),a.url}addAlphaFilter(e){let i=r(this,j,Te).get(e);if(i)return i;const[s]=b(this,j,Bc).call(this,[e]),n=`alpha_${s}`;if(i=r(this,j,Te).get(n),i)return r(this,j,Te).set(e,i),i;const a=`g_${r(this,Vs)}_alpha_map_${Me(this,jr)._++}`,o=b(this,j,Ba).call(this,a);r(this,j,Te).set(e,o),r(this,j,Te).set(n,o);const h=b(this,j,Ha).call(this,a);return b(this,j,xu).call(this,s,h),o}addLuminosityFilter(e){let i=r(this,j,Te).get(e||"luminosity");if(i)return i;let s,n;if(e?([s]=b(this,j,Bc).call(this,[e]),n=`luminosity_${s}`):n="luminosity",i=r(this,j,Te).get(n),i)return r(this,j,Te).set(e,i),i;const a=`g_${r(this,Vs)}_luminosity_map_${Me(this,jr)._++}`,o=b(this,j,Ba).call(this,a);r(this,j,Te).set(e,o),r(this,j,Te).set(n,o);const h=b(this,j,Ha).call(this,a);return b(this,j,Em).call(this,h),e&&b(this,j,xu).call(this,s,h),o}addHighlightHCMFilter(e,i,s,n,a){var x;const o=`${i}-${s}-${n}-${a}`;let h=r(this,j,yl).get(e);if((h==null?void 0:h.key)===o||(h?((x=h.filter)==null||x.remove(),h.key=o,h.url="none",h.filter=null):(h={key:o,url:"none",filter:null},r(this,j,yl).set(e,h)),!i||!s))return h.url;const[c,d]=[i,s].map(b(this,j,Al).bind(this));let u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,v]=[n,a].map(b(this,j,Al).bind(this));p<u&&([u,p,m,v]=[p,u,v,m]),r(this,j,Na).style.color="";const y=(I,E,C)=>{const P=new Array(256),k=(p-u)/C,_=I/255,S=(E-I)/(255*C);let T=0;for(let L=0;L<=C;L++){const M=Math.round(u+L*k),z=_+L*S;for(let G=T;G<=M;G++)P[G]=z;T=M+1}for(let L=T;L<256;L++)P[L]=P[T-1];return P.join(",")},w=`g_${r(this,Vs)}_hcm_${e}_filter`,A=h.filter=b(this,j,Ha).call(this,w);return b(this,j,Eu).call(this,A),b(this,j,wl).call(this,y(m[0],v[0],5),y(m[1],v[1],5),y(m[2],v[2],5),A),h.url=b(this,j,Ba).call(this,w),h.url}destroy(e=!1){var i,s,n,a;e&&((i=r(this,zr))!=null&&i.size)||((s=r(this,Us))==null||s.parentNode.parentNode.remove(),f(this,Us,null),(n=r(this,mo))==null||n.clear(),f(this,mo,null),(a=r(this,zr))==null||a.clear(),f(this,zr,null),f(this,jr,0))}}$r=new WeakMap,mo=new WeakMap,Us=new WeakMap,Vs=new WeakMap,Le=new WeakMap,zr=new WeakMap,jr=new WeakMap,j=new WeakSet,Te=function(){return r(this,mo)||f(this,mo,new Map)},yl=function(){return r(this,zr)||f(this,zr,new Map)},Na=function(){if(!r(this,Us)){const e=r(this,Le).createElement("div"),{style:i}=e;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;const s=r(this,Le).createElementNS(xs,"svg");s.setAttribute("width",0),s.setAttribute("height",0),f(this,Us,r(this,Le).createElementNS(xs,"defs")),e.append(s),s.append(r(this,Us)),r(this,Le).body.append(e)}return r(this,Us)},Bc=function(e){if(e.length===1){const c=e[0],d=new Array(256);for(let p=0;p<256;p++)d[p]=c[p]/255;const u=d.join(",");return[u,u,u]}const[i,s,n]=e,a=new Array(256),o=new Array(256),h=new Array(256);for(let c=0;c<256;c++)a[c]=i[c]/255,o[c]=s[c]/255,h[c]=n[c]/255;return[a.join(","),o.join(","),h.join(",")]},Ba=function(e){if(r(this,$r)===void 0){f(this,$r,"");const i=r(this,Le).URL;i!==r(this,Le).baseURI&&(jd(i)?at('#createUrl: ignore "data:"-URL for performance reasons.'):f(this,$r,Op(i,"")))}return`url(${r(this,$r)}#${e})`},Em=function(e){const i=r(this,Le).createElementNS(xs,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(i)},Eu=function(e){const i=r(this,Le).createElementNS(xs,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(i)},Ha=function(e){const i=r(this,Le).createElementNS(xs,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",e),r(this,j,Na).append(i),i},vl=function(e,i,s){const n=r(this,Le).createElementNS(xs,i);n.setAttribute("type","discrete"),n.setAttribute("tableValues",s),e.append(n)},wl=function(e,i,s,n){const a=r(this,Le).createElementNS(xs,"feComponentTransfer");n.append(a),b(this,j,vl).call(this,a,"feFuncR",e),b(this,j,vl).call(this,a,"feFuncG",i),b(this,j,vl).call(this,a,"feFuncB",s)},xu=function(e,i){const s=r(this,Le).createElementNS(xs,"feComponentTransfer");i.append(s),b(this,j,vl).call(this,s,"feFuncA",e)},Al=function(e){return r(this,j,Na).style.color=e,Ud(getComputedStyle(r(this,j,Na)).getPropertyValue("color"))};class xm{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Pt("Abstract method `_fetch` called.")}}class ep extends xm{async _fetch(t){const e=await fc(t,"arraybuffer");return new Uint8Array(e)}}class Cm{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Pt("Abstract method `_fetch` called.")}}class ip extends Cm{async _fetch(t){const e=await fc(t,"arraybuffer");return new Uint8Array(e)}}He&&at("Please use the `legacy` build in Node.js environments.");async function kf(l){const e=await process.getBuiltinModule("fs").promises.readFile(l);return new Uint8Array(e)}class wv extends Sm{}class Av extends _m{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class _v extends Im{async _fetch(t){return kf(t)}}class Iv extends xm{async _fetch(t){return kf(t)}}class Sv extends Cm{async _fetch(t){return kf(t)}}const Ae={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Cu(l,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,i),l.clip(s)}class Tf{isModifyingCurrentTransform(){return!1}getPattern(){Pt("Abstract method `getPattern` called.")}}class Ev extends Tf{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let n;if(s===Ae.STROKE||s===Ae.FILL){const a=e.current.getClippedPathBoundingBox(s,Ut(t))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,h=Math.ceil(a[3]-a[1])||1,c=e.cachedCanvases.getCanvas("pattern",o,h),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),i=Y.transform(i,[1,0,0,1,a[0],a[1]]),d.transform(...e.baseTransform),this.matrix&&d.transform(...this.matrix),Cu(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=t.createPattern(c.canvas,"no-repeat");const u=new DOMMatrix(i);n.setTransform(u)}else Cu(t,this._bbox),n=this._createGradient(t);return n}}function Jd(l,t,e,i,s,n,a,o){const h=t.coords,c=t.colors,d=l.data,u=l.width*4;let p;h[e+1]>h[i+1]&&(p=e,e=i,i=p,p=n,n=a,a=p),h[i+1]>h[s+1]&&(p=i,i=s,s=p,p=a,a=o,o=p),h[e+1]>h[i+1]&&(p=e,e=i,i=p,p=n,n=a,a=p);const m=(h[e]+t.offsetX)*t.scaleX,v=(h[e+1]+t.offsetY)*t.scaleY,y=(h[i]+t.offsetX)*t.scaleX,w=(h[i+1]+t.offsetY)*t.scaleY,A=(h[s]+t.offsetX)*t.scaleX,x=(h[s+1]+t.offsetY)*t.scaleY;if(v>=x)return;const I=c[n],E=c[n+1],C=c[n+2],P=c[a],k=c[a+1],_=c[a+2],S=c[o],T=c[o+1],L=c[o+2],M=Math.round(v),z=Math.round(x);let G,It,B,R,ft,q,Mt,Z;for(let X=M;X<=z;X++){if(X<w){const nt=X<v?0:(v-X)/(v-w);G=m-(m-y)*nt,It=I-(I-P)*nt,B=E-(E-k)*nt,R=C-(C-_)*nt}else{let nt;X>x?nt=1:w===x?nt=0:nt=(w-X)/(w-x),G=y-(y-A)*nt,It=P-(P-S)*nt,B=k-(k-T)*nt,R=_-(_-L)*nt}let O;X<v?O=0:X>x?O=1:O=(v-X)/(v-x),ft=m-(m-A)*O,q=I-(I-S)*O,Mt=E-(E-T)*O,Z=C-(C-L)*O;const H=Math.round(Math.min(G,ft)),st=Math.round(Math.max(G,ft));let ct=u*X+H*4;for(let nt=H;nt<=st;nt++)O=(G-nt)/(G-ft),O<0?O=0:O>1&&(O=1),d[ct++]=It-(It-q)*O|0,d[ct++]=B-(B-Mt)*O|0,d[ct++]=R-(R-Z)*O|0,d[ct++]=255}}function xv(l,t,e){const i=t.coords,s=t.colors;let n,a;switch(t.type){case"lattice":const o=t.verticesPerRow,h=Math.floor(i.length/o)-1,c=o-1;for(n=0;n<h;n++){let d=n*o;for(let u=0;u<c;u++,d++)Jd(l,e,i[d],i[d+1],i[d+o],s[d],s[d+1],s[d+o]),Jd(l,e,i[d+o+1],i[d+1],i[d+o],s[d+o+1],s[d+1],s[d+o])}break;case"triangles":for(n=0,a=i.length;n<a;n+=3)Jd(l,e,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}class Cv extends Tf{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,i){const o=Math.floor(this._bounds[0]),h=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-o,d=Math.ceil(this._bounds[3])-h,u=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*t[1]*1.1)),3e3),m=c/u,v=d/p,y={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-h,scaleX:1/m,scaleY:1/v},w=u+2*2,A=p+2*2,x=i.getCanvas("mesh",w,A),I=x.context,E=I.createImageData(u,p);if(e){const P=E.data;for(let k=0,_=P.length;k<_;k+=4)P[k]=e[0],P[k+1]=e[1],P[k+2]=e[2],P[k+3]=255}for(const P of this._figures)xv(E,P,y);return I.putImageData(E,2,2),{canvas:x.canvas,offsetX:o-2*m,offsetY:h-2*v,scaleX:m,scaleY:v}}isModifyingCurrentTransform(){return!0}getPattern(t,e,i,s){Cu(t,this._bbox);const n=new Float32Array(2);if(s===Ae.SHADING)Y.singularValueDecompose2dScale(Ut(t),n);else if(this.matrix){Y.singularValueDecompose2dScale(this.matrix,n);const[o,h]=n;Y.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=o,n[1]*=h}else Y.singularValueDecompose2dScale(e.baseTransform,n);const a=this._createMeshCanvas(n,s===Ae.SHADING?null:this._background,e.cachedCanvases);return s!==Ae.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class kv extends Tf{getPattern(){return"hotpink"}}function Tv(l){switch(l[0]){case"RadialAxial":return new Ev(l);case"Mesh":return new Cv(l);case"Dummy":return new kv}throw new Error(`Unknown IR type: ${l[0]}`)}const sp={COLORED:1,UNCOLORED:2},Ed=class Ed{constructor(t,e,i,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=i,this.baseTransform=s}createPatternCanvas(t){const{bbox:e,operatorList:i,paintType:s,tilingType:n,color:a,canvasGraphicsFactory:o}=this;let{xstep:h,ystep:c}=this;h=Math.abs(h),c=Math.abs(c),zd("TilingType: "+n);const d=e[0],u=e[1],p=e[2],m=e[3],v=p-d,y=m-u,w=new Float32Array(2);Y.singularValueDecompose2dScale(this.matrix,w);const[A,x]=w;Y.singularValueDecompose2dScale(this.baseTransform,w);const I=A*w[0],E=x*w[1];let C=v,P=y,k=!1,_=!1;const S=Math.ceil(h*I),T=Math.ceil(c*E),L=Math.ceil(v*I),M=Math.ceil(y*E);S>=L?C=h:k=!0,T>=M?P=c:_=!0;const z=this.getSizeAndScale(C,this.ctx.canvas.width,I),G=this.getSizeAndScale(P,this.ctx.canvas.height,E),It=t.cachedCanvases.getCanvas("pattern",z.size,G.size),B=It.context,R=o.createCanvasGraphics(B);if(R.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(R,s,a),B.translate(-z.scale*d,-G.scale*u),R.transform(z.scale,0,0,G.scale,0,0),B.save(),this.clipBbox(R,d,u,p,m),R.baseTransform=Ut(R.ctx),R.executeOperatorList(i),R.endDrawing(),B.restore(),k||_){const ft=It.canvas;k&&(C=h),_&&(P=c);const q=this.getSizeAndScale(C,this.ctx.canvas.width,I),Mt=this.getSizeAndScale(P,this.ctx.canvas.height,E),Z=q.size,X=Mt.size,O=t.cachedCanvases.getCanvas("pattern-workaround",Z,X),H=O.context,st=k?Math.floor(v/h):0,ct=_?Math.floor(y/c):0;for(let nt=0;nt<=st;nt++)for(let et=0;et<=ct;et++)H.drawImage(ft,Z*nt,X*et,Z,X,0,0,Z,X);return{canvas:O.canvas,scaleX:q.scale,scaleY:Mt.scale,offsetX:d,offsetY:u}}return{canvas:It.canvas,scaleX:z.scale,scaleY:G.scale,offsetX:d,offsetY:u}}getSizeAndScale(t,e,i){const s=Math.max(Ed.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*i);return n>=s?n=s:i=n/t,{scale:i,size:n}}clipBbox(t,e,i,s,n){const a=s-e,o=n-i;t.ctx.rect(e,i,a,o),Y.axialAlignedBoundingBox([e,i,s,n],Ut(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const s=t.ctx,n=t.current;switch(e){case sp.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;s.fillStyle=n.fillColor=a,s.strokeStyle=n.strokeColor=o;break;case sp.UNCOLORED:s.fillStyle=s.strokeStyle=i,n.fillColor=n.strokeColor=i;break;default:throw new qy(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,i,s){let n=i;s!==Ae.SHADING&&(n=Y.transform(n,e.baseTransform),this.matrix&&(n=Y.transform(n,this.matrix)));const a=this.createPatternCanvas(e);let o=new DOMMatrix(n);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const h=t.createPattern(a.canvas,"repeat");return h.setTransform(o),h}};D(Ed,"MAX_PATTERN_SIZE",3e3);let ku=Ed;function Pv({src:l,srcPos:t=0,dest:e,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:a=!1}){const o=xe.isLittleEndian?4278190080:255,[h,c]=a?[n,o]:[o,n],d=i>>3,u=i&7,p=l.length;e=new Uint32Array(e.buffer);let m=0;for(let v=0;v<s;v++){for(const w=t+d;t<w;t++){const A=t<p?l[t]:255;e[m++]=A&128?c:h,e[m++]=A&64?c:h,e[m++]=A&32?c:h,e[m++]=A&16?c:h,e[m++]=A&8?c:h,e[m++]=A&4?c:h,e[m++]=A&2?c:h,e[m++]=A&1?c:h}if(u===0)continue;const y=t<p?l[t++]:255;for(let w=0;w<u;w++)e[m++]=y&1<<7-w?c:h}return{srcPos:t,destPos:m}}const np=16,rp=100,Lv=15,ap=10,Xe=16,Zd=new DOMMatrix,fi=new Float32Array(2),Ua=new Float32Array([1/0,1/0,-1/0,-1/0]);function Rv(l,t){if(l._removeMirroring)throw new Error("Context is already forwarding operations.");l.__originalSave=l.save,l.__originalRestore=l.restore,l.__originalRotate=l.rotate,l.__originalScale=l.scale,l.__originalTranslate=l.translate,l.__originalTransform=l.transform,l.__originalSetTransform=l.setTransform,l.__originalResetTransform=l.resetTransform,l.__originalClip=l.clip,l.__originalMoveTo=l.moveTo,l.__originalLineTo=l.lineTo,l.__originalBezierCurveTo=l.bezierCurveTo,l.__originalRect=l.rect,l.__originalClosePath=l.closePath,l.__originalBeginPath=l.beginPath,l._removeMirroring=()=>{l.save=l.__originalSave,l.restore=l.__originalRestore,l.rotate=l.__originalRotate,l.scale=l.__originalScale,l.translate=l.__originalTranslate,l.transform=l.__originalTransform,l.setTransform=l.__originalSetTransform,l.resetTransform=l.__originalResetTransform,l.clip=l.__originalClip,l.moveTo=l.__originalMoveTo,l.lineTo=l.__originalLineTo,l.bezierCurveTo=l.__originalBezierCurveTo,l.rect=l.__originalRect,l.closePath=l.__originalClosePath,l.beginPath=l.__originalBeginPath,delete l._removeMirroring},l.save=function(){t.save(),this.__originalSave()},l.restore=function(){t.restore(),this.__originalRestore()},l.translate=function(e,i){t.translate(e,i),this.__originalTranslate(e,i)},l.scale=function(e,i){t.scale(e,i),this.__originalScale(e,i)},l.transform=function(e,i,s,n,a,o){t.transform(e,i,s,n,a,o),this.__originalTransform(e,i,s,n,a,o)},l.setTransform=function(e,i,s,n,a,o){t.setTransform(e,i,s,n,a,o),this.__originalSetTransform(e,i,s,n,a,o)},l.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},l.rotate=function(e){t.rotate(e),this.__originalRotate(e)},l.clip=function(e){t.clip(e),this.__originalClip(e)},l.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},l.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},l.bezierCurveTo=function(e,i,s,n,a,o){t.bezierCurveTo(e,i,s,n,a,o),this.__originalBezierCurveTo(e,i,s,n,a,o)},l.rect=function(e,i,s,n){t.rect(e,i,s,n),this.__originalRect(e,i,s,n)},l.closePath=function(){t.closePath(),this.__originalClosePath()},l.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Mv{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Ic(l,t,e,i,s,n,a,o,h,c){const[d,u,p,m,v,y]=Ut(l);if(u===0&&p===0){const x=a*d+v,I=Math.round(x),E=o*m+y,C=Math.round(E),P=(a+h)*d+v,k=Math.abs(Math.round(P)-I)||1,_=(o+c)*m+y,S=Math.abs(Math.round(_)-C)||1;return l.setTransform(Math.sign(d),0,0,Math.sign(m),I,C),l.drawImage(t,e,i,s,n,0,0,k,S),l.setTransform(d,u,p,m,v,y),[k,S]}if(d===0&&m===0){const x=o*p+v,I=Math.round(x),E=a*u+y,C=Math.round(E),P=(o+c)*p+v,k=Math.abs(Math.round(P)-I)||1,_=(a+h)*u+y,S=Math.abs(Math.round(_)-C)||1;return l.setTransform(0,Math.sign(u),Math.sign(p),0,I,C),l.drawImage(t,e,i,s,n,0,0,S,k),l.setTransform(d,u,p,m,v,y),[S,k]}l.drawImage(t,e,i,s,n,a,o,h,c);const w=Math.hypot(d,u),A=Math.hypot(p,m);return[w*h,A*c]}class op{constructor(t,e){D(this,"alphaIsShape",!1);D(this,"fontSize",0);D(this,"fontSizeScale",1);D(this,"textMatrix",null);D(this,"textMatrixScale",1);D(this,"fontMatrix",su);D(this,"leading",0);D(this,"x",0);D(this,"y",0);D(this,"lineX",0);D(this,"lineY",0);D(this,"charSpacing",0);D(this,"wordSpacing",0);D(this,"textHScale",1);D(this,"textRenderingMode",ke.FILL);D(this,"textRise",0);D(this,"fillColor","#000000");D(this,"strokeColor","#000000");D(this,"patternFill",!1);D(this,"patternStroke",!1);D(this,"fillAlpha",1);D(this,"strokeAlpha",1);D(this,"lineWidth",1);D(this,"activeSMask",null);D(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Ua.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Ae.FILL,e=null){const i=this.minMax.slice();if(t===Ae.STROKE){e||Pt("Stroke bounding box must include transform."),Y.singularValueDecompose2dScale(e,fi);const s=fi[0]*this.lineWidth/2,n=fi[1]*this.lineWidth/2;i[0]-=s,i[1]-=n,i[2]+=s,i[3]+=n}return i}updateClipFromPath(){const t=Y.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Ua,0)}getClippedPathBoundingBox(t=Ae.FILL,e=null){return Y.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function lp(l,t){if(t instanceof ImageData){l.putImageData(t,0,0);return}const e=t.height,i=t.width,s=e%Xe,n=(e-s)/Xe,a=s===0?n:n+1,o=l.createImageData(i,Xe);let h=0,c;const d=t.data,u=o.data;let p,m,v,y;if(t.kind===Tc.GRAYSCALE_1BPP){const w=d.byteLength,A=new Uint32Array(u.buffer,0,u.byteLength>>2),x=A.length,I=i+7>>3,E=4294967295,C=xe.isLittleEndian?4278190080:255;for(p=0;p<a;p++){for(v=p<n?Xe:s,c=0,m=0;m<v;m++){const P=w-h;let k=0;const _=P>I?i:P*8-7,S=_&-8;let T=0,L=0;for(;k<S;k+=8)L=d[h++],A[c++]=L&128?E:C,A[c++]=L&64?E:C,A[c++]=L&32?E:C,A[c++]=L&16?E:C,A[c++]=L&8?E:C,A[c++]=L&4?E:C,A[c++]=L&2?E:C,A[c++]=L&1?E:C;for(;k<_;k++)T===0&&(L=d[h++],T=128),A[c++]=L&T?E:C,T>>=1}for(;c<x;)A[c++]=0;l.putImageData(o,0,p*Xe)}}else if(t.kind===Tc.RGBA_32BPP){for(m=0,y=i*Xe*4,p=0;p<n;p++)u.set(d.subarray(h,h+y)),h+=y,l.putImageData(o,0,m),m+=Xe;p<a&&(y=i*s*4,u.set(d.subarray(h,h+y)),l.putImageData(o,0,m))}else if(t.kind===Tc.RGB_24BPP)for(v=Xe,y=i*v,p=0;p<a;p++){for(p>=n&&(v=s,y=i*v),c=0,m=y;m--;)u[c++]=d[h++],u[c++]=d[h++],u[c++]=d[h++],u[c++]=255;l.putImageData(o,0,p*Xe)}else throw new Error(`bad image kind: ${t.kind}`)}function hp(l,t){if(t.bitmap){l.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,s=e%Xe,n=(e-s)/Xe,a=s===0?n:n+1,o=l.createImageData(i,Xe);let h=0;const c=t.data,d=o.data;for(let u=0;u<a;u++){const p=u<n?Xe:s;({srcPos:h}=Pv({src:c,srcPos:h,dest:d,width:i,height:p,nonBlackColor:0})),l.putImageData(o,0,u*Xe)}}function ll(l,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)l[i]!==void 0&&(t[i]=l[i]);l.setLineDash!==void 0&&(t.setLineDash(l.getLineDash()),t.lineDashOffset=l.lineDashOffset)}function Sc(l){l.strokeStyle=l.fillStyle="#000000",l.fillRule="nonzero",l.globalAlpha=1,l.lineWidth=1,l.lineCap="butt",l.lineJoin="miter",l.miterLimit=10,l.globalCompositeOperation="source-over",l.font="10px sans-serif",l.setLineDash!==void 0&&(l.setLineDash([]),l.lineDashOffset=0);const{filter:t}=l;t!=="none"&&t!==""&&(l.filter="none")}function cp(l,t){if(t)return!0;Y.singularValueDecompose2dScale(l,fi);const e=Math.fround(Is.pixelRatio*hr.PDF_TO_CSS_UNITS);return fi[0]<=e&&fi[1]<=e}const Dv=["butt","round","square"],Fv=["miter","round","bevel"],Ov={},dp={};var qi,Tu,Pu,Lu;const Of=class Of{constructor(t,e,i,s,n,{optionalContentConfig:a,markedContentStack:o=null},h,c){g(this,qi);this.ctx=t,this.current=new op(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new Mv(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){const n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,i){const h=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=h.canvas,this.ctx=h.context,this.ctx.save(),this.ctx.transform(...Ut(this.compositeCtx))}this.ctx.save(),Sc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Ut(this.ctx)}executeOperatorList(t,e,i,s){const n=t.argsArray,a=t.fnArray;let o=e||0;const h=n.length;if(h===o)return o;const c=h-o>ap&&typeof i=="function",d=c?Date.now()+Lv:0;let u=0;const p=this.commonObjs,m=this.objs;let v;for(;;){if(s!==void 0&&o===s.nextBreakPoint)return s.breakIt(o,i),o;if(v=a[o],v!==ad.dependency)this[v].apply(this,n[o]);else for(const y of n[o]){const w=y.startsWith("g_")?p:m;if(!w.has(y))return w.get(y,i),o}if(o++,o===h)return o;if(c&&++u>ap){if(Date.now()>d)return i(),o;u=0}}}endDrawing(){b(this,qi,Tu).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),b(this,qi,Pu).call(this)}_scaleImage(t,e){const i=t.width??t.displayWidth,s=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),o=i,h=s,c="prescale1",d,u;for(;n>2&&o>1||a>2&&h>1;){let p=o,m=h;n>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/p),a>2&&h>1&&(m=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,a/=h/m),d=this.cachedCanvases.getCanvas(c,p,m),u=d.context,u.clearRect(0,0,p,m),u.drawImage(t,0,0,o,h,0,0,p,m),t=d.canvas,o=p,h=m,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:h}}_createMaskCanvas(t){const e=this.ctx,{width:i,height:s}=t,n=this.current.fillColor,a=this.current.patternFill,o=Ut(e);let h,c,d,u;if((t.bitmap||t.data)&&t.count>1){const S=t.bitmap||t.data.buffer;c=JSON.stringify(a?o:[o.slice(0,4),n]),h=this._cachedBitmapsMap.get(S),h||(h=new Map,this._cachedBitmapsMap.set(S,h));const T=h.get(c);if(T&&!a){const L=Math.round(Math.min(o[0],o[2])+o[4]),M=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:T,offsetX:L,offsetY:M}}d=T}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,s),hp(u.context,t));let p=Y.transform(o,[1/i,0,0,-1/s,0,0]);p=Y.transform(p,[1,0,0,1,0,-s]);const m=Ua.slice();Y.axialAlignedBoundingBox([0,0,i,s],p,m);const[v,y,w,A]=m,x=Math.round(w-v)||1,I=Math.round(A-y)||1,E=this.cachedCanvases.getCanvas("fillCanvas",x,I),C=E.context,P=v,k=y;C.translate(-P,-k),C.transform(...p),d||(d=this._scaleImage(u.canvas,Ji(C)),d=d.img,h&&a&&h.set(c,d)),C.imageSmoothingEnabled=cp(Ut(C),t.interpolate),Ic(C,d,0,0,d.width,d.height,0,0,i,s),C.globalCompositeOperation="source-in";const _=Y.transform(Ji(C),[1,0,0,1,-P,-k]);return C.fillStyle=a?n.getPattern(e,this,_,Ae.FILL):n,C.fillRect(0,0,i,s),h&&!a&&(this.cachedCanvases.delete("fillCanvas"),h.set(c,E.canvas)),{canvas:E.canvas,offsetX:Math.round(P),offsetY:Math.round(k)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Dv[t]}setLineJoin(t){this.ctx.lineJoin=Fv[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx;const n=this.ctx=s.context;n.setTransform(this.suspendedCtx.getTransform()),ll(this.suspendedCtx,n),Rv(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ll(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,s){const n=s[0],a=s[1],o=s[2]-n,h=s[3]-a;o===0||h===0||(this.genericComposeSMask(e.context,i,o,h,e.subtype,e.backdrop,e.transferMap,n,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,s,n,a,o,h,c,d,u){let p=t.canvas,m=h-d,v=c-u;if(a)if(m<0||v<0||m+i>p.width||v+s>p.height){const w=this.cachedCanvases.getCanvas("maskExtension",i,s),A=w.context;A.drawImage(p,-m,-v),A.globalCompositeOperation="destination-atop",A.fillStyle=a,A.fillRect(0,0,i,s),A.globalCompositeOperation="source-over",p=w.canvas,m=v=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const w=new Path2D;w.rect(m,v,i,s),t.clip(w),t.globalCompositeOperation="destination-atop",t.fillStyle=a,t.fillRect(m,v,i,s),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const y=new Path2D;y.rect(h,c,i,s),e.clip(y),e.globalCompositeOperation="destination-in",e.drawImage(p,m,v,i,s,h,c,i,s),e.restore()}save(){this.inSMaskMode&&ll(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ll(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,i,s,n,a){this.ctx.transform(t,e,i,s,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){let[s]=e;if(!i){s||(s=e[0]=new Path2D),this[t](s);return}if(!(s instanceof Path2D)){const n=e[0]=new Path2D;for(let a=0,o=s.length;a<o;)switch(s[a++]){case vc.moveTo:n.moveTo(s[a++],s[a++]);break;case vc.lineTo:n.lineTo(s[a++],s[a++]);break;case vc.curveTo:n.bezierCurveTo(s[a++],s[a++],s[a++],s[a++],s[a++],s[a++]);break;case vc.closePath:n.closePath();break;default:at(`Unrecognized drawing path operator: ${s[a-1]}`);break}s=n}Y.axialAlignedBoundingBox(i,Ut(this.ctx),this.current.minMax),this[t](s)}closePath(){this.ctx.closePath()}stroke(t,e=!0){const i=this.ctx,s=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&(s!=null&&s.getPattern)){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=s.getPattern(i,this,Ji(i),Ae.STROKE),n){const a=new Path2D;a.addPath(t,i.getTransform().invertSelf().multiplySelf(n)),t=a}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(Ae.STROKE,Ut(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,e=!0){const i=this.ctx,s=this.current.fillColor,n=this.current.patternFill;let a=!1;if(n){const h=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.fillStyle=s.getPattern(i,this,Ji(i),Ae.FILL),h){const c=new Path2D;c.addPath(t,i.getTransform().invertSelf().multiplySelf(h)),t=c}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),a&&i.restore(),e&&this.consumePath(t,o)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}rawFillPath(t){this.ctx.fill(t)}clip(){this.pendingClip=Ov}eoClip(){this.pendingClip=dp}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0)return;const i=new Path2D,s=e.getTransform().invertSelf();for(const{transform:n,x:a,y:o,fontSize:h,path:c}of t)c&&i.addPath(c,new DOMMatrix(n).preMultiplySelf(s).translate(a,o).scale(h,-h));e.clip(i),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var d;const i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||su,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&at("Invalid font matrix for font "+t),e<0?(e=-e,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;const n=i.loadedName||"sans-serif",a=((d=i.systemFontInfo)==null?void 0:d.css)||`"${n}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const h=i.italic?"italic":"normal";let c=e;e<np?c=np:e>rp&&(c=rp),this.current.fontSizeScale=e/c,this.ctx.font=`${h} ${o} ${c}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t){const{current:e}=this;e.textMatrix=t,e.textMatrixScale=Math.hypot(t[0],t[1]),e.x=e.lineX=0,e.y=e.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,i,s,n){const a=this.ctx,o=this.current,h=o.font,c=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,u=c&ke.FILL_STROKE_MASK,p=!!(c&ke.ADD_TO_PATH_FLAG),m=o.patternFill&&!h.missingFile,v=o.patternStroke&&!h.missingFile;let y;if((h.disableFontFace||p||m||v)&&!h.missingFile&&(y=h.getPathGenerator(this.commonObjs,t)),y&&(h.disableFontFace||m||v)){a.save(),a.translate(e,i),a.scale(d,-d);let w;if((u===ke.FILL||u===ke.FILL_STROKE)&&(s?(w=a.getTransform(),a.setTransform(...s),a.fill(b(this,qi,Lu).call(this,y,w,s))):a.fill(y)),u===ke.STROKE||u===ke.FILL_STROKE)if(n){w||(w=a.getTransform()),a.setTransform(...n);const{a:A,b:x,c:I,d:E}=w,C=Y.inverseTransform(n),P=Y.transform([A,x,I,E,0,0],C);Y.singularValueDecompose2dScale(P,fi),a.lineWidth*=Math.max(fi[0],fi[1])/d,a.stroke(b(this,qi,Lu).call(this,y,w,n))}else a.lineWidth/=d,a.stroke(y);a.restore()}else(u===ke.FILL||u===ke.FILL_STROKE)&&a.fillText(t,e,i),(u===ke.STROKE||u===ke.FILL_STROKE)&&a.strokeText(t,e,i);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ut(a),x:e,y:i,fontSize:d,path:y})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){i=!0;break}return ut(this,"isFontSubpixelAAEnabled",i)}showText(t){const e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);const s=e.fontSize;if(s===0)return;const n=this.ctx,a=e.fontSizeScale,o=e.charSpacing,h=e.wordSpacing,c=e.fontDirection,d=e.textHScale*c,u=t.length,p=i.vertical,m=p?1:-1,v=i.defaultVMetrics,y=s*e.fontMatrix[0],w=e.textRenderingMode===ke.FILL&&!i.disableFontFace&&!e.patternFill;n.save(),e.textMatrix&&n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),c>0?n.scale(d,-1):n.scale(d,1);let A,x;if(e.patternFill){n.save();const k=e.fillColor.getPattern(n,this,Ji(n),Ae.FILL);A=Ut(n),n.restore(),n.fillStyle=k}if(e.patternStroke){n.save();const k=e.strokeColor.getPattern(n,this,Ji(n),Ae.STROKE);x=Ut(n),n.restore(),n.strokeStyle=k}let I=e.lineWidth;const E=e.textMatrixScale;if(E===0||I===0){const k=e.textRenderingMode&ke.FILL_STROKE_MASK;(k===ke.STROKE||k===ke.FILL_STROKE)&&(I=this.getSinglePixelWidth())}else I/=E;if(a!==1&&(n.scale(a,a),I/=a),n.lineWidth=I,i.isInvalidPDFjsFont){const k=[];let _=0;for(const S of t)k.push(S.unicode),_+=S.width;n.fillText(k.join(""),0,0),e.x+=_*y*d,n.restore(),this.compose();return}let C=0,P;for(P=0;P<u;++P){const k=t[P];if(typeof k=="number"){C+=m*k*s/1e3;continue}let _=!1;const S=(k.isSpace?h:0)+o,T=k.fontChar,L=k.accent;let M,z,G=k.width;if(p){const B=k.vmetric||v,R=-(k.vmetric?B[1]:G*.5)*y,ft=B[2]*y;G=B?-B[0]:G,M=R/a,z=(C+ft)/a}else M=C/a,z=0;if(i.remeasure&&G>0){const B=n.measureText(T).width*1e3/s*a;if(G<B&&this.isFontSubpixelAAEnabled){const R=G/B;_=!0,n.save(),n.scale(R,1),M/=R}else G!==B&&(M+=(G-B)/2e3*s/a)}if(this.contentVisible&&(k.isInFont||i.missingFile)){if(w&&!L)n.fillText(T,M,z);else if(this.paintChar(T,M,z,A,x),L){const B=M+s*L.offset.x/a,R=z-s*L.offset.y/a;this.paintChar(L.fontChar,B,R,A,x)}}const It=p?G*y-S*c:G*y+S*c;C+=It,_&&n.restore()}p?e.y-=C:e.x+=C*d,n.restore(),this.compose()}showType3Text(t){const e=this.ctx,i=this.current,s=i.font,n=i.fontSize,a=i.fontDirection,o=s.vertical?1:-1,h=i.charSpacing,c=i.wordSpacing,d=i.textHScale*a,u=i.fontMatrix||su,p=t.length,m=i.textRenderingMode===ke.INVISIBLE;let v,y,w,A;if(!(m||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),i.textMatrix&&e.transform(...i.textMatrix),e.translate(i.x,i.y+i.textRise),e.scale(d,a),v=0;v<p;++v){if(y=t[v],typeof y=="number"){A=o*y*n/1e3,this.ctx.translate(A,0),i.x+=A*d;continue}const x=(y.isSpace?c:0)+h,I=s.charProcOperatorList[y.operatorListId];I?this.contentVisible&&(this.save(),e.scale(n,n),e.transform(...u),this.executeOperatorList(I),this.restore()):at(`Type3 character "${y.operatorListId}" is not available.`);const E=[y.width,0];Y.applyTransform(E,u),w=E[0]*n+x,e.translate(w,0),i.x+=w*d}e.restore()}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,n,a){const o=new Path2D;o.rect(i,s,n-i,a-s),this.ctx.clip(o),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const i=this.baseTransform||Ut(this.ctx),s={createCanvasGraphics:n=>new Of(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new ku(t,this.ctx,s,i)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t){this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t){this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=Tv(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,Ji(e),Ae.SHADING);const s=Ji(e);if(s){const{width:n,height:a}=e.canvas,o=Ua.slice();Y.axialAlignedBoundingBox([0,0,n,a],s,o);const[h,c,d,u]=o;this.ctx.fillRect(h,c,d-h,u-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Pt("Should not call beginInlineImage")}beginImageData(){Pt("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Ut(this.ctx),e)){Y.axialAlignedBoundingBox(e,this.baseTransform,this.current.minMax);const[i,s,n,a]=e,o=new Path2D;o.rect(i,s,n-i,a-s),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||zd("TODO: Support non-isolated groups."),t.knockout&&at("Knockout groups not supported.");const i=Ut(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=Ua.slice();Y.axialAlignedBoundingBox(t.bbox,Ut(e),s);const n=[0,0,e.canvas.width,e.canvas.height];s=Y.intersect(s,n)||[0,0,0,0];const a=Math.floor(s[0]),o=Math.floor(s[1]),h=Math.max(Math.ceil(s[2])-a,1),c=Math.max(Math.ceil(s[3])-o,1);this.current.startNewPathAndClipBox([0,0,h,c]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,h,c),p=u.context;p.translate(-a,-o),p.transform(...i);let m=new Path2D;const[v,y,w,A]=t.bbox;if(m.rect(v,y,w-v,A-y),t.matrix){const x=new Path2D;x.addPath(m,new DOMMatrix(t.matrix)),m=x}p.clip(m),t.smask?this.smaskStack.push({canvas:u.canvas,context:p,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.save()),ll(e,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=Ut(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const n=Ua.slice();Y.axialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s,n),this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,i,s,n){if(b(this,qi,Tu).call(this),Sc(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const a=e[2]-e[0],o=e[3]-e[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=e[0],i[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=o,Y.singularValueDecompose2dScale(Ut(this.ctx),fi);const{viewportScale:h}=this,c=Math.ceil(a*this.outputScaleX*h),d=Math.ceil(o*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(c,d);const{canvas:u,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(fi[0],0,0,-fi[1],0,o*fi[1]),Sc(this.ctx)}else{Sc(this.ctx),this.endPath();const h=new Path2D;h.rect(e[0],e[1],a,o),this.ctx.clip(h)}}this.current=new op(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),b(this,qi,Pu).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const i=this.ctx,s=this._createMaskCanvas(t),n=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(n,s.offsetX,s.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i=0,s=0,n,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);const o=this.ctx;o.save();const h=Ut(o);o.transform(e,i,s,n,0,0);const c=this._createMaskCanvas(t);o.setTransform(1,0,0,1,c.offsetX-h[4],c.offsetY-h[5]);for(let d=0,u=a.length;d<u;d+=2){const p=Y.transform(h,[e,i,s,n,a[d],a[d+1]]);o.drawImage(c.canvas,p[4],p[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const n of t){const{data:a,width:o,height:h,transform:c}=n,d=this.cachedCanvases.getCanvas("maskCanvas",o,h),u=d.context;u.save();const p=this.getObject(a,n);hp(u,p),u.globalCompositeOperation="source-in",u.fillStyle=s?i.getPattern(u,this,Ji(e),Ae.FILL):i,u.fillRect(0,0,o,h),u.restore(),e.save(),e.transform(...c),e.scale(1,-1),Ic(e,d.canvas,0,0,o,h,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){at("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,i,s){if(!this.contentVisible)return;const n=this.getObject(t);if(!n){at("Dependent image isn't ready yet");return}const a=n.width,o=n.height,h=[];for(let c=0,d=s.length;c<d;c+=2)h.push({transform:[e,0,0,i,s[c],s[c+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(n,h)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:s}=t,n=this.cachedCanvases.getCanvas("inlineImage",i,s),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,i=t.height,s=this.ctx;this.save();const{filter:n}=s;n!=="none"&&n!==""&&(s.filter="none"),s.scale(1/e,-1/i);let a;if(t.bitmap)a=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)a=t;else{const c=this.cachedCanvases.getCanvas("inlineImage",e,i).context;lp(c,t),a=this.applyTransferMapsToCanvas(c)}const o=this._scaleImage(a,Ji(s));s.imageSmoothingEnabled=cp(Ut(s),t.interpolate),Ic(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,e,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const n=t.width,a=t.height,h=this.cachedCanvases.getCanvas("inlineImage",n,a).context;lp(h,t),s=this.applyTransferMapsToCanvas(h)}for(const n of e)i.save(),i.transform(...n.transform),i.scale(1,-1),Ic(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(i||(this.pendingClip===dp?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Ut(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:s,d:n}=this.ctx.getTransform();let a,o;if(i===0&&s===0){const h=Math.abs(e),c=Math.abs(n);if(h===c)if(t===0)a=o=1/h;else{const d=h*t;a=o=d<1?1/d:1}else if(t===0)a=1/h,o=1/c;else{const d=h*t,u=c*t;a=d<1?1/d:1,o=u<1?1/u:1}}else{const h=Math.abs(e*n-i*s),c=Math.hypot(e,i),d=Math.hypot(s,n);if(t===0)a=d/h,o=c/h;else{const u=t*h;a=d>u?d/u:1,o=c>u?c/u:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:i,current:{lineWidth:s}}=this,[n,a]=this.getScaleForStroking();if(n===a){i.lineWidth=(s||1)*n,i.stroke(t);return}const o=i.getLineDash();e&&i.save(),i.scale(n,a),Zd.a=1/n,Zd.d=1/a;const h=new Path2D;if(h.addPath(t,Zd),o.length>0){const c=Math.max(n,a);i.setLineDash(o.map(d=>d/c)),i.lineDashOffset/=c}i.lineWidth=s||1,i.stroke(h),e&&i.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};qi=new WeakSet,Tu=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Pu=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},Lu=function(t,e,i){const s=new Path2D;return s.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),s};let Wa=Of;for(const l in ad)Wa.prototype[l]!==void 0&&(Wa.prototype[ad[l]]=Wa.prototype[l]);var ch,dh;class _s{static get workerPort(){return r(this,ch)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");f(this,ch,t)}static get workerSrc(){return r(this,dh)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");f(this,dh,t)}}ch=new WeakMap,dh=new WeakMap,g(_s,ch,null),g(_s,dh,"");var go,uh;class Nv{constructor({parsedData:t,rawData:e}){g(this,go);g(this,uh);f(this,go,t),f(this,uh,e)}getRaw(){return r(this,uh)}get(t){return r(this,go).get(t)??null}[Symbol.iterator](){return r(this,go).entries()}}go=new WeakMap,uh=new WeakMap;const $a=Symbol("INTERNAL");var fh,ph,mh,bo;class Bv{constructor(t,{name:e,intent:i,usage:s,rbGroups:n}){g(this,fh,!1);g(this,ph,!1);g(this,mh,!1);g(this,bo,!0);f(this,fh,!!(t&ui.DISPLAY)),f(this,ph,!!(t&ui.PRINT)),this.name=e,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(r(this,mh))return r(this,bo);if(!r(this,bo))return!1;const{print:t,view:e}=this.usage;return r(this,fh)?(e==null?void 0:e.viewState)!=="OFF":r(this,ph)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,i=!1){t!==$a&&Pt("Internal method `_setVisible` called."),f(this,mh,i),f(this,bo,e)}}fh=new WeakMap,ph=new WeakMap,mh=new WeakMap,bo=new WeakMap;var Fn,kt,yo,vo,gh,Ru;class Hv{constructor(t,e=ui.DISPLAY){g(this,gh);g(this,Fn,null);g(this,kt,new Map);g(this,yo,null);g(this,vo,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,f(this,vo,t.order);for(const i of t.groups)r(this,kt).set(i.id,new Bv(e,i));if(t.baseState==="OFF")for(const i of r(this,kt).values())i._setVisible($a,!1);for(const i of t.on)r(this,kt).get(i)._setVisible($a,!0);for(const i of t.off)r(this,kt).get(i)._setVisible($a,!1);f(this,yo,this.getHash())}}isVisible(t){if(r(this,kt).size===0)return!0;if(!t)return zd("Optional content group not defined."),!0;if(t.type==="OCG")return r(this,kt).has(t.id)?r(this,kt).get(t.id).visible:(at(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return b(this,gh,Ru).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!r(this,kt).has(e))return at(`Optional content group not found: ${e}`),!0;if(r(this,kt).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!r(this,kt).has(e))return at(`Optional content group not found: ${e}`),!0;if(!r(this,kt).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!r(this,kt).has(e))return at(`Optional content group not found: ${e}`),!0;if(!r(this,kt).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!r(this,kt).has(e))return at(`Optional content group not found: ${e}`),!0;if(r(this,kt).get(e).visible)return!1}return!0}return at(`Unknown optional content policy ${t.policy}.`),!0}return at(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){var n;const s=r(this,kt).get(t);if(!s){at(`Optional content group not found: ${t}`);return}if(i&&e&&s.rbGroups.length)for(const a of s.rbGroups)for(const o of a)o!==t&&((n=r(this,kt).get(o))==null||n._setVisible($a,!1,!0));s._setVisible($a,!!e,!0),f(this,Fn,null)}setOCGState({state:t,preserveRB:e}){let i;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const n=r(this,kt).get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!n.visible,e);break}}f(this,Fn,null)}get hasInitialVisibility(){return r(this,yo)===null||this.getHash()===r(this,yo)}getOrder(){return r(this,kt).size?r(this,vo)?r(this,vo).slice():[...r(this,kt).keys()]:null}getGroup(t){return r(this,kt).get(t)||null}getHash(){if(r(this,Fn)!==null)return r(this,Fn);const t=new gm;for(const[e,i]of r(this,kt))t.update(`${e}:${i.visible}`);return f(this,Fn,t.hexdigest())}[Symbol.iterator](){return r(this,kt).entries()}}Fn=new WeakMap,kt=new WeakMap,yo=new WeakMap,vo=new WeakMap,gh=new WeakSet,Ru=function(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let s=1;s<e;s++){const n=t[s];let a;if(Array.isArray(n))a=b(this,gh,Ru).call(this,n);else if(r(this,kt).has(n))a=r(this,kt).get(n).visible;else return at(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"};class $v{constructor(t,{disableRange:e=!1,disableStream:i=!1}){te(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:n,progressiveDone:a,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const h=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((h,c)=>{this._onReceiveData({begin:h,chunk:c})}),t.addProgressListener((h,c)=>{this._onProgress({loaded:h,total:c})}),t.addProgressiveReadListener(h=>{this._onReceiveData({chunk:h})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(i),!0)});te(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,i,s,n;t.total===void 0?(i=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||i.call(e,{loaded:t.loaded}):(n=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||n.call(s,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){te(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new zv(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new jv(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeReaders.slice(0))i.cancel(t);this._pdfDataRangeTransport.abort()}}class zv{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=xf(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class jv{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Uv(l){let t=!0,e=i("filename\\*","i").exec(l);if(e){e=e[1];let d=o(e);return d=unescape(d),d=h(d),d=c(d),n(d)}if(e=a(l),e){const d=c(e);return n(d)}if(e=i("filename","i").exec(l),e){e=e[1];let d=o(e);return d=c(d),n(d)}function i(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function s(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const p=new TextDecoder(d,{fatal:!0}),m=uc(u);u=p.decode(m),t=!1}catch{}}return u}function n(d){return t&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),t&&(d=s("iso-8859-1",d))),d}function a(d){const u=[];let p;const m=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(d))!==null;){let[,y,w,A]=p;if(y=parseInt(y,10),y in u){if(y===0)break;continue}u[y]=[w,A]}const v=[];for(let y=0;y<u.length&&y in u;++y){let[w,A]=u[y];A=o(A),w&&(A=unescape(A),y===0&&(A=h(A))),v.push(A)}return v.join("")}function o(d){if(d.startsWith('"')){const u=d.slice(1).split('\\"');for(let p=0;p<u.length;++p){const m=u[p].indexOf('"');m!==-1&&(u[p]=u[p].slice(0,m),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function h(d){const u=d.indexOf("'");if(u===-1)return d;const p=d.slice(0,u),v=d.slice(u+1).replace(/^[^']*'/,"");return s(p,v)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,m,v){if(m==="q"||m==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,w){return String.fromCharCode(parseInt(w,16))}),s(p,v);try{v=atob(v)}catch{}return s(p,v)})}return""}function km(l,t){const e=new Headers;if(!l||!t||typeof t!="object")return e;for(const i in t){const s=t[i];s!==void 0&&e.append(i,s)}return e}function Vd(l){var t;return((t=URL.parse(l))==null?void 0:t.origin)??null}function Tm({responseHeaders:l,isHttp:t,rangeChunkSize:e,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(l.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*e)||i||!t||l.get("Accept-Ranges")!=="bytes"||(l.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Pm(l){const t=l.get("Content-Disposition");if(t){let e=Uv(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(xf(e))return e}return null}function gc(l,t){return new od(`Unexpected server response (${l}) while retrieving PDF "${t}".`,l,l===404||l===0&&t.startsWith("file:"))}function Lm(l){return l===200||l===206}function Rm(l,t,e){return{method:"GET",headers:l,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Mm(l){return l instanceof Uint8Array?l.buffer:l instanceof ArrayBuffer?l:(at(`getArrayBuffer - unexpected data format: ${l}`),new Uint8Array(l).buffer)}class Vv{constructor(t){D(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=km(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return te(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Kv(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new Gv(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class Kv{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),s=e.url;fetch(s,Rm(i,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=Vd(n.url),!Lm(n.status))throw gc(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();const a=n.headers,{allowRangeRequests:o,suggestedLength:h}=Tm({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=h||this._contentLength,this._filename=Pm(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new lr("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Mm(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class Gv{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${i-1}`);const a=s.url;fetch(a,Rm(n,this._withCredentials,this._abortController)).then(o=>{const h=Vd(o.url);if(h!==t._responseOrigin)throw new Error(`Expected range response-origin "${h}" to match "${t._responseOrigin}".`);if(!Lm(o.status))throw gc(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:Mm(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const tu=200,eu=206;function Wv(l){const t=l.response;return typeof t!="string"?t:uc(t).buffer}class qv{constructor({url:t,httpHeaders:e,withCredentials:i}){D(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=km(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,a]of this.headers)e.setRequestHeader(n,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=eu):s.expectedStatus=tu,e.responseType="arraybuffer",te(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){var s;const i=this.pendingRequests[t];i&&((s=i.onProgress)==null||s.call(i,e))}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){i.onError(s.status);return}const n=s.status||tu;if(!(n===tu&&i.expectedStatus===eu)&&n!==i.expectedStatus){i.onError(s.status);return}const o=Wv(s);if(n===eu){const h=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(h);c?i.onDone({begin:parseInt(c[1],10),chunk:o}):(at('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Xv{constructor(t){this._source=t,this._manager=new qv(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return te(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Yv(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new Qv(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class Yv{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Vd(e.responseURL);const i=e.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[h,...c]=o.split(": ");return[h,c.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=Tm({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=Pm(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=gc(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Qv{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=Vd((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=gc(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Jv=/^[a-z][a-z0-9\-+.]+:/i;function Zv(l){if(Jv.test(l))return new URL(l);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(l))}class tw{constructor(t){this.source=t,this.url=Zv(t.url),te(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return te(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new ew(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new iw(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class ew{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=gc(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new lr("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class iw{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const hl=Symbol("INITIAL_DATA");var ti,bh,Mu;class Dm{constructor(){g(this,bh);g(this,ti,Object.create(null))}get(t,e=null){if(e){const s=b(this,bh,Mu).call(this,t);return s.promise.then(()=>e(s.data)),null}const i=r(this,ti)[t];if(!i||i.data===hl)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=r(this,ti)[t];return!!e&&e.data!==hl}delete(t){const e=r(this,ti)[t];return!e||e.data===hl?!1:(delete r(this,ti)[t],!0)}resolve(t,e=null){const i=b(this,bh,Mu).call(this,t);i.data=e,i.resolve()}clear(){var t;for(const e in r(this,ti)){const{data:i}=r(this,ti)[e];(t=i==null?void 0:i.bitmap)==null||t.close()}f(this,ti,Object.create(null))}*[Symbol.iterator](){for(const t in r(this,ti)){const{data:e}=r(this,ti)[t];e!==hl&&(yield[t,e])}}}ti=new WeakMap,bh=new WeakSet,Mu=function(t){var e;return(e=r(this,ti))[t]||(e[t]={...Promise.withResolvers(),data:hl})};const sw=1e5,up=30;var yp,On,We,yh,vh,Ur,Ks,wh,Ah,Vr,wo,Ao,Nn,_o,_h,Io,Kr,Ih,Sh,So,Gr,Eh,Bn,Eo,fn,Fm,Om,Du,bi,Hc,Fu,Nm,Bm;const ie=class ie{constructor({textContentSource:t,container:e,viewport:i}){g(this,fn);g(this,On,Promise.withResolvers());g(this,We,null);g(this,yh,!1);g(this,vh,!!((yp=globalThis.FontInspector)!=null&&yp.enabled));g(this,Ur,null);g(this,Ks,null);g(this,wh,0);g(this,Ah,0);g(this,Vr,null);g(this,wo,null);g(this,Ao,0);g(this,Nn,0);g(this,_o,Object.create(null));g(this,_h,[]);g(this,Io,null);g(this,Kr,[]);g(this,Ih,new WeakMap);g(this,Sh,null);var h;if(t instanceof ReadableStream)f(this,Io,t);else if(typeof t=="object")f(this,Io,new ReadableStream({start(c){c.enqueue(t),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');f(this,We,f(this,wo,e)),f(this,Nn,i.scale*Is.pixelRatio),f(this,Ao,i.rotation),f(this,Ks,{div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:n,pageX:a,pageY:o}=i.rawDims;f(this,Sh,[1,0,0,-1,-a,o+n]),f(this,Ah,s),f(this,wh,n),b(h=ie,bi,Nm).call(h),Ca(e,i),r(this,On).promise.finally(()=>{r(ie,Eo).delete(this),f(this,Ks,null),f(this,_o,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=xe.platform;return ut(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{r(this,Vr).read().then(({value:e,done:i})=>{if(i){r(this,On).resolve();return}r(this,Ur)??f(this,Ur,e.lang),Object.assign(r(this,_o),e.styles),b(this,fn,Fm).call(this,e.items),t()},r(this,On).reject)};return f(this,Vr,r(this,Io).getReader()),r(ie,Eo).add(this),t(),r(this,On).promise}update({viewport:t,onBefore:e=null}){var n;const i=t.scale*Is.pixelRatio,s=t.rotation;if(s!==r(this,Ao)&&(e==null||e(),f(this,Ao,s),Ca(r(this,wo),{rotation:s})),i!==r(this,Nn)){e==null||e(),f(this,Nn,i);const a={div:null,properties:null,ctx:b(n=ie,bi,Hc).call(n,r(this,Ur))};for(const o of r(this,Kr))a.properties=r(this,Ih).get(o),a.div=o,b(this,fn,Du).call(this,a)}}cancel(){var e;const t=new lr("TextLayer task cancelled.");(e=r(this,Vr))==null||e.cancel(t).catch(()=>{}),f(this,Vr,null),r(this,On).reject(t)}get textDivs(){return r(this,Kr)}get textContentItemsStr(){return r(this,_h)}static cleanup(){if(!(r(this,Eo).size>0)){r(this,So).clear();for(const{canvas:t}of r(this,Gr).values())t.remove();r(this,Gr).clear()}}};On=new WeakMap,We=new WeakMap,yh=new WeakMap,vh=new WeakMap,Ur=new WeakMap,Ks=new WeakMap,wh=new WeakMap,Ah=new WeakMap,Vr=new WeakMap,wo=new WeakMap,Ao=new WeakMap,Nn=new WeakMap,_o=new WeakMap,_h=new WeakMap,Io=new WeakMap,Kr=new WeakMap,Ih=new WeakMap,Sh=new WeakMap,So=new WeakMap,Gr=new WeakMap,Eh=new WeakMap,Bn=new WeakMap,Eo=new WeakMap,fn=new WeakSet,Fm=function(t){var s,n;if(r(this,yh))return;(n=r(this,Ks)).ctx??(n.ctx=b(s=ie,bi,Hc).call(s,r(this,Ur)));const e=r(this,Kr),i=r(this,_h);for(const a of t){if(e.length>sw){at("Ignoring additional textDivs for performance reasons."),f(this,yh,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=r(this,We);f(this,We,document.createElement("span")),r(this,We).classList.add("markedContent"),a.id&&r(this,We).setAttribute("id",`${a.id}`),o.append(r(this,We))}else a.type==="endMarkedContent"&&f(this,We,r(this,We).parentNode);continue}i.push(a.str),b(this,fn,Om).call(this,a)}},Om=function(t){var y;const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};r(this,Kr).push(e);const s=Y.transform(r(this,Sh),t.transform);let n=Math.atan2(s[1],s[0]);const a=r(this,_o)[t.fontName];a.vertical&&(n+=Math.PI/2);let o=r(this,vh)&&a.fontSubstitution||a.fontFamily;o=ie.fontFamilyMap.get(o)||o;const h=Math.hypot(s[2],s[3]),c=h*b(y=ie,bi,Bm).call(y,o,a,r(this,Ur));let d,u;n===0?(d=s[4],u=s[5]-c):(d=s[4]+c*Math.sin(n),u=s[5]-c*Math.cos(n));const p="calc(var(--total-scale-factor) *",m=e.style;r(this,We)===r(this,wo)?(m.left=`${(100*d/r(this,Ah)).toFixed(2)}%`,m.top=`${(100*u/r(this,wh)).toFixed(2)}%`):(m.left=`${p}${d.toFixed(2)}px)`,m.top=`${p}${u.toFixed(2)}px)`),m.fontSize=`${p}${(r(ie,Bn)*h).toFixed(2)}px)`,m.fontFamily=o,i.fontSize=h,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,r(this,vh)&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),n!==0&&(i.angle=n*(180/Math.PI));let v=!1;if(t.str.length>1)v=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const w=Math.abs(t.transform[0]),A=Math.abs(t.transform[3]);w!==A&&Math.max(w,A)/Math.min(w,A)>1.5&&(v=!0)}if(v&&(i.canvasWidth=a.vertical?t.height:t.width),r(this,Ih).set(e,i),r(this,Ks).div=e,r(this,Ks).properties=i,b(this,fn,Du).call(this,r(this,Ks)),i.hasText&&r(this,We).append(e),i.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),r(this,We).append(w)}},Du=function(t){var o;const{div:e,properties:i,ctx:s}=t,{style:n}=e;let a="";if(r(ie,Bn)>1&&(a=`scale(${1/r(ie,Bn)})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:h}=n,{canvasWidth:c,fontSize:d}=i;b(o=ie,bi,Fu).call(o,s,d*r(this,Nn),h);const{width:u}=s.measureText(e.textContent);u>0&&(a=`scaleX(${c*r(this,Nn)/u}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(n.transform=a)},bi=new WeakSet,Hc=function(t=null){let e=r(this,Gr).get(t||(t=""));if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),r(this,Gr).set(t,e),r(this,Eh).set(e,{size:0,family:""})}return e},Fu=function(t,e,i){const s=r(this,Eh).get(t);e===s.size&&i===s.family||(t.font=`${e}px ${i}`,s.size=e,s.family=i)},Nm=function(){if(r(this,Bn)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),f(this,Bn,t.getBoundingClientRect().height),t.remove()},Bm=function(t,e,i){const s=r(this,So).get(t);if(s)return s;const n=b(this,bi,Hc).call(this,i);n.canvas.width=n.canvas.height=up,b(this,bi,Fu).call(this,n,up,t);const a=n.measureText(""),o=a.fontBoundingBoxAscent,h=Math.abs(a.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let c=.8;return o?c=o/(o+h):(xe.platform.isFirefox&&at("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?c=e.ascent:e.descent&&(c=1+e.descent)),r(this,So).set(t,c),c},g(ie,bi),g(ie,So,new Map),g(ie,Gr,new Map),g(ie,Eh,new WeakMap),g(ie,Bn,null),g(ie,Eo,new Set);let Ml=ie;class Dl{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function s(n){var h;if(!n)return;let a=null;const o=n.name;if(o==="#text")a=n.value;else if(Dl.shouldBuildText(o))(h=n==null?void 0:n.attributes)!=null&&h.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&e.push({str:a}),!!n.children)for(const c of n.children)s(c)}return s(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const nw=100;function Hm(l={}){typeof l=="string"||l instanceof URL?l={url:l}:(l instanceof ArrayBuffer||ArrayBuffer.isView(l))&&(l={data:l});const t=new Ou,{docId:e}=t,i=l.url?fv(l.url):null,s=l.data?pv(l.data):null,n=l.httpHeaders||null,a=l.withCredentials===!0,o=l.password??null,h=l.range instanceof $m?l.range:null,c=Number.isInteger(l.rangeChunkSize)&&l.rangeChunkSize>0?l.rangeChunkSize:2**16;let d=l.worker instanceof Fl?l.worker:null;const u=l.verbosity,p=typeof l.docBaseUrl=="string"&&!jd(l.docBaseUrl)?l.docBaseUrl:null,m=Ac(l.cMapUrl),v=l.cMapPacked!==!1,y=l.CMapReaderFactory||(He?_v:tp),w=Ac(l.iccUrl),A=Ac(l.standardFontDataUrl),x=l.StandardFontDataFactory||(He?Iv:ep),I=Ac(l.wasmUrl),E=l.WasmFactory||(He?Sv:ip),C=l.stopAtErrors!==!0,P=Number.isInteger(l.maxImageSize)&&l.maxImageSize>-1?l.maxImageSize:-1,k=l.isEvalSupported!==!1,_=typeof l.isOffscreenCanvasSupported=="boolean"?l.isOffscreenCanvasSupported:!He,S=typeof l.isImageDecoderSupported=="boolean"?l.isImageDecoderSupported:!He&&(xe.platform.isFirefox||!globalThis.chrome),T=Number.isInteger(l.canvasMaxAreaInBytes)?l.canvasMaxAreaInBytes:-1,L=typeof l.disableFontFace=="boolean"?l.disableFontFace:He,M=l.fontExtraProperties===!0,z=l.enableXfa===!0,G=l.ownerDocument||globalThis.document,It=l.disableRange===!0,B=l.disableStream===!0,R=l.disableAutoFetch===!0,ft=l.pdfBug===!0,q=l.CanvasFactory||(He?Av:yv),Mt=l.FilterFactory||(He?wv:vv),Z=l.enableHWA===!0,X=l.useWasm!==!1,O=h?h.length:l.length??NaN,H=typeof l.useSystemFonts=="boolean"?l.useSystemFonts:!He&&!L,st=typeof l.useWorkerFetch=="boolean"?l.useWorkerFetch:!!(y===tp&&x===ep&&E===ip&&m&&A&&I&&ul(m,document.baseURI)&&ul(A,document.baseURI)&&ul(I,document.baseURI)),ct=null;Ky(u);const nt={canvasFactory:new q({ownerDocument:G,enableHWA:Z}),filterFactory:new Mt({docId:e,ownerDocument:G}),cMapReaderFactory:st?null:new y({baseUrl:m,isCompressed:v}),standardFontDataFactory:st?null:new x({baseUrl:A}),wasmFactory:st?null:new E({baseUrl:I})};d||(d=Fl.create({verbosity:u,port:_s.workerPort}),t._worker=d);const et={docId:e,apiVersion:"5.4.54",data:s,password:o,disableAutoFetch:R,rangeChunkSize:c,length:O,docBaseUrl:p,enableXfa:z,evaluatorOptions:{maxImageSize:P,disableFontFace:L,ignoreErrors:C,isEvalSupported:k,isOffscreenCanvasSupported:_,isImageDecoderSupported:S,canvasMaxAreaInBytes:T,fontExtraProperties:M,useSystemFonts:H,useWasm:X,useWorkerFetch:st,cMapUrl:m,iccUrl:w,standardFontDataUrl:A,wasmUrl:I}},it={ownerDocument:G,pdfBug:ft,styleElement:ct,loadingParams:{disableAutoFetch:R,enableXfa:z}};return d.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const At=d.messageHandler.sendWithPromise("GetDocRequest",et,s?[s.buffer]:null);let J;if(h)J=new $v(h,{disableRange:It,disableStream:B});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const Ct=ul(i)?Vv:He?tw:Xv;J=new Ct({url:i,length:O,httpHeaders:n,withCredentials:a,rangeChunkSize:c,disableRange:It,disableStream:B})}return At.then(Ct=>{if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Vt=new bl(e,Ct,d.port),Et=new ow(Vt,t,J,it,nt,Z);t._transport=Et,Vt.send("Ready",null)})}).catch(t._capability.reject),t}var xd;const Cd=class Cd{constructor(){D(this,"_capability",Promise.withResolvers());D(this,"_transport",null);D(this,"_worker",null);D(this,"docId",`d${Me(Cd,xd)._++}`);D(this,"destroyed",!1);D(this,"onPassword",null);D(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var t,e,i,s;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(n){throw(i=this._worker)!=null&&i.port&&delete this._worker._pendingDestroy,n}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}async getData(){return this._transport.getData()}};xd=new WeakMap,g(Cd,xd,0);let Ou=Cd;var Wr,xh,Ch,kh,Th;class $m{constructor(t,e,i=!1,s=null){g(this,Wr,Promise.withResolvers());g(this,xh,[]);g(this,Ch,[]);g(this,kh,[]);g(this,Th,[]);this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s}addRangeListener(t){r(this,Th).push(t)}addProgressListener(t){r(this,kh).push(t)}addProgressiveReadListener(t){r(this,Ch).push(t)}addProgressiveDoneListener(t){r(this,xh).push(t)}onDataRange(t,e){for(const i of r(this,Th))i(t,e)}onDataProgress(t,e){r(this,Wr).promise.then(()=>{for(const i of r(this,kh))i(t,e)})}onDataProgressiveRead(t){r(this,Wr).promise.then(()=>{for(const e of r(this,Ch))e(t)})}onDataProgressiveDone(){r(this,Wr).promise.then(()=>{for(const t of r(this,xh))t()})}transportReady(){r(this,Wr).resolve()}requestDataRange(t,e){Pt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}Wr=new WeakMap,xh=new WeakMap,Ch=new WeakMap,kh=new WeakMap,Th=new WeakMap;class rw{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ut(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Gs,qr,_l;class aw{constructor(t,e,i,s=!1){g(this,qr);g(this,Gs,!1);this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new Qf:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new Dm,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new pc({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ut(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,canvas:e=t.canvas,viewport:i,intent:s="display",annotationMode:n=bn.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:h=null,annotationCanvasMap:c=null,pageColors:d=null,printAnnotationStorage:u=null,isEditing:p=!1}){var C,P;(C=this._stats)==null||C.time("Overall");const m=this._transport.getRenderingIntent(s,n,u,p),{renderingIntent:v,cacheKey:y}=m;f(this,Gs,!1),h||(h=this._transport.getOptionalContentConfig(v));let w=this._intentStates.get(y);w||(w=Object.create(null),this._intentStates.set(y,w)),w.streamReaderCancelTimeout&&(clearTimeout(w.streamReaderCancelTimeout),w.streamReaderCancelTimeout=null);const A=!!(v&ui.PRINT);w.displayReadyCapability||(w.displayReadyCapability=Promise.withResolvers(),w.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(P=this._stats)==null||P.time("Page Request"),this._pumpOperatorList(m));const x=k=>{var _;w.renderTasks.delete(I),A&&f(this,Gs,!0),b(this,qr,_l).call(this),k?(I.capability.reject(k),this._abortOperatorList({intentState:w,reason:k instanceof Error?k:new Error(k)})):I.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(_=globalThis.Stats)!=null&&_.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},I=new Nu({callback:x,params:{canvas:e,canvasContext:t,viewport:i,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:w.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!A,pdfBug:this._pdfBug,pageColors:d,enableHWA:this._transport.enableHWA});(w.renderTasks||(w.renderTasks=new Set)).add(I);const E=I.task;return Promise.all([w.displayReadyCapability.promise,h]).then(([k,_])=>{var S;if(this.destroyed){x();return}if((S=this._stats)==null||S.time("Rendering"),!(_.renderingIntent&v))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");I.initializeGraphics({transparency:k,optionalContentConfig:_}),I.operatorListChanged()}).catch(x),E}getOperatorList({intent:t="display",annotationMode:e=bn.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){var c;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(h))}const a=this._transport.getRenderingIntent(t,e,i,s,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let h;return o.opListReadCapability||(h=Object.create(null),h.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(h),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Dl.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,s){function n(){a.read().then(function({value:h,done:c}){if(c){i(o);return}o.lang??(o.lang=h.lang),Object.assign(o.styles,h.styles),o.items.push(...h.items),n()},s)}const a=e.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),f(this,Gs,!1),Promise.all(t)}cleanup(t=!1){f(this,Gs,!0);const e=b(this,qr,_l).call(this);return t&&e&&this._stats&&(this._stats=new Qf),e}_startRenderPage(t,e){var s,n;const i=this._intentStates.get(e);i&&((s=this._stats)==null||s.timeEnd("Page Request"),(n=i.displayReadyCapability)==null||n.resolve(t))}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&b(this,qr,_l).call(this)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:s}){const{map:n,transfer:a}=i,h=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:s},a).getReader(),c=this._intentStates.get(e);c.streamReader=h;const d=()=>{h.read().then(({value:u,done:p})=>{if(p){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,c),d())},u=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const p of c.renderTasks)p.operatorListChanged();b(this,qr,_l).call(this)}if(c.displayReadyCapability)c.displayReadyCapability.reject(u);else if(c.opListReadCapability)c.opListReadCapability.reject(u);else throw u}})};d()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof Ef){let s=nw;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new lr(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,n]of this._intentStates)if(n===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}Gs=new WeakMap,qr=new WeakSet,_l=function(){if(!r(this,Gs)||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),f(this,Gs,!1),!0};var Hn,$i,Ws,Xr,kd,Yr,Qr,ze,$c,zm,jm,Il,xo,zc;const Nt=class Nt{constructor({name:t=null,port:e=null,verbosity:i=Gy()}={}){g(this,ze);g(this,Hn,Promise.withResolvers());g(this,$i,null);g(this,Ws,null);g(this,Xr,null);if(this.name=t,this.destroyed=!1,this.verbosity=i,e){if(r(Nt,Qr).has(e))throw new Error("Cannot use more than one PDFWorker per port.");r(Nt,Qr).set(e,this),b(this,ze,zm).call(this,e)}else b(this,ze,jm).call(this)}get promise(){return r(this,Hn).promise}get port(){return r(this,Ws)}get messageHandler(){return r(this,$i)}destroy(){var t,e;this.destroyed=!0,(t=r(this,Xr))==null||t.terminate(),f(this,Xr,null),r(Nt,Qr).delete(r(this,Ws)),f(this,Ws,null),(e=r(this,$i))==null||e.destroy(),f(this,$i,null)}static create(t){const e=r(this,Qr).get(t==null?void 0:t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Nt(t)}static get workerSrc(){if(_s.workerSrc)return _s.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ut(this,"_setupFakeWorkerGlobal",(async()=>r(this,xo,zc)?r(this,xo,zc):(await import(this.workerSrc)).WorkerMessageHandler)())}};Hn=new WeakMap,$i=new WeakMap,Ws=new WeakMap,Xr=new WeakMap,kd=new WeakMap,Yr=new WeakMap,Qr=new WeakMap,ze=new WeakSet,$c=function(){r(this,Hn).resolve(),r(this,$i).send("configure",{verbosity:this.verbosity})},zm=function(t){f(this,Ws,t),f(this,$i,new bl("main","worker",t)),r(this,$i).on("ready",()=>{}),b(this,ze,$c).call(this)},jm=function(){if(r(Nt,Yr)||r(Nt,xo,zc)){b(this,ze,Il).call(this);return}let{workerSrc:t}=Nt;try{Nt._isSameOrigin(window.location,t)||(t=Nt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new bl("main","worker",e),s=()=>{n.abort(),i.destroy(),e.terminate(),this.destroyed?r(this,Hn).reject(new Error("Worker was destroyed")):b(this,ze,Il).call(this)},n=new AbortController;e.addEventListener("error",()=>{r(this,Xr)||s()},{signal:n.signal}),i.on("test",o=>{if(n.abort(),this.destroyed||!o){s();return}f(this,$i,i),f(this,Ws,e),f(this,Xr,e),b(this,ze,$c).call(this)}),i.on("ready",o=>{if(n.abort(),this.destroyed){s();return}try{a()}catch{b(this,ze,Il).call(this)}});const a=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};a();return}catch{zd("The worker has been disabled.")}b(this,ze,Il).call(this)},Il=function(){r(Nt,Yr)||(at("Setting up fake worker."),f(Nt,Yr,!0)),Nt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){r(this,Hn).reject(new Error("Worker was destroyed"));return}const e=new bv;f(this,Ws,e);const i=`fake${Me(Nt,kd)._++}`,s=new bl(i+"_worker",i,e);t.setup(s,e),f(this,$i,new bl(i,i+"_worker",e)),b(this,ze,$c).call(this)}).catch(t=>{r(this,Hn).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},xo=new WeakSet,zc=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},g(Nt,xo),g(Nt,kd,0),g(Nt,Yr,!1),g(Nt,Qr,new WeakMap),He&&(f(Nt,Yr,!0),_s.workerSrc||(_s.workerSrc="./pdf.worker.mjs")),Nt._isSameOrigin=(t,e)=>{const i=URL.parse(t);if(!(i!=null&&i.origin)||i.origin==="null")return!1;const s=new URL(e,i);return i.origin===s.origin},Nt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Nt.fromPort=t=>{if(nv("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return Nt.create(t)};let Fl=Nt;var qs,ds,Co,ko,Xs,Jr,Sl;class ow{constructor(t,e,i,s,n,a){g(this,Jr);g(this,qs,new Map);g(this,ds,new Map);g(this,Co,new Map);g(this,ko,new Map);g(this,Xs,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Dm,this.fontLoader=new dv({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}get annotationStorage(){return ut(this,"annotationStorage",new Cf)}getRenderingIntent(t,e=bn.ENABLE,i=null,s=!1,n=!1){let a=ui.DISPLAY,o=Iu;switch(t){case"any":a=ui.ANY;break;case"display":break;case"print":a=ui.PRINT;break;default:at(`getRenderingIntent - invalid intent: ${t}`)}const h=a&ui.PRINT&&i instanceof ym?i:this.annotationStorage;switch(e){case bn.DISABLE:a+=ui.ANNOTATIONS_DISABLE;break;case bn.ENABLE:break;case bn.ENABLE_FORMS:a+=ui.ANNOTATIONS_FORMS;break;case bn.ENABLE_STORAGE:a+=ui.ANNOTATIONS_STORAGE,o=h.serializable;break;default:at(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(a+=ui.IS_EDITING),n&&(a+=ui.OPLIST);const{ids:c,hash:d}=h.modifiedIds,u=[a,o.hash,d];return{renderingIntent:a,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:c}}destroy(){var i;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(i=r(this,Xs))==null||i.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of r(this,ds).values())t.push(s._destroy());r(this,ds).clear(),r(this,Co).clear(),r(this,ko).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var s,n;this.commonObjs.clear(),this.fontLoader.clear(),r(this,qs).clear(),this.filterFactory.destroy(),Ml.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new lr("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,s)=>{te(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){s.close();return}te(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",async i=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:n,contentLength:a}=this._fullReader;return(!s||!n)&&(this._lastProgress&&((o=e.onProgress)==null||o.call(e,this._lastProgress)),this._fullReader.onProgress=h=>{var c;(c=e.onProgress)==null||c.call(e,{loaded:h.loaded,total:h.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:a}}),t.on("GetRangeReader",(i,s)=>{te(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){s.close();return}te(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{n.cancel(a),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new rw(i,this))}),t.on("DocException",i=>{e._capability.reject(Ve(i))}),t.on("PasswordRequest",i=>{f(this,Xs,Promise.withResolvers());try{if(!e.onPassword)throw Ve(i);const s=n=>{n instanceof Error?r(this,Xs).reject(n):r(this,Xs).resolve({password:n})};e.onPassword(s,i.code)}catch(s){r(this,Xs).reject(s)}return r(this,Xs).promise}),t.on("DataLoaded",i=>{var s;(s=e.onProgress)==null||s.call(e,{loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;r(this,ds).get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,s,n])=>{var a;if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":if("error"in n){const d=n.error;at(`Error during font loading: ${d}`),this.commonObjs.resolve(i,d);break}const o=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(d,u)=>globalThis.FontInspector.fontAdded(d,u):null,h=new uv(n,o);this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!h.fontExtraProperties&&h.data&&(h.data=null),this.commonObjs.resolve(i,h)});break;case"CopyLocalImage":const{imageRef:c}=n;te(c,"The imageRef must be defined.");for(const d of r(this,ds).values())for(const[,u]of d.objs)if((u==null?void 0:u.ref)===c)return u.dataLen?(this.commonObjs.resolve(i,structuredClone(u)),u.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([i,s,n,a])=>{var h;if(this.destroyed)return;const o=r(this,ds).get(s);if(!o.objs.has(i)){if(o._intentStates.size===0){(h=a==null?void 0:a.bitmap)==null||h.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",i=>{var s;this.destroyed||(s=e.onProgress)==null||s.call(e,{loaded:i.loaded,total:i.total})}),t.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[i.type];if(!s)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var i;this.annotationStorage.size<=0&&at("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((i=this._fullReader)==null?void 0:i.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=r(this,Co).get(e);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&r(this,ko).set(n.refStr,t);const a=new aw(e,n,this,this._params.pdfBug);return r(this,ds).set(e,a),a});return r(this,Co).set(e,s),s}getPageIndex(t){return Su(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return b(this,Jr,Sl).call(this,"GetFieldObjects")}hasJSActions(){return b(this,Jr,Sl).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return b(this,Jr,Sl).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return b(this,Jr,Sl).call(this,"GetOptionalContentConfig").then(e=>new Hv(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=r(this,qs).get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(s=>{var n,a;return{info:s[0],metadata:s[1]?new Nv(s[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return r(this,qs).set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of r(this,ds).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),r(this,qs).clear(),this.filterFactory.destroy(!0),Ml.cleanup()}}cachedPageNumber(t){if(!Su(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return r(this,ko).get(e)??null}}qs=new WeakMap,ds=new WeakMap,Co=new WeakMap,ko=new WeakMap,Xs=new WeakMap,Jr=new WeakSet,Sl=function(t,e=null){const i=r(this,qs).get(t);if(i)return i;const s=this.messageHandler.sendWithPromise(t,e);return r(this,qs).set(t,s),s};var $n;class lw{constructor(t){g(this,$n,null);D(this,"onContinue",null);D(this,"onError",null);f(this,$n,t)}get promise(){return r(this,$n).capability.promise}cancel(t=0){r(this,$n).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=r(this,$n).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=r(this,$n);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}$n=new WeakMap;var zn,Zr;const yr=class yr{constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:h,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:p=null,enableHWA:m=!1}){g(this,zn,null);this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=h,this.filterFactory=c,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new lw(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=m}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var o,h;if(this.cancelled)return;if(this._canvas){if(r(yr,Zr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");r(yr,Zr).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:s,background:n}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Wa(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:i,transparency:t,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,(h=this.graphicsReadyCallback)==null||h.call(this)}cancel(t=null,e=0){var i,s,n;this.running=!1,this.cancelled=!0,(i=this.gfx)==null||i.endDrawing(),r(this,zn)&&(window.cancelAnimationFrame(r(this,zn)),f(this,zn,null)),r(yr,Zr).delete(this._canvas),t||(t=new Ef(`Rendering cancelled, page ${this._pageIndex+1}`,e)),this.callback(t),(n=(s=this.task).onError)==null||n.call(s,t)}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?f(this,zn,window.requestAnimationFrame(()=>{f(this,zn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),r(yr,Zr).delete(this._canvas),this.callback())))}};zn=new WeakMap,Zr=new WeakMap,g(yr,Zr,new WeakSet);let Nu=yr;const hw="5.4.54",cw="295fb3ec4";var ei,ta,To,re,Ph,Po,Ys,Lh,jn,zi,Rh,Tt,Bu,Hu,$u,fr,Um,gn;const Ke=class Ke{constructor({editor:t=null,uiManager:e=null}){g(this,Tt);g(this,ei,null);g(this,ta,null);g(this,To);g(this,re,null);g(this,Ph,!1);g(this,Po,!1);g(this,Ys,null);g(this,Lh);g(this,jn,null);g(this,zi,null);var i,s;t?(f(this,Po,!1),f(this,Ys,t)):f(this,Po,!0),f(this,zi,(t==null?void 0:t._uiManager)||e),f(this,Lh,r(this,zi)._eventBus),f(this,To,((i=t==null?void 0:t.color)==null?void 0:i.toUpperCase())||((s=r(this,zi))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),r(Ke,Rh)||f(Ke,Rh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ut(this,"_keyboardManager",new mc([[["Escape","mac+Escape"],Ke.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ke.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ke.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ke.prototype._moveToPrevious],[["Home","mac+Home"],Ke.prototype._moveToBeginning],[["End","mac+End"],Ke.prototype._moveToEnd]]))}renderButton(){const t=f(this,ei,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",r(this,Ys)&&(t.ariaControls=`${r(this,Ys).id}_colorpicker_dropdown`);const e=r(this,zi)._signal;t.addEventListener("click",b(this,Tt,fr).bind(this),{signal:e}),t.addEventListener("keydown",b(this,Tt,$u).bind(this),{signal:e});const i=f(this,ta,document.createElement("span"));return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=r(this,To),t.append(i),t}renderMainDropdown(){const t=f(this,re,b(this,Tt,Bu).call(this));return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}_colorSelectFromKeyboard(t){if(t.target===r(this,ei)){b(this,Tt,fr).call(this,t);return}const e=t.target.getAttribute("data-color");e&&b(this,Tt,Hu).call(this,e,t)}_moveToNext(t){var e,i;if(!r(this,Tt,gn)){b(this,Tt,fr).call(this,t);return}if(t.target===r(this,ei)){(e=r(this,re).firstChild)==null||e.focus();return}(i=t.target.nextSibling)==null||i.focus()}_moveToPrevious(t){var e,i;if(t.target===((e=r(this,re))==null?void 0:e.firstChild)||t.target===r(this,ei)){r(this,Tt,gn)&&this._hideDropdownFromKeyboard();return}r(this,Tt,gn)||b(this,Tt,fr).call(this,t),(i=t.target.previousSibling)==null||i.focus()}_moveToBeginning(t){var e;if(!r(this,Tt,gn)){b(this,Tt,fr).call(this,t);return}(e=r(this,re).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!r(this,Tt,gn)){b(this,Tt,fr).call(this,t);return}(e=r(this,re).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=r(this,re))==null||t.classList.add("hidden"),r(this,ei).ariaExpanded="false",(e=r(this,jn))==null||e.abort(),f(this,jn,null)}_hideDropdownFromKeyboard(){var t;if(!r(this,Po)){if(!r(this,Tt,gn)){(t=r(this,Ys))==null||t.unselect();return}this.hideDropdown(),r(this,ei).focus({preventScroll:!0,focusVisible:r(this,Ph)})}}updateColor(t){if(r(this,ta)&&(r(this,ta).style.backgroundColor=t),!r(this,re))return;const e=r(this,zi).highlightColors.values();for(const i of r(this,re).children)i.ariaSelected=e.next().value===t.toUpperCase()}destroy(){var t,e;(t=r(this,ei))==null||t.remove(),f(this,ei,null),f(this,ta,null),(e=r(this,re))==null||e.remove(),f(this,re,null)}};ei=new WeakMap,ta=new WeakMap,To=new WeakMap,re=new WeakMap,Ph=new WeakMap,Po=new WeakMap,Ys=new WeakMap,Lh=new WeakMap,jn=new WeakMap,zi=new WeakMap,Rh=new WeakMap,Tt=new WeakSet,Bu=function(){const t=document.createElement("div"),e=r(this,zi)._signal;t.addEventListener("contextmenu",Mi,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),r(this,Ys)&&(t.id=`${r(this,Ys).id}_colorpicker_dropdown`);for(const[i,s]of r(this,zi).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",r(Ke,Rh)[i]);const a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=s,n.ariaSelected=s===r(this,To),n.addEventListener("click",b(this,Tt,Hu).bind(this,s),{signal:e}),t.append(n)}return t.addEventListener("keydown",b(this,Tt,$u).bind(this),{signal:e}),t},Hu=function(t,e){e.stopPropagation(),r(this,Lh).dispatch("switchannotationeditorparams",{source:this,type:mt.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)},$u=function(t){Ke._keyboardManager.exec(this,t)},fr=function(t){if(r(this,Tt,gn)){this.hideDropdown();return}if(f(this,Ph,t.detail===0),r(this,jn)||(f(this,jn,new AbortController),window.addEventListener("pointerdown",b(this,Tt,Um).bind(this),{signal:r(this,zi).combinedSignal(r(this,jn))})),r(this,ei).ariaExpanded="true",r(this,re)){r(this,re).classList.remove("hidden");return}const e=f(this,re,b(this,Tt,Bu).call(this));r(this,ei).append(e)},Um=function(t){var e;(e=r(this,re))!=null&&e.contains(t.target)||this.hideDropdown()},gn=function(){return r(this,re)&&!r(this,re).classList.contains("hidden")},g(Ke,Rh,null);let dd=Ke;var us,Mh,Lo,Dh;const vr=class vr{constructor(t){g(this,us,null);g(this,Mh,null);g(this,Lo,null);f(this,Mh,t),f(this,Lo,t._uiManager),r(vr,Dh)||f(vr,Dh,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(r(this,us))return r(this,us);const{editorType:t,colorType:e,colorValue:i}=r(this,Mh),s=f(this,us,document.createElement("input"));return s.type="color",s.value=i||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",r(vr,Dh)[t]),s.addEventListener("input",()=>{r(this,Lo).updateParams(e,s.value)},{signal:r(this,Lo)._signal}),s}update(t){r(this,us)&&(r(this,us).value=t)}destroy(){var t;(t=r(this,us))==null||t.remove(),f(this,us,null)}hideDropdown(){}};us=new WeakMap,Mh=new WeakMap,Lo=new WeakMap,Dh=new WeakMap,g(vr,Dh,null);let ud=vr;function fp(l){return Math.floor(Math.max(0,Math.min(1,l))*255).toString(16).padStart(2,"0")}function cl(l){return Math.max(0,Math.min(255,255*l))}class pp{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=cl(t),[t,t,t]}static G_HTML([t]){const e=fp(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(cl)}static RGB_HTML(t){return`#${t.map(fp).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[cl(1-Math.min(1,t+s)),cl(1-Math.min(1,i+s)),cl(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const s=1-t,n=1-e,a=1-i,o=Math.min(s,n,a);return["CMYK",s,n,a,o]}}class dw{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Pt("Abstract method `_createSVG` called.")}}class fd extends dw{_createSVG(t){return document.createElementNS(xs,t)}}class Vm{static setupStorage(t,e,i,s,n){const a=s.getValue(e,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?t.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",o=>{s.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(const o of i.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const h=o.target.options,c=h.selectedIndex===-1?"":h[h.selectedIndex].value;s.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:n}){const{attributes:a}=e,o=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(const[h,c]of Object.entries(a))if(c!=null)switch(h){case"class":c.length&&t.setAttribute(h,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||h!=="href"&&h!=="newWindow")&&t.setAttribute(h,c)}o&&n.addLinkAttributes(t,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(t,a.dataId,e,i)}static render(t){var u,p;const e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,n=t.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:n,linkService:i});const o=n!=="richText",h=t.div;if(h.append(a),t.viewport){const m=`matrix(${t.viewport.transform.join(",")})`;h.style.transform=m}o&&h.setAttribute("class","xfaLayer xfaFont");const c=[];if(s.children.length===0){if(s.value){const m=document.createTextNode(s.value);a.append(m),o&&Dl.shouldBuildText(s.name)&&c.push(m)}return{textDivs:c}}const d=[[s,-1,a]];for(;d.length>0;){const[m,v,y]=d.at(-1);if(v+1===m.children.length){d.pop();continue}const w=m.children[++d.at(-1)[1]];if(w===null)continue;const{name:A}=w;if(A==="#text"){const I=document.createTextNode(w.value);c.push(I),y.append(I);continue}const x=(u=w==null?void 0:w.attributes)!=null&&u.xmlns?document.createElementNS(w.attributes.xmlns,A):document.createElement(A);if(y.append(x),w.attributes&&this.setAttributes({html:x,element:w,storage:e,intent:n,linkService:i}),((p=w.children)==null?void 0:p.length)>0)d.push([w,-1,x]);else if(w.value){const I=document.createTextNode(w.value);o&&Dl.shouldBuildText(A)&&c.push(I),x.append(I)}}for(const m of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const uw=9,Ta=new WeakSet,fw=new Date().getTimezoneOffset()*60*1e3;class mp{static create(t){switch(t.data.annotationType){case Yt.LINK:return new Pf(t);case Yt.TEXT:return new pw(t);case Yt.WIDGET:switch(t.data.fieldType){case"Tx":return new mw(t);case"Btn":return t.data.radioButton?new Wm(t):t.data.checkBox?new bw(t):new yw(t);case"Ch":return new vw(t);case"Sig":return new gw(t)}return new La(t);case Yt.POPUP:return new ju(t);case Yt.FREETEXT:return new Jm(t);case Yt.LINE:return new Aw(t);case Yt.SQUARE:return new _w(t);case Yt.CIRCLE:return new Iw(t);case Yt.POLYLINE:return new Zm(t);case Yt.CARET:return new Ew(t);case Yt.INK:return new Lf(t);case Yt.POLYGON:return new Sw(t);case Yt.HIGHLIGHT:return new tg(t);case Yt.UNDERLINE:return new xw(t);case Yt.SQUIGGLY:return new Cw(t);case Yt.STRIKEOUT:return new kw(t);case Yt.STAMP:return new eg(t);case Yt.FILEATTACHMENT:return new Tw(t);default:return new qt(t)}}}var ea,Ro,Qs,Fh,zu;const Nf=class Nf{constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){g(this,Fh);g(this,ea,null);g(this,Ro,!1);g(this,Qs,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t!=null&&t.str||e!=null&&e.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Nf._hasPopupData(this.data)}updateEdited(t){var n;if(!this.container)return;t.rect&&(r(this,ea)||f(this,ea,{rect:this.data.rect.slice(0)}));const{rect:e,popup:i}=t;e&&b(this,Fh,zu).call(this,e);let s=((n=r(this,Qs))==null?void 0:n.popup)||this.popup;!s&&(i!=null&&i.text)&&(this._createPopup(i),s=r(this,Qs).popup),s&&(s.updateEdited(t),i!=null&&i.deleted&&(s.remove(),f(this,Qs,null),this.popup=null))}resetEdited(){var t;r(this,ea)&&(b(this,Fh,zu).call(this,r(this,ea).rect),(t=r(this,Qs))==null||t.popup.resetEdited(),f(this,ea,null))}_createContainer(t){const{data:e,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),!(this instanceof La)&&!(this instanceof Pf)&&(n.tabIndex=0);const{style:a}=n;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof ju){const{rotation:y}=e;return!e.hasOwnCanvas&&y!==0&&this.setRotation(y,n),n}const{width:o,height:h}=this;if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;const y=e.borderStyle.horizontalCornerRadius,w=e.borderStyle.verticalCornerRadius;if(y>0||w>0){const x=`calc(${y}px * var(--total-scale-factor)) / calc(${w}px * var(--total-scale-factor))`;a.borderRadius=x}else if(this instanceof Wm){const x=`calc(${o}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;a.borderRadius=x}switch(e.borderStyle.style){case Fa.SOLID:a.borderStyle="solid";break;case Fa.DASHED:a.borderStyle="dashed";break;case Fa.BEVELED:at("Unimplemented border style: beveled");break;case Fa.INSET:at("Unimplemented border style: inset");break;case Fa.UNDERLINE:a.borderBottomStyle="solid";break}const A=e.borderColor||null;A?(f(this,Ro,!0),a.borderColor=Y.makeHexColor(A[0]|0,A[1]|0,A[2]|0)):a.borderWidth=0}const c=Y.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:d,pageHeight:u,pageX:p,pageY:m}=s.rawDims;a.left=`${100*(c[0]-p)/d}%`,a.top=`${100*(c[1]-m)/u}%`;const{rotation:v}=e;return e.hasOwnCanvas||v===0?(a.width=`${100*o/d}%`,a.height=`${100*h/u}%`):this.setRotation(v,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims;let{width:n,height:a}=this;t%180!==0&&([n,a]=[a,n]),e.style.width=`${100*n/i}%`,e.style.height=`${100*a/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,s)=>{const n=s.detail[e],a=n[0],o=n.slice(1);s.target.style[i]=pp[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:pp[`${a}_rgb`](o)})};return ut(this,"_commonActions",{display:e=>{const{display:i}=e.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const s of Object.keys(e.detail)){const n=t[s]||i[s];n==null||n(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[s,n]of Object.entries(e)){const a=i[s];if(a){const o={detail:{[s]:n},target:t};a(o),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,s,n]=this.data.rect.map(y=>Math.fround(y));if(t.length===8){const[y,w,A,x]=t.subarray(2,6);if(s===y&&n===w&&e===A&&i===x)return}const{style:a}=this.container;let o;if(r(this,Ro)){const{borderColor:y,borderWidth:w}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${w}">`],this.container.classList.add("hasBorder")}const h=s-e,c=n-i,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const p=d.createElement("defs");u.append(p);const m=d.createElement("clipPath"),v=`clippath_${this.data.id}`;m.setAttribute("id",v),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let y=2,w=t.length;y<w;y+=8){const A=t[y],x=t[y+1],I=t[y+2],E=t[y+3],C=d.createElement("rect"),P=(I-e)/h,k=(n-x)/c,_=(A-I)/h,S=(x-E)/c;C.setAttribute("x",P),C.setAttribute("y",k),C.setAttribute("width",_),C.setAttribute("height",S),m.append(C),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${k}" width="${_}" height="${S}"/>`)}r(this,Ro)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${v})`}_createPopup(t=null){const{data:e}=this;let i,s;t?(i={str:t.text},s=t.date):(i=e.contentsObj,s=e.modificationDate);const n=f(this,Qs,new ju({data:{color:e.color,titleObj:e.titleObj,modificationDate:s,contentsObj:i,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}));this.parent.div.append(n.render())}get hasPopupElement(){return!!(r(this,Qs)||this.popup||this.data.popupRef)}render(){Pt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:n,id:a,exportValues:o}of s){if(n===-1||a===e)continue;const h=typeof o=="string"?o:null,c=document.querySelector(`[data-element-id="${a}"]`);if(c&&!Ta.has(c)){at(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:h,domElement:c})}return i}for(const s of document.getElementsByName(t)){const{exportValue:n}=s,a=s.getAttribute("data-element-id");a!==e&&Ta.has(s)&&i.push({id:a,exportValue:n,domElement:s})}return i}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var i;(i=this.linkService.eventBus)==null||i.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};ea=new WeakMap,Ro=new WeakMap,Qs=new WeakMap,Fh=new WeakSet,zu=function(t){const{container:{style:e},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:h}}}}=this;i==null||i.splice(0,4,...t),e.left=`${100*(t[0]-o)/n}%`,e.top=`${100*(a-t[3]+h)/a}%`,s===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/a}%`):this.setRotation(s)};let qt=Nf;var mi,pr,Km,Gm;class Pf extends qt{constructor(e,i=null){super(e,{isRenderable:!0,ignoreBorder:!!(i!=null&&i.ignoreBorder),createQuadrilaterals:!0});g(this,mi);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:i}=this,s=document.createElement("a");s.setAttribute("data-element-id",e.id);let n=!1;return e.url?(i.addLinkAttributes(s,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(s,e.action,e.overlaidText),n=!0):e.attachment?(b(this,mi,Km).call(this,s,e.attachment,e.overlaidText,e.attachmentDest),n=!0):e.setOCGState?(b(this,mi,Gm).call(this,s,e.setOCGState,e.overlaidText),n=!0):e.dest?(this._bindLink(s,e.dest,e.overlaidText),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,e),n=!0),e.resetForm?(this._bindResetFormAction(s,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(s,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(s),this.container}_bindLink(e,i,s=""){e.href=this.linkService.getDestinationHash(i),e.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||i==="")&&b(this,mi,pr).call(this),s&&(e.title=s)}_bindNamedAction(e,i,s=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(i),!1),s&&(e.title=s),b(this,mi,pr).call(this)}_bindJSAction(e,i){e.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(i.actions)){const a=s.get(n);a&&(e[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:n}}),!1})}i.overlaidText&&(e.title=i.overlaidText),e.onclick||(e.onclick=()=>!1),b(this,mi,pr).call(this)}_bindResetFormAction(e,i){const s=e.onclick;if(s||(e.href=this.linkService.getAnchorUrl("")),b(this,mi,pr).call(this),!this._fieldObjects){at('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(e.onclick=()=>!1);return}e.onclick=()=>{var u;s==null||s();const{fields:n,refs:a,include:o}=i,h=[];if(n.length!==0||a.length!==0){const p=new Set(a);for(const m of n){const v=this._fieldObjects[m]||[];for(const{id:y}of v)p.add(y)}for(const m of Object.values(this._fieldObjects))for(const v of m)p.has(v.id)===o&&h.push(v)}else for(const p of Object.values(this._fieldObjects))h.push(...p);const c=this.annotationStorage,d=[];for(const p of h){const{id:m}=p;switch(d.push(m),p.type){case"text":{const y=p.defaultValue||"";c.setValue(m,{value:y});break}case"checkbox":case"radiobutton":{const y=p.defaultValue===p.exportValues;c.setValue(m,{value:y});break}case"combobox":case"listbox":{const y=p.defaultValue||"";c.setValue(m,{value:y});break}default:continue}const v=document.querySelector(`[data-element-id="${m}"]`);if(v){if(!Ta.has(v)){at(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;v.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}}mi=new WeakSet,pr=function(){this.container.setAttribute("data-internal-link","")},Km=function(e,i,s="",n=null){e.href=this.linkService.getAnchorUrl(""),i.description?e.title=i.description:s&&(e.title=s),e.onclick=()=>{var a;return(a=this.downloadManager)==null||a.openOrDownloadData(i.content,i.filename,n),!1},b(this,mi,pr).call(this)},Gm=function(e,i,s=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(i),!1),s&&(e.title=s),b(this,mi,pr).call(this)};class pw extends qt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class La extends qt{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return xe.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,n){i.includes("mouse")?t.addEventListener(i,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(i,a=>{var o;if(i==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a)}}))})}_setEventListeners(t,e,i,s){var n,a,o;for(const[h,c]of i)(c==="Action"||(n=this.data.actions)!=null&&n[c])&&((c==="Focus"||c==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,h,c,s),c==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":Y.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||uw,n=t.style;let a;const o=2,h=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o),d=Math.round(c/(qd*s))||1,u=c/d;a=Math.min(s,h(u/qd))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(s,h(c/qd))}n.fontSize=`calc(${a}px * var(--total-scale-factor))`,n.color=Y.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class mw extends La{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,s){const n=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=i),n.setValue(a.id,{[s]:i})}render(){var s,n;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const a=t.getValue(e,{value:this.data.fieldValue});let o=a.value||"";const h=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;h&&o.length>h&&(o=o.slice(0,h));let c=a.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=c??o,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",c??o),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),Ta.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const{datetimeFormat:u,datetimeType:p,timeStep:m}=this.data,v=!!p&&this.enableScripting;u&&(i.title=u),this._setRequired(i,this.data.required),h&&(i.maxLength=h),i.addEventListener("input",w=>{t.setValue(e,{value:w.target.value}),this.setPropertyOnSiblings(i,"value",w.target.value,"value"),d.formattedValue=null}),i.addEventListener("resetform",w=>{const A=this.data.defaultFieldValue??"";i.value=d.userValue=A,d.formattedValue=null});let y=w=>{const{formattedValue:A}=d;A!=null&&(w.target.value=A),w.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",A=>{var I;if(d.focused)return;const{target:x}=A;if(v&&(x.type=p,m&&(x.step=m)),d.userValue){const E=d.userValue;if(v)if(p==="time"){const C=new Date(E),P=[C.getHours(),C.getMinutes(),C.getSeconds()];x.value=P.map(k=>k.toString().padStart(2,"0")).join(":")}else x.value=new Date(E-fw).toISOString().split(p==="date"?"T":".",1)[0];else x.value=E}d.lastCommittedValue=x.value,d.commitKey=1,(I=this.data.actions)!=null&&I.Focus||(d.focused=!0)}),i.addEventListener("updatefromsandbox",A=>{this.showElementAndHideCanvas(A.target);const x={value(I){d.userValue=I.detail.value??"",v||t.setValue(e,{value:d.userValue.toString()}),I.target.value=d.userValue},formattedValue(I){const{formattedValue:E}=I.detail;d.formattedValue=E,E!=null&&I.target!==document.activeElement&&(I.target.value=E);const C={formattedValue:E};v&&(C.value=E),t.setValue(e,C)},selRange(I){I.target.setSelectionRange(...I.detail.selRange)},charLimit:I=>{var k;const{charLimit:E}=I.detail,{target:C}=I;if(E===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",E);let P=d.userValue;!P||P.length<=E||(P=P.slice(0,E),C.value=d.userValue=P,t.setValue(e,{value:P}),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:P,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(x,A)}),i.addEventListener("keydown",A=>{var E;d.commitKey=1;let x=-1;if(A.key==="Escape"?x=0:A.key==="Enter"&&!this.data.multiLine?x=2:A.key==="Tab"&&(d.commitKey=3),x===-1)return;const{value:I}=A.target;d.lastCommittedValue!==I&&(d.lastCommittedValue=I,d.userValue=I,(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:I,willCommit:!0,commitKey:x,selStart:A.target.selectionStart,selEnd:A.target.selectionEnd}}))});const w=y;y=null,i.addEventListener("blur",A=>{var E,C;if(!d.focused||!A.relatedTarget)return;(E=this.data.actions)!=null&&E.Blur||(d.focused=!1);const{target:x}=A;let{value:I}=x;if(v){if(I&&p==="time"){const P=I.split(":").map(k=>parseInt(k,10));I=new Date(2e3,0,1,P[0],P[1],P[2]||0).valueOf(),x.step=""}else I=new Date(I).valueOf();x.type="text"}d.userValue=I,d.lastCommittedValue!==I&&((C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:I,willCommit:!0,commitKey:d.commitKey,selStart:A.target.selectionStart,selEnd:A.target.selectionEnd}})),w(A)}),(n=this.data.actions)!=null&&n.Keystroke&&i.addEventListener("beforeinput",A=>{var S;d.lastCommittedValue=null;const{data:x,target:I}=A,{value:E,selectionStart:C,selectionEnd:P}=I;let k=C,_=P;switch(A.inputType){case"deleteWordBackward":{const T=E.substring(0,C).match(/\w*[^\w]*$/);T&&(k-=T[0].length);break}case"deleteWordForward":{const T=E.substring(C).match(/^[^\w]*\w*/);T&&(_+=T[0].length);break}case"deleteContentBackward":C===P&&(k-=1);break;case"deleteContentForward":C===P&&(_+=1);break}A.preventDefault(),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:E,change:x||"",willCommit:!1,selStart:k,selEnd:_}})}),this._setEventListeners(i,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],A=>A.target.value)}if(y&&i.addEventListener("blur",y),this.data.comb){const A=(this.data.rect[2]-this.data.rect[0])/h;i.classList.add("comb"),i.style.letterSpacing=`calc(${A}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class gw extends La{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class bw extends La{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Ta.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:h}=a.target;for(const c of this._getElementsByName(o,i)){const d=h&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=d),t.setValue(c.id,{value:d})}t.setValue(i,{value:h})}),n.addEventListener("resetform",a=>{const o=e.defaultFieldValue||"Off";a.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{const o={value(h){h.target.checked=h.detail.value!=="Off",t.setValue(i,{value:h.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Wm extends La{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(i,{value:s})),s)for(const a of this._getElementsByName(e.fieldName,i))t.setValue(a.id,{value:!1});const n=document.createElement("input");if(Ta.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:h}=a.target;for(const c of this._getElementsByName(o,i))t.setValue(c.id,{value:!1});t.setValue(i,{value:h})}),n.addEventListener("resetform",a=>{const o=e.defaultFieldValue;a.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const a=e.buttonValue;n.addEventListener("updatefromsandbox",o=>{const h={value:c=>{const d=a===c.detail.value;for(const u of this._getElementsByName(c.target.name)){const p=d&&u.id===i;u.domElement&&(u.domElement.checked=p),t.setValue(u.id,{value:p})}}};this._dispatchEventFromSandbox(h,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class yw extends Pf{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class vw extends La{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");Ta.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{const u=this.data.defaultFieldValue;for(const p of s.options)p.selected=p.value===u});for(const d of this.data.options){const u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,i.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),n=!1),s.append(u)}let a=null;if(n){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),a=()=>{d.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}const o=d=>{const u=d?"value":"textContent",{options:p,multiple:m}=s;return m?Array.prototype.filter.call(p,v=>v.selected).map(v=>v[u]):p.selectedIndex===-1?null:p[p.selectedIndex][u]};let h=o(!1);const c=d=>{const u=d.target.options;return Array.prototype.map.call(u,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{const u={value(p){a==null||a();const m=p.detail.value,v=new Set(Array.isArray(m)?m:[m]);for(const y of s.options)y.selected=v.has(y.value);t.setValue(e,{value:o(!0)}),h=o(!1)},multipleSelection(p){s.multiple=!0},remove(p){const m=s.options,v=p.detail.remove;m[v].selected=!1,s.remove(v),m.length>0&&Array.prototype.findIndex.call(m,w=>w.selected)===-1&&(m[0].selected=!0),t.setValue(e,{value:o(!0),items:c(p)}),h=o(!1)},clear(p){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),h=o(!1)},insert(p){const{index:m,displayValue:v,exportValue:y}=p.detail.insert,w=s.children[m],A=document.createElement("option");A.textContent=v,A.value=y,w?w.before(A):s.append(A),t.setValue(e,{value:o(!0),items:c(p)}),h=o(!1)},items(p){const{items:m}=p.detail;for(;s.length!==0;)s.remove(0);for(const v of m){const{displayValue:y,exportValue:w}=v,A=document.createElement("option");A.textContent=y,A.value=w,s.append(A)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:o(!0),items:c(p)}),h=o(!1)},indices(p){const m=new Set(p.detail.indices);for(const v of p.target.options)v.selected=m.has(v.index);t.setValue(e,{value:o(!0)}),h=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(u,d)}),s.addEventListener("input",d=>{var m;const u=o(!0),p=o(!1);t.setValue(e,{value:u}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:h,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ju extends qt{constructor(t){const{data:e,elements:i}=t;super(t,{isRenderable:qt._hasPopupData(e)}),this.elements=i,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new ww({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),i=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",i.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(s=>`${Sf}${s}`).join(",")),this.container}}var Mo,Td,Pd,Do,Fo,Kt,Js,Un,Oo,Oh,No,fs,ii,Vn,Zs,Nh,tn,Bo,ia,Kn,wt,jc,Uc,Uu,qm,Xm,Ym,Qm,Vc,Kc,Vu;class ww{constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:n,contentsObj:a,richText:o,parent:h,rect:c,parentRect:d,open:u}){g(this,wt);g(this,Mo,b(this,wt,Ym).bind(this));g(this,Td,b(this,wt,Vu).bind(this));g(this,Pd,b(this,wt,Kc).bind(this));g(this,Do,b(this,wt,Vc).bind(this));g(this,Fo,null);g(this,Kt,null);g(this,Js,null);g(this,Un,null);g(this,Oo,null);g(this,Oh,null);g(this,No,null);g(this,fs,!1);g(this,ii,null);g(this,Vn,null);g(this,Zs,null);g(this,Nh,null);g(this,tn,null);g(this,Bo,null);g(this,ia,null);g(this,Kn,!1);f(this,Kt,t),f(this,Bo,s),f(this,Js,a),f(this,tn,o),f(this,Oh,h),f(this,Fo,e),f(this,Nh,c),f(this,No,d),f(this,Oo,i),f(this,Un,ld.toDateObject(n)),this.trigger=i.flatMap(p=>p.getElementsToTriggerPopup()),b(this,wt,jc).call(this),r(this,Kt).hidden=!0,u&&b(this,wt,Vc).call(this)}render(){var s;if(r(this,ii))return;const t=f(this,ii,document.createElement("div"));if(t.className="popup",r(this,Fo)){const n=t.style.outlineColor=Y.makeHexColor(...r(this,Fo));t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const e=document.createElement("span");if(e.className="header",(s=r(this,Bo))!=null&&s.str){const n=document.createElement("span");n.className="title",e.append(n),{dir:n.dir,str:n.textContent}=r(this,Bo)}if(t.append(e),r(this,Un)){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:r(this,Un).valueOf()})),n.dateTime=r(this,Un).toISOString(),e.append(n)}const i=r(this,wt,Uc);if(i)Vm.render({xfaHtml:i,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(r(this,Js));t.append(n)}r(this,Kt).append(t)}_formatContents({str:t,dir:e}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=e;const s=t.split(/(?:\r\n?|\n)/);for(let n=0,a=s.length;n<a;++n){const o=s[n];i.append(document.createTextNode(o)),n<a-1&&i.append(document.createElement("br"))}return i}updateEdited({rect:t,popup:e,deleted:i}){var s;if(i||e!=null&&e.deleted){this.remove();return}b(this,wt,jc).call(this),r(this,ia)||f(this,ia,{contentsObj:r(this,Js),richText:r(this,tn)}),t&&f(this,Zs,null),e&&(f(this,tn,b(this,wt,Xm).call(this,e.text)),f(this,Un,ld.toDateObject(e.date)),f(this,Js,null)),(s=r(this,ii))==null||s.remove(),f(this,ii,null)}resetEdited(){var t;r(this,ia)&&({contentsObj:Me(this,Js)._,richText:Me(this,tn)._}=r(this,ia),f(this,ia,null),(t=r(this,ii))==null||t.remove(),f(this,ii,null),f(this,Zs,null))}remove(){var t,e;(t=r(this,Vn))==null||t.abort(),f(this,Vn,null),(e=r(this,ii))==null||e.remove(),f(this,ii,null),f(this,Kn,!1),f(this,fs,!1);for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){f(this,Kn,this.isVisible),r(this,Kn)&&(r(this,Kt).hidden=!0)}maybeShow(){b(this,wt,jc).call(this),r(this,Kn)&&(r(this,ii)||b(this,wt,Kc).call(this),f(this,Kn,!1),r(this,Kt).hidden=!1)}get isVisible(){return r(this,Kt).hidden===!1}}Mo=new WeakMap,Td=new WeakMap,Pd=new WeakMap,Do=new WeakMap,Fo=new WeakMap,Kt=new WeakMap,Js=new WeakMap,Un=new WeakMap,Oo=new WeakMap,Oh=new WeakMap,No=new WeakMap,fs=new WeakMap,ii=new WeakMap,Vn=new WeakMap,Zs=new WeakMap,Nh=new WeakMap,tn=new WeakMap,Bo=new WeakMap,ia=new WeakMap,Kn=new WeakMap,wt=new WeakSet,jc=function(){var e;if(r(this,Vn))return;f(this,Vn,new AbortController);const{signal:t}=r(this,Vn);for(const i of this.trigger)i.addEventListener("click",r(this,Do),{signal:t}),i.addEventListener("mouseenter",r(this,Pd),{signal:t}),i.addEventListener("mouseleave",r(this,Td),{signal:t}),i.classList.add("popupTriggerArea");for(const i of r(this,Oo))(e=i.container)==null||e.addEventListener("keydown",r(this,Mo),{signal:t})},Uc=function(){const t=r(this,tn),e=r(this,Js);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&r(this,tn).html||null},Uu=function(){var t,e,i;return((i=(e=(t=r(this,wt,Uc))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.fontSize)||0},qm=function(){var t,e,i;return((i=(e=(t=r(this,wt,Uc))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.color)||null},Xm=function(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:r(this,wt,qm),fontSize:r(this,wt,Uu)?`calc(${r(this,wt,Uu)}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:s});return i},Ym=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&r(this,fs))&&b(this,wt,Vc).call(this)},Qm=function(){if(r(this,Zs)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:n}}}=r(this,Oh);let a=!!r(this,No),o=a?r(this,No):r(this,Nh);for(const v of r(this,Oo))if(!o||Y.intersect(v.data.rect,o)!==null){o=v.data.rect,a=!0;break}const h=Y.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),d=a?o[2]-o[0]+5:0,u=h[0]+d,p=h[1];f(this,Zs,[100*(u-s)/e,100*(p-n)/i]);const{style:m}=r(this,Kt);m.left=`${r(this,Zs)[0]}%`,m.top=`${r(this,Zs)[1]}%`},Vc=function(){f(this,fs,!r(this,fs)),r(this,fs)?(b(this,wt,Kc).call(this),r(this,Kt).addEventListener("click",r(this,Do)),r(this,Kt).addEventListener("keydown",r(this,Mo))):(b(this,wt,Vu).call(this),r(this,Kt).removeEventListener("click",r(this,Do)),r(this,Kt).removeEventListener("keydown",r(this,Mo)))},Kc=function(){r(this,ii)||this.render(),this.isVisible?r(this,fs)&&r(this,Kt).classList.add("focused"):(b(this,wt,Qm).call(this),r(this,Kt).hidden=!1,r(this,Kt).style.zIndex=parseInt(r(this,Kt).style.zIndex)+1e3)},Vu=function(){r(this,Kt).classList.remove("focused"),!(r(this,fs)||!this.isVisible)&&(r(this,Kt).hidden=!0,r(this,Kt).style.zIndex=parseInt(r(this,Kt).style.zIndex)-1e3)};class Jm extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=rt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Bh;class Aw extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,Bh,null)}render(){this.container.classList.add("lineAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),a=f(this,Bh,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),a.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),a.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),a.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Bh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Bh=new WeakMap;var Hh;class _w extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,Hh,null)}render(){this.container.classList.add("squareAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),a=e.borderStyle.width,o=f(this,Hh,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",i-a),o.setAttribute("height",s-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Hh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Hh=new WeakMap;var $h;class Iw extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,$h,null)}render(){this.container.classList.add("circleAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),a=e.borderStyle.width,o=f(this,$h,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",i/2),o.setAttribute("cy",s/2),o.setAttribute("rx",i/2-a/2),o.setAttribute("ry",s/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,$h)}addHighlightArea(){this.container.classList.add("highlightArea")}}$h=new WeakMap;var zh;class Zm extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,zh,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:i,borderStyle:s,popupRef:n},width:a,height:o}=this;if(!i)return this.container;const h=this.svgFactory.create(a,o,!0);let c=[];for(let u=0,p=i.length;u<p;u+=2){const m=i[u]-e[0],v=e[3]-i[u+1];c.push(`${m},${v}`)}c=c.join(" ");const d=f(this,zh,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),h.append(d),this.container.append(h),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,zh)}addHighlightArea(){this.container.classList.add("highlightArea")}}zh=new WeakMap;class Sw extends Zm{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Ew extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var jh,sa,Uh,Ku;class Lf extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,Uh);g(this,jh,null);g(this,sa,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?rt.HIGHLIGHT:rt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:i,inkLists:s,borderStyle:n,popupRef:a}}=this,{transform:o,width:h,height:c}=b(this,Uh,Ku).call(this,i,e),d=this.svgFactory.create(h,c,!0),u=f(this,jh,this.svgFactory.createElement("svg:g"));d.append(u),u.setAttribute("stroke-width",n.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let p=0,m=s.length;p<m;p++){const v=this.svgFactory.createElement(this.svgElementName);r(this,sa).push(v),v.setAttribute("points",s[p].join(",")),u.append(v)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:i,points:s,rect:n}=e,a=r(this,jh);if(i>=0&&a.setAttribute("stroke-width",i||1),s)for(let o=0,h=r(this,sa).length;o<h;o++)r(this,sa)[o].setAttribute("points",s[o].join(","));if(n){const{transform:o,width:h,height:c}=b(this,Uh,Ku).call(this,this.data.rotation,n);a.parentElement.setAttribute("viewBox",`0 0 ${h} ${c}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return r(this,sa)}addHighlightArea(){this.container.classList.add("highlightArea")}}jh=new WeakMap,sa=new WeakMap,Uh=new WeakSet,Ku=function(e,i){switch(e){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}};class tg extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=rt.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class xw extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class Cw extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class kw extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class eg extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=rt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Vh,Kh,Gu;class Tw extends qt{constructor(e){var s;super(e,{isRenderable:!0});g(this,Kh);g(this,Vh,null);const{file:i}=this.data;this.filename=i.filename,this.content=i.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:i}=this;let s;i.hasAppearance||i.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(i.name)?"paperclip":"pushpin"}.svg`,i.fillAlpha&&i.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(i.fillAlpha*100)}%);`)),s.addEventListener("dblclick",b(this,Kh,Gu).bind(this)),f(this,Vh,s);const{isMac:n}=xe.platform;return e.addEventListener("keydown",a=>{a.key==="Enter"&&(n?a.metaKey:a.ctrlKey)&&b(this,Kh,Gu).call(this)}),!i.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),e.append(s),e}getElementsToTriggerPopup(){return r(this,Vh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Vh=new WeakMap,Kh=new WeakSet,Gu=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var Gh,na,Gn,Wh,ur,qu,Xu;const Bf=class Bf{constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:a,structTreeLayer:o}){g(this,ur);g(this,Gh,null);g(this,na,null);g(this,Gn,new Map);g(this,Wh,null);this.div=t,f(this,Gh,e),f(this,na,i),f(this,Wh,o||null),this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return r(this,Gn).size>0}async render(t){var a;const{annotations:e}=t,i=this.div;Ca(i,this.viewport);const s=new Map,n={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new fd,annotationStorage:t.annotationStorage||new Cf,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const o of e){if(o.noHTML)continue;const h=o.annotationType===Yt.POPUP;if(h){const u=s.get(o.id);if(!u)continue;n.elements=u}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;n.data=o;const c=mp.create(n);if(!c.isRenderable)continue;if(!h&&o.popupRef){const u=s.get(o.popupRef);u?u.push(c):s.set(o.popupRef,[c])}const d=c.render();o.hidden&&(d.style.visibility="hidden"),await b(this,ur,qu).call(this,d,o.id,n.elements),c._isEditable&&(r(this,Gn).set(c.data.id,c),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(c))}b(this,ur,Xu).call(this)}async addLinkAnnotations(t,e){const i={data:null,layer:this.div,linkService:e,svgFactory:new fd,parent:this};for(const s of t){s.borderStyle||(s.borderStyle=Bf._defaultBorderStyle),i.data=s;const n=mp.create(i);if(!n.isRenderable)continue;const a=n.render();await b(this,ur,qu).call(this,a,s.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,Ca(e,{rotation:t.rotation}),b(this,ur,Xu).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(r(this,Gn).values())}getEditableAnnotation(t){return r(this,Gn).get(t)}static get _defaultBorderStyle(){return ut(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Fa.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Gh=new WeakMap,na=new WeakMap,Gn=new WeakMap,Wh=new WeakMap,ur=new WeakSet,qu=async function(t,e,i){var o,h;const s=t.firstChild||t,n=s.id=`${Sf}${e}`,a=await((o=r(this,Wh))==null?void 0:o.getAriaAttributes(n));if(a)for(const[c,d]of a)s.setAttribute(c,d);i?i.at(-1).container.after(t):(this.div.append(t),(h=r(this,Gh))==null||h.moveElementInDOM(this.div,t,s,!1))},Xu=function(){var e;if(!r(this,na))return;const t=this.div;for(const[i,s]of r(this,na)){const n=t.querySelector(`[data-annotation-id="${i}"]`);if(!n)continue;s.className="annotationContent";const{firstChild:a}=n;a?a.nodeName==="CANVAS"?a.replaceWith(s):a.classList.contains("annotationContent")?a.after(s):a.before(s):n.append(s);const o=r(this,Gn).get(i);o&&(o._hasNoCanvas?((e=this._annotationEditorUIManager)==null||e.setMissingCanvas(i,n.id,s),o._hasNoCanvas=!1):o.canvas=s)}r(this,na).clear()};let Wu=Bf;const Ec=/\r\n?|\n/g;var Si,si,qh,ra,ni,ee,ig,sg,ng,Gc,un,Wc,qc,rg,Qu,ag;const Ft=class Ft extends Ot{constructor(e){super({...e,name:"freeTextEditor"});g(this,ee);g(this,Si);g(this,si,"");g(this,qh,`${this.id}-editor`);g(this,ra,null);g(this,ni);D(this,"_colorPicker",null);f(this,Si,e.color||Ft._defaultColor||Ot._defaultLineColor),f(this,ni,e.fontSize||Ft._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const e=Ft.prototype,i=a=>a.isEmpty(),s=ka.TRANSLATE_SMALL,n=ka.TRANSLATE_BIG;return ut(this,"_keyboardManager",new mc([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[s,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:i}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,s],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:i}]]))}static initialize(e,i){Ot.initialize(e,i);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,i){switch(e){case mt.FREETEXT_SIZE:Ft._defaultFontSize=i;break;case mt.FREETEXT_COLOR:Ft._defaultColor=i;break}}updateParams(e,i){switch(e){case mt.FREETEXT_SIZE:b(this,ee,ig).call(this,i);break;case mt.FREETEXT_COLOR:b(this,ee,sg).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[mt.FREETEXT_SIZE,Ft._defaultFontSize],[mt.FREETEXT_COLOR,Ft._defaultColor||Ot._defaultLineColor]]}get propertiesToUpdate(){return[[mt.FREETEXT_SIZE,r(this,ni)],[mt.FREETEXT_COLOR,r(this,Si)]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new ud(this)),[["colorPicker",this._colorPicker]]}get colorType(){return mt.FREETEXT_COLOR}get colorValue(){return r(this,Si)}_translateEmpty(e,i){this._uiManager.translateSelectedEditors(e,i,!0)}getInitialTranslation(){const e=this.parentScale;return[-Ft._internalPadding*e,-(Ft._internalPadding+r(this,ni))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),f(this,ra,new AbortController);const e=this._uiManager.combinedSignal(r(this,ra));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){var e;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",r(this,qh)),this._isDraggable=!0,(e=r(this,ra))==null||e.abort(),f(this,ra,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var i;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(i=this._initialOptions)!=null&&i.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=r(this,si),i=f(this,si,b(this,ee,ng).call(this).trimEnd());if(e===i)return;const s=n=>{if(f(this,si,n),!n){this.remove();return}b(this,ee,qc).call(this),this._uiManager.rebuild(this),b(this,ee,Gc).call(this)};this.addCommands({cmd:()=>{s(i)},undo:()=>{s(e)},mustExec:!1}),b(this,ee,Gc).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){Ft._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,i;(this._isCopy||this.annotationElementId)&&(e=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",r(this,qh)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${r(this,ni)}px * var(--total-scale-factor))`,s.color=r(this,Si),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[h,c]=this.getInitialTranslation();[h,c]=this.pageTranslationToScreen(h,c);const[d,u]=this.pageDimensions,[p,m]=this.pageTranslation;let v,y;switch(this.rotation){case 0:v=e+(o[0]-p)/d,y=i+this.height-(o[1]-m)/u;break;case 90:v=e+(o[0]-p)/d,y=i-(o[1]-m)/u,[h,c]=[c,-h];break;case 180:v=e-this.width+(o[0]-p)/d,y=i-(o[1]-m)/u,[h,c]=[-h,-c];break;case 270:v=e+(o[0]-p-this.height*u)/d,y=i+(o[1]-m-this.width*d)/u,[h,c]=[-c,h];break}this.setAt(v*n,y*a,h,c)}else this._moveAfterPaste(e,i);b(this,ee,qc).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var v,y,w;const i=e.clipboardData||window.clipboardData,{types:s}=i;if(s.length===1&&s[0]==="text/plain")return;e.preventDefault();const n=b(v=Ft,un,Qu).call(v,i.getData("text")||"").replaceAll(Ec,`
`);if(!n)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:h,startOffset:c}=o,d=[],u=[];if(h.nodeType===Node.TEXT_NODE){const A=h.parentElement;if(u.push(h.nodeValue.slice(c).replaceAll(Ec,"")),A!==this.editorDiv){let x=d;for(const I of this.editorDiv.childNodes){if(I===A){x=u;continue}x.push(b(y=Ft,un,Wc).call(y,I))}}d.push(h.nodeValue.slice(0,c).replaceAll(Ec,""))}else if(h===this.editorDiv){let A=d,x=0;for(const I of this.editorDiv.childNodes)x++===c&&(A=u),A.push(b(w=Ft,un,Wc).call(w,I))}f(this,si,`${d.join(`
`)}${n}${u.join(`
`)}`),b(this,ee,qc).call(this);const p=new Range;let m=Math.sumPrecise(d.map(A=>A.length));for(const{firstChild:A}of this.editorDiv.childNodes)if(A.nodeType===Node.TEXT_NODE){const x=A.nodeValue.length;if(m<=x){p.setStart(A,m),p.setEnd(A,m);break}m-=x}a.removeAllRanges(),a.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(e,i,s){var o;let n=null;if(e instanceof Jm){const{data:{defaultAppearanceData:{fontSize:h,fontColor:c},rect:d,rotation:u,id:p,popupRef:m,contentsObj:v},textContent:y,textPosition:w,parent:{page:{pageNumber:A}}}=e;if(!y||y.length===0)return null;n=e={annotationType:rt.FREETEXT,color:Array.from(c),fontSize:h,value:y.join(`
`),position:w,pageIndex:A-1,rect:d.slice(0),rotation:u,annotationElementId:p,id:p,deleted:!1,popupRef:m,comment:(v==null?void 0:v.str)||null}}const a=await super.deserialize(e,i,s);return f(a,ni,e.fontSize),f(a,Si,Y.makeHexColor(...e.color)),f(a,si,b(o=Ft,un,Qu).call(o,e.value)),a._initialData=n,e.comment&&a.setCommentData(e.comment),a}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Ft._internalPadding*this.parentScale,s=this.getRect(i,i),n=Ot._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:r(this,Si)),a={annotationType:rt.FREETEXT,color:n,fontSize:r(this,ni),value:b(this,ee,rg).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(a),e?(a.isCopy=!0,a):this.annotationElementId&&!b(this,ee,ag).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(e){const i=super.renderAnnotationElement(e),{style:s}=i;s.fontSize=`calc(${r(this,ni)}px * var(--total-scale-factor))`,s.color=r(this,Si),i.replaceChildren();for(const o of r(this,si).split(`
`)){const h=document.createElement("div");h.append(o?document.createTextNode(o):document.createElement("br")),i.append(h)}const n=Ft._internalPadding*this.parentScale,a={rect:this.getRect(n,n)};return a.popup=this.hasEditedComment?this.comment:{text:r(this,si)},e.updateEdited(a),i}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};Si=new WeakMap,si=new WeakMap,qh=new WeakMap,ra=new WeakMap,ni=new WeakMap,ee=new WeakSet,ig=function(e){const i=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-r(this,ni))*this.parentScale),f(this,ni,n),b(this,ee,Gc).call(this)},s=r(this,ni);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:mt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},sg=function(e){const i=n=>{var a;f(this,Si,this.editorDiv.style.color=n),(a=this._colorPicker)==null||a.update(n)},s=r(this,Si);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:mt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ng=function(){var s;const e=[];this.editorDiv.normalize();let i=null;for(const n of this.editorDiv.childNodes)(i==null?void 0:i.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(b(s=Ft,un,Wc).call(s,n)),i=n);return e.join(`
`)},Gc=function(){const[e,i]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:n,div:a}=this,o=a.style.display,h=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",n.div.append(this.div),s=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",h)}this.rotation%180===this.parentRotation%180?(this.width=s.width/e,this.height=s.height/i):(this.width=s.height/e,this.height=s.width/i),this.fixAndSetPosition()},un=new WeakSet,Wc=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Ec,"")},qc=function(){if(this.editorDiv.replaceChildren(),!!r(this,si))for(const e of r(this,si).split(`
`)){const i=document.createElement("div");i.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(i)}},rg=function(){return r(this,si).replaceAll(" "," ")},Qu=function(e){return e.replaceAll(" "," ")},ag=function(e){const{value:i,fontSize:s,color:n,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==i||e.fontSize!==s||e.color.some((o,h)=>o!==n[h])||e.pageIndex!==a},g(Ft,un),D(Ft,"_freeTextDefaultContent",""),D(Ft,"_internalPadding",0),D(Ft,"_defaultColor",null),D(Ft,"_defaultFontSize",10),D(Ft,"_type","freetext"),D(Ft,"_editorType",rt.FREETEXT);let Yu=Ft;class U{toSVGPath(){Pt("Abstract method `toSVGPath` must be implemented.")}get box(){Pt("Abstract getter `box` must be implemented.")}serialize(t,e){Pt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,i,s,n,a){a||(a=new Float32Array(t.length));for(let o=0,h=t.length;o<h;o+=2)a[o]=e+t[o]*s,a[o+1]=i+t[o+1]*n;return a}static _rescaleAndSwap(t,e,i,s,n,a){a||(a=new Float32Array(t.length));for(let o=0,h=t.length;o<h;o+=2)a[o]=e+t[o+1]*s,a[o+1]=i+t[o]*n;return a}static _translate(t,e,i,s){s||(s=new Float32Array(t.length));for(let n=0,a=t.length;n<a;n+=2)s[n]=e+t[n],s[n+1]=i+t[n+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,i,s,n){switch(n){case 90:return[1-e/i,t/s];case 180:return[1-t/i,1-e/s];case 270:return[e/i,1-t/s];default:return[t/i,e/s]}}static _normalizePagePoint(t,e,i){switch(i){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,i,s,n,a){return[(t+5*i)/6,(e+5*s)/6,(5*i+n)/6,(5*s+a)/6,(i+n)/2,(s+a)/2]}}D(U,"PRECISION",1e-4);var ri,ji,Ho,$o,ps,dt,aa,oa,Xh,Yh,zo,jo,Wn,Qh,Ld,Rd,ae,El,og,lg,hg,cg,dg,ug;const Ps=class Ps{constructor({x:t,y:e},i,s,n,a,o=0){g(this,ae);g(this,ri);g(this,ji,[]);g(this,Ho);g(this,$o);g(this,ps,[]);g(this,dt,new Float32Array(18));g(this,aa);g(this,oa);g(this,Xh);g(this,Yh);g(this,zo);g(this,jo);g(this,Wn,[]);f(this,ri,i),f(this,jo,n*s),f(this,$o,a),r(this,dt).set([NaN,NaN,NaN,NaN,t,e],6),f(this,Ho,o),f(this,Yh,r(Ps,Qh)*s),f(this,Xh,r(Ps,Rd)*s),f(this,zo,s),r(this,Wn).push(t,e)}isEmpty(){return isNaN(r(this,dt)[8])}add({x:t,y:e}){var S;f(this,aa,t),f(this,oa,e);const[i,s,n,a]=r(this,ri);let[o,h,c,d]=r(this,dt).subarray(8,12);const u=t-c,p=e-d,m=Math.hypot(u,p);if(m<r(this,Xh))return!1;const v=m-r(this,Yh),y=v/m,w=y*u,A=y*p;let x=o,I=h;o=c,h=d,c+=w,d+=A,(S=r(this,Wn))==null||S.push(t,e);const E=-A/v,C=w/v,P=E*r(this,jo),k=C*r(this,jo);return r(this,dt).set(r(this,dt).subarray(2,8),0),r(this,dt).set([c+P,d+k],4),r(this,dt).set(r(this,dt).subarray(14,18),12),r(this,dt).set([c-P,d-k],16),isNaN(r(this,dt)[6])?(r(this,ps).length===0&&(r(this,dt).set([o+P,h+k],2),r(this,ps).push(NaN,NaN,NaN,NaN,(o+P-i)/n,(h+k-s)/a),r(this,dt).set([o-P,h-k],14),r(this,ji).push(NaN,NaN,NaN,NaN,(o-P-i)/n,(h-k-s)/a)),r(this,dt).set([x,I,o,h,c,d],6),!this.isEmpty()):(r(this,dt).set([x,I,o,h,c,d],6),Math.abs(Math.atan2(I-h,x-o)-Math.atan2(A,w))<Math.PI/2?([o,h,c,d]=r(this,dt).subarray(2,6),r(this,ps).push(NaN,NaN,NaN,NaN,((o+c)/2-i)/n,((h+d)/2-s)/a),[o,h,x,I]=r(this,dt).subarray(14,18),r(this,ji).push(NaN,NaN,NaN,NaN,((x+o)/2-i)/n,((I+h)/2-s)/a),!0):([x,I,o,h,c,d]=r(this,dt).subarray(0,6),r(this,ps).push(((x+5*o)/6-i)/n,((I+5*h)/6-s)/a,((5*o+c)/6-i)/n,((5*h+d)/6-s)/a,((o+c)/2-i)/n,((h+d)/2-s)/a),[c,d,o,h,x,I]=r(this,dt).subarray(12,18),r(this,ji).push(((x+5*o)/6-i)/n,((I+5*h)/6-s)/a,((5*o+c)/6-i)/n,((5*h+d)/6-s)/a,((o+c)/2-i)/n,((h+d)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const t=r(this,ps),e=r(this,ji);if(isNaN(r(this,dt)[6])&&!this.isEmpty())return b(this,ae,og).call(this);const i=[];i.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);b(this,ae,hg).call(this,i);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return b(this,ae,lg).call(this,i),i.join(" ")}newFreeDrawOutline(t,e,i,s,n,a){return new fg(t,e,i,s,n,a)}getOutlines(){var u;const t=r(this,ps),e=r(this,ji),i=r(this,dt),[s,n,a,o]=r(this,ri),h=new Float32Array((((u=r(this,Wn))==null?void 0:u.length)??0)+2);for(let p=0,m=h.length-2;p<m;p+=2)h[p]=(r(this,Wn)[p]-s)/a,h[p+1]=(r(this,Wn)[p+1]-n)/o;if(h[h.length-2]=(r(this,aa)-s)/a,h[h.length-1]=(r(this,oa)-n)/o,isNaN(i[6])&&!this.isEmpty())return b(this,ae,cg).call(this,h);const c=new Float32Array(r(this,ps).length+24+r(this,ji).length);let d=t.length;for(let p=0;p<d;p+=2){if(isNaN(t[p])){c[p]=c[p+1]=NaN;continue}c[p]=t[p],c[p+1]=t[p+1]}d=b(this,ae,ug).call(this,c,d);for(let p=e.length-6;p>=6;p-=6)for(let m=0;m<6;m+=2){if(isNaN(e[p+m])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=e[p+m],c[d+1]=e[p+m+1],d+=2}return b(this,ae,dg).call(this,c,d),this.newFreeDrawOutline(c,h,r(this,ri),r(this,zo),r(this,Ho),r(this,$o))}};ri=new WeakMap,ji=new WeakMap,Ho=new WeakMap,$o=new WeakMap,ps=new WeakMap,dt=new WeakMap,aa=new WeakMap,oa=new WeakMap,Xh=new WeakMap,Yh=new WeakMap,zo=new WeakMap,jo=new WeakMap,Wn=new WeakMap,Qh=new WeakMap,Ld=new WeakMap,Rd=new WeakMap,ae=new WeakSet,El=function(){const t=r(this,dt).subarray(4,6),e=r(this,dt).subarray(16,18),[i,s,n,a]=r(this,ri);return[(r(this,aa)+(t[0]-e[0])/2-i)/n,(r(this,oa)+(t[1]-e[1])/2-s)/a,(r(this,aa)+(e[0]-t[0])/2-i)/n,(r(this,oa)+(e[1]-t[1])/2-s)/a]},og=function(){const[t,e,i,s]=r(this,ri),[n,a,o,h]=b(this,ae,El).call(this);return`M${(r(this,dt)[2]-t)/i} ${(r(this,dt)[3]-e)/s} L${(r(this,dt)[4]-t)/i} ${(r(this,dt)[5]-e)/s} L${n} ${a} L${o} ${h} L${(r(this,dt)[16]-t)/i} ${(r(this,dt)[17]-e)/s} L${(r(this,dt)[14]-t)/i} ${(r(this,dt)[15]-e)/s} Z`},lg=function(t){const e=r(this,ji);t.push(`L${e[4]} ${e[5]} Z`)},hg=function(t){const[e,i,s,n]=r(this,ri),a=r(this,dt).subarray(4,6),o=r(this,dt).subarray(16,18),[h,c,d,u]=b(this,ae,El).call(this);t.push(`L${(a[0]-e)/s} ${(a[1]-i)/n} L${h} ${c} L${d} ${u} L${(o[0]-e)/s} ${(o[1]-i)/n}`)},cg=function(t){const e=r(this,dt),[i,s,n,a]=r(this,ri),[o,h,c,d]=b(this,ae,El).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(e[2]-i)/n,(e[3]-s)/a,NaN,NaN,NaN,NaN,(e[4]-i)/n,(e[5]-s)/a,NaN,NaN,NaN,NaN,o,h,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(e[16]-i)/n,(e[17]-s)/a,NaN,NaN,NaN,NaN,(e[14]-i)/n,(e[15]-s)/a],0),this.newFreeDrawOutline(u,t,r(this,ri),r(this,zo),r(this,Ho),r(this,$o))},dg=function(t,e){const i=r(this,ji);return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6},ug=function(t,e){const i=r(this,dt).subarray(4,6),s=r(this,dt).subarray(16,18),[n,a,o,h]=r(this,ri),[c,d,u,p]=b(this,ae,El).call(this);return t.set([NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/h,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/h],e),e+=24},g(Ps,Qh,8),g(Ps,Ld,2),g(Ps,Rd,r(Ps,Qh)+r(Ps,Ld));let pd=Ps;var Uo,la,en,Jh,ai,Zh,Wt,Md,pg;class fg extends U{constructor(e,i,s,n,a,o){super();g(this,Md);g(this,Uo);g(this,la,new Float32Array(4));g(this,en);g(this,Jh);g(this,ai);g(this,Zh);g(this,Wt);f(this,Wt,e),f(this,ai,i),f(this,Uo,s),f(this,Zh,n),f(this,en,a),f(this,Jh,o),this.lastPoint=[NaN,NaN],b(this,Md,pg).call(this,o);const[h,c,d,u]=r(this,la);for(let p=0,m=e.length;p<m;p+=2)e[p]=(e[p]-h)/d,e[p+1]=(e[p+1]-c)/u;for(let p=0,m=i.length;p<m;p+=2)i[p]=(i[p]-h)/d,i[p+1]=(i[p+1]-c)/u}toSVGPath(){const e=[`M${r(this,Wt)[4]} ${r(this,Wt)[5]}`];for(let i=6,s=r(this,Wt).length;i<s;i+=6){if(isNaN(r(this,Wt)[i])){e.push(`L${r(this,Wt)[i+4]} ${r(this,Wt)[i+5]}`);continue}e.push(`C${r(this,Wt)[i]} ${r(this,Wt)[i+1]} ${r(this,Wt)[i+2]} ${r(this,Wt)[i+3]} ${r(this,Wt)[i+4]} ${r(this,Wt)[i+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,i,s,n],a){const o=s-e,h=n-i;let c,d;switch(a){case 0:c=U._rescale(r(this,Wt),e,n,o,-h),d=U._rescale(r(this,ai),e,n,o,-h);break;case 90:c=U._rescaleAndSwap(r(this,Wt),e,i,o,h),d=U._rescaleAndSwap(r(this,ai),e,i,o,h);break;case 180:c=U._rescale(r(this,Wt),s,i,-o,h),d=U._rescale(r(this,ai),s,i,-o,h);break;case 270:c=U._rescaleAndSwap(r(this,Wt),s,n,-o,-h),d=U._rescaleAndSwap(r(this,ai),s,n,-o,-h);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return r(this,la)}newOutliner(e,i,s,n,a,o=0){return new pd(e,i,s,n,a,o)}getNewOutline(e,i){const[s,n,a,o]=r(this,la),[h,c,d,u]=r(this,Uo),p=a*d,m=o*u,v=s*d+h,y=n*u+c,w=this.newOutliner({x:r(this,ai)[0]*p+v,y:r(this,ai)[1]*m+y},r(this,Uo),r(this,Zh),e,r(this,Jh),i??r(this,en));for(let A=2;A<r(this,ai).length;A+=2)w.add({x:r(this,ai)[A]*p+v,y:r(this,ai)[A+1]*m+y});return w.getOutlines()}}Uo=new WeakMap,la=new WeakMap,en=new WeakMap,Jh=new WeakMap,ai=new WeakMap,Zh=new WeakMap,Wt=new WeakMap,Md=new WeakSet,pg=function(e){const i=r(this,Wt);let s=i[4],n=i[5];const a=[s,n,s,n];let o=s,h=n;const c=e?Math.max:Math.min;for(let u=6,p=i.length;u<p;u+=6){const m=i[u+4],v=i[u+5];if(isNaN(i[u]))Y.pointBoundingBox(m,v,a),h<v?(o=m,h=v):h===v&&(o=c(o,m));else{const y=[1/0,1/0,-1/0,-1/0];Y.bezierBoundingBox(s,n,...i.slice(u,u+6),y),Y.rectBoundingBox(...y,a),h<y[3]?(o=y[2],h=y[3]):h===y[3]&&(o=c(o,y[2]))}s=m,n=v}const d=r(this,la);d[0]=a[0]-r(this,en),d[1]=a[1]-r(this,en),d[2]=a[2]-a[0]+2*r(this,en),d[3]=a[3]-a[1]+2*r(this,en),this.lastPoint=[o,h]};var tc,ec,qn,Ui,je,mg,Xc,gg,bg,Zu;class Ju{constructor(t,e=0,i=0,s=!0){g(this,je);g(this,tc);g(this,ec);g(this,qn,[]);g(this,Ui,[]);const n=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:m,y:v,width:y,height:w}of t){const A=Math.floor((m-e)/a)*a,x=Math.ceil((m+y+e)/a)*a,I=Math.floor((v-e)/a)*a,E=Math.ceil((v+w+e)/a)*a,C=[A,I,E,!0],P=[x,I,E,!1];r(this,qn).push(C,P),Y.rectBoundingBox(A,I,x,E,n)}const o=n[2]-n[0]+2*i,h=n[3]-n[1]+2*i,c=n[0]-i,d=n[1]-i,u=r(this,qn).at(s?-1:-2),p=[u[0],u[2]];for(const m of r(this,qn)){const[v,y,w]=m;m[0]=(v-c)/o,m[1]=(y-d)/h,m[2]=(w-d)/h}f(this,tc,new Float32Array([c,d,o,h])),f(this,ec,p)}getOutlines(){r(this,qn).sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of r(this,qn))e[3]?(t.push(...b(this,je,Zu).call(this,e)),b(this,je,gg).call(this,e)):(b(this,je,bg).call(this,e),t.push(...b(this,je,Zu).call(this,e)));return b(this,je,mg).call(this,t)}}tc=new WeakMap,ec=new WeakMap,qn=new WeakMap,Ui=new WeakMap,je=new WeakSet,mg=function(t){const e=[],i=new Set;for(const a of t){const[o,h,c]=a;e.push([o,h,a],[o,c,a])}e.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=e.length;a<o;a+=2){const h=e[a][2],c=e[a+1][2];h.push(c),c.push(h),i.add(h),i.add(c)}const s=[];let n;for(;i.size>0;){const a=i.values().next().value;let[o,h,c,d,u]=a;i.delete(a);let p=o,m=h;for(n=[o,c],s.push(n);;){let v;if(i.has(d))v=d;else if(i.has(u))v=u;else break;i.delete(v),[o,h,c,d,u]=v,p!==o&&(n.push(p,m,o,m===h?h:c),p=o),m=m===h?c:h}n.push(p,m)}return new Pw(s,r(this,tc),r(this,ec))},Xc=function(t){const e=r(this,Ui);let i=0,s=e.length-1;for(;i<=s;){const n=i+s>>1,a=e[n][0];if(a===t)return n;a<t?i=n+1:s=n-1}return s+1},gg=function([,t,e]){const i=b(this,je,Xc).call(this,t);r(this,Ui).splice(i,0,[t,e])},bg=function([,t,e]){const i=b(this,je,Xc).call(this,t);for(let s=i;s<r(this,Ui).length;s++){const[n,a]=r(this,Ui)[s];if(n!==t)break;if(n===t&&a===e){r(this,Ui).splice(s,1);return}}for(let s=i-1;s>=0;s--){const[n,a]=r(this,Ui)[s];if(n!==t)break;if(n===t&&a===e){r(this,Ui).splice(s,1);return}}},Zu=function(t){const[e,i,s]=t,n=[[e,i,s]],a=b(this,je,Xc).call(this,s);for(let o=0;o<a;o++){const[h,c]=r(this,Ui)[o];for(let d=0,u=n.length;d<u;d++){const[,p,m]=n[d];if(!(c<=p||m<=h)){if(p>=h){if(m>c)n[d][1]=c;else{if(u===1)return[];n.splice(d,1),d--,u--}continue}n[d][2]=h,m>c&&n.push([e,c,m])}}}return n};var ic,Vo;class Pw extends U{constructor(e,i,s){super();g(this,ic);g(this,Vo);f(this,Vo,e),f(this,ic,i),this.lastPoint=s}toSVGPath(){const e=[];for(const i of r(this,Vo)){let[s,n]=i;e.push(`M${s} ${n}`);for(let a=2;a<i.length;a+=2){const o=i[a],h=i[a+1];o===s?(e.push(`V${h}`),n=h):h===n&&(e.push(`H${o}`),s=o)}e.push("Z")}return e.join(" ")}serialize([e,i,s,n],a){const o=[],h=s-e,c=n-i;for(const d of r(this,Vo)){const u=new Array(d.length);for(let p=0;p<d.length;p+=2)u[p]=e+d[p]*h,u[p+1]=n-d[p+1]*c;o.push(u)}return o}get box(){return r(this,ic)}get classNamesForOutlining(){return["highlightOutline"]}}ic=new WeakMap,Vo=new WeakMap;class tf extends pd{newFreeDrawOutline(t,e,i,s,n,a){return new Lw(t,e,i,s,n,a)}}class Lw extends fg{newOutliner(t,e,i,s,n,a=0){return new tf(t,e,i,s,n,a)}}var Ko,sc,sn,ha,nc,qe,rc,ac,ca,Ei,oi,ve,Go,nn,Re,Wo,xi,oc,ot,ef,Yc,yg,vg,wg,sf,mr,Ti,za,Ag,Qc,xl,_g,Ig,Sg,Eg,xg;const _t=class _t extends Ot{constructor(e){super({...e,name:"highlightEditor"});g(this,ot);g(this,Ko,null);g(this,sc,0);g(this,sn);g(this,ha,null);g(this,nc,null);g(this,qe,null);g(this,rc,null);g(this,ac,0);g(this,ca,null);g(this,Ei,null);g(this,oi,null);g(this,ve,!1);g(this,Go,null);g(this,nn);g(this,Re,null);g(this,Wo,"");g(this,xi);g(this,oc,"");this.color=e.color||_t._defaultColor,f(this,xi,e.thickness||_t._defaultThickness),f(this,nn,e.opacity||_t._defaultOpacity),f(this,sn,e.boxes||null),f(this,oc,e.methodOfCreation||""),f(this,Wo,e.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(f(this,ve,!0),b(this,ot,Yc).call(this,e),b(this,ot,mr).call(this)):r(this,sn)&&(f(this,Ko,e.anchorNode),f(this,sc,e.anchorOffset),f(this,rc,e.focusNode),f(this,ac,e.focusOffset),b(this,ot,ef).call(this),b(this,ot,mr).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const e=_t.prototype;return ut(this,"_keyboardManager",new mc([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:r(this,ve)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:r(this,xi),methodOfCreation:r(this,oc)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,i){var s;Ot.initialize(e,i),_t._defaultColor||(_t._defaultColor=((s=i.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(e,i){switch(e){case mt.HIGHLIGHT_COLOR:_t._defaultColor=i;break;case mt.HIGHLIGHT_THICKNESS:_t._defaultThickness=i;break}}translateInPage(e,i){}get toolbarPosition(){return r(this,Go)}updateParams(e,i){switch(e){case mt.HIGHLIGHT_COLOR:b(this,ot,yg).call(this,i);break;case mt.HIGHLIGHT_THICKNESS:b(this,ot,vg).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[mt.HIGHLIGHT_COLOR,_t._defaultColor],[mt.HIGHLIGHT_THICKNESS,_t._defaultThickness]]}get propertiesToUpdate(){return[[mt.HIGHLIGHT_COLOR,this.color||_t._defaultColor],[mt.HIGHLIGHT_THICKNESS,r(this,xi)||_t._defaultThickness],[mt.HIGHLIGHT_FREE,r(this,ve)]]}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",f(this,nc,new dd({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(b(this,ot,xl).call(this))}getBaseTranslation(){return[0,0]}getRect(e,i){return super.getRect(e,i,b(this,ot,xl).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){b(this,ot,sf).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(b(this,ot,mr).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let i=!1;this.parent&&!e?b(this,ot,sf).call(this):e&&(b(this,ot,mr).call(this,e),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),i&&this.select()}rotate(e){var n,a,o;const{drawLayer:i}=this.parent;let s;r(this,ve)?(e=(e-this.rotation+360)%360,s=b(n=_t,Ti,za).call(n,r(this,Ei).box,e)):s=b(a=_t,Ti,za).call(a,[this.x,this.y,this.width,this.height],e),i.updateProperties(r(this,oi),{bbox:s,root:{"data-main-rotation":e}}),i.updateProperties(r(this,Re),{bbox:b(o=_t,Ti,za).call(o,r(this,qe).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();r(this,Wo)&&(e.setAttribute("aria-label",r(this,Wo)),e.setAttribute("role","mark")),r(this,ve)?e.classList.add("free"):this.div.addEventListener("keydown",b(this,ot,Ag).bind(this),{signal:this._uiManager._signal});const i=f(this,ca,document.createElement("div"));e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=r(this,ha);const[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),Gp(this,r(this,ca),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(r(this,Re),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(r(this,Re),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:b(this,ot,Qc).call(this,!0);break;case 1:case 3:b(this,ot,Qc).call(this,!1);break}}select(){var e;super.select(),r(this,Re)&&((e=this.parent)==null||e.drawLayer.updateProperties(r(this,Re),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),r(this,Re)&&((e=this.parent)==null||e.drawLayer.updateProperties(r(this,Re),{rootClass:{selected:!1}}),r(this,ve)||b(this,ot,Qc).call(this,!1))}get _mustFixPosition(){return!r(this,ve)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(r(this,oi),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(r(this,Re),{rootClass:{hidden:!e}}))}static startHighlighting(e,i,{target:s,x:n,y:a}){const{x:o,y:h,width:c,height:d}=s.getBoundingClientRect(),u=new AbortController,p=e.combinedSignal(u),m=v=>{u.abort(),b(this,Ti,Eg).call(this,e,v)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",Jt,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Mi,{signal:p}),s.addEventListener("pointermove",b(this,Ti,Sg).bind(this,e),{signal:p}),this._freeHighlight=new tf({x:n,y:a},[o,h,c,d],e.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,i,s){var y,w,A,x;let n=null;if(e instanceof tg){const{data:{quadPoints:I,rect:E,rotation:C,id:P,color:k,opacity:_,popupRef:S,contentsObj:T},parent:{page:{pageNumber:L}}}=e;n=e={annotationType:rt.HIGHLIGHT,color:Array.from(k),opacity:_,quadPoints:I,boxes:null,pageIndex:L-1,rect:E.slice(0),rotation:C,annotationElementId:P,id:P,deleted:!1,popupRef:S,comment:(T==null?void 0:T.str)||null}}else if(e instanceof Lf){const{data:{inkLists:I,rect:E,rotation:C,id:P,color:k,borderStyle:{rawWidth:_},popupRef:S,contentsObj:T},parent:{page:{pageNumber:L}}}=e;n=e={annotationType:rt.HIGHLIGHT,color:Array.from(k),thickness:_,inkLists:I,boxes:null,pageIndex:L-1,rect:E.slice(0),rotation:C,annotationElementId:P,id:P,deleted:!1,popupRef:S,comment:(T==null?void 0:T.str)||null}}const{color:a,quadPoints:o,inkLists:h,opacity:c}=e,d=await super.deserialize(e,i,s);d.color=Y.makeHexColor(...a),f(d,nn,c||1),h&&f(d,xi,e.thickness),d._initialData=n,e.comment&&d.setCommentData(e.comment);const[u,p]=d.pageDimensions,[m,v]=d.pageTranslation;if(o){const I=f(d,sn,[]);for(let E=0;E<o.length;E+=8)I.push({x:(o[E]-m)/u,y:1-(o[E+1]-v)/p,width:(o[E+2]-o[E])/u,height:(o[E+1]-o[E+5])/p});b(y=d,ot,ef).call(y),b(w=d,ot,mr).call(w),d.rotate(d.rotation)}else if(h){f(d,ve,!0);const I=h[0],E={x:I[0]-m,y:p-(I[1]-v)},C=new tf(E,[0,0,u,p],1,r(d,xi)/2,!0,.001);for(let _=0,S=I.length;_<S;_+=2)E.x=I[_]-m,E.y=p-(I[_+1]-v),C.add(E);const{id:P,clipPathId:k}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);b(A=d,ot,Yc).call(A,{highlightOutlines:C.getOutlines(),highlightId:P,clipPathId:k}),b(x=d,ot,mr).call(x),d.rotate(d.parentRotation)}return d}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const i=this.getRect(0,0),s=Ot._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n={annotationType:rt.HIGHLIGHT,color:s,opacity:r(this,nn),thickness:r(this,xi),quadPoints:b(this,ot,_g).call(this),outlines:b(this,ot,Ig).call(this,i),pageIndex:this.pageIndex,rect:i,rotation:b(this,ot,xl).call(this),structTreeParentId:this._structTreeParentId};return this.addComment(n),this.annotationElementId&&!b(this,ot,xg).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(e){const i={rect:this.getRect(0,0)};return this.hasEditedComment&&(i.popup=this.comment),e.updateEdited(i),null}static canCreateNewEmptyEditor(){return!1}};Ko=new WeakMap,sc=new WeakMap,sn=new WeakMap,ha=new WeakMap,nc=new WeakMap,qe=new WeakMap,rc=new WeakMap,ac=new WeakMap,ca=new WeakMap,Ei=new WeakMap,oi=new WeakMap,ve=new WeakMap,Go=new WeakMap,nn=new WeakMap,Re=new WeakMap,Wo=new WeakMap,xi=new WeakMap,oc=new WeakMap,ot=new WeakSet,ef=function(){const e=new Ju(r(this,sn),.001);f(this,Ei,e.getOutlines()),[this.x,this.y,this.width,this.height]=r(this,Ei).box;const i=new Ju(r(this,sn),.0025,.001,this._uiManager.direction==="ltr");f(this,qe,i.getOutlines());const{lastPoint:s}=r(this,qe);f(this,Go,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Yc=function({highlightOutlines:e,highlightId:i,clipPathId:s}){var u,p;if(f(this,Ei,e),f(this,qe,e.getNewOutline(r(this,xi)/2+1.5,.0025)),i>=0)f(this,oi,i),f(this,ha,s),this.parent.drawLayer.finalizeDraw(i,{bbox:e.box,path:{d:e.toSVGPath()}}),f(this,Re,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:r(this,qe).box,path:{d:r(this,qe).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(r(this,oi),{bbox:b(u=_t,Ti,za).call(u,r(this,Ei).box,(m-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(r(this,Re),{bbox:b(p=_t,Ti,za).call(p,r(this,qe).box,m),path:{d:r(this,qe).toSVGPath()}})}const[a,o,h,c]=e.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=h,this.height=c;break;case 90:{const[m,v]=this.parentDimensions;this.x=o,this.y=1-a,this.width=h*v/m,this.height=c*m/v;break}case 180:this.x=1-a,this.y=1-o,this.width=h,this.height=c;break;case 270:{const[m,v]=this.parentDimensions;this.x=1-o,this.y=a,this.width=h*v/m,this.height=c*m/v;break}}const{lastPoint:d}=r(this,qe);f(this,Go,[(d[0]-a)/h,(d[1]-o)/c])},yg=function(e){const i=(a,o)=>{var h,c;this.color=a,f(this,nn,o),(h=this.parent)==null||h.drawLayer.updateProperties(r(this,oi),{root:{fill:a,"fill-opacity":o}}),(c=r(this,nc))==null||c.updateColor(a)},s=this.color,n=r(this,nn);this.addCommands({cmd:i.bind(this,e,_t._defaultOpacity),undo:i.bind(this,s,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:mt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)},vg=function(e){const i=r(this,xi),s=n=>{f(this,xi,n),b(this,ot,wg).call(this,n)};this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:mt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},wg=function(e){if(!r(this,ve))return;b(this,ot,Yc).call(this,{highlightOutlines:r(this,Ei).getNewOutline(e/2)}),this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)},sf=function(){r(this,oi)===null||!this.parent||(this.parent.drawLayer.remove(r(this,oi)),f(this,oi,null),this.parent.drawLayer.remove(r(this,Re)),f(this,Re,null))},mr=function(e=this.parent){r(this,oi)===null&&({id:Me(this,oi)._,clipPathId:Me(this,ha)._}=e.drawLayer.draw({bbox:r(this,Ei).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":r(this,nn)},rootClass:{highlight:!0,free:r(this,ve)},path:{d:r(this,Ei).toSVGPath()}},!1,!0),f(this,Re,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:r(this,ve)},bbox:r(this,qe).box,path:{d:r(this,qe).toSVGPath()}},r(this,ve))),r(this,ca)&&(r(this,ca).style.clipPath=r(this,ha)))},Ti=new WeakSet,za=function([e,i,s,n],a){switch(a){case 90:return[1-i-n,e,n,s];case 180:return[1-e-s,1-i-n,s,n];case 270:return[i,1-e-s,n,s]}return[e,i,s,n]},Ag=function(e){_t._keyboardManager.exec(this,e)},Qc=function(e){if(!r(this,Ko))return;const i=window.getSelection();e?i.setPosition(r(this,Ko),r(this,sc)):i.setPosition(r(this,rc),r(this,ac))},xl=function(){return r(this,ve)?this.rotation:0},_g=function(){if(r(this,ve))return null;const[e,i]=this.pageDimensions,[s,n]=this.pageTranslation,a=r(this,sn),o=new Float32Array(a.length*8);let h=0;for(const{x:c,y:d,width:u,height:p}of a){const m=c*e+s,v=(1-d)*i+n;o[h]=o[h+4]=m,o[h+1]=o[h+3]=v,o[h+2]=o[h+6]=m+u*e,o[h+5]=o[h+7]=v-p*i,h+=8}return o},Ig=function(e){return r(this,Ei).serialize(e,b(this,ot,xl).call(this))},Sg=function(e,i){this._freeHighlight.add(i)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Eg=function(e,i){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},xg=function(e){const{color:i}=this._initialData;return this.hasEditedComment||e.color.some((s,n)=>s!==i[n])},g(_t,Ti),D(_t,"_defaultColor",null),D(_t,"_defaultOpacity",1),D(_t,"_defaultThickness",12),D(_t,"_type","highlight"),D(_t,"_editorType",rt.HIGHLIGHT),D(_t,"_freeHighlightId",-1),D(_t,"_freeHighlight",null),D(_t,"_freeHighlightClipId","");let md=_t;var da;class Cg{constructor(){g(this,da,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,i]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,i)}updateSVGProperty(t,e){r(this,da)[t]=e}toSVGProperties(){const t=r(this,da);return f(this,da,Object.create(null)),{root:t}}reset(){f(this,da,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){Pt("Not implemented")}}da=new WeakMap;var li,qo,ce,ua,fa,Xn,Yn,Qn,pa,bt,nf,rf,af,Cl,kg,Jc,kl,ja;const V=class V extends Ot{constructor(e){super(e);g(this,bt);g(this,li,null);g(this,qo);D(this,"_colorPicker",null);D(this,"_drawId",null);f(this,qo,e.mustBeCommitted||!1),this._addOutlines(e)}_addOutlines(e){e.drawOutlines&&(b(this,bt,nf).call(this,e),b(this,bt,Cl).call(this))}static _mergeSVGProperties(e,i){const s=new Set(Object.keys(e));for(const[n,a]of Object.entries(i))s.has(n)?Object.assign(e[n],a):e[n]=a;return e}static getDefaultDrawingOptions(e){Pt("Not implemented")}static get typesMap(){Pt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,i){const s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(r(V,ce).updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,i){const s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,i)}static get defaultPropertiesToUpdate(){const e=[],i=this._defaultDrawingOptions;for(const[s,n]of this.typesMap)e.push([s,i[n]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:i}=this;for(const[s,n]of this.constructor.typesMap)e.push([s,i[n]]);return e}_updateProperty(e,i,s){const n=this._drawingOptions,a=n[i],o=h=>{var d,u;n.updateProperty(i,h);const c=r(this,li).updateProperty(i,h);c&&b(this,bt,kl).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,n.toSVGProperties()),e===this.colorType&&((u=this._colorPicker)==null||u.update(h))};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,V._mergeSVGProperties(r(this,li).getPathResizingSVGProperties(b(this,bt,Jc).call(this)),{bbox:b(this,bt,ja).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,V._mergeSVGProperties(r(this,li).getPathResizedSVGProperties(b(this,bt,Jc).call(this)),{bbox:b(this,bt,ja).call(this)}))}_onTranslating(e,i){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:b(this,bt,ja).call(this)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,V._mergeSVGProperties(r(this,li).getPathTranslatedSVGProperties(b(this,bt,Jc).call(this),this.parentDimensions),{bbox:b(this,bt,ja).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,r(this,qo)&&(f(this,qo,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){b(this,bt,af).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(b(this,bt,Cl).call(this),b(this,bt,kl).call(this,r(this,li).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let i=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),b(this,bt,af).call(this)):e&&(this._uiManager.addShouldRescale(this),b(this,bt,Cl).call(this,e),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),i&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,V._mergeSVGProperties({bbox:b(this,bt,ja).call(this)},r(this,li).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&b(this,bt,kl).call(this,r(this,li).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,i;this._isCopy&&(e=this.x,i=this.y);const s=super.render();s.classList.add("draw");const n=document.createElement("div");s.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[a,o]=this.parentDimensions;return this.setDims(this.width*a,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,i),s}static createDrawerInstance(e,i,s,n,a){Pt("Not implemented")}static startDrawing(e,i,s,n){var w;const{target:a,offsetX:o,offsetY:h,pointerId:c,pointerType:d}=n;if(r(V,Yn)&&r(V,Yn)!==d)return;const{viewport:{rotation:u}}=e,{width:p,height:m}=a.getBoundingClientRect(),v=f(V,ua,new AbortController),y=e.combinedSignal(v);if(r(V,Xn)||f(V,Xn,c),r(V,Yn)??f(V,Yn,d),window.addEventListener("pointerup",A=>{var x;r(V,Xn)===A.pointerId?this._endDraw(A):(x=r(V,Qn))==null||x.delete(A.pointerId)},{signal:y}),window.addEventListener("pointercancel",A=>{var x;r(V,Xn)===A.pointerId?this._currentParent.endDrawingSession():(x=r(V,Qn))==null||x.delete(A.pointerId)},{signal:y}),window.addEventListener("pointerdown",A=>{r(V,Yn)===A.pointerType&&((r(V,Qn)||f(V,Qn,new Set)).add(A.pointerId),r(V,ce).isCancellable()&&(r(V,ce).removeLastElement(),r(V,ce).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Mi,{signal:y}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),a.addEventListener("touchmove",A=>{A.timeStamp===r(V,pa)&&Jt(A)},{signal:y}),e.toggleDrawing(),(w=i._editorUndoBar)==null||w.hide(),r(V,ce)){e.drawLayer.updateProperties(this._currentDrawId,r(V,ce).startNew(o,h,p,m,u));return}i.updateUIForDefaultProperties(this),f(V,ce,this.createDrawerInstance(o,h,p,m,u)),f(V,fa,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(r(V,fa).toSVGProperties(),r(V,ce).defaultSVGProperties),!0,!1)}static _drawMove(e){var a;if(f(V,pa,-1),!r(V,ce))return;const{offsetX:i,offsetY:s,pointerId:n}=e;if(r(V,Xn)===n){if(((a=r(V,Qn))==null?void 0:a.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,r(V,ce).add(i,s)),f(V,pa,e.timeStamp),Jt(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,f(V,ce,null),f(V,fa,null),f(V,Yn,null),f(V,pa,NaN)),r(V,ua)&&(r(V,ua).abort(),f(V,ua,null),f(V,Xn,NaN),f(V,Qn,null))}static _endDraw(e){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),(e==null?void 0:e.target)===i.div&&i.drawLayer.updateProperties(this._currentDrawId,r(V,ce).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const s=r(V,ce),n=this._currentDrawId,a=s.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(n,s.setLastElement(a))},undo:()=>{i.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:mt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(mt.DRAW_STEP),!r(V,ce).isEmpty()){const{pageDimensions:[s,n],scale:a}=i,o=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:r(V,ce).getOutlines(s*a,n*a,a,this._INNER_MARGIN),drawingOptions:r(V,fa),mustBeCommitted:!e});return this._cleanup(!0),o}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,i,s,n,a,o){Pt("Not implemented")}static async deserialize(e,i,s){var u,p;const{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:h}}=i.viewport,c=this.deserializeDraw(o,h,n,a,this._INNER_MARGIN,e),d=await super.deserialize(e,i,s);return d.createDrawingOptions(e),b(u=d,bt,nf).call(u,{drawOutlines:c}),b(p=d,bt,Cl).call(p),d.onScaleChanging(),d.rotate(),d}serializeDraw(e){const[i,s]=this.pageTranslation,[n,a]=this.pageDimensions;return r(this,li).serialize([i,s,n,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};li=new WeakMap,qo=new WeakMap,ce=new WeakMap,ua=new WeakMap,fa=new WeakMap,Xn=new WeakMap,Yn=new WeakMap,Qn=new WeakMap,pa=new WeakMap,bt=new WeakSet,nf=function({drawOutlines:e,drawId:i,drawingOptions:s}){f(this,li,e),this._drawingOptions||(this._drawingOptions=s),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,e.defaultProperties)):this._drawId=b(this,bt,rf).call(this,e,this.parent),b(this,bt,kl).call(this,e.box)},rf=function(e,i){const{id:s}=i.drawLayer.draw(V._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s},af=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Cl=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=b(this,bt,rf).call(this,r(this,li),e)}},kg=function([e,i,s,n]){const{parentDimensions:[a,o],rotation:h}=this;switch(h){case 90:return[i,1-e,s*(o/a),n*(a/o)];case 180:return[1-e,1-i,s,n];case 270:return[1-i,e,s*(o/a),n*(a/o)];default:return[e,i,s,n]}},Jc=function(){const{x:e,y:i,width:s,height:n,parentDimensions:[a,o],rotation:h}=this;switch(h){case 90:return[1-i,e,s*(a/o),n*(o/a)];case 180:return[1-e,1-i,s,n];case 270:return[i,1-e,s*(a/o),n*(o/a)];default:return[e,i,s,n]}},kl=function(e){if([this.x,this.y,this.width,this.height]=b(this,bt,kg).call(this,e),this.div){this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()},ja=function(){const{x:e,y:i,width:s,height:n,rotation:a,parentRotation:o,parentDimensions:[h,c]}=this;switch((a*4+o)/90){case 1:return[1-i-n,e,n,s];case 2:return[1-e-s,1-i-n,s,n];case 3:return[i,1-e-s,n,s];case 4:return[e,i-s*(h/c),n*(c/h),s*(h/c)];case 5:return[1-i,e,s*(h/c),n*(c/h)];case 6:return[1-e-n*(c/h),1-i,n*(c/h),s*(h/c)];case 7:return[i-s*(h/c),1-e-n*(c/h),s*(h/c),n*(c/h)];case 8:return[e-s,i-n,s,n];case 9:return[1-i,e-s,n,s];case 10:return[1-e,1-i,s,n];case 11:return[i-n,1-e,n,s];case 12:return[e-n*(c/h),i,n*(c/h),s*(h/c)];case 13:return[1-i-s*(h/c),e-n*(c/h),s*(h/c),n*(c/h)];case 14:return[1-e,1-i-s*(h/c),n*(c/h),s*(h/c)];case 15:return[i,1-e,s*(h/c),n*(c/h)];default:return[e,i,s,n]}},D(V,"_currentDrawId",-1),D(V,"_currentParent",null),g(V,ce,null),g(V,ua,null),g(V,fa,null),g(V,Xn,NaN),g(V,Yn,null),g(V,Qn,null),g(V,pa,NaN),D(V,"_INNER_MARGIN",3);let gd=V;var ms,de,ue,ma,Xo,Oe,we,Ci,ga,ba,ya,Yo,Zc;class Rw{constructor(t,e,i,s,n,a){g(this,Yo);g(this,ms,new Float64Array(6));g(this,de);g(this,ue);g(this,ma);g(this,Xo);g(this,Oe);g(this,we,"");g(this,Ci,0);g(this,ga,new bc);g(this,ba);g(this,ya);f(this,ba,i),f(this,ya,s),f(this,ma,n),f(this,Xo,a),[t,e]=b(this,Yo,Zc).call(this,t,e);const o=f(this,de,[NaN,NaN,NaN,NaN,t,e]);f(this,Oe,[t,e]),f(this,ue,[{line:o,points:r(this,Oe)}]),r(this,ms).set(o,0)}updateProperty(t,e){t==="stroke-width"&&f(this,Xo,e)}isEmpty(){return!r(this,ue)||r(this,ue).length===0}isCancellable(){return r(this,Oe).length<=10}add(t,e){[t,e]=b(this,Yo,Zc).call(this,t,e);const[i,s,n,a]=r(this,ms).subarray(2,6),o=t-n,h=e-a;return Math.hypot(r(this,ba)*o,r(this,ya)*h)<=2?null:(r(this,Oe).push(t,e),isNaN(i)?(r(this,ms).set([n,a,t,e],2),r(this,de).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(r(this,ms)[0])&&r(this,de).splice(6,6),r(this,ms).set([i,s,n,a,t,e],0),r(this,de).push(...U.createBezierPoints(i,s,n,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const i=this.add(t,e);return i||(r(this,Oe).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,s,n){f(this,ba,i),f(this,ya,s),f(this,ma,n),[t,e]=b(this,Yo,Zc).call(this,t,e);const a=f(this,de,[NaN,NaN,NaN,NaN,t,e]);f(this,Oe,[t,e]);const o=r(this,ue).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),r(this,ue).push({line:a,points:r(this,Oe)}),r(this,ms).set(a,0),f(this,Ci,0),this.toSVGPath(),null}getLastElement(){return r(this,ue).at(-1)}setLastElement(t){return r(this,ue)?(r(this,ue).push(t),f(this,de,t.line),f(this,Oe,t.points),f(this,Ci,0),{path:{d:this.toSVGPath()}}):r(this,ga).setLastElement(t)}removeLastElement(){if(!r(this,ue))return r(this,ga).removeLastElement();r(this,ue).pop(),f(this,we,"");for(let t=0,e=r(this,ue).length;t<e;t++){const{line:i,points:s}=r(this,ue)[t];f(this,de,i),f(this,Oe,s),f(this,Ci,0),this.toSVGPath()}return{path:{d:r(this,we)}}}toSVGPath(){const t=U.svgRound(r(this,de)[4]),e=U.svgRound(r(this,de)[5]);if(r(this,Oe).length===2)return f(this,we,`${r(this,we)} M ${t} ${e} Z`),r(this,we);if(r(this,Oe).length<=6){const s=r(this,we).lastIndexOf("M");f(this,we,`${r(this,we).slice(0,s)} M ${t} ${e}`),f(this,Ci,6)}if(r(this,Oe).length===4){const s=U.svgRound(r(this,de)[10]),n=U.svgRound(r(this,de)[11]);return f(this,we,`${r(this,we)} L ${s} ${n}`),f(this,Ci,12),r(this,we)}const i=[];r(this,Ci)===0&&(i.push(`M ${t} ${e}`),f(this,Ci,6));for(let s=r(this,Ci),n=r(this,de).length;s<n;s+=6){const[a,o,h,c,d,u]=r(this,de).slice(s,s+6).map(U.svgRound);i.push(`C${a} ${o} ${h} ${c} ${d} ${u}`)}return f(this,we,r(this,we)+i.join(" ")),f(this,Ci,r(this,de).length),r(this,we)}getOutlines(t,e,i,s){const n=r(this,ue).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),r(this,ga).build(r(this,ue),t,e,i,r(this,ma),r(this,Xo),s),f(this,ms,null),f(this,de,null),f(this,ue,null),f(this,we,null),r(this,ga)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}ms=new WeakMap,de=new WeakMap,ue=new WeakMap,ma=new WeakMap,Xo=new WeakMap,Oe=new WeakMap,we=new WeakMap,Ci=new WeakMap,ga=new WeakMap,ba=new WeakMap,ya=new WeakMap,Yo=new WeakSet,Zc=function(t,e){return U._normalizePoint(t,e,r(this,ba),r(this,ya),r(this,ma))};var Ne,lc,hc,hi,gs,bs,Qo,Jo,va,_e,ks,Tg,Pg,Lg;class bc extends U{constructor(){super(...arguments);g(this,_e);g(this,Ne);g(this,lc,0);g(this,hc);g(this,hi);g(this,gs);g(this,bs);g(this,Qo);g(this,Jo);g(this,va)}build(e,i,s,n,a,o,h){f(this,gs,i),f(this,bs,s),f(this,Qo,n),f(this,Jo,a),f(this,va,o),f(this,hc,h??0),f(this,hi,e),b(this,_e,Pg).call(this)}get thickness(){return r(this,va)}setLastElement(e){return r(this,hi).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return r(this,hi).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:i}of r(this,hi)){if(e.push(`M${U.svgRound(i[4])} ${U.svgRound(i[5])}`),i.length===6){e.push("Z");continue}if(i.length===12&&isNaN(i[6])){e.push(`L${U.svgRound(i[10])} ${U.svgRound(i[11])}`);continue}for(let s=6,n=i.length;s<n;s+=6){const[a,o,h,c,d,u]=i.subarray(s,s+6).map(U.svgRound);e.push(`C${a} ${o} ${h} ${c} ${d} ${u}`)}}return e.join("")}serialize([e,i,s,n],a){const o=[],h=[],[c,d,u,p]=b(this,_e,Tg).call(this);let m,v,y,w,A,x,I,E,C;switch(r(this,Jo)){case 0:C=U._rescale,m=e,v=i+n,y=s,w=-n,A=e+c*s,x=i+(1-d-p)*n,I=e+(c+u)*s,E=i+(1-d)*n;break;case 90:C=U._rescaleAndSwap,m=e,v=i,y=s,w=n,A=e+d*s,x=i+c*n,I=e+(d+p)*s,E=i+(c+u)*n;break;case 180:C=U._rescale,m=e+s,v=i,y=-s,w=n,A=e+(1-c-u)*s,x=i+d*n,I=e+(1-c)*s,E=i+(d+p)*n;break;case 270:C=U._rescaleAndSwap,m=e+s,v=i+n,y=-s,w=-n,A=e+(1-d-p)*s,x=i+(1-c-u)*n,I=e+(1-d)*s,E=i+(1-c)*n;break}for(const{line:P,points:k}of r(this,hi))o.push(C(P,m,v,y,w,a?new Array(P.length):null)),h.push(C(k,m,v,y,w,a?new Array(k.length):null));return{lines:o,points:h,rect:[A,x,I,E]}}static deserialize(e,i,s,n,a,{paths:{lines:o,points:h},rotation:c,thickness:d}){const u=[];let p,m,v,y,w;switch(c){case 0:w=U._rescale,p=-e/s,m=i/n+1,v=1/s,y=-1/n;break;case 90:w=U._rescaleAndSwap,p=-i/n,m=-e/s,v=1/n,y=1/s;break;case 180:w=U._rescale,p=e/s+1,m=-i/n,v=-1/s,y=1/n;break;case 270:w=U._rescaleAndSwap,p=i/n+1,m=e/s+1,v=-1/n,y=-1/s;break}if(!o){o=[];for(const x of h){const I=x.length;if(I===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1]]));continue}if(I===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1],NaN,NaN,NaN,NaN,x[2],x[3]]));continue}const E=new Float32Array(3*(I-2));o.push(E);let[C,P,k,_]=x.subarray(0,4);E.set([NaN,NaN,NaN,NaN,C,P],0);for(let S=4;S<I;S+=2){const T=x[S],L=x[S+1];E.set(U.createBezierPoints(C,P,k,_,T,L),(S-2)*3),[C,P,k,_]=[k,_,T,L]}}}for(let x=0,I=o.length;x<I;x++)u.push({line:w(o[x].map(E=>E??NaN),p,m,v,y),points:w(h[x].map(E=>E??NaN),p,m,v,y)});const A=new this.prototype.constructor;return A.build(u,s,n,1,c,d,a),A}get box(){return r(this,Ne)}updateProperty(e,i){return e==="stroke-width"?b(this,_e,Lg).call(this,i):null}updateParentDimensions([e,i],s){const[n,a]=b(this,_e,ks).call(this);f(this,gs,e),f(this,bs,i),f(this,Qo,s);const[o,h]=b(this,_e,ks).call(this),c=o-n,d=h-a,u=r(this,Ne);return u[0]-=c,u[1]-=d,u[2]+=2*c,u[3]+=2*d,u}updateRotation(e){return f(this,lc,e),{path:{transform:this.rotationTransform}}}get viewBox(){return r(this,Ne).map(U.svgRound).join(" ")}get defaultProperties(){const[e,i]=r(this,Ne);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${U.svgRound(e)} ${U.svgRound(i)}`}}}get rotationTransform(){const[,,e,i]=r(this,Ne);let s=0,n=0,a=0,o=0,h=0,c=0;switch(r(this,lc)){case 90:n=i/e,a=-e/i,h=e;break;case 180:s=-1,o=-1,h=e,c=i;break;case 270:n=-i/e,a=e/i,c=i;break;default:return""}return`matrix(${s} ${n} ${a} ${o} ${U.svgRound(h)} ${U.svgRound(c)})`}getPathResizingSVGProperties([e,i,s,n]){const[a,o]=b(this,_e,ks).call(this),[h,c,d,u]=r(this,Ne);if(Math.abs(d-a)<=U.PRECISION||Math.abs(u-o)<=U.PRECISION){const w=e+s/2-(h+d/2),A=i+n/2-(c+u/2);return{path:{"transform-origin":`${U.svgRound(e)} ${U.svgRound(i)}`,transform:`${this.rotationTransform} translate(${w} ${A})`}}}const p=(s-2*a)/(d-2*a),m=(n-2*o)/(u-2*o),v=d/s,y=u/n;return{path:{"transform-origin":`${U.svgRound(h)} ${U.svgRound(c)}`,transform:`${this.rotationTransform} scale(${v} ${y}) translate(${U.svgRound(a)} ${U.svgRound(o)}) scale(${p} ${m}) translate(${U.svgRound(-a)} ${U.svgRound(-o)})`}}}getPathResizedSVGProperties([e,i,s,n]){const[a,o]=b(this,_e,ks).call(this),h=r(this,Ne),[c,d,u,p]=h;if(h[0]=e,h[1]=i,h[2]=s,h[3]=n,Math.abs(u-a)<=U.PRECISION||Math.abs(p-o)<=U.PRECISION){const A=e+s/2-(c+u/2),x=i+n/2-(d+p/2);for(const{line:I,points:E}of r(this,hi))U._translate(I,A,x,I),U._translate(E,A,x,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${U.svgRound(e)} ${U.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(s-2*a)/(u-2*a),v=(n-2*o)/(p-2*o),y=-m*(c+a)+e+a,w=-v*(d+o)+i+o;if(m!==1||v!==1||y!==0||w!==0)for(const{line:A,points:x}of r(this,hi))U._rescale(A,y,w,m,v,A),U._rescale(x,y,w,m,v,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${U.svgRound(e)} ${U.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,i],s){const[n,a]=s,o=r(this,Ne),h=e-o[0],c=i-o[1];if(r(this,gs)===n&&r(this,bs)===a)for(const{line:d,points:u}of r(this,hi))U._translate(d,h,c,d),U._translate(u,h,c,u);else{const d=r(this,gs)/n,u=r(this,bs)/a;f(this,gs,n),f(this,bs,a);for(const{line:p,points:m}of r(this,hi))U._rescale(p,h,c,d,u,p),U._rescale(m,h,c,d,u,m);o[2]*=d,o[3]*=u}return o[0]=e,o[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${U.svgRound(e)} ${U.svgRound(i)}`}}}get defaultSVGProperties(){const e=r(this,Ne);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${U.svgRound(e[0])} ${U.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}Ne=new WeakMap,lc=new WeakMap,hc=new WeakMap,hi=new WeakMap,gs=new WeakMap,bs=new WeakMap,Qo=new WeakMap,Jo=new WeakMap,va=new WeakMap,_e=new WeakSet,ks=function(e=r(this,va)){const i=r(this,hc)+e/2*r(this,Qo);return r(this,Jo)%180===0?[i/r(this,gs),i/r(this,bs)]:[i/r(this,bs),i/r(this,gs)]},Tg=function(){const[e,i,s,n]=r(this,Ne),[a,o]=b(this,_e,ks).call(this,0);return[e+a,i+o,s-2*a,n-2*o]},Pg=function(){const e=f(this,Ne,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of r(this,hi)){if(n.length<=12){for(let h=4,c=n.length;h<c;h+=6)Y.pointBoundingBox(n[h],n[h+1],e);continue}let a=n[4],o=n[5];for(let h=6,c=n.length;h<c;h+=6){const[d,u,p,m,v,y]=n.subarray(h,h+6);Y.bezierBoundingBox(a,o,d,u,p,m,v,y,e),a=v,o=y}}const[i,s]=b(this,_e,ks).call(this);e[0]=$e(e[0]-i,0,1),e[1]=$e(e[1]-s,0,1),e[2]=$e(e[2]+i,0,1),e[3]=$e(e[3]+s,0,1),e[2]-=e[0],e[3]-=e[1]},Lg=function(e){const[i,s]=b(this,_e,ks).call(this);f(this,va,e);const[n,a]=b(this,_e,ks).call(this),[o,h]=[n-i,a-s],c=r(this,Ne);return c[0]-=o,c[1]-=h,c[2]+=2*o,c[3]+=2*h,c};class Kd extends Cg{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:Ot._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??(e=this["stroke-width"]),e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Kd(this._viewParameters);return t.updateAll(this),t}}var Dd,Rg;const Ka=class Ka extends gd{constructor(e){super({...e,name:"inkEditor"});g(this,Dd);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,i){Ot.initialize(e,i),this._defaultDrawingOptions=new Kd(i.viewParameters)}static getDefaultDrawingOptions(e){const i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return ut(this,"typesMap",new Map([[mt.INK_THICKNESS,"stroke-width"],[mt.INK_COLOR,"stroke"],[mt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,i,s,n,a){return new Rw(e,i,s,n,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,i,s,n,a,o){return bc.deserialize(e,i,s,n,a,o)}static async deserialize(e,i,s){let n=null;if(e instanceof Lf){const{data:{inkLists:o,rect:h,rotation:c,id:d,color:u,opacity:p,borderStyle:{rawWidth:m},popupRef:v,contentsObj:y},parent:{page:{pageNumber:w}}}=e;n=e={annotationType:rt.INK,color:Array.from(u),thickness:m,opacity:p,paths:{points:o},boxes:null,pageIndex:w-1,rect:h.slice(0),rotation:c,annotationElementId:d,id:d,deleted:!1,popupRef:v,comment:(y==null?void 0:y.str)||null}}const a=await super.deserialize(e,i,s);return a._initialData=n,e.comment&&a.setCommentData(e.comment),a}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new ud(this)),[["colorPicker",this._colorPicker]]}get colorType(){return mt.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:i,parent:s}=this;i.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(e,i.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:i,opacity:s}){this._drawingOptions=Ka.getDefaultDrawingOptions({stroke:Y.makeHexColor(...e),"stroke-width":i,"stroke-opacity":s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:i,points:s,rect:n}=this.serializeDraw(e),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":h}}=this,c={annotationType:rt.INK,color:Ot._colorManager.convert(a),opacity:o,thickness:h,paths:{lines:i,points:s},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(c),e?(c.isCopy=!0,c):this.annotationElementId&&!b(this,Dd,Rg).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(e){const{points:i,rect:s}=this.serializeDraw(!1),n={rect:s,thickness:this._drawingOptions["stroke-width"],points:i};return this.hasEditedComment&&(n.popup=this.comment),e.updateEdited(n),null}};Dd=new WeakSet,Rg=function(e){const{color:i,thickness:s,opacity:n,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((o,h)=>o!==i[h])||e.thickness!==s||e.opacity!==n||e.pageIndex!==a},D(Ka,"_type","ink"),D(Ka,"_editorType",rt.INK),D(Ka,"_defaultDrawingOptions",null);let of=Ka;class lf extends bc{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const xc=8,dl=3;var wa,St,hf,Vi,Mg,Dg,cf,td,Fg,Og,Ng,df,uf,Bg;class cn{static extractContoursFromText(t,{fontFamily:e,fontStyle:i,fontWeight:s},n,a,o,h){let c=new OffscreenCanvas(1,1),d=c.getContext("2d",{alpha:!1});const u=200,p=d.font=`${i} ${s} ${u}px ${e}`,{actualBoundingBoxLeft:m,actualBoundingBoxRight:v,actualBoundingBoxAscent:y,actualBoundingBoxDescent:w,fontBoundingBoxAscent:A,fontBoundingBoxDescent:x,width:I}=d.measureText(t),E=1.5,C=Math.ceil(Math.max(Math.abs(m)+Math.abs(v)||0,I)*E),P=Math.ceil(Math.max(Math.abs(y)+Math.abs(w)||u,Math.abs(A)+Math.abs(x)||u)*E);c=new OffscreenCanvas(C,P),d=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=p,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,C,P),d.fillStyle="black",d.fillText(t,C*(E-1)/2,P*(3-E)/2);const k=b(this,St,df).call(this,d.getImageData(0,0,C,P).data),_=b(this,St,Ng).call(this,k),S=b(this,St,uf).call(this,_),T=b(this,St,cf).call(this,k,C,P,S);return this.processDrawnLines({lines:{curves:T,width:C,height:P},pageWidth:n,pageHeight:a,rotation:o,innerMargin:h,mustSmooth:!0,areContours:!0})}static process(t,e,i,s,n){const[a,o,h]=b(this,St,Bg).call(this,t),[c,d]=b(this,St,Og).call(this,a,o,h,Math.hypot(o,h)*r(this,wa).sigmaSFactor,r(this,wa).sigmaR,r(this,wa).kernelSize),u=b(this,St,uf).call(this,d),p=b(this,St,cf).call(this,c,o,h,u);return this.processDrawnLines({lines:{curves:p,width:o,height:h},pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:a,areContours:o}){s%180!==0&&([e,i]=[i,e]);const{curves:h,width:c,height:d}=t,u=t.thickness??0,p=[],m=Math.min(e/c,i/d),v=m/e,y=m/i,w=[];for(const{points:x}of h){const I=a?b(this,St,Fg).call(this,x):x;if(!I)continue;w.push(I);const E=I.length,C=new Float32Array(E),P=new Float32Array(3*(E===2?2:E-2));if(p.push({line:P,points:C}),E===2){C[0]=I[0]*v,C[1]=I[1]*y,P.set([NaN,NaN,NaN,NaN,C[0],C[1]],0);continue}let[k,_,S,T]=I;k*=v,_*=y,S*=v,T*=y,C.set([k,_,S,T],0),P.set([NaN,NaN,NaN,NaN,k,_],0);for(let L=4;L<E;L+=2){const M=C[L]=I[L]*v,z=C[L+1]=I[L+1]*y;P.set(U.createBezierPoints(k,_,S,T,M,z),(L-2)*3),[k,_,S,T]=[S,T,M,z]}}if(p.length===0)return null;const A=o?new lf:new bc;return A.build(p,e,i,1,s,o?0:u,n),{outline:A,newCurves:w,areContours:o,thickness:u,width:c,height:d}}static async compressSignature({outlines:t,areContours:e,thickness:i,width:s,height:n}){let a=1/0,o=-1/0,h=0;for(const I of t){h+=I.length;for(let E=2,C=I.length;E<C;E++){const P=I[E]-I[E-2];a=Math.min(a,P),o=Math.max(o,P)}}let c;a>=-128&&o<=127?c=Int8Array:a>=-32768&&o<=32767?c=Int16Array:c=Int32Array;const d=t.length,u=xc+dl*d,p=new Uint32Array(u);let m=0;p[m++]=u*Uint32Array.BYTES_PER_ELEMENT+(h-2*d)*c.BYTES_PER_ELEMENT,p[m++]=0,p[m++]=s,p[m++]=n,p[m++]=e?0:1,p[m++]=Math.max(0,Math.floor(i??0)),p[m++]=d,p[m++]=c.BYTES_PER_ELEMENT;for(const I of t)p[m++]=I.length-2,p[m++]=I[0],p[m++]=I[1];const v=new CompressionStream("deflate-raw"),y=v.writable.getWriter();await y.ready,y.write(p);const w=c.prototype.constructor;for(const I of t){const E=new w(I.length-2);for(let C=2,P=I.length;C<P;C++)E[C-2]=I[C]-I[C-2];y.write(E)}y.close();const A=await new Response(v.readable).arrayBuffer(),x=new Uint8Array(A);return Hp(x)}static async decompressSignature(t){try{const e=ev(t),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),n=s.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let a=null,o=0;for await(const I of i)a||(a=new Uint8Array(new Uint32Array(I.buffer,0,4)[0])),a.set(I,o),o+=I.length;const h=new Uint32Array(a.buffer,0,a.length>>2),c=h[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const d=h[2],u=h[3],p=h[4]===0,m=h[5],v=h[6],y=h[7],w=[],A=(xc+dl*v)*Uint32Array.BYTES_PER_ELEMENT;let x;switch(y){case Int8Array.BYTES_PER_ELEMENT:x=new Int8Array(a.buffer,A);break;case Int16Array.BYTES_PER_ELEMENT:x=new Int16Array(a.buffer,A);break;case Int32Array.BYTES_PER_ELEMENT:x=new Int32Array(a.buffer,A);break}o=0;for(let I=0;I<v;I++){const E=h[dl*I+xc],C=new Float32Array(E+2);w.push(C);for(let P=0;P<dl-1;P++)C[P]=h[dl*I+xc+P+1];for(let P=0;P<E;P++)C[P+2]=C[P]+x[o++]}return{areContours:p,thickness:m,outlines:w,width:d,height:u}}catch(e){return at(`decompressSignature: ${e}`),null}}}wa=new WeakMap,St=new WeakSet,hf=function(t,e,i,s){return i-=t,s-=e,i===0?s>0?0:4:i===1?s+6:2-s},Vi=new WeakMap,Mg=function(t,e,i,s,n,a,o){const h=b(this,St,hf).call(this,i,s,n,a);for(let c=0;c<8;c++){const d=(-c+h-o+16)%8,u=r(this,Vi)[2*d],p=r(this,Vi)[2*d+1];if(t[(i+u)*e+(s+p)]!==0)return d}return-1},Dg=function(t,e,i,s,n,a,o){const h=b(this,St,hf).call(this,i,s,n,a);for(let c=0;c<8;c++){const d=(c+h+o+16)%8,u=r(this,Vi)[2*d],p=r(this,Vi)[2*d+1];if(t[(i+u)*e+(s+p)]!==0)return d}return-1},cf=function(t,e,i,s){const n=t.length,a=new Int32Array(n);for(let d=0;d<n;d++)a[d]=t[d]<=s?1:0;for(let d=1;d<i-1;d++)a[d*e]=a[d*e+e-1]=0;for(let d=0;d<e;d++)a[d]=a[e*i-1-d]=0;let o=1,h;const c=[];for(let d=1;d<i-1;d++){h=1;for(let u=1;u<e-1;u++){const p=d*e+u,m=a[p];if(m===0)continue;let v=d,y=u;if(m===1&&a[p-1]===0)o+=1,y-=1;else if(m>=1&&a[p+1]===0)o+=1,y+=1,m>1&&(h=m);else{m!==1&&(h=Math.abs(m));continue}const w=[u,d],A=y===u+1,x={isHole:A,points:w,id:o,parent:0};c.push(x);let I;for(const L of c)if(L.id===h){I=L;break}I?I.isHole?x.parent=A?I.parent:h:x.parent=A?h:I.parent:x.parent=A?h:0;const E=b(this,St,Mg).call(this,a,e,d,u,v,y,0);if(E===-1){a[p]=-o,a[p]!==1&&(h=Math.abs(a[p]));continue}let C=r(this,Vi)[2*E],P=r(this,Vi)[2*E+1];const k=d+C,_=u+P;v=k,y=_;let S=d,T=u;for(;;){const L=b(this,St,Dg).call(this,a,e,S,T,v,y,1);C=r(this,Vi)[2*L],P=r(this,Vi)[2*L+1];const M=S+C,z=T+P;w.push(z,M);const G=S*e+T;if(a[G+1]===0?a[G]=-o:a[G]===1&&(a[G]=o),M===d&&z===u&&S===k&&T===_){a[p]!==1&&(h=Math.abs(a[p]));break}else v=S,y=T,S=M,T=z}}}return c},td=function(t,e,i,s){if(i-e<=4){for(let k=e;k<i-2;k+=2)s.push(t[k],t[k+1]);return}const n=t[e],a=t[e+1],o=t[i-4]-n,h=t[i-3]-a,c=Math.hypot(o,h),d=o/c,u=h/c,p=d*a-u*n,m=h/o,v=1/c,y=Math.atan(m),w=Math.cos(y),A=Math.sin(y),x=v*(Math.abs(w)+Math.abs(A)),I=v*(1-x+x**2),E=Math.max(Math.atan(Math.abs(A+w)*I),Math.atan(Math.abs(A-w)*I));let C=0,P=e;for(let k=e+2;k<i-2;k+=2){const _=Math.abs(p-d*t[k+1]+u*t[k]);_>C&&(P=k,C=_)}C>(c*E)**2?(b(this,St,td).call(this,t,e,P+2,s),b(this,St,td).call(this,t,P,i,s)):s.push(n,a)},Fg=function(t){const e=[],i=t.length;return b(this,St,td).call(this,t,0,i,e),e.push(t[i-2],t[i-1]),e.length<=4?null:e},Og=function(t,e,i,s,n,a){const o=new Float32Array(a**2),h=-2*s**2,c=a>>1;for(let y=0;y<a;y++){const w=(y-c)**2;for(let A=0;A<a;A++)o[y*a+A]=Math.exp((w+(A-c)**2)/h)}const d=new Float32Array(256),u=-2*n**2;for(let y=0;y<256;y++)d[y]=Math.exp(y**2/u);const p=t.length,m=new Uint8Array(p),v=new Uint32Array(256);for(let y=0;y<i;y++)for(let w=0;w<e;w++){const A=y*e+w,x=t[A];let I=0,E=0;for(let P=0;P<a;P++){const k=y+P-c;if(!(k<0||k>=i))for(let _=0;_<a;_++){const S=w+_-c;if(S<0||S>=e)continue;const T=t[k*e+S],L=o[P*a+_]*d[Math.abs(T-x)];I+=T*L,E+=L}}const C=m[A]=Math.round(I/E);v[C]++}return[m,v]},Ng=function(t){const e=new Uint32Array(256);for(const i of t)e[i]++;return e},df=function(t){const e=t.length,i=new Uint8ClampedArray(e>>2);let s=-1/0,n=1/0;for(let o=0,h=i.length;o<h;o++){const c=i[o]=t[o<<2];s=Math.max(s,c),n=Math.min(n,c)}const a=255/(s-n);for(let o=0,h=i.length;o<h;o++)i[o]=(i[o]-n)*a;return i},uf=function(t){let e,i=-1/0,s=-1/0;const n=t.findIndex(h=>h!==0);let a=n,o=n;for(e=n;e<256;e++){const h=t[e];h>i&&(e-a>s&&(s=e-a,o=e-1),i=h,a=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e},Bg=function(t){const e=t,{width:i,height:s}=t,{maxDim:n}=r(this,wa);let a=i,o=s;if(i>n||s>n){let p=i,m=s,v=Math.log2(Math.max(i,s)/n);const y=Math.floor(v);v=v===y?y-1:y;for(let A=0;A<v;A++){a=Math.ceil(p/2),o=Math.ceil(m/2);const x=new OffscreenCanvas(a,o);x.getContext("2d").drawImage(t,0,0,p,m,0,0,a,o),p=a,m=o,t!==e&&t.close(),t=x.transferToImageBitmap()}const w=Math.min(n/a,n/o);a=Math.round(a*w),o=Math.round(o*w)}const c=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});c.fillStyle="white",c.fillRect(0,0,a,o),c.filter="grayscale(1)",c.drawImage(t,0,0,t.width,t.height,0,0,a,o);const d=c.getImageData(0,0,a,o).data;return[b(this,St,df).call(this,d),a,o]},g(cn,St),g(cn,wa,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),g(cn,Vi,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Rf extends Cg{constructor(){super(),super.updateProperties({fill:Ot._defaultLineColor,"stroke-width":0})}clone(){const t=new Rf;return t.updateAll(this),t}}class Mf extends Kd{constructor(t){super(t),super.updateProperties({stroke:Ot._defaultLineColor,"stroke-width":1})}clone(){const t=new Mf(this._viewParameters);return t.updateAll(this),t}}var Jn,ys,Zn,Aa;const Ye=class Ye extends gd{constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"});g(this,Jn,!1);g(this,ys,null);g(this,Zn,null);g(this,Aa,null);this._willKeepAspectRatio=!0,f(this,Zn,e.signatureData||null),f(this,ys,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,i){Ot.initialize(e,i),this._defaultDrawingOptions=new Rf,this._defaultDrawnSignatureOptions=new Mf(i.viewParameters)}static getDefaultDrawingOptions(e){const i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!1}static get typesMap(){return ut(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!r(this,ys)}}static computeTelemetryFinalData(e){const i=e.get("hasDescription");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,i;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,e=this.x,i=this.y),super.render(),this._drawId===null)if(r(this,Zn)){const{lines:n,mustSmooth:a,areContours:o,description:h,uuid:c,heightInPage:d}=r(this,Zn),{rawDims:{pageWidth:u,pageHeight:p},rotation:m}=this.parent.viewport,v=cn.processDrawnLines({lines:n,pageWidth:u,pageHeight:p,rotation:m,innerMargin:Ye._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(v,d,h,c)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:r(this,ys)||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(e,i)),this.div}setUuid(e){f(this,Aa,e),this.addEditToolbar()}getUuid(){return r(this,Aa)}get description(){return r(this,ys)}set description(e){f(this,ys,e),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(i=>{i==null||i.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:i,thickness:s,width:n,height:a}=r(this,Zn),o=Math.max(n,a),h=cn.processDrawnLines({lines:{curves:e.map(c=>({points:c})),thickness:s,width:n,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:i});return{areContours:i,outline:h.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,i,s,n){const{x:a,y:o}=this,{outline:h}=f(this,Zn,e);f(this,Jn,h instanceof lf),this.description=s;let c;r(this,Jn)?c=Ye.getDefaultDrawingOptions():(c=Ye._defaultDrawnSignatureOptions.clone(),c.updateProperties({"stroke-width":h.thickness})),this._addOutlines({drawOutlines:h,drawingOptions:c});const[d,u]=this.parentDimensions,[,p]=this.pageDimensions;let m=i/p;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(d*this.width,u*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return cn.process(e,i,s,n,Ye._INNER_MARGIN)}getFromText(e,i){const{rawDims:{pageWidth:s,pageHeight:n},rotation:a}=this.parent.viewport;return cn.extractContoursFromText(e,i,s,n,a,Ye._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return cn.processDrawnLines({lines:e,pageWidth:i,pageHeight:s,rotation:n,innerMargin:Ye._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:i}){e?this._drawingOptions=Ye.getDefaultDrawingOptions():(this._drawingOptions=Ye._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":i}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:i,points:s,rect:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":a}}=this,o={annotationType:rt.SIGNATURE,isSignature:!0,areContours:r(this,Jn),color:[0,0,0],thickness:r(this,Jn)?0:a,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(o),e?(o.paths={lines:i,points:s},o.uuid=r(this,Aa),o.isCopy=!0):o.lines=i,r(this,ys)&&(o.accessibilityData={type:"Figure",alt:r(this,ys)}),o}static deserializeDraw(e,i,s,n,a,o){return o.areContours?lf.deserialize(e,i,s,n,a,o):bc.deserialize(e,i,s,n,a,o)}static async deserialize(e,i,s){var a;const n=await super.deserialize(e,i,s);return f(n,Jn,e.areContours),n.description=((a=e.accessibilityData)==null?void 0:a.alt)||"",f(n,Aa,e.uuid),n}};Jn=new WeakMap,ys=new WeakMap,Zn=new WeakMap,Aa=new WeakMap,D(Ye,"_type","signature"),D(Ye,"_editorType",rt.SIGNATURE),D(Ye,"_defaultDrawingOptions",null);let ff=Ye;var Ht,fe,tr,rn,er,Zo,an,_a,vs,ci,tl,yt,Tl,Pl,ed,id,sd,mf,nd,Hg;class pf extends Ot{constructor(e){super({...e,name:"stampEditor"});g(this,yt);g(this,Ht,null);g(this,fe,null);g(this,tr,null);g(this,rn,null);g(this,er,null);g(this,Zo,"");g(this,an,null);g(this,_a,!1);g(this,vs,null);g(this,ci,!1);g(this,tl,!1);f(this,rn,e.bitmapUrl),f(this,er,e.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,i){Ot.initialize(e,i)}static isHandlingMimeForPasting(e){return au.includes(e)}static paste(e,i){i.pasteEditor({mode:rt.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const i=e.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}async mlGuessAltText(e=null,i=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:a,height:o}=e||this.copyCanvas(null,null,!0).imageData,h=await s.guess({name:"altText",request:{data:n,width:a,height:o,channels:n.length/(a*o)}});if(!h)throw new Error("No response from the AI service.");if(h.error)throw new Error("Error from the AI service.");if(h.cancel)return null;if(!h.output)throw new Error("No valid response from the AI service.");const c=h.output;return await this.setGuessedAltText(c),i&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var e;r(this,fe)&&(f(this,Ht,null),this._uiManager.imageManager.deleteId(r(this,fe)),(e=r(this,an))==null||e.remove(),f(this,an,null),r(this,vs)&&(clearTimeout(r(this,vs)),f(this,vs,null))),super.remove()}rebuild(){if(!this.parent){r(this,fe)&&b(this,yt,ed).call(this);return}super.rebuild(),this.div!==null&&(r(this,fe)&&r(this,an)===null&&b(this,yt,ed).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(r(this,tr)||r(this,Ht)||r(this,rn)||r(this,er)||r(this,fe)||r(this,_a))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,i;return this._isCopy&&(e=this.x,i=this.y),super.render(),this.div.hidden=!0,this.createAltText(),r(this,_a)||(r(this,Ht)?b(this,yt,id).call(this):b(this,yt,ed).call(this)),this._isCopy&&this._moveAfterPaste(e,i),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,i){const{id:s,bitmap:n}=this._uiManager.imageManager.getFromCanvas(e,i);i.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(f(this,fe,s),n&&f(this,Ht,n),f(this,_a,!1),b(this,yt,id).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;r(this,vs)!==null&&clearTimeout(r(this,vs)),f(this,vs,setTimeout(()=>{f(this,vs,null),b(this,yt,mf).call(this)},200))}copyCanvas(e,i,s=!1){var m;e||(e=224);const{width:n,height:a}=r(this,Ht),o=new Is;let h=r(this,Ht),c=n,d=a,u=null;if(i){if(n>i||a>i){const _=Math.min(i/n,i/a);c=Math.floor(n*_),d=Math.floor(a*_)}u=document.createElement("canvas");const v=u.width=Math.ceil(c*o.sx),y=u.height=Math.ceil(d*o.sy);r(this,ci)||(h=b(this,yt,sd).call(this,v,y));const w=u.getContext("2d");w.filter=this._uiManager.hcmFilter;let A="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(A="#8f8f9d",x="#42414d");const I=15,E=I*o.sx,C=I*o.sy,P=new OffscreenCanvas(E*2,C*2),k=P.getContext("2d");k.fillStyle=A,k.fillRect(0,0,E*2,C*2),k.fillStyle=x,k.fillRect(0,0,E,C),k.fillRect(E,C,E,C),w.fillStyle=w.createPattern(P,"repeat"),w.fillRect(0,0,v,y),w.drawImage(h,0,0,h.width,h.height,0,0,v,y)}let p=null;if(s){let v,y;if(o.symmetric&&h.width<e&&h.height<e)v=h.width,y=h.height;else if(h=r(this,Ht),n>e||a>e){const x=Math.min(e/n,e/a);v=Math.floor(n*x),y=Math.floor(a*x),r(this,ci)||(h=b(this,yt,sd).call(this,v,y))}const A=new OffscreenCanvas(v,y).getContext("2d",{willReadFrequently:!0});A.drawImage(h,0,0,h.width,h.height,0,0,v,y),p={width:v,height:y,data:A.getImageData(0,0,v,y).data}}return{canvas:u,width:c,height:d,imageData:p}}static async deserialize(e,i,s){var w;let n=null,a=!1;if(e instanceof eg){const{data:{rect:A,rotation:x,id:I,structParent:E,popupRef:C,contentsObj:P},container:k,parent:{page:{pageNumber:_}},canvas:S}=e;let T,L;S?(delete e.canvas,{id:T,bitmap:L}=s.imageManager.getFromCanvas(k.id,S),S.remove()):(a=!0,e._hasNoCanvas=!0);const M=((w=await i._structTree.getAriaAttributes(`${Sf}${I}`))==null?void 0:w.get("aria-label"))||"";n=e={annotationType:rt.STAMP,bitmapId:T,bitmap:L,pageIndex:_-1,rect:A.slice(0),rotation:x,annotationElementId:I,id:I,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:E,popupRef:C,comment:(P==null?void 0:P.str)||null}}const o=await super.deserialize(e,i,s),{rect:h,bitmap:c,bitmapUrl:d,bitmapId:u,isSvg:p,accessibilityData:m}=e;a?(s.addMissingCanvas(e.id,o),f(o,_a,!0)):u&&s.imageManager.isValidId(u)?(f(o,fe,u),c&&f(o,Ht,c)):f(o,rn,d),f(o,ci,p);const[v,y]=o.pageDimensions;return o.width=(h[2]-h[0])/v,o.height=(h[3]-h[1])/y,m&&(o.altTextData=m),o._initialData=n,e.comment&&o.setCommentData(e.comment),f(o,tl,!!n),o}serialize(e=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:rt.STAMP,bitmapId:r(this,fe),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:r(this,ci),structTreeParentId:this._structTreeParentId};if(this.addComment(s),e)return s.bitmapUrl=b(this,yt,nd).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:n,altText:a}=this.serializeAltText(!1);if(!n&&a&&(s.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const h=b(this,yt,Hg).call(this,s);if(h.isSame)return null;h.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,i===null)return s;i.stamps||(i.stamps=new Map);const o=r(this,ci)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!i.stamps.has(r(this,fe)))i.stamps.set(r(this,fe),{area:o,serialized:s}),s.bitmap=b(this,yt,nd).call(this,!1);else if(r(this,ci)){const h=i.stamps.get(r(this,fe));o>h.area&&(h.area=o,h.serialized.bitmap.close(),h.serialized.bitmap=b(this,yt,nd).call(this,!1))}return s}renderAnnotationElement(e){const i={rect:this.getRect(0,0)};return this.hasEditedComment&&(i.popup=this.comment),e.updateEdited(i),null}}Ht=new WeakMap,fe=new WeakMap,tr=new WeakMap,rn=new WeakMap,er=new WeakMap,Zo=new WeakMap,an=new WeakMap,_a=new WeakMap,vs=new WeakMap,ci=new WeakMap,tl=new WeakMap,yt=new WeakSet,Tl=function(e,i=!1){if(!e){this.remove();return}f(this,Ht,e.bitmap),i||(f(this,fe,e.id),f(this,ci,e.isSvg)),e.file&&f(this,Zo,e.file.name),b(this,yt,id).call(this)},Pl=function(){if(f(this,tr,null),this._uiManager.enableWaiting(!1),!!r(this,an)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,Ht)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,Ht)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},ed=function(){if(r(this,fe)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(r(this,fe)).then(s=>b(this,yt,Tl).call(this,s,!0)).finally(()=>b(this,yt,Pl).call(this));return}if(r(this,rn)){const s=r(this,rn);f(this,rn,null),this._uiManager.enableWaiting(!0),f(this,tr,this._uiManager.imageManager.getFromUrl(s).then(n=>b(this,yt,Tl).call(this,n)).finally(()=>b(this,yt,Pl).call(this)));return}if(r(this,er)){const s=r(this,er);f(this,er,null),this._uiManager.enableWaiting(!0),f(this,tr,this._uiManager.imageManager.getFromFile(s).then(n=>b(this,yt,Tl).call(this,n)).finally(()=>b(this,yt,Pl).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=au.join(",");const i=this._uiManager._signal;f(this,tr,new Promise(s=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),b(this,yt,Tl).call(this,n)}s()},{signal:i}),e.addEventListener("cancel",()=>{this.remove(),s()},{signal:i})}).finally(()=>b(this,yt,Pl).call(this))),e.click()},id=function(){var u;const{div:e}=this;let{width:i,height:s}=r(this,Ht);const[n,a]=this.pageDimensions,o=.75;if(this.width)i=this.width*n,s=this.height*a;else if(i>o*n||s>o*a){const p=Math.min(o*n/i,o*a/s);i*=p,s*=p}const[h,c]=this.parentDimensions;this.setDims(i*h/n,s*c/a),this._uiManager.enableWaiting(!1);const d=f(this,an,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=i/n,this.height=s/a,(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),b(this,yt,mf).call(this),r(this,tl)||(this.parent.addUndoableEditor(this),f(this,tl,!0)),this._reportTelemetry({action:"inserted_image"}),r(this,Zo)&&this.div.setAttribute("aria-description",r(this,Zo)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},sd=function(e,i){const{width:s,height:n}=r(this,Ht);let a=s,o=n,h=r(this,Ht);for(;a>2*e||o>2*i;){const c=a,d=o;a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*i&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(a,o);u.getContext("2d").drawImage(h,0,0,c,d,0,0,a,o),h=u.transferToImageBitmap()}return h},mf=function(){const[e,i]=this.parentDimensions,{width:s,height:n}=this,a=new Is,o=Math.ceil(s*e*a.sx),h=Math.ceil(n*i*a.sy),c=r(this,an);if(!c||c.width===o&&c.height===h)return;c.width=o,c.height=h;const d=r(this,ci)?r(this,Ht):b(this,yt,sd).call(this,o,h),u=c.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(d,0,0,d.width,d.height,0,0,o,h)},nd=function(e){if(e){if(r(this,ci)){const n=this._uiManager.imageManager.getSvgUrl(r(this,fe));if(n)return n}const i=document.createElement("canvas");return{width:i.width,height:i.height}=r(this,Ht),i.getContext("2d").drawImage(r(this,Ht),0,0),i.toDataURL()}if(r(this,ci)){const[i,s]=this.pageDimensions,n=Math.round(this.width*i*hr.PDF_TO_CSS_UNITS),a=Math.round(this.height*s*hr.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,a);return o.getContext("2d").drawImage(r(this,Ht),0,0,r(this,Ht).width,r(this,Ht).height,0,0,n,a),o.transferToImageBitmap()}return structuredClone(r(this,Ht))},Hg=function(e){var o;const{pageIndex:i,accessibilityData:{altText:s}}=this._initialData,n=e.pageIndex===i,a=(((o=e.accessibilityData)==null?void 0:o.alt)||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&n&&a,isSameAltText:a}},D(pf,"_type","stamp"),D(pf,"_editorType",rt.STAMP);var Ia,el,ws,ir,on,di,sr,il,Sa,Ki,ln,pe,hn,nr,sl,W,rr,$t,$g,ts,bf,yf,rd;const Fi=class Fi{constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:s,accessibilityManager:n,annotationLayer:a,drawLayer:o,textLayer:h,viewport:c,l10n:d}){g(this,$t);g(this,Ia);g(this,el,!1);g(this,ws,null);g(this,ir,null);g(this,on,null);g(this,di,new Map);g(this,sr,!1);g(this,il,!1);g(this,Sa,!1);g(this,Ki,null);g(this,ln,null);g(this,pe,null);g(this,hn,null);g(this,nr,null);g(this,sl,-1);g(this,W);const u=[...r(Fi,rr).values()];if(!Fi._initialized){Fi._initialized=!0;for(const p of u)p.initialize(d,t)}t.registerEditorTypes(u),f(this,W,t),this.pageIndex=e,this.div=i,f(this,Ia,n),f(this,ws,a),this.viewport=c,f(this,pe,h),this.drawLayer=o,this._structTree=s,r(this,W).addLayer(this)}get isEmpty(){return r(this,di).size===0}get isInvisible(){return this.isEmpty&&r(this,W).getMode()===rt.NONE}updateToolbar(t){r(this,W).updateToolbar(t)}updateMode(t=r(this,W).getMode()){switch(b(this,$t,rd).call(this),t){case rt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case rt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case rt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const i of r(Fi,rr).values())e.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=r(this,pe))==null?void 0:e.div)}setEditingState(t){r(this,W).setEditingState(t)}addCommands(t){r(this,W).addCommands(t)}cleanUndoStack(t){r(this,W).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=r(this,ws))==null||e.div.classList.toggle("disabled",!t)}async enable(){var i;f(this,Sa,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),(i=r(this,nr))==null||i.abort(),f(this,nr,null);const t=new Set;for(const s of r(this,di).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(r(this,W).removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!r(this,ws)){f(this,Sa,!1);return}const e=r(this,ws).getEditableAnnotations();for(const s of e){if(s.hide(),r(this,W).isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const n=await this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}f(this,Sa,!1)}disable(){var s;if(f(this,il,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),r(this,pe)&&!r(this,nr)){f(this,nr,new AbortController);const n=r(this,W).combinedSignal(r(this,nr));r(this,pe).div.addEventListener("pointerdown",a=>{const{clientX:h,clientY:c,timeStamp:d}=a,u=r(this,sl);if(d-u>500){f(this,sl,d);return}f(this,sl,-1);const{classList:p}=this.div;p.toggle("getElements",!0);const m=document.elementsFromPoint(h,c);if(p.toggle("getElements",!1),!this.div.contains(m[0]))return;let v;const y=new RegExp(`^${Dp}[0-9]+$`);for(const A of m)if(y.test(A.id)){v=A.id;break}if(!v)return;const w=r(this,di).get(v);(w==null?void 0:w.annotationElementId)===null&&(a.stopPropagation(),a.preventDefault(),w.dblclick())},{signal:n,capture:!0})}const t=new Map,e=new Map;for(const n of r(this,di).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else e.set(n.annotationElementId,n);(s=this.getEditableAnnotation(n.annotationElementId))==null||s.show(),n.remove()}if(r(this,ws)){const n=r(this,ws).getEditableAnnotations();for(const a of n){const{id:o}=a.data;if(r(this,W).isDeletedAnnotationElement(o)){a.updateEdited({deleted:!0});continue}let h=e.get(o);if(h){h.resetAnnotationElement(a),h.show(!1),a.show();continue}h=t.get(o),h&&(r(this,W).addChangedExistingAnnotation(h),h.renderAnnotationElement(a)&&h.show(!1)),a.show()}}b(this,$t,rd).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const n of r(Fi,rr).values())i.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),f(this,il,!1)}getEditableAnnotation(t){var e;return((e=r(this,ws))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){r(this,W).getActive()!==t&&r(this,W).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=r(this,pe))!=null&&t.div&&!r(this,hn)){f(this,hn,new AbortController);const e=r(this,W).combinedSignal(r(this,hn));r(this,pe).div.addEventListener("pointerdown",b(this,$t,$g).bind(this),{signal:e}),r(this,pe).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=r(this,pe))!=null&&t.div&&r(this,hn)&&(r(this,hn).abort(),f(this,hn,null),r(this,pe).div.classList.remove("highlighting"))}enableClick(){if(r(this,ir))return;f(this,ir,new AbortController);const t=r(this,W).combinedSignal(r(this,ir));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=r(this,ir))==null||t.abort(),f(this,ir,null)}attach(t){r(this,di).set(t.id,t);const{annotationElementId:e}=t;e&&r(this,W).isDeletedAnnotationElement(e)&&r(this,W).removeDeletedAnnotationElement(t)}detach(t){var e;r(this,di).delete(t.id),(e=r(this,Ia))==null||e.removePointerInTextLayer(t.contentDiv),!r(this,il)&&t.annotationElementId&&r(this,W).addDeletedAnnotationElement(t)}remove(t){this.detach(t),r(this,W).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(r(this,W).addDeletedAnnotationElement(t.annotationElementId),Ot.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),r(this,W).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!r(this,Sa)),r(this,W).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var i;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!r(this,on)&&(t._focusEventsAllowed=!1,f(this,on,setTimeout(()=>{f(this,on,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:r(this,W)._signal}),e.focus())},0))),t._structTreeParentId=(i=r(this,Ia))==null?void 0:i.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getNextId(){return r(this,W).getId()}combinedSignal(t){return r(this,W).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=r(this,$t,ts))==null?void 0:t.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await r(this,W).updateMode(t.mode);const{offsetX:i,offsetY:s}=b(this,$t,yf).call(this),n=this.getNextId(),a=b(this,$t,bf).call(this,{parent:this,id:n,x:i,y:s,uiManager:r(this,W),isCentered:!0,...e});a&&this.add(a)}async deserialize(t){var e;return await((e=r(Fi,rr).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,r(this,W)))||null}createAndAddNewEditor(t,e,i={}){const s=this.getNextId(),n=b(this,$t,bf).call(this,{parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:r(this,W),isCentered:e,...i});return n&&this.add(n),n}addNewEditor(t={}){this.createAndAddNewEditor(b(this,$t,yf).call(this),!0,t)}setSelected(t){r(this,W).setSelected(t)}toggleSelected(t){r(this,W).toggleSelected(t)}unselect(t){r(this,W).unselect(t)}pointerup(t){var s;const{isMac:e}=xe.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!r(this,sr)||(f(this,sr,!1),(s=r(this,$t,ts))!=null&&s.isDrawer&&r(this,$t,ts).supportMultipleDrawings))return;if(!r(this,el)){f(this,el,!0);return}const i=r(this,W).getMode();if(i===rt.STAMP||i===rt.SIGNATURE){r(this,W).unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){var s;if(r(this,W).getMode()===rt.HIGHLIGHT&&this.enableTextSelection(),r(this,sr)){f(this,sr,!1);return}const{isMac:e}=xe.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(f(this,sr,!0),(s=r(this,$t,ts))!=null&&s.isDrawer){this.startDrawingSession(t);return}const i=r(this,W).getActive();f(this,el,!i||i.isEmpty())}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),r(this,Ki)){r(this,$t,ts).startDrawing(this,r(this,W),!1,t);return}r(this,W).setCurrentDrawingSession(this),f(this,Ki,new AbortController);const e=r(this,W).combinedSignal(r(this,Ki));this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(f(this,ln,null),this.commitOrRemove())},{signal:e}),r(this,$t,ts).startDrawing(this,r(this,W),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&f(this,ln,e);return}r(this,ln)&&setTimeout(()=>{var e;(e=r(this,ln))==null||e.focus(),f(this,ln,null)},0)}endDrawingSession(t=!1){return r(this,Ki)?(r(this,W).setCurrentDrawingSession(null),r(this,Ki).abort(),f(this,Ki,null),f(this,ln,null),r(this,$t,ts).endDrawing(t)):null}findNewParent(t,e,i){const s=r(this,W).findParent(e,i);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return r(this,Ki)?(this.endDrawingSession(),!0):!1}onScaleChanging(){r(this,Ki)&&r(this,$t,ts).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=r(this,W).getActive())==null?void 0:t.parent)===this&&(r(this,W).commitOrRemove(),r(this,W).setActiveEditor(null)),r(this,on)&&(clearTimeout(r(this,on)),f(this,on,null));for(const i of r(this,di).values())(e=r(this,Ia))==null||e.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,r(this,di).clear(),r(this,W).removeLayer(this)}render({viewport:t}){this.viewport=t,Ca(this.div,t);for(const e of r(this,W).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){r(this,W).commitOrRemove(),b(this,$t,rd).call(this);const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,Ca(this.div,{rotation:i}),e!==i)for(const s of r(this,di).values())s.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return r(this,W).viewParameters.realScale}};Ia=new WeakMap,el=new WeakMap,ws=new WeakMap,ir=new WeakMap,on=new WeakMap,di=new WeakMap,sr=new WeakMap,il=new WeakMap,Sa=new WeakMap,Ki=new WeakMap,ln=new WeakMap,pe=new WeakMap,hn=new WeakMap,nr=new WeakMap,sl=new WeakMap,W=new WeakMap,rr=new WeakMap,$t=new WeakSet,$g=function(t){r(this,W).unselectAll();const{target:e}=t;if(e===r(this,pe).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&r(this,pe).div.contains(e)){const{isMac:i}=xe.platform;if(t.button!==0||t.ctrlKey&&i)return;r(this,W).showAllEditors("highlight",!0,!0),r(this,pe).div.classList.add("free"),this.toggleDrawing(),md.startHighlighting(this,r(this,W).direction==="ltr",{target:r(this,pe).div,x:t.x,y:t.y}),r(this,pe).div.addEventListener("pointerup",()=>{r(this,pe).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:r(this,W)._signal}),t.preventDefault()}},ts=function(){return r(Fi,rr).get(r(this,W).getMode())},bf=function(t){const e=r(this,$t,ts);return e?new e.prototype.constructor(t):null},yf=function(){const{x:t,y:e,width:i,height:s}=this.div.getBoundingClientRect(),n=Math.max(0,t),a=Math.max(0,e),o=Math.min(window.innerWidth,t+i),h=Math.min(window.innerHeight,e+s),c=(n+o)/2-t,d=(a+h)/2-e,[u,p]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:u,offsetY:p}},rd=function(){for(const t of r(this,di).values())t.isEmpty()&&t.remove()},D(Fi,"_initialized",!1),g(Fi,rr,new Map([Yu,of,pf,md,ff].map(t=>[t._editorType,t])));let gf=Fi;var Gi,Be,Ea,cc,Fd,zg,Ss,wf,jg,Af;const se=class se{constructor({pageIndex:t}){g(this,Ss);g(this,Gi,null);g(this,Be,new Map);g(this,Ea,new Map);this.pageIndex=t}setParent(t){if(!r(this,Gi)){f(this,Gi,t);return}if(r(this,Gi)!==t){if(r(this,Be).size>0)for(const e of r(this,Be).values())e.remove(),t.append(e);f(this,Gi,t)}}static get _svgFactory(){return ut(this,"_svgFactory",new fd)}draw(t,e=!1,i=!1){const s=Me(se,cc)._++,n=b(this,Ss,wf).call(this),a=se._svgFactory.createElement("defs");n.append(a);const o=se._svgFactory.createElement("path");a.append(o);const h=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",h),o.setAttribute("vector-effect","non-scaling-stroke"),e&&r(this,Ea).set(s,o);const c=i?b(this,Ss,jg).call(this,a,h):null,d=se._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${h}`),this.updateProperties(n,t),r(this,Be).set(s,n),{id:s,clipPathId:`url(#${c})`}}drawOutline(t,e){const i=Me(se,cc)._++,s=b(this,Ss,wf).call(this),n=se._svgFactory.createElement("defs");s.append(n);const a=se._svgFactory.createElement("path");n.append(a);const o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let h;if(e){const u=se._svgFactory.createElement("mask");n.append(u),h=`mask_p${this.pageIndex}_${i}`,u.setAttribute("id",h),u.setAttribute("maskUnits","objectBoundingBox");const p=se._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const m=se._svgFactory.createElement("use");u.append(m),m.setAttribute("href",`#${o}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const c=se._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${o}`),h&&c.setAttribute("mask",`url(#${h})`);const d=c.cloneNode();return s.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,t),r(this,Be).set(i,s),i}finalizeDraw(t,e){r(this,Ea).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var h;if(!e)return;const{root:i,bbox:s,rootClass:n,path:a}=e,o=typeof t=="number"?r(this,Be).get(t):t;if(o){if(i&&b(this,Ss,Af).call(this,o,i),s&&b(h=se,Fd,zg).call(h,o,s),n){const{classList:c}=o;for(const[d,u]of Object.entries(n))c.toggle(d,u)}if(a){const d=o.firstChild.firstChild;b(this,Ss,Af).call(this,d,a)}}}updateParent(t,e){if(e===this)return;const i=r(this,Be).get(t);i&&(r(e,Gi).append(i),r(this,Be).delete(t),r(e,Be).set(t,i))}remove(t){r(this,Ea).delete(t),r(this,Gi)!==null&&(r(this,Be).get(t).remove(),r(this,Be).delete(t))}destroy(){f(this,Gi,null);for(const t of r(this,Be).values())t.remove();r(this,Be).clear(),r(this,Ea).clear()}};Gi=new WeakMap,Be=new WeakMap,Ea=new WeakMap,cc=new WeakMap,Fd=new WeakSet,zg=function(t,[e,i,s,n]){const{style:a}=t;a.top=`${100*i}%`,a.left=`${100*e}%`,a.width=`${100*s}%`,a.height=`${100*n}%`},Ss=new WeakSet,wf=function(){const t=se._svgFactory.create(1,1,!0);return r(this,Gi).append(t),t.setAttribute("aria-hidden",!0),t},jg=function(t,e){const i=se._svgFactory.createElement("clipPath");t.append(i);const s=`clip_${e}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const n=se._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),s},Af=function(t,e){for(const[i,s]of Object.entries(e))s===null?t.removeAttribute(i):t.setAttribute(i,s)},g(se,Fd),g(se,cc,0);let vf=se;globalThis._pdfjsTestingUtils={HighlightOutliner:Ju};globalThis.pdfjsLib={AbortException:lr,AnnotationEditorLayer:gf,AnnotationEditorParamsType:mt,AnnotationEditorType:rt,AnnotationEditorUIManager:ka,AnnotationLayer:Wu,AnnotationMode:bn,AnnotationType:Yt,build:cw,ColorPicker:dd,createValidAbsoluteUrl:Fp,DOMSVGFactory:fd,DrawLayer:vf,FeatureTest:xe,fetchData:fc,getDocument:Hm,getFilenameFromUrl:iv,getPdfFilenameFromUrl:sv,getRGB:Ud,getUuid:Bp,getXfaPageViewport:rv,GlobalWorkerOptions:_s,ImageKind:Tc,InvalidPDFException:nu,isDataScheme:jd,isPdfFile:xf,isValidExplicitDest:gv,MathClamp:$e,noContextMenu:Mi,normalizeUnicode:Zy,OPS:ad,OutputScale:Is,PasswordResponses:Vy,PDFDataRangeTransport:$m,PDFDateString:ld,PDFWorker:Fl,PermissionFlag:Uy,PixelsPerInch:hr,RenderingCancelledException:Ef,ResponseException:od,setLayerDimensions:Ca,shadow:ut,SignatureExtractor:cn,stopEvent:Jt,SupportedImageMimeTypes:au,TextLayer:Ml,TouchManager:cd,updateUrlHash:Op,Util:Y,VerbosityLevel:Hd,version:hw,XfaLayer:Vm};const Mw="/assets/pdf.worker-DcN26wb1.mjs";_s.workerSrc=Mw;function Dw(l){const t=l.replace(/^data:application\/pdf;base64,/,""),e=atob(t),i=new Uint8Array(e.length);for(let s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return i}async function Fw(l){return(await l.getTextContent()).items.map(e=>e.str).join(" ")}function Ow(l){let t=0;for(let e=0;e<l.length;e++)t=(t<<5)-t+l.charCodeAt(e),t|=0;return t.toString()}const Nw=()=>{const l=new Map;return{extractText:async e=>{const i=Ow(e);if(l.has(i))return l.get(i);const s=(async()=>{try{const n=Dw(e),a=await Hm({data:n}).promise,o=a.numPages,h=[];for(let c=1;c<=o;c++){const d=await a.getPage(c),u=await Fw(d);h.push(u)}return h.join(" ").trim()}catch(n){throw l.delete(i),new Error(`PDF parsing failed: ${n.message||n}`)}})();return l.set(i,s),s}}},gp=jy(),{compressImageToBase64:Bw}=Ny(),Hw=()=>{const l=Lt([]);let t=null;const e=a=>{t=a};let i=null;return{pastedFiles:l,handle:a=>{var h;const o=(h=a.clipboardData)==null?void 0:h.items;if(o){for(const c of o)if(c.type.includes("image")){const d=c.getAsFile();if(!d)return;Bw(d,{maxWidth:1280,quality:.9}).then(u=>{const p={type:"image",data:u,extension:"jpg",name:d.name};l.value.push(p),i==null||i(p)}).catch(u=>{t==null||t(u)}),a.preventDefault()}else if(c.type.includes("application/pdf")){const d=c.getAsFile();if(!d)return;const u=new FileReader;u.onerror=()=>{t==null||t(new Error("Failed to read pasted PDF."))},u.onload=async()=>{const p=u.result;try{const v={type:"pdf",data:await Nw().extractText(p),extension:null,name:d.name};l.value.push(v),i==null||i(v)}catch{}},u.readAsDataURL(d),a.preventDefault()}else if(c.type.includes("application/vnd.ms-excel")){const d=c.getAsFile();if(!d)return;const u=new FileReader;u.onerror=()=>{t==null||t(new Error("Failed to read pasted Excel file."))},u.onload=async()=>{const p=u.result;try{const{rows:m,ext:v,markdown:y}=await gp.parseBase64(p,d.name),w={type:"excel",data:m,markdown:y,extension:v,name:d.name};l.value.push(w),i==null||i(w)}catch{t==null||t(new Error("Could not parse Excel file."))}},u.readAsDataURL(d),a.preventDefault()}else if(c.type.includes("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")){const d=c.getAsFile();if(!d)return;const u=new FileReader;u.onerror=()=>{t==null||t(new Error("Failed to read pasted Excel file."))},u.onload=async()=>{const p=u.result;try{const{rows:m,ext:v,markdown:y}=await gp.parseBase64(p,d.name),w={type:"excel",data:m,markdown:y,extension:v,name:d.name};l.value.push(w),i==null||i(w)}catch{t==null||t(new Error("Could not parse Excel file."))}},u.readAsDataURL(d),a.preventDefault()}}},setOnPasteError:e,setOnFilePasted:a=>{i=a}}},bp={socketURL:"https://api.imanextgencbt.id/chat",socketPort:6625,socketPath:"/socket.io"};var Ug=(l=>(l.SYSTEM="system",l.USER="user",l.ASSISTANT="assistant",l))(Ug||{});const $w=()=>{const l=Lt(null),t=Lt(!1),e=Lt(null),i=Lt(!1),s=Lt([]),n=Lt(""),a=Lt([{name:"4.1 (Flagship)",value:"gpt-4.1-2025-04-14"},{name:"4.1 Mini (Cost-efficient - Flagship)",value:"gpt-4.1-mini-2025-04-14"},{name:"4.1 Nano",value:"gpt-4.1-nano-2025-04-14"}]),o=Lt([{name:"Indonesia",value:"id"},{name:"English",value:"en"}]),h=Lt({name:"AI Assistant",prompt:`
    Kamu adalah asisten AI yang dikembangkan oleh Tim Developer IMA Nextgent CBT. Kamu sangat ahli di bidang evaluasi ujian dengan prinsip Computerized Adaptive Test.
    Kamu dapat menganalisis data, memberikan saran pengembangan metode belajar, mengevaluasi hasil ujian, pengingkatan kualitas pembelajaran, dan memberikan rekomendasi yang sesuai saat diminta oleh pengguna.
    Kamu selalu memberikan respon yang lengkap, mudah dipahami, teknis, dan ilmiah. Gunakan bahasa indonesia yang santai.
    `,temperature:.7,language:o.value[0].value,model:a.value[0].value,memory:10});let c=null;const d=H=>{c=H};let u=null;const p=H=>{u=H};let m=null;const v=H=>{m=H};let y=null;const w=H=>{y=H};let A=null;const x=H=>{A=H};let I=null;const E=H=>{I=H},C=H=>{},P=H=>{},k=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(H){const st=Math.random()*16|0;return(H==="x"?st:st&3|8).toString(16)}),_=(H,st,ct=!1)=>{const nt={id:k(),role:H,message:st.text||"",media:st.media||null,isErrorResponse:!1};s.value.push(nt),ct||S(),i.value=!0,u==null||u()},S=()=>{if(l.value&&t.value){if(s.value.length===0){y==null||y({message:"No conversations to send."});return}const H=s.value.filter(st=>st.role!=="system").filter(st=>st.isErrorResponse!==!0);if(H.length===0){y==null||y({message:"No valid conversations to send."});return}l.value.emit("chatbot:client_chat",{assistant_options:h.value,conversation:H})}},T=H=>{n.value=H},L=H=>{s.value=H},M=()=>h.value,z=H=>{h.value=H},G=()=>a.value,It=()=>o.value,B=()=>new Promise((H,st)=>{try{l.value&&(l.value.off(),l.value.disconnect()),l.value=yb(bp.socketURL,{path:bp.socketPath,auth:{token:localStorage.getItem("authToken")||""}}),l.value.on("connect",()=>{H(l.value)})}catch(ct){y==null||y({message:ct.message||"Failed to connect to the assistant."}),st(ct)}}),R=()=>l.value,ft=()=>{l.value&&(l.value.off(),l.value.disconnect(),m==null||m(),t.value=!1,l.value=null)},q=H=>{e.value=H},Mt=()=>{var H,st,ct,nt,et;(H=l.value)==null||H.on("connect",()=>{t.value=!0,c==null||c(l.value)}),(st=l.value)==null||st.on("disconnect",()=>{m==null||m(),t.value=!1}),(ct=l.value)==null||ct.on("chatbot:completion_respond",it=>{i.value=!1,Cc(()=>{if(it.error){y==null||y({message:it.message});const J=s.value.findLastIndex(Ct=>Ct.role==="assistant");s.value[J].message="Error: "+it.message,s.value[J].isErrorResponse=!0;return}const At=s.value.findLastIndex(J=>J.role==="assistant");At!==-1&&(s.value[At].message+=it.data.content,s.value[At].isErrorResponse=!1),A==null||A(it)})}),(nt=l.value)==null||nt.on("chatbot:completion_new_respond",it=>{_("assistant",{text:it.data.content,media:null},!0),i.value=!1,A==null||A(it)}),(et=l.value)==null||et.on("chatbot:completion_respond_end",it=>{if(it.error){y==null||y({message:it.message});const At=s.value.findLastIndex(J=>J.role==="assistant");s.value[At].message="Error: "+it.message,s.value[At].isErrorResponse=!0,I==null||I(it);return}})};sb(()=>i.value,H=>{H||s.value.push({id:k(),role:"assistant",message:"",media:null,isErrorResponse:!1})});const Z=()=>{l.value&&(l.value.off(),l.value.disconnect(),t.value=!1,l.value=null),c=null,u=null,m=null,y=null,s.value=[],n.value=""},X=H=>(H=O(H),H.replace(/^(#{1,6})\s+(.*)$/gm,(st,ct,nt)=>{const et=ct.length;return`<h${et} style="color:orange">${nt}</h${et}>`}).replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/_(.*?)_/g,"<i>$1</i>").replace(/~~(.*?)~~/g,"<del>$1</del>").replace(/\n/g,"<br>").replace(/!\[([^\]]+)\]\(([^)]+)\)/g,'<img src="$2" alt="$1" style="max-width:100%;height:auto;"/>').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>')),O=H=>H.replace(/```(\w+)?\n([\s\S]*?)```/g,(st,ct,nt)=>{const et=ct||"plaintext",it=nt.replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<div style="margin-top:0.5rem;padding:15px;border-radius:5px;overflow-y:auto;background:rgb(10,10,10);color:rgb(255,255,255);"><span style='color:orange;text-transform:uppercase;font-weight:bold;font-size:12px;'>${et}</span><hr><pre class="language-${et}"><code>${it}</code></pre></div>`});return If(()=>{B().then(()=>{c==null||c(l.value),t.value=!0,Mt()}).catch(H=>{y==null||y({message:H.message||"Failed to connect to the assistant."})})}),Sp(()=>{Z()}),{addConversation:_,assistantOptions:h,chatBodyContainer:e,ConversationRole:Ug,conversationContext:n,conversations:s,disconnectSocket:ft,formatResult:X,getAssistantLanguages:It,getAssistantModels:G,getAssistantOptions:M,getSocketInstance:R,isSocketConnected:t,setAssistantOptions:z,setChatBodyContainer:q,setConversations:L,setConversationContext:T,setOnAddConversationListener:p,setOnAnyErrorListener:w,setOnSocketConnectListener:d,setOnSocketDisconnectListener:v,setOnStreamingEndListener:E,setOnStreamingListener:x,setOnWabQrReadyListener:C,setOnWabReadyListener:P}},zw={key:0,class:"chatbot-window"},jw={style:{margin:"0"}},Uw={style:{margin:"0","margin-bottom":"1rem",display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"0.5rem"}},Vw={key:0,style:{color:"#fff","font-size":"11px",padding:"2px","border-radius":"100px","background-color":"green","padding-left":"10px","padding-right":"10px"}},Kw={key:1,style:{color:"#fff","font-size":"11px",padding:"2px","border-radius":"100px","background-color":"#aaa","padding-left":"10px","padding-right":"10px"}},Gw={key:0,class:"chatbot-assistant-message"},Ww={key:1,class:"chatbot-user-message"},qw=["innerHTML"],Xw={key:0,class:"chatbot-user-media"},Yw=["src"],Qw={key:1,style:{color:"#fff",position:"absolute",bottom:"5px",left:"5px"}},Jw={key:2,style:{color:"#fff",position:"absolute",bottom:"5px",left:"5px"}},Zw={style:{color:"#fff",position:"absolute",top:"5px",left:"5px","font-size":"10px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap",width:"100%"}},tA={key:2,class:"chatbot-user-assistant"},eA={key:0,style:{display:"flex",gap:"0.4rem","flex-flow":"row nowrap","align-items":"center"}},iA=["innerHTML"],sA={key:1},nA=["innerHTML"],rA={style:{"border-radius":"15px","margin-top":"1rem",display:"flex","flex-flow":"column"}},aA={key:0,style:{display:"flex","flex-flow":"row nowrap","overflow-x":"auto",width:"100%","padding-bottom":"10px",gap:"5px","scroll-behavior":"smooth"}},oA=["onClick"],lA=["src"],hA={key:1,style:{color:"#fff",position:"absolute",bottom:"5px",left:"5px"}},cA={key:2,style:{color:"#fff",position:"absolute",bottom:"5px",left:"5px"}},dA={style:{color:"#fff",position:"absolute",top:"5px",left:"5px","font-size":"10px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap",width:"100%"}},uA={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",gap:"0.5rem"}},fA=pn({__name:"ChatBot",setup(l){const t=Hw(),e=$w(),i=Lt(),s=Lt(null),n=Lt(null),a=Ip(),o=()=>{i.value=!0},h=()=>{i.value=!1},c=()=>{const w=n.value;if(w){w.style.height="auto",w.style.overflowY="hidden";const x=w.scrollHeight;x<=200?w.style.height=`${x}px`:(w.style.height="200px",w.style.overflowY="auto")}},d=Lt(),u=w=>{var x,I;const A=w.target.tagName;if(A==="BUTTON"){const E=((x=s.value)==null?void 0:x.trim())||"";if(!E||E.length==0){s.value="",w.target.focus();return}e.addConversation(e.ConversationRole.USER,{text:E,media:m.value}),s.value="",Cc(()=>{c(),p(),n.value.focus()}),console.log("!"),m.value=[]}else if(A==="TEXTAREA"){const E=((I=s.value)==null?void 0:I.trim())||"";if(!E||E.length==0){s.value="",w.target.focus();return}w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),E.length>0&&(e.addConversation(e.ConversationRole.USER,{text:E,media:m.value}),s.value="",w.target.focus()),Cc(()=>{c(),p()}),console.log("!"),m.value=[])}},p=()=>{Cc(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})},m=Lt([]);t.setOnFilePasted(w=>{m.value.push(w)});const v=()=>{e.addConversation(e.ConversationRole.SYSTEM,{text:"Selamat Datang di Chatbot Assistant. Ajukan pertanyaan Anda!"}),e.setChatBodyContainer(d),c(),e.setOnSocketConnectListener(()=>{console.log("Socket connected")}),e.setOnAnyErrorListener(w=>{a.add({severity:"error",summary:"Error",detail:w.message,life:3e3})}),e.setOnStreamingListener(w=>{p()})},y=()=>{t.setOnPasteError(w=>{a.add({severity:"error",summary:"Paste Error",detail:w.message,life:3e3})})};return If(()=>{setTimeout(()=>{var w;(w=n.value)==null||w.addEventListener("paste",A=>{t.handle(A)}),v(),y(),n.value.focus(),c()},1e3)}),Sp(()=>{var w;e.disconnectSocket(),(w=n.value)==null||w.removeEventListener("paste",A=>{t.handle(A)})}),(w,A)=>{const x=Ri("fasicon");return F(),$(Ee,null,[vt(Nd,{name:"fade"},{default:gi(()=>[i.value?(F(),$("div",zw,[K("button",{type:"button",onClick:h,class:"chatbot-dismiss"},[vt(x,{icon:"times"})]),K("h2",jw,Ie(Rt(gr).appFullName),1),K("p",Uw,[ar(Ie(Rt(e).assistantOptions.value.name)+" ",1),Rt(e).isSocketConnected.value?(F(),$("span",Vw,"Online")):(F(),$("span",Kw,"Offline"))]),K("div",{ref_key:"chatBodyContainer",ref:d,class:"chatbot-conversations-wrapper"},[(F(!0),$(Ee,null,xa(Rt(e).conversations.value,(I,E)=>(F(),$("div",{key:E,class:yi(["chatbot-conversation",[`${I.role=="user"?"chatbot-user":"chatbot-assistant"}`]])},[I.role==="system"?(F(),$("div",Gw,[vt(x,{icon:"info-circle"}),ar(" "+Ie(I.message),1)])):I.role===Rt(e).ConversationRole.USER?(F(),$("div",Ww,[K("div",{innerHTML:I.message},null,8,qw),I.media&&I.media.length>0?(F(),$("div",Xw,[(F(!0),$(Ee,null,xa(I.media,(C,P)=>(F(),$("div",{key:P,class:"chatbot-user-file"},[C.type==="image"?(F(),$("img",{key:0,src:C.data,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Yw)):C.type==="pdf"?(F(),$("span",Qw,"PDF")):C.type==="excel"?(F(),$("span",Jw,"Excel")):gt("",!0),K("span",Zw,Ie(C.name),1)]))),128))])):gt("",!0)])):I.role===Rt(e).ConversationRole.ASSISTANT?(F(),$("div",tA,[I.isErrorResponse?(F(),$("div",eA,[vt(x,{icon:"exclamation-triangle"}),A[3]||(A[3]=ar()),K("div",{innerHTML:I.message},null,8,iA)])):(F(),$("div",sA,[K("div",{innerHTML:Rt(e).formatResult(I.message)},null,8,nA)]))])):gt("",!0)],2))),128))],512),K("div",rA,[m.value.length>0?(F(),$("div",aA,[(F(!0),$(Ee,null,xa(m.value,(I,E)=>(F(),$("div",{key:E,class:"chatbot-pasted-file",onClick:C=>m.value.splice(E,1),style:{flex:"0 0 auto",width:"50px",height:"65px",position:"relative",background:"#aaa","border-radius":"5px",cursor:"pointer",overflow:"hidden"}},[I.type==="image"?(F(),$("img",{key:0,src:I.data,style:{width:"100%",height:"100%",position:"absolute",top:"0",left:"0","object-fit":"cover",border:"1px solid #ccc"}},null,8,lA)):I.type==="pdf"?(F(),$("span",hA,"PDF")):I.type==="excel"?(F(),$("span",cA,"Excel")):gt("",!0),K("span",dA,Ie(I.name),1)],8,oA))),128))])):gt("",!0),K("div",uA,[or(K("textarea",{ref_key:"promptRef",ref:n,onInput:c,onKeypress:A[0]||(A[0]=I=>u(I)),"onUpdate:modelValue":A[1]||(A[1]=I=>s.value=I),class:"chatbot-prompt",placeholder:"Masukan pesan Anda..."},null,544),[[nb,s.value]]),s.value!=null&&s.value.trim()!==""?(F(),$("button",{key:0,onClick:A[2]||(A[2]=I=>u(I)),class:"prompt-send"},[vt(x,{icon:"paper-plane"})])):gt("",!0)])])])):gt("",!0)]),_:1}),i.value?gt("",!0):(F(),$("button",{key:0,class:"chatbot-open",onClick:o},[vt(x,{icon:"robot"})]))],64)}}}),pA=rl(fA,[["__scopeId","data-v-fe9e79e5"]]),mA={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between",gap:"1rem"}},gA={style:{width:"50%",display:"flex","flex-flow":"column",gap:"0.5rem"}},bA={style:{width:"50%",display:"flex","flex-flow":"column",gap:"0.5rem"}},yA={key:0},vA={else:"",style:{width:"100%",display:"flex","flex-flow":"column"}},wA=["innerHTML"],AA=pn({__name:"LatexParser",setup(l){const t=Lt(""),e=Lt([]),i=Lt([]),s=Lt(!1),n=async()=>{e.value=[],i.value=[];const o=t.value.split(`
`).filter(h=>h.trim()!=="");if(o.length!==0)for(const h of o)try{const c=await wb().parse(h);i.value.push(c.html)}catch(c){console.error("Error parsing LaTeX:",c)}};return If(()=>{window.addEventListener("keydown",a=>{a.ctrlKey&&a.altKey&&a.key==="p"&&(s.value=!0)})}),(a,o)=>{const h=Ri("fasicon");return F(),Zt(Rt(Cp),{visible:s.value,"onUpdate:visible":o[1]||(o[1]=c=>s.value=c),header:"LaTeX Parser",modal:!0,style:{width:"70vw"},closable:!0,maximizable:!0},{default:gi(()=>[K("div",mA,[K("div",gA,[o[3]||(o[3]=K("label",null,[K("b",null,"Raw Equation")],-1)),vt(Rt(vb),{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=c=>t.value=c),style:{width:"100%"},rows:"10",class:"w-full"},null,8,["modelValue"]),vt(Rt(kp),{onClick:n,style:{width:"150px",padding:"15px"}},{default:gi(()=>[vt(h,{icon:"check"}),o[2]||(o[2]=ar(" Parse"))]),_:1})]),K("div",bA,[o[4]||(o[4]=K("label",null,[K("b",null,"Parsed")],-1)),e.value?gt("",!0):(F(),$("span",yA)),K("div",vA,[(F(!0),$(Ee,null,xa(i.value,(c,d)=>(F(),$("div",{key:d,innerHTML:c},null,8,wA))),128))])])])]),_:1},8,["visible"])}}}),_A={class:"content-wrapper"},IA=pn({__name:"BaseLayout",setup(l){const t=Bd();return(e,i)=>{const s=Ri("RouterView");return F(),$(Ee,null,[vt(Oy),vt(Wb),K("div",_A,[K("div",{class:yi(Rt(t).mTheme=="theme-light"?"content-inner":"content-inner-dark")},[vt(s)],2)]),vt(pA),vt(AA)],64)}}}),YA=rl(IA,[["__scopeId","data-v-f50fb491"]]);export{YA as default};
