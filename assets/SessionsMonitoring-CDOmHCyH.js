import{d as Me,f as Te,r as m,Q as oe,i as je,j as $e,c as d,k as l,w as f,u as r,F as S,o as u,a,p as Ae,b as v,t as p,l as C,m as Be,e as Ue,O as D,a6 as le}from"./index-D8N-YEmx.js";import{a as De}from"./index-t--hEgTQ.js";import{h as He}from"./html2canvas.esm-BfYXEYrK.js";import{s as F}from"./index-CebLASv9.js";import{s as b,a as re}from"./index-Ce1TxfxQ.js";import{h as H}from"./moment-C5S46NFB.js";import{i as Pe}from"./index-Bb6yjXMn.js";import{j as W}from"./jsonToMarkdown-C5mXda7r.js";import{s as K}from"./index-VDt4N7-Y.js";import{s as Q}from"./index-B9CC8ejM.js";import{e as ie}from"./index-CmCgfugq.js";import{C as Ve}from"./ContentWrapper-Bxly0__Q.js";import{t as G}from"./testModel-BUpJR1Hb.js";import{l as ze}from"./index-BLRFddlS.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D46HF0HJ.js";import"./index-ChsAChPW.js";import"./index-B6p2Nsl_.js";import"./index-DWqkmtiQ.js";import"./index-BW2jOI2X.js";import"./index-0418-DUv.js";import"./index-PIPAwceg.js";const Ne={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Re={key:0},Ye={key:1},Je={key:0},Ee={key:1},Oe={key:1,style:{"margin-top":"1rem",display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},Fe={style:{display:"flex","flex-flow":"row wrap","align-items":"center",gap:"0.5rem","justify-content":"center"}},We={style:{padding:"20px"}},Ke=["src"],Qe={style:{display:"flex","flex-flow":"column"}},Ge={style:{margin:"0",padding:"0"}},Ze={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Xe={style:{display:"flex","flex-flow":"column","justify-content":"center","align-items":"center"}},et={style:{"font-size":"1.5rem","font-weight":"bold"}},tt={key:0},at={class:"mtable",style:{"margin-top":"1rem"}},st={style:{width:"10px","text-align":"center"}},nt={key:0,style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},ot={key:0,"data-is-correct":"true"},lt={style:{color:"green"}},rt=["innerHTML"],it={key:1,"data-is-correct":"false"},ut={style:{color:"red"}},dt=["innerHTML"],pt={key:2},ct=["onClick"],mt={key:1},vt={style:{display:"flex","flex-flow":"column",width:"100%","margin-top":"1rem"}},ft={style:{display:"flex","flex-flow":"column","justify-content":"space-between",width:"100%","align-items":"center"}},yt={style:{color:"green","font-weight":"bold"}},gt={style:{color:"red","font-weight":"bold"}},ht={style:{display:"flex","flex-flow":"column","word-wrap":"break-word"}},bt=["innerHTML"],wt={style:{display:"flex","flex-flow":"column",gap:".3rem"}},_t=["innerHTML"],kt={key:0},xt={key:1},Ct=["innerHTML"],qt={key:2,style:{color:"red"}},St=["innerHTML"],Lt={style:{"font-size":"12px"}},Mt=["innerHTML"],Tt=Me({__name:"SessionsMonitoring",setup(jt){const q=Te(),y=m(null),Z={socketURL:"https://api.imanextgencbt.id",socketPath:"/socket.io"},L=m(null),P=m(null),M=m({title:{text:"Ikhtisar",left:"center",top:10,textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{},legend:{data:["Jawaban Benar","Jawaban Salah"],top:40,left:"center"},radar:{center:["50%","55%"],radius:"55%",indicator:[],shape:"circle",name:{show:!0,textStyle:{fontSize:12,color:"#333",overflow:"break",lineHeight:16}},nameGap:10,splitNumber:5,axisLine:{lineStyle:{color:"#aaa"}},splitLine:{lineStyle:{color:"#aaa"}}},series:[{name:"Jawaban Benar",type:"radar",data:[]}]}),T=m([]),V=m([]),j=m([]),_=m(null),X=m([]),$=m([]),k=m(null),ue=()=>new Promise((o,e)=>{setTimeout(()=>{if(L.value)try{P.value=Pe(L.value),P.value.setOption(M.value),console.log(L.value),o(!0)}catch(s){e(s)}},1e3)}),de=()=>{pe(),G().getSessions().then(o=>{const e=o.map(s=>({id:s._id,name:s.name,instances:s.instances,questions:s.questions,isStarted:s.isStarted}));V.value=e,j.value=e.map(s=>({label:s.name,value:s.id})),_.value=j.value[0].value}).catch(o=>{console.error(o)})},pe=()=>{V.value=[],j.value=[],_.value=null,X.value=[],$.value=[],k.value=null};oe(()=>_.value,()=>{var e;const o=((e=V.value.find(s=>s.id===_.value))==null?void 0:e.instances)||[];X.value=o,$.value=o.map(s=>({label:s.name,value:s._id})),k.value=$.value[0].value}),oe(()=>k.value,()=>{ce()});const ce=()=>{const o={id_test:_.value,id_instance:k.value};G().getUserSessions(o).then(e=>{T.value=e}).catch(e=>{T.value=[]})},z=m(!1),i=m({}),A=m({}),I=m([]),w=m([]),me=async o=>{z.value=!0,i.value=o,A.value.question_categories=o.question.categories,A.value.question_items=o.question.payload;const e=o.question.payload.reduce((s,t)=>t.questions.length>s.questions.length?t:s).questions;I.value=e,console.log(o,i.value,I.value),w.value=[];for(let s=0;s<i.value.question.payload.length;s++){const t=i.value.question.payload[s];t.questions.length>0&&w.value.push({name:t.name,total:t.questions.length,correct:t.questions.filter(n=>n.result.isCorrect).length,incorrect:t.questions.filter(n=>n.result.answer!==null&&!n.result.isCorrect).length,not_taken:t.questions.filter(n=>n.result.answer===null&&n.result.isCorrect===!1).length})}ue().then(()=>{const s=Math.max(...w.value.map(t=>t.correct||0));M.value.radar.indicator=w.value.map(t=>({name:t.name,max:s>0?s:1})),M.value.series=[{name:"Jawaban Benar",type:"radar",data:[{value:w.value.map(t=>t.correct),name:"Jawaban Benar"}],areaStyle:{opacity:.1}}],P.value.setOption(M.value)}).catch(s=>{console.error(s)})},N=m(!1),g=m({}),ve=o=>{g.value.user_answer=o,fe(o.id_question)},fe=o=>{const e={id_question:o};G().getSoalData(e).then(s=>{g.value.soal=s,N.value=!0}).catch(s=>{console.error(s),q.add({severity:"error",summary:"Error",detail:s,life:3e3})})},R=m(!1),B=m(""),ye=()=>{var c;B.value="";const o=W(w.value),e=W(i.value.participant_data.profile),s=ge(".mtable"),t=W(s);let n=`### Detail Peserta (Jangan sebut informasi tidak perlu):
${e}

`;n+=`### Hasil Ujian. Terdapat level soal. Misal C3, C4, C5, dst, sesuai prinsip Computerized Adaptive Test: 
${t}

`,n+=`### Skor Insight:
${o}

`;const h={from:"sessions-monitoring",prompt:`
    Analisis dokumen hasil ujian peserta berikut ini. Cukup berikan hasil analisisnya saja, jangan tawarkan pertanyaan atau penjelasan lebih lanjut.
    Fokus pada analisis hasil ujian peserta.
    Kecualikan dari analisis untuk data soal yang tidak dijawab karena tidak dibutuhkan pada Computerized Adaptive Test, tidak menjawab artinya peserta tidak menguasai level tersebut atau karena sedang mengerjakan soal di level yang lebih tinggi.
    Analisis pola jawaban peserta: Letak benar dan salah, dan berikan insight tentang pola tersebut.
    Berikan kesimpulan estimasi kemampuan peserta dalam persentase.
    Buat kedalam format yang ramah untuk ditampilkan ke dokumen PDF. Gunakan heading dan poin-poin
    `,payload:n};(c=y.value)==null||c.emit("socket-analyzer:send-data",h),R.value=!0};function ge(o){const e=document.querySelector(o);if(!e)throw new Error("Table gak ketemu broh, cek selector-nya.");const t=Array.from(e.querySelectorAll("thead th")).slice(1).map(c=>{var x;return((x=c.textContent)==null?void 0:x.trim())||""}),n=[];return Array.from(e.querySelectorAll("tbody tr")).forEach(c=>{var ee,te;const x=Array.from(c.querySelectorAll("td")),Ce=((te=(ee=x[0])==null?void 0:ee.textContent)==null?void 0:te.trim())||"",qe=parseInt(Ce,10)||0,Se=t.map((ae,Le)=>{var se,ne;const Y=x[Le+1];if(!Y)return{categoryName:ae,answer:null,isCorrect:!1};let J="-",E=!1;const O=Y.querySelector("span[data-is-correct]");if(O)E=O.getAttribute("data-is-correct")==="true",J=((se=O.textContent)==null?void 0:se.trim())||null;else{const U=((ne=Y.textContent)==null?void 0:ne.trim())||"";U&&U!=="-"&&(J=U,E=!1)}return{categoryName:ae,answer:J,isCorrect:E}});n.push({no:qe,perCategory:Se})}),{rows:n}}const he=o=>(o=be(o),o.replace(/^(#{1,6})\s+(.*)$/gm,(e,s,t)=>{const n=s.length;return`<h${n} style="color:orange">${t}</h${n}>`}).replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/_(.*?)_/g,"<i>$1</i>").replace(/~~(.*?)~~/g,"<del>$1</del>").replace(/\n/g,"<br>").replace(/!\[([^\]]+)\]\(([^)]+)\)/g,'<img src="$2" alt="$1" style="max-width:100%;height:auto;"/>').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>')),be=o=>o.replace(/```(\w+)?\n([\s\S]*?)```/g,(e,s,t)=>{const n=s||"plaintext",h=t.replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<div style="margin-top:0.5rem;padding:15px;border-radius:5px;overflow-y:auto;background:rgb(10,10,10);color:rgb(255,255,255);"><span style='color:orange;text-transform:uppercase;font-weight:bold;font-size:12px;'>${n}</span><hr><pre class="language-${n}"><code>${h}</code></pre></div>`}),we=()=>{y.value&&(y.value.off(),y.value.disconnect()),y.value=ze(`${Z.socketURL}/analyzer`,{path:Z.socketPath}),y.value.on("connect",()=>{console.log("Connected to socket: ANALYZER NS"),_e()})},_e=()=>{var o,e;(o=y.value)==null||o.on("socket-analyzer:on-response",s=>{B.value+=s.data.content}),(e=y.value)==null||e.on("socket-analyzer:on-response-end",()=>{console.log("Response ended")})},ke=o=>new Promise((e,s)=>{const t=document.getElementById(o);if(!t){q.add({severity:"error",summary:"Error",detail:"Area not found",life:3e3});return}He(t,{scale:6}).then(n=>{e(n.toDataURL("image/jpeg"))}).catch(n=>{s(n),q.add({severity:"error",summary:"Error",detail:n.message,life:3e3})})}),xe=async()=>{let o={score_insight:w.value,ai_response:B.value,participant:i.value.participant_data.profile,radar_chart:await ke("captureArea").then(e=>e)};De.post("https://pdf.imanextgencbt.id/pdf/individual/generate",o,{headers:{"Content-Type":"application/json"}}).then(e=>{const s=e.data.data,t=new Blob([Uint8Array.from(atob(s),c=>c.charCodeAt(0))],{type:"application/pdf"}),n=URL.createObjectURL(t),h=document.createElement("a");h.href=n,h.download=`Laporan_Peserta_${H().format("YYYYMMDD_HHmmss")}.pdf`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(n),q.add({severity:"success",summary:"Berhasil",detail:"Laporan PDF berhasil diunduh.",life:3e3})}).catch(e=>{q.add({severity:"error",summary:"Oops",detail:e,life:3e3})})};return je(()=>{de(),we()}),$e(()=>{y.value&&(y.value.off(),y.value.disconnect(),y.value=null)}),(o,e)=>{const s=Be("fasicon");return u(),d(S,null,[l(Ve,{contentTitle:"Monitoring Ujian"},{default:f(()=>[a("div",Ne,[l(r(ie),{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),options:j.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Sesi Ujian",class:"w-full mb-4"},null,8,["modelValue","options"]),l(r(ie),{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Instansi",class:"w-full mb-4"},null,8,["modelValue","options"])]),T.value.length>0?(u(),Ae(r(re),{key:0,style:{"margin-top":"1rem"},value:T.value,paginator:!0,rows:20,rowsPerPageOptions:[10,20,50],dataKey:"_id"},{default:f(()=>[l(r(b),{header:"Nama"},{body:f(({data:t})=>[v(p(t.participant_data.meta.name),1)]),_:1}),l(r(b),{header:"Kelas"},{body:f(({data:t})=>[v(p(t.participant_data.meta.kelas),1)]),_:1}),l(r(b),{header:"Jurusan"},{body:f(({data:t})=>[v(p(t.participant_data.meta.jurusan),1)]),_:1}),l(r(b),{header:"Mulai"},{body:f(({data:t})=>[v(p(r(H)(t.start).format("DD MMM YYYY -- hh:mm")+" WIB"),1)]),_:1}),l(r(b),{header:"Progres"},{body:f(({data:t})=>[t.test_status==="in_progress"?(u(),d("span",Re,"Berlangsung")):C("",!0),t.test_status==="completed"?(u(),d("span",Ye,"Selesai")):C("",!0)]),_:1}),l(r(b),{header:"Soal"},{body:f(({data:t})=>[t.test_status!=="completed"?(u(),d("span",Je,p(t.state.current_question)+" / "+p(t.question_done.length),1)):(u(),d("span",Ee,[l(s,{icon:"check-circle"})]))]),_:1}),l(r(b),{header:"Aksi"},{body:f(({data:t})=>[l(r(F),{onClick:n=>me(t)},{default:f(()=>e[5]||(e[5]=[v("Detail")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value"])):(u(),d("div",Oe,e[6]||(e[6]=[a("img",{style:{width:"250px",height:"250px","object-fit":"contain"},src:"https://assets-v2.lottiefiles.com/a/f0470cd6-117f-11ee-a4ed-1b2d7fb6aaaf/i83iUdPISg.gif"},null,-1),a("h3",{style:{"text-align":"center",margin:"0"}},"Belum ada yang tersedia data untuk ditampilkan",-1)])))]),_:1}),l(r(K),{visible:z.value,"onUpdate:visible":e[2]||(e[2]=t=>z.value=t),modal:!0,header:"Detail Sesi Ujian",style:{width:"90vw"}},{default:f(()=>[a("div",Fe,[a("div",We,[a("img",{src:`${r(Ue).baseUserContent}${i.value.participant_data.profile.avatar}`,alt:"Participant Photo",style:{width:"200px",height:"200px","border-radius":"50%","object-fit":"cover",border:"8px solid #eee","box-shadow":"5px 5px 20px rgba(0,0,0,0.5)"}},null,8,Ke)]),a("div",Qe,[a("h1",Ge,p(i.value.participant_data.profile.name),1),a("div",Ze,[a("span",null,[e[7]||(e[7]=v("Kelas: ")),a("b",null,p(i.value.participant_data.meta.kelas),1)]),e[9]||(e[9]=v("  ·  ")),a("span",null,[e[8]||(e[8]=v("Jurusan: ")),a("b",null,p(i.value.participant_data.meta.jurusan),1)])]),a("span",null,[e[10]||(e[10]=v("Dimulai: ")),a("b",null,p(r(H)(i.value.start).format("DD MMM YYYY -- hh:mm")+" WIB"),1)]),a("span",null,[e[11]||(e[11]=v("Berakhir: ")),a("b",null,p(i.value.test_status==="completed"?"Selesai":r(H)(i.value.end).fromNow()),1)]),l(r(F),{onClick:ye,style:{width:"120px","margin-top":"1rem","font-size":"13px"}},{default:f(()=>e[12]||(e[12]=[v("Analisis Hasil")])),_:1})]),l(r(Q)),a("div",Xe,[a("span",et,p(i.value.test_status==="in_progress"?"Asesmen Sedang Berlangsung":"Asesmen Selesai"),1),i.value.test_status==="in_progress"?(u(),d("span",tt,[e[13]||(e[13]=v("Soal yang dikerjakan: ")),a("b",null,p(i.value.state.current_question)+" / "+p(i.value.question_done.length),1)])):C("",!0)]),a("table",at,[a("thead",null,[a("tr",null,[e[14]||(e[14]=a("th",{style:{"text-align":"center"}},"No",-1)),(u(!0),d(S,null,D(A.value.question_categories,(t,n)=>(u(),d("th",{style:{"text-align":"left"},key:n},p(t.name),1))),128))])]),a("tbody",null,[(u(!0),d(S,null,D(I.value,(t,n)=>(u(),d("tr",{key:n},[a("td",st,p(n+1),1),(u(!0),d(S,null,D(A.value.question_categories,(h,c)=>(u(),d("td",{style:{width:"50%"},key:c},[a("div",null,[i.value.question.payload[c].questions[n]!==void 0?(u(),d("div",nt,[i.value.question.payload[c].questions[n].result.answer!=null&&i.value.question.payload[c].questions[n].result.isCorrect?(u(),d("span",ot,[a("span",lt,[l(s,{icon:"check-circle"}),e[15]||(e[15]=v()),a("span",{innerHTML:i.value.question.payload[c].questions[n].result.answer},null,8,rt)])])):C("",!0),i.value.question.payload[c].questions[n].result.answer!=null&&!i.value.question.payload[c].questions[n].result.isCorrect?(u(),d("span",it,[a("span",ut,[l(s,{icon:"times-circle"}),e[16]||(e[16]=v()),a("span",{innerHTML:i.value.question.payload[c].questions[n].result.answer},null,8,dt)])])):C("",!0),!i.value.question.payload[c].questions[n].result.answer&&!i.value.question.payload[c].questions[n].result.isCorrect?(u(),d("span",pt,"-")):C("",!0),a("button",{onClick:x=>ve(i.value.question.payload[c].questions[n]),style:{width:"30px",height:"30px",background:"transparent",border:"1px solid #ccc",color:"#888",cursor:"pointer","border-radius":"5px"}},[l(s,{icon:"search"})],8,ct)])):(u(),d("div",mt,e[17]||(e[17]=[a("span",{style:{"font-weight":"bold",color:"#aaa"}},"N/A",-1)])))])]))),128))]))),128))])]),a("div",vt,[e[19]||(e[19]=a("h2",{style:{margin:"0",padding:"0"}},"Test Insight:",-1)),a("div",ft,[l(r(re),{value:w.value,dataKey:"name",style:{width:"100%","margin-top":"1rem"}},{default:f(()=>[l(r(b),{field:"name",header:"Level"}),l(r(b),{field:"correct",header:"Benar"}),l(r(b),{field:"incorrect",header:"Salah"}),l(r(b),{header:"%"},{body:f(({data:t})=>[a("span",yt,p((t.correct/t.total*100).toFixed(2))+"%",1),e[18]||(e[18]=v("    ·    ")),a("span",gt,p((t.incorrect/t.total*100).toFixed(2))+"%",1)]),_:1})]),_:1},8,["value"]),a("div",{id:"captureArea",ref_key:"radarContainer",ref:L,style:{width:"400px",height:"400px","margin-top":"1.5rem"}},null,512)])])])]),_:1},8,["visible"]),l(r(K),{closable:!0,visible:N.value,"onUpdate:visible":e[3]||(e[3]=t=>N.value=t),modal:!0,header:"Soal",style:{width:"40rem"}},{default:f(()=>[a("div",ht,[a("div",{innerHTML:g.value.soal.soal,style:{"margin-bottom":"1rem"}},null,8,bt),a("div",wt,[(u(!0),d(S,null,D(g.value.soal.answers,(t,n)=>(u(),d("div",{key:n,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem","box-shadow":"5px 5px 20px rgba(0,0,0,0.2)",padding:"10px","border-radius":"10px"}},[a("span",{style:le([{background:`${t.is_correct?"green":"#555"}`},{overflow:"clip","font-size":"13px",width:"30px",height:"30px",display:"flex","justify-content":"center","align-items":"center","font-weight":"bold","border-radius":"50%",color:"#fff"}])},p(String.fromCharCode(65+n)),5),a("span",{style:le([{color:`${t.is_correct?"green":"#555"}`},{"margin-left":"0.5rem",width:"80%","font-size":"13px"}]),innerHTML:t.value},null,12,_t)]))),128))]),l(r(Q)),e[24]||(e[24]=v(" Jawaban Peserta: ")),g.value.user_answer.result.answer==null?(u(),d("span",kt,e[20]||(e[20]=[a("b",null,"Tidak/Belum Menjawab",-1)]))):g.value.user_answer.result.isCorrect?(u(),d("span",xt,[a("b",{style:{color:"green"},innerHTML:g.value.user_answer.result.answer},null,8,Ct)])):(u(),d("span",qt,[a("b",{innerHTML:g.value.user_answer.result.answer},null,8,St)])),l(r(Q)),a("span",Lt,[a("code",null,[e[21]||(e[21]=v("QID: ")),a("b",null,p(g.value.soal._id),1),e[22]||(e[22]=v(" | Level: ")),a("b",null,p(g.value.user_answer.level),1),e[23]||(e[23]=v(" | Time Taken: ")),a("b",null,p(g.value.user_answer.result.time_taken?g.value.user_answer.result.time_taken+" seconds":"not recorded"),1)])])])]),_:1},8,["visible"]),l(r(K),{closable:!0,visible:R.value,"onUpdate:visible":e[4]||(e[4]=t=>R.value=t),modal:!0,header:"Hasil Analisis AI",style:{width:"40rem"}},{default:f(()=>[a("p",{innerHTML:he(B.value),style:{"white-space":"pre-wrap","word-wrap":"break-word"}},null,8,Mt),l(r(F),{onClick:xe,style:{"margin-top":"1rem"}},{default:f(()=>e[25]||(e[25]=[v("Download Laporan")])),_:1})]),_:1},8,["visible"])],64)}}}),Xt=Ie(Tt,[["__scopeId","data-v-bb328ca2"]]);export{Xt as default};
